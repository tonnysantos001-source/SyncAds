import{r as i,b as W,u as Y,j as e,M as v,B as h,I as y,S as ee,d as F,e as G,f as L,h as q,n as ae}from"./index-BlhzBD62.js";import{T as se,a as te,b as re,c,d as ie,e as u}from"./table-RTubUygn.js";import{D as le,a as oe,b as ne,c as de,d as ce,f as ue}from"./dialog-C4bJnssC.js";import{L as n}from"./label-D4RezkQY.js";import{S as A,a as E,b as I,c as S,d as N}from"./select-BLZMSr4v.js";import{T as xe}from"./textarea-CJxzKD9H.js";import{m as w}from"./marketingApi-DjYFJ7Ho.js";import{p as me}from"./productsApi-CuxzMtdt.js";import{S as D}from"./skeleton-DsmkW4_t.js";import{P as z}from"./plus-N3OQEaO_.js";import{A as R}from"./arrow-up-right-CsNHsRNm.js";import{Z as he}from"./zap-CPuOAH6g.js";import{T as ge}from"./target-5zf_M4uJ.js";import{D as pe}from"./dollar-sign-BxU5VKRT.js";import{S as je}from"./square-pen-uZpLbmaN.js";import{T as ve}from"./trash-2-BwOz_mdi.js";import"./x-CJOvJHTG.js";import"./index-B1RRfdq-.js";const C=({title:l,value:T,icon:g,color:p,delay:b=0,subtitle:x})=>e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:b},children:e.jsxs(F,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${p} opacity-10 rounded-full blur-3xl`}),e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:l}),e.jsx("div",{className:`p-2 rounded-lg ${p} bg-opacity-10`,children:e.jsx(g,{className:`h-5 w-5 ${p.replace("bg-","text-")}`})})]}),e.jsxs(q,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:T}),x&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:x})]})]})}),Fe=()=>{const[l,T]=i.useState([]),[g,p]=i.useState([]),[b,x]=i.useState([]),[O,$]=i.useState(!0),[d,B]=i.useState(""),[H,j]=i.useState(!1),[f,U]=i.useState(null),{toast:m}=W(),o=Y(a=>a.user),[s,r]=i.useState({name:"",triggerProductId:"",upsellProductId:"",title:"",description:"",discountType:"PERCENTAGE",discountValue:0,isActive:!0});i.useEffect(()=>{P()},[]),i.useEffect(()=>{M()},[d,l]);const P=async()=>{try{if(!(o!=null&&o.organizationId))return;const[a,t]=await Promise.all([w.upsells.getAll(o.organizationId),me.list()]);T(a),p(t),x(a)}catch(a){m({title:"Erro",description:a.message,variant:"destructive"})}finally{$(!1)}},M=()=>{if(!d){x(l);return}const a=l.filter(t=>t.name.toLowerCase().includes(d.toLowerCase())||t.title.toLowerCase().includes(d.toLowerCase()));x(a)},Z=async a=>{a.preventDefault();try{if(!(o!=null&&o.organizationId))return;f?(await w.upsells.update(f.id,s),m({title:"Upsell atualizado!"})):(await w.upsells.create({...s,organizationId:o.organizationId}),m({title:"Upsell criado!"})),j(!1),k(),P()}catch(t){m({title:"Erro",description:t.message,variant:"destructive"})}},X=async a=>{if(confirm("Tem certeza que deseja deletar este upsell?"))try{await w.upsells.delete(a),m({title:"Upsell deletado"}),P()}catch(t){m({title:"Erro",description:t.message,variant:"destructive"})}},_=a=>{U(a),r({name:a.name,triggerProductId:a.triggerProductId,upsellProductId:a.upsellProductId,title:a.title,description:a.description||"",discountType:a.discountType||"PERCENTAGE",discountValue:a.discountValue||0,isActive:a.isActive}),j(!0)},k=()=>{U(null),r({name:"",triggerProductId:"",upsellProductId:"",title:"",description:"",discountType:"PERCENTAGE",discountValue:0,isActive:!0})},J=l.filter(a=>a.isActive).length,K=l.length>0?"15.8%":"-",V=a=>{const t=g.find(Q=>Q.id===a);return(t==null?void 0:t.name)||"Produto não encontrado"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 bg-clip-text text-transparent",children:"Upsell"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mt-2",children:"Ofertas complementares após a compra"})]}),e.jsxs(le,{open:H,onOpenChange:j,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(h,{onClick:k,size:"lg",className:"shadow-lg hover:shadow-xl transition-all",children:[e.jsx(z,{className:"mr-2 h-5 w-5"}),"Criar Upsell"]})}),e.jsxs(ne,{className:"max-w-2xl",children:[e.jsx(de,{children:e.jsx(ce,{children:f?"Editar Upsell":"Novo Upsell"})}),e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{children:"Nome Interno *"}),e.jsx(y,{value:s.name,onChange:a=>r({...s,name:a.target.value}),placeholder:"Ex: Upgrade Premium",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Produto Gatilho *"}),e.jsxs(A,{value:s.triggerProductId,onValueChange:a=>r({...s,triggerProductId:a}),required:!0,children:[e.jsx(E,{children:e.jsx(I,{placeholder:"Produto que ativa o upsell"})}),e.jsx(S,{children:g.map(a=>e.jsx(N,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Produto Upsell *"}),e.jsxs(A,{value:s.upsellProductId,onValueChange:a=>r({...s,upsellProductId:a}),required:!0,children:[e.jsx(E,{children:e.jsx(I,{placeholder:"Produto a ser oferecido"})}),e.jsx(S,{children:g.map(a=>e.jsxs(N,{value:a.id,children:[a.name," - R$ ",a.price.toFixed(2)]},a.id))})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{children:"Título da Oferta *"}),e.jsx(y,{value:s.title,onChange:a=>r({...s,title:a.target.value}),placeholder:"Ex: Aproveite este upgrade especial!",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{children:"Descrição"}),e.jsx(xe,{value:s.description,onChange:a=>r({...s,description:a.target.value}),placeholder:"Descreva os benefícios...",rows:3})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Tipo de Desconto"}),e.jsxs(A,{value:s.discountType,onValueChange:a=>r({...s,discountType:a}),children:[e.jsx(E,{children:e.jsx(I,{})}),e.jsxs(S,{children:[e.jsx(N,{value:"PERCENTAGE",children:"Porcentagem"}),e.jsx(N,{value:"FIXED_AMOUNT",children:"Valor Fixo"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Valor do Desconto"}),e.jsx(y,{type:"number",step:"0.01",value:s.discountValue,onChange:a=>r({...s,discountValue:parseFloat(a.target.value)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.isActive,onChange:a=>r({...s,isActive:a.target.checked}),className:"rounded"}),e.jsx(n,{children:"Ativo"})]})]}),e.jsxs(ue,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),e.jsx(h,{type:"submit",children:f?"Atualizar":"Criar"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-4",children:[e.jsx(C,{title:"Total de Upsells",value:l.length,icon:R,color:"bg-purple-500",delay:.1,subtitle:"Ofertas criadas"}),e.jsx(C,{title:"Upsells Ativos",value:J,icon:he,color:"bg-green-500",delay:.2,subtitle:"Atualmente em uso"}),e.jsx(C,{title:"Taxa de Conversão",value:K,icon:ge,color:"bg-blue-500",delay:.3,subtitle:"Média de aceitação"}),e.jsx(C,{title:"Receita Extra",value:"-",icon:pe,color:"bg-pink-500",delay:.4,subtitle:"Gerada por upsells"})]}),e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.5},className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(y,{placeholder:"Buscar upsells...",value:d,onChange:a=>B(a.target.value),className:"pl-9 border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg"})]}),e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:e.jsxs(F,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsx(G,{children:e.jsx(L,{className:"text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:"Lista de Upsells"})}),e.jsx(q,{children:O?e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{className:"h-12 w-full"}),e.jsx(D,{className:"h-12 w-full"}),e.jsx(D,{className:"h-12 w-full"})]}):b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 mb-4",children:e.jsx(R,{className:"h-12 w-12 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum upsell encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-md",children:d?"Tente ajustar sua busca":"Comece criando seu primeiro upsell e maximize suas vendas"}),!d&&e.jsxs(h,{onClick:()=>{k(),j(!0)},size:"lg",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Criar Primeiro Upsell"]})]}):e.jsx("div",{className:"rounded-md border border-gray-200 dark:border-gray-800",children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(re,{className:"hover:bg-transparent",children:[e.jsx(c,{children:"Nome"}),e.jsx(c,{children:"Produto Gatilho"}),e.jsx(c,{children:"Produto Upsell"}),e.jsx(c,{children:"Título"}),e.jsx(c,{children:"Desconto"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Ações"})]})}),e.jsx(ie,{children:b.map((a,t)=>e.jsxs(v.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:t*.05},className:"hover:bg-gray-50/50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx(u,{className:"font-medium",children:a.name}),e.jsx(u,{className:"text-sm text-gray-600 dark:text-gray-400",children:V(a.triggerProductId)}),e.jsx(u,{className:"text-sm text-gray-600 dark:text-gray-400",children:V(a.upsellProductId)}),e.jsx(u,{children:a.title}),e.jsx(u,{children:a.discountValue?a.discountType==="PERCENTAGE"?`${a.discountValue}%`:`R$ ${a.discountValue.toFixed(2)}`:"-"}),e.jsx(u,{children:e.jsx(ae,{variant:a.isActive?"default":"secondary",className:a.isActive?"bg-green-500 hover:bg-green-600":"",children:a.isActive?"Ativo":"Inativo"})}),e.jsx(u,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>_(a),className:"hover:bg-blue-50 hover:text-blue-600 dark:hover:bg-blue-950",children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>X(a.id),className:"hover:bg-red-50 hover:text-red-600 dark:hover:bg-red-950",children:e.jsx(ve,{className:"h-4 w-4"})})]})})]},a.id))})]})})})]})})]})};export{Fe as default};
