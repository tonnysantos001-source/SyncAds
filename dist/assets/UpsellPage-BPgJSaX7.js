import{j as e}from"./vendor-ui-D3JNL6pE.js";import{r as s}from"./vendor-react-X41Bjl18.js";import{g as a,f as t,B as r,I as i,C as l,a as d,b as o,c as n,e as c}from"./index-CCMizExq.js";import{T as u,a as x,b as m,c as h,d as p,e as j}from"./table-BcS_hPiv.js";import{D as g,e as v,a as y,b,c as f,f as N}from"./dialog-CFUZhIQN.js";import{L as w}from"./label-SrtbuFzQ.js";import{S as k,a as C,b as P,c as A,d as E}from"./select-am1m2IAu.js";import{T as I}from"./textarea-B88jRDtV.js";import{m as T}from"./marketingApi-BRWxa8We.js";import{p as U}from"./productsApi-CQZ9QDZx.js";import{S as V}from"./skeleton-5vzZg5qu.js";import{m as z}from"./vendor-animation-DtB50Lbk.js";import{aO as S,y as D,Z as G,aK as R,D as q,S as $,Q as L,Y as O}from"./vendor-icons-C9d2sOc_.js";import"./vendor-supabase-HUq0BeMy.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-DqG_mm-v.js";const F=({title:s,value:a,icon:t,color:r,delay:i=0,subtitle:c})=>e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:i},children:e.jsxs(l,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${r} opacity-10 rounded-full blur-3xl`}),e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:s}),e.jsx("div",{className:`p-2 rounded-lg ${r} bg-opacity-10`,children:e.jsx(t,{className:`h-5 w-5 ${r.replace("bg-","text-")}`})})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:a}),c&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:c})]})]})}),B=()=>{const[B,M]=s.useState([]),[K,Q]=s.useState([]),[X,Y]=s.useState([]),[Z,_]=s.useState(!0),[H,J]=s.useState(""),[W,ee]=s.useState(!1),[se,ae]=s.useState(null),{toast:te}=a(),re=t(e=>e.user),[ie,le]=s.useState({name:"",triggerProductId:"",upsellProductId:"",title:"",description:"",discountType:"PERCENTAGE",discountValue:0,isActive:!0});s.useEffect(()=>{de()},[]),s.useEffect(()=>{oe()},[H,B]);const de=async()=>{try{if(!re?.organizationId)return;const[e,s]=await Promise.all([T.upsells.getAll(re.organizationId),U.list()]);M(e),Q(s),Y(e)}catch(e){te({title:"Erro",description:e.message,variant:"destructive"})}finally{_(!1)}},oe=()=>{if(!H)return void Y(B);const e=B.filter(e=>e.name.toLowerCase().includes(H.toLowerCase())||e.title.toLowerCase().includes(H.toLowerCase()));Y(e)},ne=()=>{ae(null),le({name:"",triggerProductId:"",upsellProductId:"",title:"",description:"",discountType:"PERCENTAGE",discountValue:0,isActive:!0})},ce=B.filter(e=>e.isActive).length,ue=B.length>0?"15.8%":"-",xe=e=>{const s=K.find(s=>s.id===e);return s?.name||"Produto não encontrado"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(z.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 bg-clip-text text-transparent",children:"Upsell"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mt-2",children:"Ofertas complementares após a compra"})]}),e.jsxs(g,{open:W,onOpenChange:ee,children:[e.jsx(v,{asChild:!0,children:e.jsxs(r,{onClick:ne,size:"lg",className:"shadow-lg hover:shadow-xl transition-all",children:[e.jsx(S,{className:"mr-2 h-5 w-5"}),"Criar Upsell"]})}),e.jsxs(y,{className:"max-w-2xl",children:[e.jsx(b,{children:e.jsx(f,{children:se?"Editar Upsell":"Novo Upsell"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{if(!re?.organizationId)return;se?(await T.upsells.update(se.id,ie),te({title:"Upsell atualizado!"})):(await T.upsells.create({...ie,organizationId:re.organizationId}),te({title:"Upsell criado!"})),ee(!1),ne(),de()}catch(s){te({title:"Erro",description:s.message,variant:"destructive"})}},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(w,{children:"Nome Interno *"}),e.jsx(i,{value:ie.name,onChange:e=>le({...ie,name:e.target.value}),placeholder:"Ex: Upgrade Premium",required:!0})]}),e.jsxs("div",{children:[e.jsx(w,{children:"Produto Gatilho *"}),e.jsxs(k,{value:ie.triggerProductId,onValueChange:e=>le({...ie,triggerProductId:e}),required:!0,children:[e.jsx(C,{children:e.jsx(P,{placeholder:"Produto que ativa o upsell"})}),e.jsx(A,{children:K.map(s=>e.jsx(E,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(w,{children:"Produto Upsell *"}),e.jsxs(k,{value:ie.upsellProductId,onValueChange:e=>le({...ie,upsellProductId:e}),required:!0,children:[e.jsx(C,{children:e.jsx(P,{placeholder:"Produto a ser oferecido"})}),e.jsx(A,{children:K.map(s=>e.jsxs(E,{value:s.id,children:[s.name," - R$ ",s.price.toFixed(2)]},s.id))})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(w,{children:"Título da Oferta *"}),e.jsx(i,{value:ie.title,onChange:e=>le({...ie,title:e.target.value}),placeholder:"Ex: Aproveite este upgrade especial!",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(w,{children:"Descrição"}),e.jsx(I,{value:ie.description,onChange:e=>le({...ie,description:e.target.value}),placeholder:"Descreva os benefícios...",rows:3})]}),e.jsxs("div",{children:[e.jsx(w,{children:"Tipo de Desconto"}),e.jsxs(k,{value:ie.discountType,onValueChange:e=>le({...ie,discountType:e}),children:[e.jsx(C,{children:e.jsx(P,{})}),e.jsxs(A,{children:[e.jsx(E,{value:"PERCENTAGE",children:"Porcentagem"}),e.jsx(E,{value:"FIXED_AMOUNT",children:"Valor Fixo"})]})]})]}),e.jsxs("div",{children:[e.jsx(w,{children:"Valor do Desconto"}),e.jsx(i,{type:"number",step:"0.01",value:ie.discountValue,onChange:e=>le({...ie,discountValue:parseFloat(e.target.value)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ie.isActive,onChange:e=>le({...ie,isActive:e.target.checked}),className:"rounded"}),e.jsx(w,{children:"Ativo"})]})]}),e.jsxs(N,{children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>ee(!1),children:"Cancelar"}),e.jsx(r,{type:"submit",children:se?"Atualizar":"Criar"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-4",children:[e.jsx(F,{title:"Total de Upsells",value:B.length,icon:D,color:"bg-purple-500",delay:.1,subtitle:"Ofertas criadas"}),e.jsx(F,{title:"Upsells Ativos",value:ce,icon:G,color:"bg-green-500",delay:.2,subtitle:"Atualmente em uso"}),e.jsx(F,{title:"Taxa de Conversão",value:ue,icon:R,color:"bg-blue-500",delay:.3,subtitle:"Média de aceitação"}),e.jsx(F,{title:"Receita Extra",value:"-",icon:q,color:"bg-pink-500",delay:.4,subtitle:"Gerada por upsells"})]}),e.jsxs(z.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.5},className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(i,{placeholder:"Buscar upsells...",value:H,onChange:e=>J(e.target.value),className:"pl-9 border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg"})]}),e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:e.jsxs(l,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsx(d,{children:e.jsx(o,{className:"text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:"Lista de Upsells"})}),e.jsx(n,{children:Z?e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"h-12 w-full"}),e.jsx(V,{className:"h-12 w-full"}),e.jsx(V,{className:"h-12 w-full"})]}):0===X.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 mb-4",children:e.jsx(D,{className:"h-12 w-12 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum upsell encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-md",children:H?"Tente ajustar sua busca":"Comece criando seu primeiro upsell e maximize suas vendas"}),!H&&e.jsxs(r,{onClick:()=>{ne(),ee(!0)},size:"lg",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Criar Primeiro Upsell"]})]}):e.jsx("div",{className:"rounded-md border border-gray-200 dark:border-gray-800",children:e.jsxs(u,{children:[e.jsx(x,{children:e.jsxs(m,{className:"hover:bg-transparent",children:[e.jsx(h,{children:"Nome"}),e.jsx(h,{children:"Produto Gatilho"}),e.jsx(h,{children:"Produto Upsell"}),e.jsx(h,{children:"Título"}),e.jsx(h,{children:"Desconto"}),e.jsx(h,{children:"Status"}),e.jsx(h,{className:"text-right",children:"Ações"})]})}),e.jsx(p,{children:X.map((s,a)=>e.jsxs(z.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.05*a},className:"hover:bg-gray-50/50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx(j,{className:"font-medium",children:s.name}),e.jsx(j,{className:"text-sm text-gray-600 dark:text-gray-400",children:xe(s.triggerProductId)}),e.jsx(j,{className:"text-sm text-gray-600 dark:text-gray-400",children:xe(s.upsellProductId)}),e.jsx(j,{children:s.title}),e.jsx(j,{children:s.discountValue?"PERCENTAGE"===s.discountType?`${s.discountValue}%`:`R$ ${s.discountValue.toFixed(2)}`:"-"}),e.jsx(j,{children:e.jsx(c,{variant:s.isActive?"default":"secondary",className:s.isActive?"bg-green-500 hover:bg-green-600":"",children:s.isActive?"Ativo":"Inativo"})}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>(e=>{ae(e),le({name:e.name,triggerProductId:e.triggerProductId,upsellProductId:e.upsellProductId,title:e.title,description:e.description||"",discountType:e.discountType||"PERCENTAGE",discountValue:e.discountValue||0,isActive:e.isActive}),ee(!0)})(s),className:"hover:bg-blue-50 hover:text-blue-600 dark:hover:bg-blue-950",children:e.jsx(L,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>(async e=>{if(confirm("Tem certeza que deseja deletar este upsell?"))try{await T.upsells.delete(e),te({title:"Upsell deletado"}),de()}catch(s){te({title:"Erro",description:s.message,variant:"destructive"})}})(s.id),className:"hover:bg-red-50 hover:text-red-600 dark:hover:bg-red-950",children:e.jsx(O,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]})})]})};export{B as default};
