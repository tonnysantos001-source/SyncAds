import{j as e}from"./vendor-ui-D8qh2McD.js";import{r as s}from"./vendor-react-X41Bjl18.js";import{f as t,s as a,C as r,c as n,a as c,b as l}from"./index-i3b3sNGH.js";import{D as i,u as d,w as o,g as x,L as m,x as h,y as u,z as g,E as p,o as j,f,F as N,J as v,K as b,N as y}from"./vendor-icons-CouwLySB.js";import{R as w,A as k,C,X as A,Y as O,T as S,a as R}from"./vendor-charts-DhkUgiCU.js";import"./vendor-supabase-ChjAI-9u.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-animation-APnkykC6.js";import"./vendor-query-CYpOgAEj.js";const D=()=>{const D=t(e=>e.user),[M,I]=s.useState(!0),[P,T]=s.useState([]),[V,q]=s.useState([]),[z,B]=s.useState([]),[L,F]=s.useState("week"),[E,K]=s.useState({totalRevenue:0,revenueChange:0,totalOrders:0,ordersChange:0,conversionRate:0,conversionChange:0,averageOrderValue:0,aovChange:0,onlineNow:0,checkoutViews:0,checkoutAbandonment:0,topProducts:[]});s.useEffect(()=>{if(D?.id){U();const e=setInterval(()=>{X()},3e4);return()=>clearInterval(e)}},[D?.id,L]);const U=async()=>{try{I(!0),await Promise.all([Y(),H(),$(),G(),J(),W(),X()])}catch(e){}finally{I(!1)}},Y=async()=>{try{const{data:e}=await a.from("Order").select("total, createdAt").eq("userId",D.id).eq("status","paid").gte("createdAt",Q()).order("createdAt",{ascending:!1});if(e&&e.length>0){const s=e.reduce((e,s)=>e+(s.total||0),0),t=Z(e);K(e=>({...e,totalRevenue:s,revenueChange:t}))}}catch(e){}},H=async()=>{try{const{data:e}=await a.from("Order").select("id, createdAt, total").eq("userId",D.id).gte("createdAt",Q()).order("createdAt",{ascending:!1});if(e){const s=e.length,t=_(e),a=e.reduce((e,s)=>e+(s.total||0),0),r=s>0?a/s:0;K(e=>({...e,totalOrders:s,ordersChange:t,averageOrderValue:r,aovChange:5.2}))}}catch(e){}},$=async()=>{try{const e=3.2,s=.8;K(t=>({...t,conversionRate:e,conversionChange:s,checkoutViews:1247,checkoutAbandonment:68.5}))}catch(e){}},G=async()=>{try{const{data:e}=await a.from("Order").select("total, createdAt").eq("userId",D.id).eq("status","paid").gte("createdAt",Q()).order("createdAt",{ascending:!0});if(e){const s=ee(e);T(s)}}catch(e){}},J=async()=>{try{const{data:e}=await a.from("Order").select("id, customerName, total, status, createdAt, paymentMethod").eq("userId",D.id).order("createdAt",{ascending:!1}).limit(5);if(e){const s=e.map(e=>({id:e.id,customer:e.customerName||"Cliente",amount:e.total||0,status:"paid"===e.status?"approved":"pending"===e.status?"pending":"failed",time:se(e.createdAt),paymentMethod:e.paymentMethod||"Cartão"}));B(s)}}catch(e){}},W=async()=>{try{const e=[{name:"Produto A",sales:45,revenue:4500},{name:"Produto B",sales:32,revenue:3200},{name:"Produto C",sales:28,revenue:2800},{name:"Produto D",sales:21,revenue:2100}];K(s=>({...s,topProducts:e}))}catch(e){}},X=async()=>{try{const e=new Date;e.setMinutes(e.getMinutes()-5);const{count:s,error:t}=await a.from("User").select("*",{count:"exact",head:!0}).gte("lastSeen",e.toISOString());if(t){const{count:e}=await a.from("User").select("*",{count:"exact",head:!0});K(s=>({...s,onlineNow:e||0}))}else K(e=>({...e,onlineNow:s||0}));q([])}catch(e){K(e=>({...e,onlineNow:0})),q([])}},Q=()=>{const e=new Date;switch(L){case"today":return new Date(e.setHours(0,0,0,0)).toISOString();case"week":default:return new Date(e.setDate(e.getDate()-7)).toISOString();case"month":return new Date(e.setMonth(e.getMonth()-1)).toISOString();case"year":return new Date(e.setFullYear(e.getFullYear()-1)).toISOString()}},Z=e=>12.5,_=e=>8.3,ee=e=>{const s={};return e.forEach(e=>{const t=new Date(e.createdAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"});s[t]=(s[t]||0)+(e.total||0)}),Object.entries(s).map(([e,s])=>({date:e,revenue:s,orders:0}))},se=e=>{const s=new Date(e),t=(new Date).getTime()-s.getTime(),a=Math.floor(t/6e4);return a<1?"Agora":a<60?`${a}m atrás`:a<1440?`${Math.floor(a/60)}h atrás`:s.toLocaleDateString("pt-BR")},te=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),ae=[{title:"Receita Total",value:te(E.totalRevenue),change:E.revenueChange,trend:E.revenueChange>=0?"up":"down",icon:e.jsx(i,{className:"h-5 w-5"})},{title:"Pedidos",value:E.totalOrders,change:E.ordersChange,trend:E.ordersChange>=0?"up":"down",icon:e.jsx(d,{className:"h-5 w-5"})},{title:"Taxa de Conversão",value:E.conversionRate,change:E.conversionChange,trend:E.conversionChange>=0?"up":"down",icon:e.jsx(o,{className:"h-5 w-5"}),suffix:"%"},{title:"Ticket Médio",value:te(E.averageOrderValue),change:E.aovChange,trend:E.aovChange>=0?"up":"down",icon:e.jsx(x,{className:"h-5 w-5"})}];return M?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(m,{className:"h-8 w-8 animate-spin text-pink-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Visão geral das suas métricas de vendas"})]}),e.jsx("div",{className:"flex gap-2",children:["today","week","month","year"].map(s=>e.jsxs("button",{onClick:()=>F(s),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+(L===s?"bg-pink-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),children:["today"===s&&"Hoje","week"===s&&"7 dias","month"===s&&"30 dias","year"===s&&"1 ano"]},s))})]}),e.jsx(r,{className:"bg-gradient-to-br from-pink-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(h,{className:"h-8 w-8 animate-pulse"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm font-medium",children:"Usuários Online Agora"}),e.jsx("p",{className:"text-4xl font-bold mt-1",children:E.onlineNow}),e.jsxs("p",{className:"text-white/80 text-xs mt-1",children:[V.filter(e=>e.page.includes("Checkout")).length," ","no checkout"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium",children:"Ao Vivo"})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:ae.map((s,t)=>e.jsx(r,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"h-12 w-12 bg-pink-100 rounded-lg flex items-center justify-center text-pink-600",children:s.icon}),e.jsxs("div",{className:"flex items-center gap-1 text-sm font-medium "+("up"===s.trend?"text-green-600":"text-red-600"),children:["up"===s.trend?e.jsx(u,{className:"h-4 w-4"}):e.jsx(g,{className:"h-4 w-4"}),Math.abs(s.change),"%"]})]}),e.jsx("p",{className:"text-gray-600 text-sm font-medium mb-1",children:s.title}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[s.prefix,s.value,s.suffix]})]})},t))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(r,{className:"lg:col-span-2",children:[e.jsx(c,{children:e.jsx(l,{className:"text-lg font-semibold",children:"Receita ao Longo do Tempo"})}),e.jsx(n,{children:e.jsx(w,{width:"100%",height:300,children:e.jsxs(k,{data:P,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ec4899",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#ec4899",stopOpacity:0})]})}),e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(A,{dataKey:"date",tick:{fill:"#666",fontSize:12}}),e.jsx(O,{tick:{fill:"#666",fontSize:12}}),e.jsx(S,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),e.jsx(R,{type:"monotone",dataKey:"revenue",stroke:"#ec4899",strokeWidth:2,fillOpacity:1,fill:"url(#colorRevenue)"})]})})})]}),e.jsxs(r,{children:[e.jsx(c,{children:e.jsxs(l,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5 text-pink-600"}),"Atividade em Tempo Real"]})}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-4",children:[V.map(s=>e.jsxs("div",{className:"flex items-start gap-3 pb-4 border-b last:border-0 last:pb-0",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full mt-2 animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.page}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[s.timeOnPage,"s na página"]}),e.jsx("span",{className:"text-xs text-gray-400",children:"•"}),e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:s.device})]})]})]},s.id)),0===V.length&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Nenhum usuário online no momento"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r,{children:[e.jsx(c,{children:e.jsx(l,{className:"text-lg font-semibold",children:"Transações Recentes"})}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-4",children:[z.map(s=>e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b last:border-0 last:pb-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"h-10 w-10 rounded-full flex items-center justify-center "+("approved"===s.status?"bg-green-100":"pending"===s.status?"bg-yellow-100":"bg-red-100"),children:["approved"===s.status&&e.jsx(j,{className:"h-5 w-5 text-green-600"}),"pending"===s.status&&e.jsx(f,{className:"h-5 w-5 text-yellow-600"}),"failed"===s.status&&e.jsx(N,{className:"h-5 w-5 text-red-600"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.customer}),e.jsx("p",{className:"text-xs text-gray-500",children:s.time})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold text-gray-900",children:te(s.amount)}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:s.paymentMethod})]})]},s.id)),0===z.length&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Nenhuma transação recente"})]})})]}),e.jsxs(r,{children:[e.jsx(c,{children:e.jsxs(l,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5 text-pink-600"}),"Produtos Mais Vendidos"]})}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-4",children:[E.topProducts.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"h-8 w-8 bg-gradient-to-br from-pink-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-sm",children:t+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.sales," vendas"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-sm font-bold text-gray-900",children:te(s.revenue)})})]},t)),0===E.topProducts.length&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Nenhum produto vendido ainda"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(r,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(p,{className:"h-5 w-5 text-blue-600"}),e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Visualizações do Checkout"})]}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:E.checkoutViews}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Últimos 7 dias"})]})}),e.jsx(r,{className:"bg-gradient-to-br from-amber-50 to-amber-100 border-amber-200",children:e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(b,{className:"h-5 w-5 text-amber-600"}),e.jsx("p",{className:"text-sm font-medium text-amber-900",children:"Taxa de Abandono"})]}),e.jsxs("p",{className:"text-3xl font-bold text-amber-900",children:[E.checkoutAbandonment,"%"]}),e.jsx("p",{className:"text-xs text-amber-700 mt-1",children:"Oportunidade de melhoria"})]})}),e.jsx(r,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(y,{className:"h-5 w-5 text-green-600"}),e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Novos Clientes"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:Math.floor(.65*E.totalOrders)}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"65% dos pedidos"})]})})]})]})};export{D as default};
