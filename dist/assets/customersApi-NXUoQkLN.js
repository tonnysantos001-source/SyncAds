import{s as t}from"./index-D0_lz_P6.js";const e={async list(e){try{let r=t.from("Customer").select("*").order("createdAt",{ascending:!1});e?.status&&(r=r.eq("status",e.status)),e?.search&&(r=r.or(`name.ilike.%${e.search}%,email.ilike.%${e.search}%,cpf.ilike.%${e.search}%`)),e?.tags&&e.tags.length>0&&(r=r.contains("tags",e.tags));const{data:a,error:s}=await r;if(s)throw s;return a}catch(r){throw r}},async listFromShopify(e,r){try{let a=t.from("ShopifyCustomer").select("*").eq("userId",e).order("updatedAt",{ascending:!1});r?.search&&(a=a.or(`email.ilike.%${r.search}%,firstName.ilike.%${r.search}%,lastName.ilike.%${r.search}%`));const{data:s,error:o}=await a;if(o)throw o;return(s||[]).map(t=>({id:String(t.id),userId:t.userId,email:t.email||"",name:`${t.firstName||""} ${t.lastName||""}`.trim()||"Cliente",phone:t.phone,cpf:void 0,birthDate:void 0,gender:void 0,totalOrders:t.ordersCount||0,totalSpent:parseFloat(t.totalSpent||"0"),averageOrderValue:t.ordersCount>0?parseFloat(t.totalSpent||"0")/t.ordersCount:0,lastOrderAt:t.shopifyData?.last_order_date||void 0,tags:t.shopifyData?.tags?t.shopifyData.tags.split(",").map(t=>t.trim()):[],notes:void 0,acceptsMarketing:t.shopifyData?.accepts_marketing||!1,status:"ACTIVE",createdAt:t.createdAt,updatedAt:t.updatedAt}))}catch(a){throw a}},async getById(e){try{const{data:r,error:a}=await t.from("Customer").select("*, CustomerAddress(*)").eq("id",e).single();if(a)throw a;return r}catch(r){throw r}},async getByEmail(e){try{const{data:r,error:a}=await t.from("Customer").select("*").eq("email",e).single();if(a)throw a;return r}catch(r){throw r}},async create(e){try{const{data:r,error:a}=await t.from("Customer").insert({...e,totalOrders:0,totalSpent:0,averageOrderValue:0}).select().single();if(a)throw a;return r}catch(r){throw r}},async update(e,r){try{const{data:a,error:s}=await t.from("Customer").update({...r,updatedAt:(new Date).toISOString()}).eq("id",e).select().single();if(s)throw s;return a}catch(a){throw a}},async toggleStatus(e,r){try{const{data:a,error:s}=await t.from("Customer").update({status:r,updatedAt:(new Date).toISOString()}).eq("id",e).select().single();if(s)throw s;return a}catch(a){throw a}},async delete(e){try{const{error:r}=await t.from("Customer").delete().eq("id",e);if(r)throw r}catch(r){throw r}}};export{e as c};
