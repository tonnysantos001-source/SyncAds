import{c as $,s as d,r as m,f as J,u as K,j as e,g as y,h as g,i as N,S as F,l as S,P as W,Q as Y,I as Z,B,ad as ee,k as te,o as k}from"./index-DfBMW4On.js";import{T as ae,a as se,b as q,c as x,d as re,e as f}from"./table-C0VMV1yH.js";import{S as le,a as ne,b as ie,c as de,d as p}from"./select-C8vFkf4D.js";import{s as ce}from"./shopifySync-Br63NSHc.js";import{S as C}from"./skeleton-CJb4SwmM.js";import{D as oe}from"./dollar-sign-D6u_a0HW.js";import{E as me}from"./eye-iIKjJelo.js";import{f as ue,p as he}from"./pt-BR-BQ5kKd2v.js";import"./index-BZchsj1x.js";import"./constructFrom-rJN6zrQ_.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=$("PackageX",[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["path",{d:"m17 13 5 5m-5 0 5-5",key:"im3w4b"}]]),G={async getAll(a){const{data:l,error:s}=await d.from("Order").select(`
        *,
        items:OrderItem(*),
        history:OrderHistory(*)
      `).eq("userId",a).order("createdAt",{ascending:!1});if(s)throw s;return l},async getById(a){const{data:l,error:s}=await d.from("Order").select(`
        *,
        items:OrderItem(*),
        history:OrderHistory(*)
      `).eq("id",a).single();if(s)throw s;return l},async getByCustomer(a){const{data:l,error:s}=await d.from("Order").select(`
        *,
        items:OrderItem(*)
      `).eq("customerId",a).order("createdAt",{ascending:!1});if(s)throw s;return l},async create(a){const{data:l,error:s}=await d.from("Order").insert(a).select().single();if(s)throw s;return l},async update(a,l){const{data:s,error:n}=await d.from("Order").update({...l,updatedAt:new Date().toISOString()}).eq("id",a).select().single();if(n)throw n;return s},async updatePaymentStatus(a,l,s){const n={paymentStatus:l};s&&(n.paidAt=s);const{data:o,error:u}=await d.from("Order").update(n).eq("id",a).select().single();if(u)throw u;return o},async updateFulfillmentStatus(a,l,s){const n={fulfillmentStatus:l,...s},{data:o,error:u}=await d.from("Order").update(n).eq("id",a).select().single();if(u)throw u;return o},async cancel(a,l){const s={paymentStatus:"CANCELLED",fulfillmentStatus:"CANCELLED",cancelledAt:new Date().toISOString()},{data:n,error:o}=await d.from("Order").update(s).eq("id",a).select().single();if(o)throw o;return n&&await G.addHistory(a,"ORDER_CANCELLED",l||"Order cancelled"),n},async delete(a){const{error:l}=await d.from("Order").delete().eq("id",a);if(l)throw l}},De=()=>{const[a,l]=m.useState([]),[s,n]=m.useState([]),[o,u]=m.useState(!0),[D,P]=m.useState(!1),[h,M]=m.useState(""),[j,z]=m.useState("all"),{toast:v}=J(),c=K(t=>t.user);m.useEffect(()=>{I()},[]),m.useEffect(()=>{V()},[h,j,a]);const I=async()=>{try{if(!(c!=null&&c.id))return;const t=await G.getAll(c.id),{data:i}=await d.from("ShopifyOrder").select("*").eq("userId",c.id).order("createdAt",{ascending:!1}),Q=(i||[]).map(r=>{var w,b,E,T;return{id:r.id.toString(),userId:r.userId,orderNumber:((w=r.orderNumber)==null?void 0:w.toString())||r.id.toString(),customerId:((b=r.customerData)==null?void 0:b.id)||"shopify-customer",cartId:void 0,customerEmail:r.email||"",customerName:r.name||((E=r.customerData)==null?void 0:E.first_name)+" "+((T=r.customerData)==null?void 0:T.last_name)||"Cliente",customerPhone:r.phone,shippingAddress:r.shippingAddress||{},billingAddress:r.billingAddress||{},items:r.lineItems||{},subtotal:parseFloat(r.subtotalPrice||0),discount:0,shipping:0,tax:parseFloat(r.totalTax||0),total:parseFloat(r.totalPrice||0),currency:r.currency||"BRL",paymentMethod:"CREDIT_CARD",paymentStatus:r.financialStatus==="paid"?"PAID":r.financialStatus==="pending"?"PENDING":"FAILED",fulfillmentStatus:r.fulfillmentStatus==="fulfilled"?"DELIVERED":"PENDING",createdAt:r.createdAt,updatedAt:r.updatedAt}}),R=[...t,...Q].filter((r,w,b)=>w===b.findIndex(E=>E.orderNumber===r.orderNumber));l(R),n(R)}catch(t){console.error("Erro ao carregar pedidos:",t),v({title:"Erro ao carregar pedidos",description:t.message,variant:"destructive"})}finally{u(!1)}},H=async()=>{try{if(P(!0),v({title:"Sincronizando com Shopify..."}),!(c!=null&&c.id))return;await ce.syncOrders(c.id),v({title:"Pedidos sincronizados com sucesso!"}),await I()}catch(t){console.error("Erro ao sincronizar:",t),v({title:"Erro ao sincronizar",description:t.message,variant:"destructive"})}finally{P(!1)}},V=()=>{let t=a;h&&(t=t.filter(i=>i.orderNumber.toLowerCase().includes(h.toLowerCase())||i.customerName.toLowerCase().includes(h.toLowerCase())||i.customerEmail.toLowerCase().includes(h.toLowerCase()))),j!=="all"&&(t=t.filter(i=>i.paymentStatus===j)),n(t)},A=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),O=t=>({PENDING:{label:"Pendente",variant:"secondary"},PROCESSING:{label:"Processando",variant:"default"},PAID:{label:"Pago",variant:"default"},FAILED:{label:"Falhou",variant:"destructive"},REFUNDED:{label:"Reembolsado",variant:"secondary"},CANCELLED:{label:"Cancelado",variant:"secondary"}})[t]||{label:"Desconhecido",variant:"secondary"},L=t=>({PENDING:{label:"Pendente",variant:"secondary"},PROCESSING:{label:"Preparando",variant:"default"},SHIPPED:{label:"Enviado",variant:"default"},DELIVERED:{label:"Entregue",variant:"default"},CANCELLED:{label:"Cancelado",variant:"destructive"}})[t]||{label:"Desconhecido",variant:"secondary"},_=a.filter(t=>t.paymentStatus==="PAID").reduce((t,i)=>t+i.total,0),U=a.filter(t=>t.paymentStatus==="PENDING").length,X=a.filter(t=>t.paymentStatus==="PAID").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Pedidos"}),e.jsx("p",{className:"text-muted-foreground",children:"Visualize e gerencie todos os pedidos da sua loja"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(y,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total de Pedidos"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold",children:a.length})})]}),e.jsxs(y,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Pedidos Pagos"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold",children:X})})]}),e.jsxs(y,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Pedidos Pendentes"}),e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold",children:U})})]}),e.jsxs(y,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Receita Total"}),e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold",children:A(_)})})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Z,{placeholder:"Buscar por número, cliente ou email...",value:h,onChange:t=>M(t.target.value),className:"pl-9"})]}),e.jsxs(le,{value:j,onValueChange:z,children:[e.jsx(ne,{className:"w-[200px]",children:e.jsx(ie,{placeholder:"Status"})}),e.jsxs(de,{children:[e.jsx(p,{value:"all",children:"Todos os Status"}),e.jsx(p,{value:"PENDING",children:"Pendente"}),e.jsx(p,{value:"PROCESSING",children:"Processando"}),e.jsx(p,{value:"PAID",children:"Pago"}),e.jsx(p,{value:"FAILED",children:"Falhou"}),e.jsx(p,{value:"REFUNDED",children:"Reembolsado"}),e.jsx(p,{value:"CANCELLED",children:"Cancelado"})]})]}),e.jsxs(B,{onClick:H,disabled:D,variant:"outline",children:[e.jsx(ee,{className:`h-4 w-4 mr-2 ${D?"animate-spin":""}`}),D?"Sincronizando...":"Sincronizar Shopify"]})]}),e.jsxs(y,{children:[e.jsxs(g,{children:[e.jsx(N,{children:"Lista de Pedidos"}),e.jsxs(te,{children:[s.length," pedido(s) encontrado(s)"]})]}),e.jsx(S,{children:o?e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"h-12 w-full"}),e.jsx(C,{className:"h-12 w-full"}),e.jsx(C,{className:"h-12 w-full"})]}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(F,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h||j!=="all"?"Tente ajustar os filtros":"Aguardando o primeiro pedido"})]}):e.jsxs(ae,{children:[e.jsx(se,{children:e.jsxs(q,{children:[e.jsx(x,{children:"Pedido"}),e.jsx(x,{children:"Cliente"}),e.jsx(x,{children:"Valor"}),e.jsx(x,{children:"Pagamento"}),e.jsx(x,{children:"Entrega"}),e.jsx(x,{children:"Data"}),e.jsx(x,{className:"text-right",children:"Ações"})]})}),e.jsx(re,{children:s.map(t=>e.jsxs(q,{children:[e.jsx(f,{children:e.jsxs("div",{className:"font-mono text-sm",children:["#",t.orderNumber]})}),e.jsx(f,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.customerName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.customerEmail})]})}),e.jsxs(f,{children:[e.jsx("div",{className:"font-medium",children:A(t.total)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.paymentMethod})]}),e.jsx(f,{children:e.jsx(k,{variant:O(t.paymentStatus).variant,children:O(t.paymentStatus).label})}),e.jsx(f,{children:e.jsx(k,{variant:L(t.fulfillmentStatus).variant,children:L(t.fulfillmentStatus).label})}),e.jsx(f,{children:ue(new Date(t.createdAt),"dd/MM/yyyy",{locale:he})}),e.jsx(f,{className:"text-right",children:e.jsx(B,{variant:"ghost",size:"icon",children:e.jsx(me,{className:"h-4 w-4"})})})]},t.id))})]})})]})]})};export{De as default};
