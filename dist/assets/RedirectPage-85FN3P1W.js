import{j as e}from"./vendor-ui-DAyDU-p2.js";import{r}from"./vendor-react-BDwqAlkB.js";import{s as t,g as a,f as s,B as i,C as n,a as l,b as o,c,d,e as g,I as u}from"./index-rVWx4UKY.js";import{L as h}from"./label-smVLxZ8W.js";import{T as m,a as x,b as v,c as j,d as p,e as f}from"./table-Dkr9nirc.js";import{D as w,a as R,b as y,c as N,d as I,f as C}from"./dialog-CfS0tgAA.js";import{S as b,a as T,b as E,c as A,d as S}from"./select-k918aNG-.js";import{S as V}from"./switch-BOqw6BeX.js";import{T as P}from"./textarea-Cf9R0_z4.js";import{A as k,b as D}from"./alert-BoFQ5dMg.js";import{S as L}from"./skeleton-DxmxvFVt.js";import{a7 as U,aQ as q,aS as _,E as O,k as F,R as B,a2 as M,_ as H,a1 as G,aC as z,C as $}from"./vendor-icons-ByXnbRBH.js";import"./vendor-supabase-rKXMzPQL.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-animation-x8f1c1kX.js";import"./vendor-query-D3VdSFIC.js";const X={async createRule(e){try{const{data:r,error:a}=await t.from("RedirectRule").insert({...e,currentRedirects:0,conversions:0}).select().single();if(a)throw a;return r}catch(r){throw r}},async updateRule(e,r){try{const{data:a,error:s}=await t.from("RedirectRule").update({...r,updatedAt:(new Date).toISOString()}).eq("id",e).select().single();if(s)throw s;return a}catch(a){throw a}},async deleteRule(e){try{const{error:r}=await t.from("RedirectRule").delete().eq("id",e);if(r)throw r}catch(r){throw r}},async listRules(e,r){try{let a=t.from("RedirectRule").select("*").eq("userId",e).order("priority",{ascending:!1}).order("createdAt",{ascending:!1});r?.status&&(a=a.eq("status",r.status)),r?.trigger&&(a=a.eq("trigger",r.trigger)),void 0!==r?.active&&(a=r.active?a.eq("status","ACTIVE"):a.neq("status","ACTIVE"));const{data:s,error:i}=await a;if(i)throw i;return s}catch(a){throw a}},async getRuleById(e){try{const{data:r,error:a}=await t.from("RedirectRule").select("*").eq("id",e).single();if(a)throw a;return r}catch(r){throw r}},async toggleRule(e,r){try{const t=r?"ACTIVE":"INACTIVE";return await X.updateRule(e,{status:t})}catch(t){throw t}},async updatePriority(e,r){try{return await X.updateRule(e,{priority:r})}catch(t){throw t}},async getApplicableRules(e,r){try{const a=(new Date).toISOString();let s=t.from("RedirectRule").select("*").eq("userId",e).eq("status","ACTIVE").or(`validFrom.is.null,validFrom.lte.${a}`).or(`validUntil.is.null,validUntil.gte.${a}`).order("priority",{ascending:!1});r.trigger&&(s=s.eq("trigger",r.trigger));const{data:i,error:n}=await s;if(n)throw n;let l=i;return r.page&&(l=l.filter(e=>e.applicablePages&&e.applicablePages.length>0?e.applicablePages.includes(r.page):!(e.excludedPages&&e.excludedPages.length>0)||!e.excludedPages.includes(r.page))),l=l.filter(e=>{if(!e.conditions)return!0;if(void 0!==r.cartValue){if(e.conditions.minCartValue&&r.cartValue<e.conditions.minCartValue)return!1;if(e.conditions.maxCartValue&&r.cartValue>e.conditions.maxCartValue)return!1}if(e.conditions.productIds&&e.conditions.productIds.length>0&&r.productIds){if(!r.productIds.some(r=>e.conditions.productIds.includes(r)))return!1}return(!e.conditions.utmSource||r.utmSource===e.conditions.utmSource)&&((!e.conditions.deviceType||r.deviceType===e.conditions.deviceType)&&(!(void 0!==e.conditions.newVisitors&&void 0!==r.isNewVisitor&&e.conditions.newVisitors&&!r.isNewVisitor)&&(void 0===e.conditions.returningVisitors||void 0===r.isNewVisitor||!e.conditions.returningVisitors||!r.isNewVisitor)))}),l=l.filter(e=>!e.maxRedirects||e.currentRedirects<e.maxRedirects),l}catch(a){throw a}},async duplicateRule(e){try{const r=await X.getRuleById(e),{id:t,createdAt:a,updatedAt:s,...i}=r;return await X.createRule({...i,name:`${r.name} (Cópia)`,status:"INACTIVE",currentRedirects:0,conversions:0})}catch(r){throw r}},async logRedirect(e){try{const{data:r,error:a}=await t.from("RedirectLog").insert(e).select().single();if(a)throw a;const s=await X.getRuleById(e.ruleId);return await X.updateRule(e.ruleId,{currentRedirects:s.currentRedirects+1}),r}catch(r){throw r}},async markAsConverted(e,r,a){try{const s=await X.getLogById(e),{data:i,error:n}=await t.from("RedirectLog").update({converted:!0,convertedAt:(new Date).toISOString(),orderId:r,conversionValue:a}).eq("id",e).select().single();if(n)throw n;const l=await X.getRuleById(s.ruleId);return await X.updateRule(s.ruleId,{conversions:l.conversions+1}),i}catch(s){throw s}},async getLogById(e){try{const{data:r,error:a}=await t.from("RedirectLog").select("*").eq("id",e).single();if(a)throw a;return r}catch(r){throw r}},async getLogsBySession(e){try{const{data:r,error:a}=await t.from("RedirectLog").select("*").eq("sessionId",e).order("createdAt",{ascending:!1});if(a)throw a;return r}catch(r){throw r}},async getLogs(e,r){try{let a=t.from("RedirectLog").select("*").eq("userId",e).order("createdAt",{ascending:!1});r?.ruleId&&(a=a.eq("ruleId",r.ruleId)),void 0!==r?.converted&&(a=a.eq("converted",r.converted)),r?.trigger&&(a=a.eq("trigger",r.trigger)),r?.dateFrom&&(a=a.gte("createdAt",r.dateFrom)),r?.dateTo&&(a=a.lte("createdAt",r.dateTo)),r?.limit&&(a=a.limit(r.limit));const{data:s,error:i}=await a;if(i)throw i;return s}catch(a){throw a}},async getAnalytics(e,r){try{const a=await X.listRules(e);let s=t.from("RedirectLog").select("*").eq("userId",e);r&&(s=s.gte("createdAt",r.from).lte("createdAt",r.to));const{data:i,error:n}=await s;if(n)throw n;const l=i,o=a.length,c=a.filter(e=>"ACTIVE"===e.status).length,d=l.length,g=l.filter(e=>e.converted).length,u=d>0?g/d*100:0,h=l.filter(e=>e.converted&&e.conversionValue).reduce((e,r)=>e+(r.conversionValue||0),0),m=g>0?h/g:0,x={};["POST_PURCHASE","ABANDONED_CART","EXIT_INTENT","TIME_DELAY","SCROLL_PERCENTAGE","IDLE","FIRST_VISIT","RETURNING_VISITOR"].forEach(e=>{const r=l.filter(r=>r.trigger===e);if(r.length>0){const t=r.filter(e=>e.converted).length,a=r.filter(e=>e.converted&&e.conversionValue).reduce((e,r)=>e+(r.conversionValue||0),0);x[e]={redirects:r.length,conversions:t,conversionRate:t/r.length*100,revenue:a}}});const v=a.map(e=>{const r=l.filter(r=>r.ruleId===e.id),t=r.filter(e=>e.converted).length,a=r.filter(e=>e.converted&&e.conversionValue).reduce((e,r)=>e+(r.conversionValue||0),0);return{ruleId:e.id,ruleName:e.name,redirects:r.length,conversions:t,conversionRate:r.length>0?t/r.length*100:0,revenue:a}}).filter(e=>e.redirects>0).sort((e,r)=>r.revenue-e.revenue).slice(0,10);return{totalRules:o,activeRules:c,totalRedirects:d,totalConversions:g,conversionRate:u,totalRevenue:h,averageOrderValue:m,byTrigger:x,topRules:v}}catch(a){throw a}},async getConversionRate(e){try{const{data:r,error:a}=await t.from("RedirectLog").select("converted").eq("ruleId",e);if(a)throw a;const s=r,i=s.length,n=s.filter(e=>e.converted).length;return i>0?n/i*100:0}catch(r){throw r}},async getRulePerformance(e){try{const r=await X.getRuleById(e),t=await X.getLogs(r.userId,{ruleId:e}),a=t.length,s=t.filter(e=>e.converted).length,i=a>0?s/a*100:0,n=t.filter(e=>e.converted&&e.conversionValue).reduce((e,r)=>e+(r.conversionValue||0),0);return{rule:r,redirects:a,conversions:s,conversionRate:i,revenue:n,averageOrderValue:s>0?n/s:0}}catch(r){throw r}},async resetRuleStats(e){try{return await X.updateRule(e,{currentRedirects:0,conversions:0})}catch(r){throw r}},async processExpiredRules(e){try{const r=(new Date).toISOString(),{data:a,error:s}=await t.from("RedirectRule").select("id").eq("userId",e).eq("status","ACTIVE").not("validUntil","is",null).lt("validUntil",r);if(s)throw s;const i=a,n=i.map(e=>X.updateRule(e.id,{status:"EXPIRED"}));return await Promise.all(n),i.length}catch(r){throw r}},async processScheduledRules(e){try{const r=(new Date).toISOString(),{data:a,error:s}=await t.from("RedirectRule").select("id").eq("userId",e).eq("status","SCHEDULED").not("validFrom","is",null).lte("validFrom",r);if(s)throw s;const i=a,n=i.map(e=>X.updateRule(e.id,{status:"ACTIVE"}));return await Promise.all(n),i.length}catch(r){throw r}}},Y=()=>{const[t,Y]=r.useState([]),[Q,J]=r.useState(null),[K,W]=r.useState(!0),[Z,ee]=r.useState(!1),[re,te]=r.useState(null),[ae,se]=r.useState({name:"",description:"",trigger:"POST_PURCHASE",destinationUrl:"",status:"ACTIVE",priority:1,openInNewTab:!0,showConfirmation:!1}),{toast:ie}=a(),ne=s(e=>e.user);r.useEffect(()=>{ne?.id&&le()},[ne?.id]);const le=async()=>{try{W(!0);const[e,r]=await Promise.all([X.listRules(ne.id),X.getAnalytics(ne.id)]);Y(e),J(r)}catch(e){ie({title:"Erro ao carregar dados",description:e.message,variant:"destructive"})}finally{W(!1)}},oe=()=>{se({name:"",description:"",trigger:"POST_PURCHASE",destinationUrl:"",status:"ACTIVE",priority:1,openInNewTab:!0,showConfirmation:!1})},ce=e=>`${e.toFixed(1)}%`,de=e=>({POST_PURCHASE:"Pós-Compra",ABANDONED_CART:"Carrinho Abandonado",EXIT_INTENT:"Intenção de Saída",TIME_DELAY:"Tempo na Página",SCROLL_PERCENTAGE:"Rolagem de Página",IDLE:"Inatividade",FIRST_VISIT:"Primeira Visita",RETURNING_VISITOR:"Visitante Retornante"}[e]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 dark:from-blue-400 dark:via-purple-400 dark:to-pink-400 bg-clip-text text-transparent",children:"Redirecionamentos"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 font-medium",children:"Configure redirecionamentos inteligentes para maximizar conversões"})]}),e.jsxs(i,{onClick:()=>ee(!0),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Nova Regra"]})]}),Q&&e.jsxs("div",{className:"grid gap-6 md:grid-cols-4",children:[e.jsxs(n,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Regras Ativas"}),e.jsx(q,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Q.total}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["de ",Q.totalRules," regras"]})]})]}),e.jsxs(n,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Total Redirecionamentos"}),e.jsx(_,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Q.active}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Regras ativas"})]})]}),e.jsxs(n,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Conversões"}),e.jsx(O,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Q.totalConversions}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Taxa: ",ce(Q.conversionRate)]})]})]}),e.jsxs(n,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Receita Gerada"}),e.jsx(F,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})]}),e.jsxs(c,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["R$ ",Q.totalRevenue.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Ticket: R$ ",Q.averageOrderValue.toFixed(2)]})]})]})]}),e.jsxs(n,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Regras de Redirecionamento"}),e.jsxs(d,{children:[t.length," regra(s) cadastrada(s)"]})]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:le,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]}),e.jsx(c,{children:K?e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{className:"h-12 w-full"}),e.jsx(L,{className:"h-12 w-full"}),e.jsx(L,{className:"h-12 w-full"})]}):0===t.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(M,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhuma regra cadastrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Crie sua primeira regra de redirecionamento"}),e.jsxs(i,{onClick:()=>ee(!0),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Criar Regra"]})]}):e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs(v,{children:[e.jsx(j,{children:"Nome"}),e.jsx(j,{children:"Trigger"}),e.jsx(j,{children:"URL Destino"}),e.jsx(j,{children:"Status"}),e.jsx(j,{className:"text-right",children:"Redirecionamentos"}),e.jsx(j,{className:"text-right",children:"Conversões"}),e.jsx(j,{className:"text-right",children:"Taxa"}),e.jsx(j,{className:"text-right",children:"Ações"})]})}),e.jsx(p,{children:t.map(r=>{const t=(e=>{const r={ACTIVE:{label:"Ativo",variant:"default",icon:$},INACTIVE:{label:"Inativo",variant:"secondary",icon:z},EXPIRED:{label:"Expirado",variant:"destructive",icon:z},SCHEDULED:{label:"Agendado",variant:"secondary",icon:z}};return r[e]||r.INACTIVE})(r.status),a=t.icon,s=r.currentRedirects>0?r.conversions/r.currentRedirects*100:0;return e.jsxs(v,{children:[e.jsx(f,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.name}),r.description&&e.jsx("div",{className:"text-sm text-muted-foreground",children:r.description})]})}),e.jsx(f,{children:e.jsx(g,{variant:"outline",children:de(r.trigger)})}),e.jsx(f,{children:e.jsxs("a",{href:r.destinationUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline flex items-center gap-1",children:[r.destinationUrl.substring(0,40),"...",e.jsx(M,{className:"h-3 w-3"})]})}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{variant:t.variant,className:"gap-1",children:[e.jsx(a,{className:"h-3 w-3"}),t.label]}),e.jsx(V,{checked:"ACTIVE"===r.status,onCheckedChange:e=>(async(e,r)=>{try{await X.toggleRule(e,r),ie({title:r?"Regra ativada!":"Regra desativada!"}),le()}catch(t){ie({title:"Erro ao alternar status",description:t.message,variant:"destructive"})}})(r.id,e)})]})}),e.jsx(f,{className:"text-right",children:r.currentRedirects}),e.jsx(f,{className:"text-right",children:e.jsx("span",{className:"font-medium text-green-600",children:r.conversions})}),e.jsx(f,{className:"text-right",children:e.jsx(g,{variant:"outline",children:ce(s)})}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{te(e),se(e),ee(!0)})(r),children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Deseja realmente excluir esta regra?"))try{await X.deleteRule(e),ie({title:"Regra excluída com sucesso!"}),le()}catch(r){ie({title:"Erro ao excluir",description:r.message,variant:"destructive"})}})(r.id),children:e.jsx(G,{className:"h-4 w-4 text-red-600"})})]})})]},r.id)})})]})})]}),e.jsx(w,{open:Z,onOpenChange:ee,children:e.jsxs(R,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(y,{children:[e.jsx(N,{children:re?"Editar Regra":"Nova Regra de Redirecionamento"}),e.jsx(I,{children:"Configure quando e para onde redirecionar seus usuários"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"name",children:"Nome da Regra *"}),e.jsx(u,{id:"name",value:ae.name,onChange:e=>se({...ae,name:e.target.value}),placeholder:"Ex: Upsell pós-compra"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"description",children:"Descrição"}),e.jsx(P,{id:"description",value:ae.description||"",onChange:e=>se({...ae,description:e.target.value}),placeholder:"Descrição opcional",rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"trigger",children:"Trigger *"}),e.jsxs(b,{value:ae.trigger,onValueChange:e=>se({...ae,trigger:e}),children:[e.jsx(T,{children:e.jsx(E,{})}),e.jsxs(A,{children:[e.jsx(S,{value:"POST_PURCHASE",children:"Pós-Compra"}),e.jsx(S,{value:"ABANDONED_CART",children:"Carrinho Abandonado"}),e.jsx(S,{value:"EXIT_INTENT",children:"Intenção de Saída"}),e.jsx(S,{value:"TIME_DELAY",children:"Tempo na Página"}),e.jsx(S,{value:"SCROLL_PERCENTAGE",children:"Rolagem de Página"}),e.jsx(S,{value:"IDLE",children:"Inatividade"}),e.jsx(S,{value:"FIRST_VISIT",children:"Primeira Visita"}),e.jsx(S,{value:"RETURNING_VISITOR",children:"Visitante Retornante"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"priority",children:"Prioridade"}),e.jsx(u,{id:"priority",type:"number",value:ae.priority,onChange:e=>se({...ae,priority:parseInt(e.target.value)}),placeholder:"1"})]})]}),"TIME_DELAY"===ae.trigger&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"triggerDelay",children:"Delay (segundos)"}),e.jsx(u,{id:"triggerDelay",type:"number",value:ae.triggerDelay||"",onChange:e=>se({...ae,triggerDelay:parseInt(e.target.value)}),placeholder:"30"})]}),"SCROLL_PERCENTAGE"===ae.trigger&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"triggerScrollPercentage",children:"Porcentagem de Rolagem (%)"}),e.jsx(u,{id:"triggerScrollPercentage",type:"number",min:"0",max:"100",value:ae.triggerScrollPercentage||"",onChange:e=>se({...ae,triggerScrollPercentage:parseInt(e.target.value)}),placeholder:"75"})]}),"IDLE"===ae.trigger&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"triggerIdleTime",children:"Tempo de Inatividade (segundos)"}),e.jsx(u,{id:"triggerIdleTime",type:"number",value:ae.triggerIdleTime||"",onChange:e=>se({...ae,triggerIdleTime:parseInt(e.target.value)}),placeholder:"60"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"destinationUrl",children:"URL de Destino *"}),e.jsx(u,{id:"destinationUrl",type:"url",value:ae.destinationUrl,onChange:e=>se({...ae,destinationUrl:e.target.value}),placeholder:"https://example.com/oferta"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"status",children:"Status"}),e.jsxs(b,{value:ae.status,onValueChange:e=>se({...ae,status:e}),children:[e.jsx(T,{children:e.jsx(E,{})}),e.jsxs(A,{children:[e.jsx(S,{value:"ACTIVE",children:"Ativo"}),e.jsx(S,{value:"INACTIVE",children:"Inativo"}),e.jsx(S,{value:"SCHEDULED",children:"Agendado"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{id:"openInNewTab",checked:ae.openInNewTab,onCheckedChange:e=>se({...ae,openInNewTab:e})}),e.jsx(h,{htmlFor:"openInNewTab",className:"cursor-pointer",children:"Abrir em nova aba"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{id:"showConfirmation",checked:ae.showConfirmation,onCheckedChange:e=>se({...ae,showConfirmation:e})}),e.jsx(h,{htmlFor:"showConfirmation",className:"cursor-pointer",children:"Mostrar confirmação antes de redirecionar"})]})]}),ae.showConfirmation&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"confirmationMessage",children:"Mensagem de Confirmação"}),e.jsx(P,{id:"confirmationMessage",value:ae.confirmationMessage||"",onChange:e=>se({...ae,confirmationMessage:e.target.value}),placeholder:"Deseja ser redirecionado para nossa oferta especial?",rows:2})]}),e.jsxs(k,{children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs(D,{children:["Esta regra será acionada quando o trigger"," ",e.jsx("strong",{children:de(ae.trigger||"POST_PURCHASE")})," ","for detectado.",ae.openInNewTab?" O redirecionamento abrirá em nova aba.":" O redirecionamento será na mesma janela."]})]})]}),e.jsxs(C,{children:[e.jsx(i,{variant:"outline",onClick:()=>{ee(!1),te(null),oe()},children:"Cancelar"}),e.jsx(i,{onClick:async()=>{try{if(!ne?.id)return;if(!ae.name||!ae.destinationUrl)return void ie({title:"Campos obrigatórios",description:"Preencha nome e URL de destino",variant:"destructive"});const e={...ae,userId:ne.id};re?(await X.updateRule(re.id,ae),ie({title:"Regra atualizada com sucesso!"})):(await X.createRule(e),ie({title:"Regra criada com sucesso!"})),ee(!1),te(null),oe(),le()}catch(e){ie({title:"Erro ao salvar",description:e.message,variant:"destructive"})}},children:"Salvar"})]})]})})]})};export{Y as default};
