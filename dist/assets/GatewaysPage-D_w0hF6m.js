import{s as n,r as d,f as _,u as R,j as e,g as b,h as W,i as H,l as N,a8 as X,I as g,C as E,n as F,B as y,an as P}from"./index-DKyyon9m.js";import{D as Y,a as V,b as $,c as J,e as Q}from"./dialog-3ciyg0P0.js";import{L as h}from"./label-3OPg2MSJ.js";import{S as D}from"./switch-eVE53Nhx.js";import{T as Z,a as ee,b as j}from"./tabs-DCezHv1y.js";import{S as ae}from"./skeleton-B8_zI6OO.js";import{W as te}from"./wallet-BYuXmNyE.js";import{B as se}from"./building-2-Cmx-G2tz.js";import{C as q}from"./circle-check-QORYzP-T.js";import"./index-CbDtDFJK.js";import"./index-Cxz1Wjyj.js";const re={async list(s){try{let t=n.from("Gateway").select("*").eq("isActive",!0).order("isPopular",{ascending:!1}).order("name",{ascending:!0});s!=null&&s.type&&(t=t.eq("type",s.type)),(s==null?void 0:s.isPopular)!==void 0&&(t=t.eq("isPopular",s.isPopular)),(s==null?void 0:s.supportsPix)!==void 0&&(t=t.eq("supportsPix",s.supportsPix)),(s==null?void 0:s.supportsCreditCard)!==void 0&&(t=t.eq("supportsCreditCard",s.supportsCreditCard));const{data:i,error:c}=await t;if(c)throw c;return i}catch(t){throw console.error("Error listing gateways:",t),t}},async getById(s){try{const{data:t,error:i}=await n.from("Gateway").select("*").eq("id",s).single();if(i)throw i;return t}catch(t){throw console.error("Error getting gateway:",t),t}},async getBySlug(s){try{const{data:t,error:i}=await n.from("Gateway").select("*").eq("slug",s).single();if(i)throw i;return t}catch(t){throw console.error("Error getting gateway by slug:",t),t}},async listPopular(){try{const{data:s,error:t}=await n.from("Gateway").select("*").eq("isActive",!0).eq("isPopular",!0).order("name",{ascending:!0});if(t)throw t;return s}catch(s){throw console.error("Error listing popular gateways:",s),s}}},A={async list(){try{const{data:s,error:t}=await n.from("GatewayConfig").select("*, Gateway(*)").order("isDefault",{ascending:!1}).order("createdAt",{ascending:!1});if(t)throw t;return s}catch(s){throw console.error("Error listing gateway configs:",s),s}},async getById(s){try{const{data:t,error:i}=await n.from("GatewayConfig").select("*, Gateway(*)").eq("id",s).single();if(i)throw i;return t}catch(t){throw console.error("Error getting gateway config:",t),t}},async getDefault(){try{const{data:s,error:t}=await n.from("GatewayConfig").select("*, Gateway(*)").eq("isDefault",!0).eq("isActive",!0).single();if(t)throw t;return s}catch(s){throw console.error("Error getting default gateway:",s),s}},async create(s){try{s.isDefault&&await n.from("GatewayConfig").update({isDefault:!1}).eq("organizationId",s.organizationId);const{data:t,error:i}=await n.from("GatewayConfig").insert(s).select().single();if(i)throw i;return t}catch(t){throw console.error("Error creating gateway config:",t),t}},async update(s,t){try{if(t.isDefault){const m=await n.from("GatewayConfig").select("organizationId").eq("id",s).single();m.data&&await n.from("GatewayConfig").update({isDefault:!1}).eq("organizationId",m.data.organizationId)}const{data:i,error:c}=await n.from("GatewayConfig").update({...t,updatedAt:new Date().toISOString()}).eq("id",s).select().single();if(c)throw c;return i}catch(i){throw console.error("Error updating gateway config:",i),i}},async toggleActive(s,t){try{const{data:i,error:c}=await n.from("GatewayConfig").update({isActive:t,updatedAt:new Date().toISOString()}).eq("id",s).select().single();if(c)throw c;return i}catch(i){throw console.error("Error toggling gateway:",i),i}},async setAsDefault(s){try{const t=await n.from("GatewayConfig").select("organizationId").eq("id",s).single();if(!t.data)throw new Error("Gateway config not found");await n.from("GatewayConfig").update({isDefault:!1}).eq("organizationId",t.data.organizationId);const{data:i,error:c}=await n.from("GatewayConfig").update({isDefault:!0,updatedAt:new Date().toISOString()}).eq("id",s).select().single();if(c)throw c;return i}catch(t){throw console.error("Error setting default gateway:",t),t}},async delete(s){try{const{error:t}=await n.from("GatewayConfig").delete().eq("id",s);if(t)throw t}catch(t){throw console.error("Error deleting gateway config:",t),t}},async testConnection(s){try{return{success:!0,message:"Conexão testada com sucesso"}}catch(t){throw console.error("Error testing gateway connection:",t),t}}},pe=()=>{const[s,t]=d.useState([]),[i,c]=d.useState([]),[m,L]=d.useState(!0),[G,z]=d.useState(""),[u,B]=d.useState(null),[M,f]=d.useState(!1),[v,O]=d.useState("ALL"),{toast:w}=_(),x=R(a=>a.user),[r,l]=d.useState({apiKey:"",secretKey:"",publicKey:"",webhookUrl:"",pixFee:0,creditCardFee:0,boletoFee:0,isTestMode:!0,isActive:!0});d.useEffect(()=>{S()},[]);const S=async()=>{try{const a=await re.list();if(t(a),x!=null&&x.organizationId){const o=await A.list();c(o)}}catch(a){w({title:"Erro ao carregar gateways",description:a.message,variant:"destructive"})}finally{L(!1)}},T=a=>{B(a);const o=i.find(p=>p.gatewayId===a.id);l(o?{apiKey:o.credentials.apiKey||"",secretKey:o.credentials.secretKey||"",publicKey:o.credentials.publicKey||"",webhookUrl:o.webhookUrl||"",pixFee:o.pixFee||0,creditCardFee:o.creditCardFee||0,boletoFee:o.boletoFee||0,isTestMode:o.isTestMode,isActive:o.isActive}:{apiKey:"",secretKey:"",publicKey:"",webhookUrl:"",pixFee:0,creditCardFee:0,boletoFee:0,isTestMode:!0,isActive:!0}),f(!0)},U=async()=>{try{if(!(x!=null&&x.organizationId)||!u)return;const a=i.find(p=>p.gatewayId===u.id),o={apiKey:r.apiKey,secretKey:r.secretKey,publicKey:r.publicKey};a?(await A.update(a.id,{credentials:o,webhookUrl:r.webhookUrl,pixFee:r.pixFee,creditCardFee:r.creditCardFee,boletoFee:r.boletoFee,isTestMode:r.isTestMode,isActive:r.isActive}),w({title:"Configuração atualizada!"})):(await A.create({organizationId:x.organizationId,gatewayId:u.id,credentials:o,webhookUrl:r.webhookUrl,pixFee:r.pixFee,creditCardFee:r.creditCardFee,boletoFee:r.boletoFee,isTestMode:r.isTestMode,isActive:r.isActive,isDefault:!1}),w({title:"Gateway configurado!",description:"O gateway está pronto para uso."})),f(!1),S()}catch(a){w({title:"Erro ao salvar",description:a.message,variant:"destructive"})}},K=a=>i.some(o=>o.gatewayId===a&&o.isActive),C=s.filter(a=>{const o=a.name.toLowerCase().includes(G.toLowerCase()),p=v==="ALL"||a.type===v;return o&&p}),I=C.filter(a=>a.isPopular),k=C.filter(a=>!a.isPopular);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Gateways de Pagamento"}),e.jsxs("p",{className:"text-muted-foreground",children:["Configure e gerencie seus gateways de pagamento (",s.length," disponíveis)"]})]}),e.jsxs(b,{children:[e.jsx(W,{children:e.jsx(H,{className:"text-lg",children:"Gateways Configurados"})}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.filter(a=>a.isActive).length}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["de ",s.length," gateways disponíveis"]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(g,{placeholder:"Buscar gateway...",value:G,onChange:a=>z(a.target.value),className:"pl-9"})]}),e.jsx(Z,{value:v,onValueChange:a=>O(a),children:e.jsxs(ee,{children:[e.jsx(j,{value:"ALL",children:"Todos"}),e.jsx(j,{value:"PAYMENT_PROCESSOR",children:"Processadores"}),e.jsx(j,{value:"WALLET",children:"Wallets"}),e.jsx(j,{value:"BANK",children:"Bancos"})]})})]}),m?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((a,o)=>e.jsx(ae,{className:"h-32"},o))}):e.jsxs(e.Fragment,{children:[I.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Gateways Populares"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:I.map(a=>e.jsx(b,{className:"hover:shadow-md transition-shadow",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"w-12 h-12 rounded bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0",children:[a.type==="PAYMENT_PROCESSOR"&&e.jsx(E,{className:"h-6 w-6 text-white"}),a.type==="WALLET"&&e.jsx(te,{className:"h-6 w-6 text-white"}),a.type==="BANK"&&e.jsx(se,{className:"h-6 w-6 text-white"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:a.name}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[a.supportsPix&&e.jsx(F,{variant:"outline",className:"text-xs",children:"PIX"}),a.supportsCreditCard&&e.jsx(F,{variant:"outline",className:"text-xs",children:"Cartão"}),a.supportsBoleto&&e.jsx(F,{variant:"outline",className:"text-xs",children:"Boleto"})]}),K(a.id)&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-green-600",children:[e.jsx(q,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs font-medium",children:"Configurado"})]})]})]}),e.jsx(y,{size:"sm",variant:"outline",onClick:()=>T(a),children:e.jsx(P,{className:"h-4 w-4"})})]})})},a.id))})]}),k.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Outros Gateways"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:k.map(a=>e.jsx(b,{className:"hover:shadow transition-shadow",children:e.jsx(N,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-bold",children:a.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium truncate",children:a.name}),K(a.id)&&e.jsx(q,{className:"h-3 w-3 text-green-600"})]})]}),e.jsx(y,{size:"sm",variant:"ghost",onClick:()=>T(a),children:e.jsx(P,{className:"h-3 w-3"})})]})})},a.id))})]})]}),e.jsx(Y,{open:M,onOpenChange:f,children:e.jsxs(V,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx($,{children:e.jsxs(J,{children:["Configurar ",u==null?void 0:u.name]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"API Key *"}),e.jsx(g,{value:r.apiKey,onChange:a=>l({...r,apiKey:a.target.value}),placeholder:"sk_live_xxx"})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Secret Key"}),e.jsx(g,{value:r.secretKey,onChange:a=>l({...r,secretKey:a.target.value}),placeholder:"secret_xxx"})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Public Key"}),e.jsx(g,{value:r.publicKey,onChange:a=>l({...r,publicKey:a.target.value}),placeholder:"pk_live_xxx"})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Webhook URL"}),e.jsx(g,{value:r.webhookUrl,onChange:a=>l({...r,webhookUrl:a.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Taxa PIX (%)"}),e.jsx(g,{type:"number",step:"0.01",value:r.pixFee,onChange:a=>l({...r,pixFee:parseFloat(a.target.value)})})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Taxa Cartão (%)"}),e.jsx(g,{type:"number",step:"0.01",value:r.creditCardFee,onChange:a=>l({...r,creditCardFee:parseFloat(a.target.value)})})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Taxa Boleto (R$)"}),e.jsx(g,{type:"number",step:"0.01",value:r.boletoFee,onChange:a=>l({...r,boletoFee:parseFloat(a.target.value)})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{checked:r.isTestMode,onCheckedChange:a=>l({...r,isTestMode:a})}),e.jsx(h,{children:"Modo de Teste"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{checked:r.isActive,onCheckedChange:a=>l({...r,isActive:a})}),e.jsx(h,{children:"Ativo"})]})]})]}),e.jsxs(Q,{children:[e.jsx(y,{variant:"outline",onClick:()=>f(!1),children:"Cancelar"}),e.jsx(y,{onClick:U,children:"Salvar Configuração"})]})]})}),C.length===0&&!m&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhum gateway encontrado"})]})]})};export{pe as default};
