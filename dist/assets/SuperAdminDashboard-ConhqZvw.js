import{a as T,r as o,s as a,U as c,o as I,m as D,j as e,C as x,c as p,d as h,f,e as O}from"./index-C1Nu6yIE.js";import{A as q,a as z,b as G}from"./alert-eNWsxrwB.js";import{S as d}from"./SuperAdminLayout-BnAjlSnb.js";import{D as j}from"./dollar-sign-2Pj0-gGN.js";import{M as L}from"./message-square-DUHJ6kPH.js";import{C as V}from"./circle-alert-BGXsQdat.js";import{A as P}from"./arrow-right-DNt3Fgjm.js";import"./Logo-S9fQjXj9.js";function W(){const b=T(),[s,v]=o.useState({totalClients:0,activeClients:0,totalUsers:0,totalRevenue:0,monthlyRevenue:0,totalAiConnections:0,totalMessages:0,totalTokens:0,gatewaysConfigured:0}),[C,m]=o.useState(!0),[N,u]=o.useState(!1);o.useEffect(()=>{y()},[]);const y=async()=>{try{const{error:t}=await a.from("Organization").select("*",{count:"exact",head:!0});if(t&&t.message.includes("does not exist")){u(!0),m(!1);return}const{count:r}=await a.from("Organization").select("*",{count:"exact",head:!0}),{count:n}=await a.from("Organization").select("*",{count:"exact",head:!0}).eq("status","ACTIVE"),{count:k}=await a.from("User").select("*",{count:"exact",head:!0}),{count:A}=await a.from("GlobalAiConnection").select("*",{count:"exact",head:!0}),{count:E}=await a.from("ChatMessage").select("*",{count:"exact",head:!0}),{data:M}=await a.from("AiUsage").select("tokensUsed"),S=(M||[]).reduce((i,l)=>i+(l.tokensUsed||0),0),U={FREE:0,STARTER:49.9,PRO:199.9,ENTERPRISE:999.9},{data:$}=await a.from("Organization").select("plan").eq("status","ACTIVE"),g=($||[]).reduce((i,l)=>i+(U[l.plan]||0),0);v({totalClients:r||0,activeClients:n||0,totalUsers:k||0,totalRevenue:g*3,monthlyRevenue:g,totalAiConnections:A||0,totalMessages:E||0,totalTokens:S,gatewaysConfigured:2})}catch(t){console.error("Error loading stats:",t),u(!0)}finally{m(!1)}},w=[{title:"Usuários",description:"Gerenciar todos os usuários",icon:c,color:"from-blue-500 to-cyan-500",stats:`${s.totalUsers} usuários`,route:"/super-admin/clients"},{title:"Faturamento",description:"Receita e pagamentos",icon:j,color:"from-green-500 to-emerald-500",stats:`R$ ${s.monthlyRevenue.toLocaleString("pt-BR")} MRR`,route:"/super-admin/billing"},{title:"Uso de IA",description:"Mensagens e tokens processados",icon:I,color:"from-purple-500 to-pink-500",stats:`${s.totalMessages} mensagens`,route:"/super-admin/usage"},{title:"Gateways",description:"Meios de pagamento",icon:D,color:"from-orange-500 to-red-500",stats:`${s.gatewaysConfigured} configurados`,route:"/super-admin/gateways"}],R=[{title:"Usuários Ativos",value:s.activeClients,description:`${s.totalUsers} total`,icon:c,color:"text-blue-600",bgColor:"bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20",change:"+12%"},{title:"MRR",value:`R$ ${s.monthlyRevenue.toLocaleString("pt-BR")}`,description:"Receita mensal",icon:j,color:"text-green-600",bgColor:"bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20",change:"+8%"},{title:"Usuários",value:s.totalUsers,description:"Total no sistema",icon:c,color:"text-purple-600",bgColor:"bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20",change:"+23%"},{title:"Mensagens IA",value:s.totalMessages,description:"Chat processado",icon:L,color:"text-amber-600",bgColor:"bg-gradient-to-br from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20",change:"+45%"}];return C?e.jsx(d,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-76px)]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})})}):N?e.jsx(d,{children:e.jsx("div",{className:"p-8",children:e.jsxs(q,{variant:"destructive",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx(z,{children:"Migration Necessária"}),e.jsxs(G,{children:["As tabelas do SaaS ainda não foram criadas. Execute a migration primeiro:",e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{className:"bg-black/10 px-2 py-1 rounded text-sm",children:"supabase_migrations/saas_architecture.sql"}),e.jsx("br",{}),e.jsx("br",{}),"Veja instruções em: ",e.jsx("strong",{children:"EXECUTAR_MIGRATION.md"})]})]})})}):e.jsx(d,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Dashboard"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Visão geral da plataforma"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:R.map((t,r)=>{const n=t.icon;return e.jsxs(x,{className:"overflow-hidden",children:[e.jsx("div",{className:`h-2 ${t.bgColor}`}),e.jsxs(p,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:t.title}),e.jsx("div",{className:`p-2 rounded-lg ${t.bgColor}`,children:e.jsx(n,{className:`h-5 w-5 ${t.color}`})})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-3xl font-bold",children:t.value}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description}),e.jsx("span",{className:"text-xs font-medium text-green-600",children:t.change})]})]})]},r)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Acesso Rápido"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:w.map(t=>{const r=t.icon;return e.jsxs(x,{className:"group cursor-pointer hover:shadow-xl transition-all duration-300 overflow-hidden relative",onClick:()=>b(t.route),children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${t.color} opacity-0 group-hover:opacity-10 transition-opacity`}),e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${t.color}`,children:e.jsx(r,{className:"h-6 w-6 text-white"})}),e.jsx(P,{className:"h-5 w-5 text-gray-400 group-hover:text-blue-600 group-hover:translate-x-1 transition-all"})]}),e.jsx(h,{className:"mt-4",children:t.title}),e.jsx(O,{children:t.description})]}),e.jsx(f,{children:e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:t.stats})})]},t.route)})})]})]})})}export{W as default};
