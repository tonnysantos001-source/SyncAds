import{b as z,a as R,r as d,s as c,j as e,i as A,B as r,d as m,e as x,f as h,h as u,I as L,aJ as q}from"./index-0kr0DzAb.js";import{L as j}from"./label-BXryy7kj.js";import{S as P,a as $,b as Z,c as B,d as f}from"./select-COouhwtD.js";import{A as Q,a as X}from"./alert-vwISppXQ.js";import{A as G}from"./arrow-left-CF2GUgDA.js";import{C as y}from"./copy-DfE4ie0d.js";import{C as g}from"./circle-alert-DKEE5ksJ.js";import{C as D}from"./circle-check-DDol4gSa.js";import{E as _}from"./external-link-fY1dapki.js";import"./index-ovLsy2RU.js";function oe(){const{toast:t}=z(),I=R(),[b,E]=d.useState([]),[V,O]=d.useState(!0),[T,N]=d.useState(!1),[C,k]=d.useState(!1),[o,v]=d.useState({subdomain:"checkout",domain:""});d.useEffect(()=>{p()},[]);const p=async()=>{try{const{data:{user:a}}=await c.auth.getUser();if(!a)return;const{data:s}=await c.from("User").select("domain, domainVerified").eq("id",a.id).single();s!=null&&s.domain&&E([{id:"1",domain:s.domain,subdomain:"checkout",cnameRecord:S(s.domain),verified:s.domainVerified||!1,sslConfigured:!1,createdAt:new Date().toISOString()}])}catch(a){console.error("Erro ao carregar domínios:",a)}finally{O(!1)}},S=a=>{const s=a.split("").reduce((l,n)=>(l<<5)-l+n.charCodeAt(0)|0,0);return`checkout-${Math.abs(s).toString(36)}.syncads.com.br`},U=async()=>{if(!o.domain){t({title:"Erro",description:"Por favor, preencha o domínio",variant:"destructive"});return}try{const{data:{user:a}}=await c.auth.getUser();if(!a)return;const s=S(o.domain),l=`${o.subdomain}.${o.domain}`,{error:n}=await c.from("User").update({domain:l,domainVerified:!1,domainVerificationToken:crypto.randomUUID(),domainVerificationMethod:"DNS"}).eq("id",a.id);if(n)throw n;t({title:"Domínio cadastrado",description:"Agora você precisa configurar o DNS no seu provedor"}),await p(),N(!1),v({subdomain:"checkout",domain:""})}catch(a){console.error("Erro ao adicionar domínio:",a),t({title:"Erro",description:"Não foi possível cadastrar o domínio",variant:"destructive"})}},M=async()=>{k(!0);try{const{data:{user:a}}=await c.auth.getUser();if(!a)return;const{data:s}=await c.auth.getSession(),l=await fetch(`${q.functionsUrl}/verify-domain`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s==null?void 0:s.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92c2tlcHFnZ214bGZja3hxZ2JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4MjQ4NTUsImV4cCI6MjA3NjQwMDg1NX0.UdNgqpTN38An6FuoJPZlj_zLkmAqfJQXb6i1DdTQO_E"},body:JSON.stringify({subdomain:i.subdomain,domain:i.domain})}),n=await l.json();if(!l.ok||!n.verified)throw new Error(n.details||n.reason||"Verificação falhou");t({title:"Domínio verificado com sucesso!",description:"Seu domínio está pronto para uso"}),await p()}catch(a){console.error("Erro ao verificar domínio:",a),t({title:"Erro",description:a.message||"Não foi possível verificar o domínio. Verifique se o DNS está configurado corretamente.",variant:"destructive"})}finally{k(!1)}},w=(a,s)=>{navigator.clipboard.writeText(a),t({title:"Copiado!",description:`${s} copiado para a área de transferência`})},F=async()=>{try{const{data:{user:a}}=await c.auth.getUser();if(!a)return;const{error:s}=await c.from("User").update({domain:null,domainVerified:!1,domainVerificationToken:null}).eq("id",a.id);if(s)throw s;t({title:"Domínio excluído",description:"O domínio foi removido com sucesso"}),await p()}catch(a){console.error("Erro ao excluir domínio:",a),t({title:"Erro",description:"Não foi possível excluir o domínio",variant:"destructive"})}};if(V)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(A,{className:"h-8 w-8 animate-spin text-gray-400"})});if(b.length===0)return e.jsx("div",{children:e.jsxs("div",{className:"p-6 sm:p-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Você ainda não tem nenhum domínio cadastrado."}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400 mb-8",children:"Cadastrando seu domínio você aumenta a credibilidade e conversão da sua loja."}),e.jsx(r,{size:"lg",onClick:()=>N(!0),className:"bg-pink-600 hover:bg-pink-700 text-white",children:"CADASTRAR DOMÍNIO"})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(m,{className:"w-full max-w-md",children:[e.jsx(x,{children:e.jsx(h,{className:"uppercase text-lg",children:"Adicionar novo domínio"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Domínio"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{value:o.subdomain,onValueChange:a=>v({...o,subdomain:a}),children:[e.jsx($,{className:"w-[140px]",children:e.jsx(Z,{})}),e.jsxs(B,{children:[e.jsx(f,{value:"checkout",children:"checkout."}),e.jsx(f,{value:"seguro",children:"seguro."}),e.jsx(f,{value:"secure",children:"secure."}),e.jsx(f,{value:"pay",children:"pay."})]})]}),e.jsx(L,{placeholder:"ex.: sualoja.com.br",value:o.domain,onChange:a=>v({...o,domain:a.target.value})})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("p",{children:"• Vincule um domínio que já pertença a você."}),e.jsx("p",{children:"• Não use http, https, www e url da sua loja myshopify."})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(r,{variant:"outline",className:"flex-1",onClick:()=>N(!1),children:"Cancelar"}),e.jsx(r,{className:"flex-1 bg-pink-600 hover:bg-pink-700",onClick:U,children:"Salvar"})]})]})]})})]})});const i=b[0],J=`${i.subdomain}.${i.domain}`;return e.jsx("div",{children:e.jsx("div",{className:"p-6 sm:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>I("/onboarding"),className:"text-pink-600 hover:text-pink-700 mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"ver todos os domínios"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"CONFIGURAÇÃO DO DOMÍNIO"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:J})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(m,{children:[e.jsx(x,{children:e.jsx(h,{children:"Cadastrando o apontamento"})}),e.jsxs(u,{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Em seu provedor, na seção de configuração registros DNS, adicione as informações abaixo. Preencha cada campo com as respectivas informações listadas abaixo:"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"text-xs uppercase tracking-wide",children:"Tipo"}),e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>w("CNAME","Tipo"),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"CNAME"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"text-xs uppercase tracking-wide",children:"Nome"}),e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>w(i.subdomain,"Nome"),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),i.subdomain]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"text-xs uppercase tracking-wide",children:"Valor"}),e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>w(i.cnameRecord,"Valor"),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),i.cnameRecord]})]})]}),e.jsxs(Q,{children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx(X,{children:"Após realizar corretamente os apontamentos acima em seu provedor de domínio, você deve aguardar um tempo para que as informações sejam propagadas. Esse processo costuma levar até 4h."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(r,{variant:"outline",className:"flex-1",onClick:F,children:"Excluir domínio"}),e.jsx(r,{className:"flex-1 bg-pink-600 hover:bg-pink-700 text-white",onClick:M,disabled:C||i.verified,children:C?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-4 w-4 mr-2 animate-spin"}),"Verificando..."]}):"VERIFICAR DOMÍNIO"})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(x,{children:e.jsx(h,{className:"text-sm",children:"Status"})}),e.jsx(u,{children:e.jsx("div",{className:"flex items-center gap-2",children:i.verified?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-green-500 font-medium",children:"Concluído"})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-yellow-500 font-medium",children:"Pendente"})]})})})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsx(h,{className:"text-sm",children:"SSL"})}),e.jsx(u,{children:e.jsx("div",{className:"flex items-center gap-2",children:i.sslConfigured?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-green-500 font-medium",children:"Concluído"})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-yellow-500 font-medium",children:"Pendente"})]})})})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs(h,{className:"text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-pink-100 flex items-center justify-center",children:e.jsx(g,{className:"h-5 w-5 text-pink-600"})}),"Está com dúvidas?"]})}),e.jsxs(u,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Aprenda como verificar o domínio da sua loja."}),e.jsxs(r,{variant:"link",className:"p-0",children:["Ver tutorial ",e.jsx(_,{className:"h-4 w-4 ml-1"})]})]})]})]})]})]})})})}export{oe as default};
