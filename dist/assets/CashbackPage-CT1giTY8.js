import{s as y,c as le,r as b,bg as Te,v as Ie,j as e,l as Re,t as De,P as q,bw as de,bx as Pe,by as Se,y as B,z as Ve,m as W,d as Le,a as Fe,O,B as D,C as $,e as _,f as z,g as Q,a7 as Oe,h as H,o as Y,a6 as Z,I as P}from"./index-CQ2-MXC2.js";import{L as R}from"./label-C_QFaouH.js";import{T as ee,a as ae,b as U,c as k,d as te,e as A}from"./table-6mNi2wwQ.js";import{D as qe,b as Me,c as Ge,d as Be,e as Ue,f as $e}from"./dialog--fm4oCwZ.js";import{S as se,a as re,b as oe,c as ne,d as S}from"./select-sqyP70Fp.js";import{S as ce}from"./switch-ceSPAkPh.js";import{A as _e,a as ze}from"./alert-KmCnlS80.js";import{S as V}from"./skeleton-CTl8BRHF.js";import{P as ie}from"./plus-C_SSMLWF.js";import{W as He}from"./wallet-CQQ9rEKW.js";import{D as Xe}from"./dollar-sign-CYjdeJpZ.js";import{U as Ke}from"./users-CkIcIneo.js";import{S as We}from"./square-pen-BD4CEcKs.js";import{T as Je}from"./trash-2-BY4qoUQG.js";import{C as L}from"./circle-alert-DWQEYNPT.js";import{f as Qe,p as Ye}from"./pt-BR-BQ5kKd2v.js";import"./index-B61Y-YZA.js";import"./constructFrom-rJN6zrQ_.js";const x={async createRule(s){try{const{data:a,error:t}=await y.from("Cashback").insert(s).select().single();if(t)throw t;return a}catch(a){throw console.error("Error creating cashback rule:",a),a}},async updateRule(s,a){try{const{data:t,error:r}=await y.from("Cashback").update({...a,updatedAt:new Date().toISOString()}).eq("id",s).select().single();if(r)throw r;return t}catch(t){throw console.error("Error updating cashback rule:",t),t}},async deleteRule(s){try{const{error:a}=await y.from("Cashback").delete().eq("id",s);if(a)throw a}catch(a){throw console.error("Error deleting cashback rule:",a),a}},async listRules(s,a){try{let t=y.from("Cashback").select("*").eq("userId",s).order("createdAt",{ascending:!1});a!=null&&a.status&&(t=t.eq("status",a.status)),(a==null?void 0:a.active)!==void 0&&(a.active?t=t.eq("status","ACTIVE"):t=t.neq("status","ACTIVE"));const{data:r,error:c}=await t;if(c)throw c;return r}catch(t){throw console.error("Error listing cashback rules:",t),t}},async getRuleById(s){try{const{data:a,error:t}=await y.from("Cashback").select("*").eq("id",s).single();if(t)throw t;return a}catch(a){throw console.error("Error getting cashback rule:",a),a}},async toggleRule(s,a){try{const t=a?"ACTIVE":"INACTIVE";return await x.updateRule(s,{status:t})}catch(t){throw console.error("Error toggling cashback rule:",t),t}},async createTransaction(s){try{const{data:a,error:t}=await y.from("CashbackTransaction").insert(s).select().single();if(t)throw t;return a}catch(a){throw console.error("Error creating cashback transaction:",a),a}},async updateTransaction(s,a){try{const{data:t,error:r}=await y.from("CashbackTransaction").update({...a,updatedAt:new Date().toISOString()}).eq("id",s).select().single();if(r)throw r;return t}catch(t){throw console.error("Error updating cashback transaction:",t),t}},async getTransactions(s,a){try{let t=y.from("CashbackTransaction").select("*").eq("userId",s).order("createdAt",{ascending:!1});a!=null&&a.customerId&&(t=t.eq("customerId",a.customerId)),a!=null&&a.status&&(t=t.eq("status",a.status)),a!=null&&a.orderId&&(t=t.eq("orderId",a.orderId)),a!=null&&a.dateFrom&&(t=t.gte("createdAt",a.dateFrom)),a!=null&&a.dateTo&&(t=t.lte("createdAt",a.dateTo)),a!=null&&a.limit&&(t=t.limit(a.limit));const{data:r,error:c}=await t;if(c)throw c;return r}catch(t){throw console.error("Error getting cashback transactions:",t),t}},async getTransactionById(s){try{const{data:a,error:t}=await y.from("CashbackTransaction").select("*").eq("id",s).single();if(t)throw t;return a}catch(a){throw console.error("Error getting cashback transaction:",a),a}},async getAvailableCashback(s){try{const{data:a,error:t}=await y.from("CashbackTransaction").select("amount").eq("customerId",s).eq("status","AVAILABLE");if(t)throw t;return a.reduce((c,u)=>c+u.amount,0)}catch(a){throw console.error("Error getting available cashback:",a),a}},async getCustomerCashback(s){try{const{data:a,error:t}=await y.from("CashbackTransaction").select("*").eq("customerId",s).order("createdAt",{ascending:!1});if(t)throw t;const r=a,c=r.filter(l=>l.status!=="CANCELLED").reduce((l,i)=>l+i.amount,0),u=r.filter(l=>l.status==="USED").reduce((l,i)=>l+i.amount,0),n=r.filter(l=>l.status==="AVAILABLE").reduce((l,i)=>l+i.amount,0),h=r.filter(l=>l.status==="EXPIRED").reduce((l,i)=>l+i.amount,0);return{customerId:s,totalEarned:c,totalUsed:u,available:n,expired:h,transactions:r}}catch(a){throw console.error("Error getting customer cashback:",a),a}},async useCashback(s,a,t){try{const r=await x.getTransactionById(s);if(r.status!=="AVAILABLE")throw new Error("Cashback não está disponível para uso");const c=t||r.amount;if(c>r.amount)throw new Error("Valor a usar maior que o disponível");if(c===r.amount)return await x.updateTransaction(s,{status:"USED",usedAt:new Date().toISOString(),usedInOrderId:a});const u=r.amount-c;return await x.updateTransaction(s,{amount:u}),await x.createTransaction({userId:r.userId,customerId:r.customerId,cashbackId:r.cashbackId,orderId:r.orderId,amount:c,status:"USED",earnedAt:r.earnedAt,usedAt:new Date().toISOString(),usedInOrderId:a})}catch(r){throw console.error("Error using cashback:",r),r}},async expireCashback(s){try{return await x.updateTransaction(s,{status:"EXPIRED"})}catch(a){throw console.error("Error expiring cashback:",a),a}},async cancelCashback(s,a){try{return await x.updateTransaction(s,{status:"CANCELLED",cancelledAt:new Date().toISOString(),cancellationReason:a})}catch(t){throw console.error("Error cancelling cashback:",t),t}},async processExpiredCashbacks(s){try{const a=new Date().toISOString(),{data:t,error:r}=await y.from("CashbackTransaction").select("id").eq("userId",s).eq("status","AVAILABLE").lt("expiresAt",a);if(r)throw r;const c=t,u=c.map(n=>x.expireCashback(n.id));return await Promise.all(u),c.length}catch(a){throw console.error("Error processing expired cashbacks:",a),a}},async getStats(s,a){try{const t=await x.listRules(s),r=t.length,c=t.filter(g=>g.status==="ACTIVE").length;let u=y.from("CashbackTransaction").select("*").eq("userId",s);a&&(u=u.gte("createdAt",a.from).lte("createdAt",a.to));const{data:n,error:h}=await u;if(h)throw h;const l=n,i=l.filter(g=>g.status!=="CANCELLED").reduce((g,C)=>g+C.amount,0),m=l.filter(g=>g.status==="USED").reduce((g,C)=>g+C.amount,0),p=l.filter(g=>g.status==="AVAILABLE").reduce((g,C)=>g+C.amount,0),d=l.filter(g=>g.status==="EXPIRED").reduce((g,C)=>g+C.amount,0),j=[...new Set(l.map(g=>g.customerId))].length,v=j>0?i/j:0,T={};for(const g of t){const C=l.filter(E=>E.cashbackId===g.id),G=[...new Set(C.map(E=>E.customerId))];T[g.id]={ruleId:g.id,ruleName:g.name,totalEarned:C.filter(E=>E.status!=="CANCELLED").reduce((E,f)=>E+f.amount,0),totalUsed:C.filter(E=>E.status==="USED").reduce((E,f)=>E+f.amount,0),totalCustomers:G.length}}return{totalRules:r,activeRules:c,totalEarned:i,totalUsed:m,totalAvailable:p,totalExpired:d,customersWithCashback:j,averageCashbackPerCustomer:v,byRule:T}}catch(t){throw console.error("Error getting cashback stats:",t),t}},async getTopCustomers(s,a=10,t="available"){try{const{data:r,error:c}=await y.from("CashbackTransaction").select("customerId, amount, status").eq("userId",s);if(c)throw c;const u=r,n=new Map;u.forEach(i=>{n.has(i.customerId)||n.set(i.customerId,{customerId:i.customerId,totalEarned:0,available:0,used:0});const m=n.get(i.customerId);i.status!=="CANCELLED"&&(m.totalEarned+=i.amount),i.status==="AVAILABLE"&&(m.available+=i.amount),i.status==="USED"&&(m.used+=i.amount)});const h=Array.from(n.values()),l=t==="earned"?"totalEarned":"available";return h.sort((i,m)=>m[l]-i[l]).slice(0,a)}catch(r){throw console.error("Error getting top customers:",r),r}},async calculateCashback(s,a,t,r){try{const u=(await x.listRules(s,{active:!0})).sort((n,h)=>{const l=n.type==="PERCENTAGE"?a*n.value/100:n.value;return(h.type==="PERCENTAGE"?a*h.value/100:h.value)-l});for(const n of u){if(n.minOrderValue&&a<n.minOrderValue||n.validFrom&&new Date(n.validFrom)>new Date||n.validUntil&&new Date(n.validUntil)<new Date||n.applicableToProducts&&n.applicableToProducts.length>0&&r&&!r.some(i=>n.applicableToProducts.includes(i))||n.excludedProducts&&n.excludedProducts.length>0&&r&&r.some(i=>n.excludedProducts.includes(i))||n.maxUsesPerCustomer&&(await x.getTransactions(s,{customerId:t})).filter(m=>m.cashbackId===n.id&&m.status!=="CANCELLED").length>=n.maxUsesPerCustomer||n.firstPurchaseOnly&&(await x.getTransactions(s,{customerId:t})).length>0)continue;let h=n.type==="PERCENTAGE"?a*n.value/100:n.value;return n.maxCashbackAmount&&h>n.maxCashbackAmount&&(h=n.maxCashbackAmount),{applicable:!0,amount:h,rule:n}}return{applicable:!1,amount:0,reason:"Nenhuma regra de cashback aplicável"}}catch(c){throw console.error("Error calculating cashback:",c),c}}};/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=le("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=le("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);var M="Tabs",[aa]=Re(M,[de]),ue=de(),[ta,J]=aa(M),he=b.forwardRef((s,a)=>{const{__scopeTabs:t,value:r,onValueChange:c,defaultValue:u,orientation:n="horizontal",dir:h,activationMode:l="automatic",...i}=s,m=Te(h),[p,d]=Ie({prop:r,onChange:c,defaultProp:u??"",caller:M});return e.jsx(ta,{scope:t,baseId:De(),value:p,onValueChange:d,orientation:n,dir:m,activationMode:l,children:e.jsx(q.div,{dir:m,"data-orientation":n,...i,ref:a})})});he.displayName=M;var me="TabsList",ge=b.forwardRef((s,a)=>{const{__scopeTabs:t,loop:r=!0,...c}=s,u=J(me,t),n=ue(t);return e.jsx(Pe,{asChild:!0,...n,orientation:u.orientation,dir:u.dir,loop:r,children:e.jsx(q.div,{role:"tablist","aria-orientation":u.orientation,...c,ref:a})})});ge.displayName=me;var xe="TabsTrigger",pe=b.forwardRef((s,a)=>{const{__scopeTabs:t,value:r,disabled:c=!1,...u}=s,n=J(xe,t),h=ue(t),l=fe(n.baseId,r),i=ye(n.baseId,r),m=r===n.value;return e.jsx(Se,{asChild:!0,...h,focusable:!c,active:m,children:e.jsx(q.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":i,"data-state":m?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:l,...u,ref:a,onMouseDown:B(s.onMouseDown,p=>{!c&&p.button===0&&p.ctrlKey===!1?n.onValueChange(r):p.preventDefault()}),onKeyDown:B(s.onKeyDown,p=>{[" ","Enter"].includes(p.key)&&n.onValueChange(r)}),onFocus:B(s.onFocus,()=>{const p=n.activationMode!=="manual";!m&&!c&&p&&n.onValueChange(r)})})})});pe.displayName=xe;var be="TabsContent",ve=b.forwardRef((s,a)=>{const{__scopeTabs:t,value:r,forceMount:c,children:u,...n}=s,h=J(be,t),l=fe(h.baseId,r),i=ye(h.baseId,r),m=r===h.value,p=b.useRef(m);return b.useEffect(()=>{const d=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(d)},[]),e.jsx(Ve,{present:c||m,children:({present:d})=>e.jsx(q.div,{"data-state":m?"active":"inactive","data-orientation":h.orientation,role:"tabpanel","aria-labelledby":l,hidden:!d,id:i,tabIndex:0,...n,ref:a,style:{...s.style,animationDuration:p.current?"0s":void 0},children:d&&u})})});ve.displayName=be;function fe(s,a){return`${s}-trigger-${a}`}function ye(s,a){return`${s}-content-${a}`}var sa=he,je=ge,Ce=pe,Ee=ve;const ra=sa,we=b.forwardRef(({className:s,...a},t)=>e.jsx(je,{ref:t,className:W("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a}));we.displayName=je.displayName;const X=b.forwardRef(({className:s,...a},t)=>e.jsx(Ce,{ref:t,className:W("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...a}));X.displayName=Ce.displayName;const K=b.forwardRef(({className:s,...a},t)=>e.jsx(Ee,{ref:t,className:W("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a}));K.displayName=Ee.displayName;const F=({title:s,value:a,icon:t,color:r,delay:c=0,subtitle:u})=>e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:c},children:e.jsxs($,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${r} opacity-10 rounded-full blur-3xl`}),e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(z,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:s}),e.jsx("div",{className:`p-2 rounded-lg ${r} bg-opacity-10`,children:e.jsx(t,{className:`h-5 w-5 ${r.replace("bg-","text-")}`})})]}),e.jsxs(H,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:a}),u&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:u})]})]})}),Ea=()=>{const[s,a]=b.useState([]),[t,r]=b.useState(null),[c,u]=b.useState([]),[n,h]=b.useState(!0),[l,i]=b.useState(!1),[m,p]=b.useState(null),[d,w]=b.useState({name:"",description:"",type:"PERCENTAGE",value:0,status:"ACTIVE",firstPurchaseOnly:!1}),{toast:j}=Le(),v=Fe(o=>o.user);b.useEffect(()=>{v!=null&&v.id&&T()},[v==null?void 0:v.id]);const T=async()=>{try{h(!0);const[o,N,I]=await Promise.all([x.listRules(v.id),x.getStats(v.id),x.getTopCustomers(v.id,10,"available")]);a(o),r(N),u(I)}catch(o){console.error("Erro ao carregar dados:",o),j({title:"Erro ao carregar dados",description:o.message,variant:"destructive"})}finally{h(!1)}},g=async()=>{try{if(!(v!=null&&v.id))return;if(!d.name||!d.value){j({title:"Campos obrigatórios",description:"Preencha nome e valor do cashback",variant:"destructive"});return}const o={...d,userId:v.id};m?(await x.updateRule(m.id,d),j({title:"Regra atualizada com sucesso!"})):(await x.createRule(o),j({title:"Regra criada com sucesso!"})),i(!1),p(null),w({name:"",description:"",type:"PERCENTAGE",value:0,status:"ACTIVE",firstPurchaseOnly:!1}),T()}catch(o){console.error("Erro ao salvar:",o),j({title:"Erro ao salvar",description:o.message,variant:"destructive"})}},C=o=>{p(o),w(o),i(!0)},G=async o=>{if(confirm("Deseja realmente excluir esta regra?"))try{await x.deleteRule(o),j({title:"Regra excluída com sucesso!"}),T()}catch(N){console.error("Erro ao excluir:",N),j({title:"Erro ao excluir",description:N.message,variant:"destructive"})}},E=async(o,N)=>{try{await x.toggleRule(o,N),j({title:N?"Regra ativada!":"Regra desativada!"}),T()}catch(I){console.error("Erro ao alternar status:",I),j({title:"Erro ao alternar status",description:I.message,variant:"destructive"})}},f=o=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o),Ne=o=>{const N={ACTIVE:{label:"Ativo",variant:"default",icon:Z},INACTIVE:{label:"Inativo",variant:"secondary",icon:L},EXPIRED:{label:"Expirado",variant:"destructive",icon:L},SCHEDULED:{label:"Agendado",variant:"secondary",icon:L}};return N[o]||N.INACTIVE};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(O.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 bg-clip-text text-transparent",children:"Cashback"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mt-2",children:"Recompense seus clientes com cashback automático"})]}),e.jsxs(D,{onClick:()=>i(!0),size:"lg",className:"shadow-lg hover:shadow-xl transition-all",children:[e.jsx(ie,{className:"h-5 w-5 mr-2"}),"Nova Regra"]})]}),t&&e.jsxs("div",{className:"grid gap-6 md:grid-cols-4",children:[e.jsx(F,{title:"Regras Ativas",value:t.activeRules,icon:Ze,color:"bg-green-500",delay:.1,subtitle:`de ${t.totalRules} regras`}),e.jsx(F,{title:"Total Distribuído",value:f(t.totalEarned),icon:He,color:"bg-emerald-500",delay:.2,subtitle:"Cashback total gerado"}),e.jsx(F,{title:"Disponível",value:f(t.totalAvailable),icon:Xe,color:"bg-teal-500",delay:.3,subtitle:"Aguardando uso"}),e.jsx(F,{title:"Clientes Ativos",value:t.customersWithCashback,icon:Ke,color:"bg-blue-500",delay:.4,subtitle:`Média: ${f(t.averageCashbackPerCustomer)}`})]}),e.jsxs(ra,{defaultValue:"rules",className:"space-y-4",children:[e.jsxs(we,{children:[e.jsx(X,{value:"rules",children:"Regras"}),e.jsx(X,{value:"customers",children:"Top Clientes"})]}),e.jsx(K,{value:"rules",className:"space-y-4",children:e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},children:e.jsxs($,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(z,{className:"text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:"Regras de Cashback"}),e.jsxs(Q,{children:[s.length," regra(s) cadastrada(s)"]})]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:T,children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]}),e.jsx(H,{children:n?e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"h-12 w-full"}),e.jsx(V,{className:"h-12 w-full"}),e.jsx(V,{className:"h-12 w-full"})]}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-gradient-to-br from-green-500 to-teal-500 mb-4",children:e.jsx(ea,{className:"h-12 w-12 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhuma regra cadastrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-md",children:"Crie sua primeira regra de cashback e fidelize seus clientes"}),e.jsxs(D,{onClick:()=>i(!0),size:"lg",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Criar Primeira Regra"]})]}):e.jsx("div",{className:"rounded-md border border-gray-200 dark:border-gray-800",children:e.jsxs(ee,{children:[e.jsx(ae,{children:e.jsxs(U,{className:"hover:bg-transparent",children:[e.jsx(k,{children:"Nome"}),e.jsx(k,{children:"Tipo"}),e.jsx(k,{children:"Valor"}),e.jsx(k,{children:"Status"}),e.jsx(k,{children:"Primeira Compra"}),e.jsx(k,{children:"Criado em"}),e.jsx(k,{className:"text-right",children:"Ações"})]})}),e.jsx(te,{children:s.map((o,N)=>{const I=Ne(o.status),ke=I.icon;return e.jsxs(O.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:N*.05},className:"hover:bg-gray-50/50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx(A,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:o.name}),o.description&&e.jsx("div",{className:"text-sm text-muted-foreground",children:o.description})]})}),e.jsx(A,{children:e.jsx(Y,{variant:"outline",className:"font-medium",children:o.type==="PERCENTAGE"?"Percentual":"Valor Fixo"})}),e.jsxs(A,{children:[e.jsx("div",{className:"font-medium",children:o.type==="PERCENTAGE"?`${o.value}%`:f(o.value)}),o.minOrderValue&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Min: ",f(o.minOrderValue)]})]}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Y,{variant:I.variant,className:"gap-1",children:[e.jsx(ke,{className:"h-3 w-3"}),I.label]}),e.jsx(ce,{checked:o.status==="ACTIVE",onCheckedChange:Ae=>E(o.id,Ae)})]})}),e.jsx(A,{children:o.firstPurchaseOnly?e.jsx(Z,{className:"h-4 w-4 text-green-600"}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(A,{children:Qe(new Date(o.createdAt),"dd/MM/yyyy",{locale:Ye})}),e.jsx(A,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>C(o),className:"hover:bg-blue-50 hover:text-blue-600 dark:hover:bg-blue-950",children:e.jsx(We,{className:"h-4 w-4"})}),e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>G(o.id),className:"hover:bg-red-50 hover:text-red-600 dark:hover:bg-red-950",children:e.jsx(Je,{className:"h-4 w-4"})})]})})]},o.id)})})]})})})]})})}),e.jsx(K,{value:"customers",className:"space-y-4",children:e.jsxs($,{children:[e.jsxs(_,{children:[e.jsx(z,{children:"Clientes com Mais Cashback"}),e.jsx(Q,{children:"Top 10 clientes com cashback disponível"})]}),e.jsx(H,{children:n?e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"h-12 w-full"}),e.jsx(V,{className:"h-12 w-full"})]}):c.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhum cliente com cashback ainda"}):e.jsxs(ee,{children:[e.jsx(ae,{children:e.jsxs(U,{children:[e.jsx(k,{children:"Cliente"}),e.jsx(k,{children:"Total Ganho"}),e.jsx(k,{children:"Disponível"}),e.jsx(k,{children:"Usado"})]})}),e.jsx(te,{children:c.map(o=>e.jsxs(U,{children:[e.jsx(A,{children:e.jsxs("div",{className:"font-mono text-sm",children:[o.customerId.substring(0,8),"..."]})}),e.jsx(A,{children:e.jsx("div",{className:"font-medium",children:f(o.totalEarned)})}),e.jsx(A,{children:e.jsx("div",{className:"font-medium text-green-600",children:f(o.available)})}),e.jsx(A,{children:e.jsx("div",{className:"text-muted-foreground",children:f(o.used)})})]},o.customerId))})]})})]})})]}),e.jsx(qe,{open:l,onOpenChange:i,children:e.jsxs(Me,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ge,{children:[e.jsx(Be,{children:m?"Editar Regra":"Nova Regra de Cashback"}),e.jsx(Ue,{children:"Configure os parâmetros da regra de cashback"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"name",children:"Nome da Regra *"}),e.jsx(P,{id:"name",value:d.name,onChange:o=>w({...d,name:o.target.value}),placeholder:"Ex: Cashback 5% em todas as compras"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"description",children:"Descrição"}),e.jsx(P,{id:"description",value:d.description||"",onChange:o=>w({...d,description:o.target.value}),placeholder:"Descrição opcional"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"type",children:"Tipo *"}),e.jsxs(se,{value:d.type,onValueChange:o=>w({...d,type:o}),children:[e.jsx(re,{children:e.jsx(oe,{})}),e.jsxs(ne,{children:[e.jsx(S,{value:"PERCENTAGE",children:"Percentual"}),e.jsx(S,{value:"FIXED_AMOUNT",children:"Valor Fixo"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(R,{htmlFor:"value",children:["Valor * ",d.type==="PERCENTAGE"&&"(%)"]}),e.jsx(P,{id:"value",type:"number",step:"0.01",value:d.value,onChange:o=>w({...d,value:parseFloat(o.target.value)}),placeholder:d.type==="PERCENTAGE"?"5":"10.00"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"minOrderValue",children:"Valor Mínimo do Pedido"}),e.jsx(P,{id:"minOrderValue",type:"number",step:"0.01",value:d.minOrderValue||"",onChange:o=>w({...d,minOrderValue:parseFloat(o.target.value)}),placeholder:"0.00"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"maxCashbackAmount",children:"Cashback Máximo"}),e.jsx(P,{id:"maxCashbackAmount",type:"number",step:"0.01",value:d.maxCashbackAmount||"",onChange:o=>w({...d,maxCashbackAmount:parseFloat(o.target.value)}),placeholder:"0.00"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"status",children:"Status"}),e.jsxs(se,{value:d.status,onValueChange:o=>w({...d,status:o}),children:[e.jsx(re,{children:e.jsx(oe,{})}),e.jsxs(ne,{children:[e.jsx(S,{value:"ACTIVE",children:"Ativo"}),e.jsx(S,{value:"INACTIVE",children:"Inativo"}),e.jsx(S,{value:"SCHEDULED",children:"Agendado"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{id:"firstPurchaseOnly",checked:d.firstPurchaseOnly,onCheckedChange:o=>w({...d,firstPurchaseOnly:o})}),e.jsx(R,{htmlFor:"firstPurchaseOnly",className:"cursor-pointer",children:"Apenas primeira compra do cliente"})]}),d.type==="PERCENTAGE"&&d.value>0&&e.jsxs(_e,{children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs(ze,{children:["Exemplo: Em uma compra de R$ 100,00, o cliente receberá"," ",f(100*(d.value/100))," de cashback",d.maxCashbackAmount&&` (limitado a ${f(d.maxCashbackAmount)})`]})]})]}),e.jsxs($e,{children:[e.jsx(D,{variant:"outline",onClick:()=>{i(!1),p(null),w({name:"",description:"",type:"PERCENTAGE",value:0,status:"ACTIVE",firstPurchaseOnly:!1})},children:"Cancelar"}),e.jsx(D,{onClick:g,children:"Salvar"})]})]})})]})};export{Ea as default};
