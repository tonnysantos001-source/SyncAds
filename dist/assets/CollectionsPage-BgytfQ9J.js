import{c as J,s as x,r as u,f as K,u as Q,j as e,B as f,I as A,g as D,h as I,i as T,l as E,P as W,M as X,o as Y}from"./index-CQReMJg2.js";import{T as Z,a as _,b as z,c as v,d as ee,e as b}from"./table-BwtdwbLH.js";import{D as te,a as se,b as re,c as ae,d as oe,f as ie}from"./dialog-DEh8RoSm.js";import{L as N}from"./label--QE-Krp5.js";import{T as le}from"./textarea-BgXbP76D.js";import{p as k}from"./productsApi-NXmvv5Uz.js";import{S as L}from"./skeleton-DiypLdjw.js";import{P as O}from"./plus-Dd-Mm_Zm.js";import{S as ne}from"./square-pen-CwBvTD1-.js";import{T as ce}from"./trash-2-CqfB0G-8.js";import"./index-CTcTxgHL.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=J("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),de={async listFromShopify(i,r){try{let o=x.from("ShopifyCollection").select("*").eq("userId",i).order("updatedAt",{ascending:!1});(r==null?void 0:r.published)!==void 0&&(o=o.eq("published",r.published)),r!=null&&r.search&&(o=o.or(`title.ilike.%${r.search}%,handle.ilike.%${r.search}%`));const{data:s,error:l}=await o;if(l)throw l;return(s||[]).map(a=>{var d;return{id:String(a.id),userId:a.userId,name:a.title,slug:a.handle,description:a.description||a.bodyHtml,imageUrl:((d=a.image)==null?void 0:d.src)||null,productsCount:a.productsCount||0,published:a.published,metadata:{shopifyId:a.id,shopifyData:a.shopifyData,sortOrder:a.sortOrder,publishedScope:a.publishedScope,image:a.image},createdAt:a.createdAt,updatedAt:a.updatedAt}})}catch(o){throw console.error("Error listing Shopify collections:",o),o}},async getById(i,r){var o;try{const{data:s,error:l}=await x.from("ShopifyCollection").select("*").eq("userId",i).eq("id",r).single();return l?(console.error("Error getting Shopify collection:",l),null):s?{id:String(s.id),userId:s.userId,name:s.title,slug:s.handle,description:s.description||s.bodyHtml,imageUrl:((o=s.image)==null?void 0:o.src)||null,productsCount:s.productsCount||0,published:s.published,metadata:{shopifyId:s.id,shopifyData:s.shopifyData,sortOrder:s.sortOrder,publishedScope:s.publishedScope,image:s.image},createdAt:s.createdAt,updatedAt:s.updatedAt}:null}catch(s){return console.error("Error getting Shopify collection:",s),null}},async getCollectionProducts(i,r){var o,s;try{const{data:l,error:a}=await x.from("ShopifyCollection").select("shopifyData").eq("userId",i).eq("id",r).single();if(a||!l)return console.error("Collection not found"),[];const d=((s=(o=l.shopifyData)==null?void 0:o.products)==null?void 0:s.map(S=>S.id))||[];if(d.length===0)return[];const{data:y,error:h}=await x.from("ShopifyProduct").select("*").eq("userId",i).in("id",d);if(h)throw h;return y||[]}catch(l){return console.error("Error getting collection products:",l),[]}},async count(i){try{const{count:r,error:o}=await x.from("ShopifyCollection").select("*",{count:"exact",head:!0}).eq("userId",i);if(o)throw o;return r||0}catch(r){return console.error("Error counting Shopify collections:",r),0}},async getStats(i){try{const{data:r,error:o}=await x.from("ShopifyCollection").select("published, productsCount").eq("userId",i);if(o)throw o;const s=(r==null?void 0:r.length)||0,l=(r==null?void 0:r.filter(d=>d.published).length)||0,a=(r==null?void 0:r.reduce((d,y)=>d+(y.productsCount||0),0))||0;return{total:s,published:l,draft:s-l,totalProducts:a,averageProducts:s>0?Math.round(a/s):0}}catch(r){return console.error("Error getting collection stats:",r),{total:0,published:0,draft:0,totalProducts:0,averageProducts:0}}}},be=()=>{const[i,r]=u.useState([]),[o,s]=u.useState([]),[l,a]=u.useState(!0),[d,y]=u.useState(!1),[h,S]=u.useState(""),[H,j]=u.useState(!1),[C,q]=u.useState(null),{toast:m}=K(),n=Q(t=>t.user),[c,p]=u.useState({name:"",slug:"",description:"",isActive:!0});u.useEffect(()=>{n!=null&&n.id&&w()},[n==null?void 0:n.id]),u.useEffect(()=>{B()},[h,i]);const w=async()=>{if(!(n!=null&&n.id)){a(!1);return}try{a(!0);const t=await de.listFromShopify(n.id);r(t),s(t)}catch(t){console.error("Erro ao carregar coleções:",t),m({title:"Erro ao carregar coleções",description:t.message,variant:"destructive"})}finally{a(!1)}},B=()=>{if(!h){s(i);return}const t=i.filter(g=>g.name.toLowerCase().includes(h.toLowerCase())||g.slug.toLowerCase().includes(h.toLowerCase()));s(t)},R=t=>t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),U=t=>{p({...c,name:t,slug:C?c.slug:R(t)})},$=async t=>{t.preventDefault();try{if(!(n!=null&&n.organizationId))return;C?(await k.collections.update(C.id,c),m({title:"Coleção atualizada!"})):(await k.collections.create({...c,organizationId:n.organizationId}),m({title:"Coleção criada!",description:"A coleção está pronta para receber produtos."})),j(!1),P(),w()}catch(g){m({title:"Erro",description:g.message,variant:"destructive"})}},M=async t=>{if(confirm("Tem certeza que deseja deletar esta coleção?"))try{await k.collections.delete(t),m({title:"Coleção deletada"}),w()}catch(g){m({title:"Erro ao deletar",description:g.message,variant:"destructive"})}},V=t=>{q(t),p({name:t.name,slug:t.slug,description:t.description||"",isActive:t.isActive}),j(!0)},P=()=>{q(null),p({name:"",slug:"",description:"",isActive:!0})},G=i.filter(t=>t.isActive).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Coleções de Produtos"}),e.jsx("p",{className:"text-muted-foreground",children:"Organize seus produtos em coleções"})]}),e.jsxs(te,{open:H,onOpenChange:j,children:[e.jsx(se,{asChild:!0,children:e.jsxs(f,{onClick:P,children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Criar Coleção"]})}),e.jsxs(re,{children:[e.jsx(ae,{children:e.jsx(oe,{children:C?"Editar Coleção":"Nova Coleção"})}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Nome da Coleção"}),e.jsx(A,{value:c.name,onChange:t=>U(t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Slug (URL)"}),e.jsx(A,{value:c.slug,onChange:t=>p({...c,slug:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Descrição"}),e.jsx(le,{value:c.description,onChange:t=>p({...c,description:t.target.value})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c.isActive,onChange:t=>p({...c,isActive:t.target.checked})}),e.jsx(N,{children:"Ativa"})]})]}),e.jsxs(ie,{className:"mt-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),e.jsx(f,{type:"submit",children:C?"Atualizar":"Criar"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(D,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium",children:"Total de Coleções"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl font-bold",children:i.length})})]}),e.jsxs(D,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium",children:"Coleções Ativas"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl font-bold",children:G})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(A,{placeholder:"Buscar coleções...",value:h,onChange:t=>S(t.target.value),className:"pl-9"})]}),e.jsxs(D,{children:[e.jsx(I,{children:e.jsx(T,{children:"Lista de Coleções"})}),e.jsx(E,{children:l?e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{className:"h-12 w-full"}),e.jsx(L,{className:"h-12 w-full"})]}):o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"h-12 w-12 text-muted-foreground mb-4 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhuma coleção encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Comece criando a primeira coleção"}),e.jsxs(f,{onClick:()=>j(!0),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Criar Primeira Coleção"]})]}):e.jsxs(Z,{children:[e.jsx(_,{children:e.jsxs(z,{children:[e.jsx(v,{children:"Nome"}),e.jsx(v,{children:"Slug"}),e.jsx(v,{children:"Status"}),e.jsx(v,{className:"text-right",children:"Ações"})]})}),e.jsx(ee,{children:o.map(t=>e.jsxs(z,{children:[e.jsx(b,{className:"font-medium",children:t.name}),e.jsx(b,{className:"text-sm text-muted-foreground",children:t.slug}),e.jsx(b,{children:e.jsx(Y,{variant:t.isActive?"default":"secondary",children:t.isActive?"Ativa":"Inativa"})}),e.jsx(b,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>V(t),children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>M(t.id),children:e.jsx(ce,{className:"h-4 w-4"})})]})})]},t.id))})]})})]})]})};export{be as default};
