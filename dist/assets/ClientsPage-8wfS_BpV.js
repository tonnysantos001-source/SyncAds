import{f as B,r as m,s as j,j as e,g as n,h as c,i as d,U as L,l as o,x as M,k as R,t as I,I as D,n as f}from"./index-C3GM5hGh.js";import{T as k,a as V,b as p,c as i,d as _,e as r}from"./table-BOku-wKM.js";import{S as v}from"./SuperAdminLayout-DTfH9BYS.js";import{S as q}from"./Logo-YJfhlPg-.js";import{M as H}from"./message-square-KVlV6iZH.js";import"./dollar-sign-Dxz-xfRW.js";function O(){const{toast:N}=B(),[l,b]=m.useState([]),[h,C]=m.useState(""),[w,y]=m.useState(!0);m.useEffect(()=>{S()},[]);const S=async()=>{try{const{data:s,error:a}=await j.from("User").select("*").order("createdAt",{ascending:!1});if(a)throw a;const t=await Promise.all((s||[]).map(async u=>{const{count:U}=await j.from("Campaign").select("*",{count:"exact",head:!0}).eq("userId",u.id),{count:A}=await j.from("ChatConversation").select("*",{count:"exact",head:!0}).eq("userId",u.id);return{...u,_count:{campaigns:U||0,messages:A||0}}}));b(t)}catch(s){N({title:"Erro ao carregar usuários",description:s.message,variant:"destructive"})}finally{y(!1)}},g=l.filter(s=>s.name.toLowerCase().includes(h.toLowerCase())||s.email.toLowerCase().includes(h.toLowerCase())),T=s=>{const a={ADMIN:{variant:"default",label:"Admin"},MEMBER:{variant:"secondary",label:"Membro"},VIEWER:{variant:"outline",label:"Visualizador"}},t=a[s]||a.MEMBER;return e.jsx(f,{variant:t.variant,children:t.label})},E=s=>s?e.jsx(f,{variant:"default",children:"Ativo"}):e.jsx(f,{variant:"destructive",children:"Suspenso"}),x={total:l.length,active:l.filter(s=>s.isActive).length,verified:l.filter(s=>s.emailVerified).length,totalCampaigns:l.reduce((s,a)=>{var t;return s+(((t=a._count)==null?void 0:t.campaigns)||0)},0)};return w?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsx(v,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Usuários"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Todos os usuários cadastrados na plataforma"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total de Usuários"}),e.jsx(L,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Todos cadastrados"})]})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Usuários Ativos"}),e.jsx(M,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.active}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contas ativas"})]})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Emails Verificados"}),e.jsx(q,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.verified}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contas verificadas"})]})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total Campanhas"}),e.jsx(H,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.totalCampaigns}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Criadas por todos"})]})]})]}),e.jsxs(n,{children:[e.jsx(c,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(d,{children:"Todos os Usuários"}),e.jsx(R,{children:"Lista completa de usuários cadastrados"})]})})}),e.jsxs(o,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(D,{placeholder:"Buscar por nome ou email...",value:h,onChange:s=>C(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(k,{children:[e.jsx(V,{children:e.jsxs(p,{children:[e.jsx(i,{children:"Usuário"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Role"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Campanhas"}),e.jsx(i,{children:"Conversas"}),e.jsx(i,{children:"Criado em"})]})}),e.jsx(_,{children:g.length===0?e.jsx(p,{children:e.jsx(r,{colSpan:7,className:"text-center py-8 text-gray-500",children:"Nenhum usuário encontrado"})}):g.map(s=>{var a,t;return e.jsxs(p,{children:[e.jsx(r,{children:e.jsx("div",{className:"font-medium",children:s.name})}),e.jsx(r,{children:e.jsx("div",{className:"text-sm text-gray-600",children:s.email})}),e.jsx(r,{children:T(s.role)}),e.jsx(r,{children:E(s.isActive)}),e.jsx(r,{children:e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{children:((a=s._count)==null?void 0:a.campaigns)||0})})}),e.jsx(r,{children:((t=s._count)==null?void 0:t.messages)||0}),e.jsx(r,{className:"text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString("pt-BR")})]},s.id)})})]})})]})]})]})})}export{O as default};
