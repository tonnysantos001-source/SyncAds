import{j as e}from"./vendor-ui-DAyDU-p2.js";import{r as a,e as s}from"./vendor-react-BDwqAlkB.js";import{d as t,a as r,c as i,I as l,i as o,b as n}from"./chatService-PK1ccT8G.js";import{i as c,f as d,k as m,g as x,l as h,h as u,s as p}from"./index-D8-xWu09.js";import{S as g}from"./SuperAdminLayout--MS9xf8C.js";import{A as v,m as f}from"./vendor-animation-x8f1c1kX.js";import"./vendor-charts-DgCBwi6-.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-supabase-rKXMzPQL.js";import"./vendor-query-D3VdSFIC.js";import"./vendor-icons-D-zwSoGL.js";const b=c("outline","menu-2","Menu2",[["path",{d:"M4 6l16 0",key:"svg-0"}],["path",{d:"M4 12l16 0",key:"svg-1"}],["path",{d:"M4 18l16 0",key:"svg-2"}]]),y=c("outline","messages","Messages",[["path",{d:"M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10",key:"svg-0"}],["path",{d:"M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2",key:"svg-1"}]]),j=c("outline","shield-check","ShieldCheck",[["path",{d:"M11.46 20.846a12 12 0 0 1 -7.96 -14.846a12 12 0 0 0 8.5 -3a12 12 0 0 0 8.5 3a12 12 0 0 1 -.09 7.06",key:"svg-0"}],["path",{d:"M15 19l2 2l4 -4",key:"svg-1"}]]),w=c("outline","user-circle","UserCircle",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M12 10m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-1"}],["path",{d:"M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855",key:"svg-2"}]]),N=2e3;function k(){const[c,k]=a.useState(""),[C,A]=a.useState(!0),[S,M]=a.useState(!0),T=d(e=>e.user),E=d(e=>e.isAuthenticated),D=s(),H=m(e=>e.conversations),I=m(e=>e.activeConversationId),P=m(e=>e.setActiveConversationId),q=m(e=>e.isAssistantTyping),z=m(e=>e.setAssistantTyping),F=m(e=>e.addMessage),R=a.useRef(null),{toast:K}=x(),L=H.find(e=>e.id===I);a.useEffect(()=>{E&&T||D("/login-v2",{replace:!0})},[E,T,D]);a.useEffect(()=>{R.current?.scrollIntoView({behavior:"smooth"})},[L?.messages,q]),a.useEffect(()=>{(async()=>{if(T)try{M(!0),await m.getState().loadConversations(T.id);const{data:e,error:a}=await p.from("ChatConversation").select("id").eq("userId",T.id).limit(1);if(a)throw a;e&&0!==e.length||await m.getState().createNewConversation(T.id,"Chat Admin")}catch(e){K({title:"Erro ao carregar chat",description:"Não foi possível carregar as conversas. Tente recarregar a página.",variant:"destructive"})}finally{M(!1)}})()},[T,K]);const U=a.useCallback(async()=>{if(""===c.trim()||!I||c.length>N)return;const e=c;T&&F(T.id,I,{id:`msg-${Date.now()}`,role:"user",content:e}),k(""),z(!0);try{let a="";if(a=await t.sendMessage(e,I),T){const e=`msg-${Date.now()+1}`;F(T.id,I,{id:e,role:"assistant",content:""});const s=a.split(" ");let t="";for(let a=0;a<s.length;a+=2){t+=(a>0?" ":"")+s.slice(a,a+2).join(" "),F(T.id,I,{id:e,role:"assistant",content:t}),await new Promise(e=>setTimeout(e,20))}F(T.id,I,{id:e,role:"assistant",content:a})}}catch(a){K({title:"Erro ao enviar",description:a.message||"Não foi possível enviar a mensagem.",variant:"destructive"})}finally{z(!1)}},[I,c,T,L?.messages,K,F,z]);return e.jsx(g,{children:e.jsxs("div",{className:"h-[calc(100vh-4rem)] flex bg-[#0A0A0F] overflow-hidden",children:[e.jsx(v,{children:C&&e.jsxs(f.div,{initial:{x:-320,opacity:0},animate:{x:0,opacity:1},exit:{x:-320,opacity:0},transition:{type:"spring",damping:25,stiffness:200},className:"fixed md:relative w-80 h-full bg-[#12121A]/95 backdrop-blur-xl border-r border-gray-700/50 flex flex-col z-50 shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700/50 bg-gradient-to-b from-gray-800/50 to-transparent",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(j,{className:"w-6 h-6 text-blue-400"}),"Admin Chat"]}),e.jsx(f.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:()=>A(!1),className:"p-2 rounded-lg hover:bg-gray-800/50 text-gray-400 hover:text-white transition-all",children:e.jsx(h,{className:"w-5 h-5"})})]}),e.jsxs(f.button,{whileHover:{scale:1.02,boxShadow:"0 0 25px rgba(59, 130, 246, 0.5)"},whileTap:{scale:.98},onClick:async()=>{try{if(!T)return;await m.getState().createNewConversation(T.id,"Nova Conversa Admin"),await m.getState().loadConversations(T.id),K({title:"Nova conversa criada",description:"Uma nova conversa foi iniciada.",variant:"success"})}catch(e){K({title:"Erro",description:"Não foi possível criar nova conversa.",variant:"destructive"})}},className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl px-4 py-3 flex items-center justify-center gap-2 font-medium transition-all shadow-lg shadow-blue-500/30",children:[e.jsx(r,{className:"w-5 h-5"}),"Nova Conversa"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:H.map(a=>e.jsx(f.div,{whileHover:{scale:1.02,x:4},onClick:()=>P(a.id),className:u("p-3 rounded-xl cursor-pointer transition-all group relative",I===a.id?"bg-gradient-to-r from-blue-600/20 to-purple-600/20 border border-blue-500/50 shadow-lg shadow-blue-500/20":"bg-gray-800/30 hover:bg-gray-800/50 border border-transparent"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium text-sm truncate",children:a.title}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:a.messages&&a.messages.length>0?a.messages[a.messages.length-1].content.substring(0,35)+"...":"Nova conversa"})]}),e.jsx(f.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:e=>{e.stopPropagation(),(async e=>{try{await m.getState().deleteConversation(e),I===e&&T&&await m.getState().loadConversations(T.id),K({title:"Conversa deletada",description:"A conversa foi removida com sucesso.",variant:"success"})}catch(a){}})(a.id)},className:"opacity-0 group-hover:opacity-100 p-2 rounded-lg hover:bg-red-500/20 text-red-400 transition-all",children:e.jsx(i,{className:"w-4 h-4"})})]})},a.id))})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#12121A] to-[#1A1A2E] border-b border-gray-700/50 px-6 py-4 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[!C&&e.jsx(f.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>A(!0),className:"p-2 rounded-lg hover:bg-gray-800/50 text-gray-400 hover:text-white transition-all",children:e.jsx(b,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(j,{className:"w-6 h-6 text-blue-400"}),"Admin AI Assistant"]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Sistema especializado para administradores"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4 bg-[#0A0A0F] custom-scrollbar",children:S?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(f.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-16 h-16 border-4 border-blue-500/30 border-t-blue-500 rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg font-medium",children:"Carregando conversas..."}),e.jsx("p",{className:"text-gray-600 text-sm mt-2",children:"Aguarde enquanto configuramos seu chat"})]})}):L&&L.messages?e.jsxs(e.Fragment,{children:[L.messages.map(a=>e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:u("flex","user"===a.role?"justify-end":"justify-start"),children:e.jsxs("div",{className:u("max-w-[80%] rounded-2xl p-4 backdrop-blur-sm","user"===a.role?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg shadow-blue-500/20 border border-blue-400/30":"bg-gray-800/50 text-gray-200 border border-gray-700/30"),children:[e.jsxs("div",{className:"flex items-start gap-3",children:["assistant"===a.role&&e.jsx(f.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},whileHover:{rotate:10,scale:1.1},className:"flex-shrink-0",children:e.jsx(l,{className:"w-6 h-6 text-blue-400"})}),"user"===a.role&&e.jsx(f.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},whileHover:{scale:1.1},className:"flex-shrink-0",children:e.jsx(w,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"flex-1 whitespace-pre-wrap break-words",children:a.content})]}),e.jsx("div",{className:u("text-xs mt-2 ml-9","user"===a.role?"text-white/60":"text-gray-500"),children:a.timestamp?new Date(a.timestamp).toLocaleTimeString("pt-BR"):""})]})},a.id)),q&&e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-start",children:e.jsx("div",{className:"max-w-[80%] bg-gray-800/50 rounded-2xl p-4 border border-gray-700/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"w-6 h-6 text-blue-400 animate-pulse"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(f.div,{animate:{y:[0,-8,0]},transition:{duration:.6,repeat:1/0,delay:0},className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsx(f.div,{animate:{y:[0,-8,0]},transition:{duration:.6,repeat:1/0,delay:.2},className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsx(f.div,{animate:{y:[0,-8,0]},transition:{duration:.6,repeat:1/0,delay:.4},className:"w-2 h-2 bg-blue-400 rounded-full"})]})]})})}),e.jsx("div",{ref:R})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma conversa selecionada"}),e.jsx("p",{className:"text-gray-600 text-sm mt-2",children:"Crie uma nova conversa para começar"})]})})}),e.jsx("div",{className:"border-t border-gray-700/50 bg-[#12121A]/50 backdrop-blur-xl p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx(o,{value:c,onChange:e=>k(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),U())},onPaste:e=>{e.stopPropagation();const a=e.clipboardData.getData("text");a&&k(c+a)},placeholder:"Digite sua mensagem admin...",maxRows:6,className:"w-full bg-gray-800/50 border-2 border-gray-700/50 focus:border-blue-500/50 rounded-2xl px-6 py-4 pr-14 text-white placeholder-gray-500 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all"}),e.jsx(f.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:U,disabled:""===c.trim()||q||c.length>N,className:"absolute right-3 bottom-3 p-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-xl text-white disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-blue-500/30",children:e.jsx(n,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 px-2",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[c.length,"/",N," caracteres"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Shift + Enter para nova linha"})]})]})})]})]})})}export{k as default};
