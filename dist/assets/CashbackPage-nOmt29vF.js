import{s as C,c as Ne,r as b,as as Te,v as Ae,j as e,l as ke,t as Ie,P as B,aG as ie,aH as Re,aI as De,x as $,y as Se,m as X,b as Pe,u as Ve,B as R,d as S,e as P,f as V,h as L,g as W,a6 as Le,o as J,a5 as Q,I as F}from"./index-zpfJpNlB.js";import{L as I}from"./label-DpctM5L2.js";import{T as Y,a as Z,b as M,c as T,d as ee,e as A}from"./table-BDHOK3CL.js";import{D as Fe,b as qe,c as Oe,d as Me,e as Ge,f as Be}from"./dialog-Ag0sImPP.js";import{S as ae,a as se,b as te,c as re,d as q}from"./select-BAemSCuj.js";import{S as oe}from"./switch-Dy3-GExh.js";import{A as Ue,a as _e}from"./alert-B51PFBFQ.js";import{S as O}from"./skeleton-DcTTVbs-.js";import{P as ne}from"./plus-BSUyEjEI.js";import{T as $e}from"./trending-up-TWQG9_Ia.js";import{D as He}from"./dollar-sign-B3N5560X.js";import{U as ze}from"./users-CADKLQi8.js";import{S as Xe}from"./square-pen-QBqBKQhm.js";import{T as Ke}from"./trash-2-BDXzwbVy.js";import{C as G}from"./circle-alert-C6rVRryL.js";import{f as We,p as Je}from"./pt-BR-BQ5kKd2v.js";import"./x-CV3j7J3i.js";import"./index-Bi9BdktY.js";import"./constructFrom-rJN6zrQ_.js";const g={async createRule(t){try{const{data:a,error:s}=await C.from("Cashback").insert(t).select().single();if(s)throw s;return a}catch(a){throw console.error("Error creating cashback rule:",a),a}},async updateRule(t,a){try{const{data:s,error:r}=await C.from("Cashback").update({...a,updatedAt:new Date().toISOString()}).eq("id",t).select().single();if(r)throw r;return s}catch(s){throw console.error("Error updating cashback rule:",s),s}},async deleteRule(t){try{const{error:a}=await C.from("Cashback").delete().eq("id",t);if(a)throw a}catch(a){throw console.error("Error deleting cashback rule:",a),a}},async listRules(t,a){try{let s=C.from("Cashback").select("*").eq("userId",t).order("createdAt",{ascending:!1});a!=null&&a.status&&(s=s.eq("status",a.status)),(a==null?void 0:a.active)!==void 0&&(a.active?s=s.eq("status","ACTIVE"):s=s.neq("status","ACTIVE"));const{data:r,error:i}=await s;if(i)throw i;return r}catch(s){throw console.error("Error listing cashback rules:",s),s}},async getRuleById(t){try{const{data:a,error:s}=await C.from("Cashback").select("*").eq("id",t).single();if(s)throw s;return a}catch(a){throw console.error("Error getting cashback rule:",a),a}},async toggleRule(t,a){try{const s=a?"ACTIVE":"INACTIVE";return await g.updateRule(t,{status:s})}catch(s){throw console.error("Error toggling cashback rule:",s),s}},async createTransaction(t){try{const{data:a,error:s}=await C.from("CashbackTransaction").insert(t).select().single();if(s)throw s;return a}catch(a){throw console.error("Error creating cashback transaction:",a),a}},async updateTransaction(t,a){try{const{data:s,error:r}=await C.from("CashbackTransaction").update({...a,updatedAt:new Date().toISOString()}).eq("id",t).select().single();if(r)throw r;return s}catch(s){throw console.error("Error updating cashback transaction:",s),s}},async getTransactions(t,a){try{let s=C.from("CashbackTransaction").select("*").eq("userId",t).order("createdAt",{ascending:!1});a!=null&&a.customerId&&(s=s.eq("customerId",a.customerId)),a!=null&&a.status&&(s=s.eq("status",a.status)),a!=null&&a.orderId&&(s=s.eq("orderId",a.orderId)),a!=null&&a.dateFrom&&(s=s.gte("createdAt",a.dateFrom)),a!=null&&a.dateTo&&(s=s.lte("createdAt",a.dateTo)),a!=null&&a.limit&&(s=s.limit(a.limit));const{data:r,error:i}=await s;if(i)throw i;return r}catch(s){throw console.error("Error getting cashback transactions:",s),s}},async getTransactionById(t){try{const{data:a,error:s}=await C.from("CashbackTransaction").select("*").eq("id",t).single();if(s)throw s;return a}catch(a){throw console.error("Error getting cashback transaction:",a),a}},async getAvailableCashback(t){try{const{data:a,error:s}=await C.from("CashbackTransaction").select("amount").eq("customerId",t).eq("status","AVAILABLE");if(s)throw s;return a.reduce((i,u)=>i+u.amount,0)}catch(a){throw console.error("Error getting available cashback:",a),a}},async getCustomerCashback(t){try{const{data:a,error:s}=await C.from("CashbackTransaction").select("*").eq("customerId",t).order("createdAt",{ascending:!1});if(s)throw s;const r=a,i=r.filter(l=>l.status!=="CANCELLED").reduce((l,c)=>l+c.amount,0),u=r.filter(l=>l.status==="USED").reduce((l,c)=>l+c.amount,0),n=r.filter(l=>l.status==="AVAILABLE").reduce((l,c)=>l+c.amount,0),h=r.filter(l=>l.status==="EXPIRED").reduce((l,c)=>l+c.amount,0);return{customerId:t,totalEarned:i,totalUsed:u,available:n,expired:h,transactions:r}}catch(a){throw console.error("Error getting customer cashback:",a),a}},async useCashback(t,a,s){try{const r=await g.getTransactionById(t);if(r.status!=="AVAILABLE")throw new Error("Cashback não está disponível para uso");const i=s||r.amount;if(i>r.amount)throw new Error("Valor a usar maior que o disponível");if(i===r.amount)return await g.updateTransaction(t,{status:"USED",usedAt:new Date().toISOString(),usedInOrderId:a});const u=r.amount-i;return await g.updateTransaction(t,{amount:u}),await g.createTransaction({userId:r.userId,customerId:r.customerId,cashbackId:r.cashbackId,orderId:r.orderId,amount:i,status:"USED",earnedAt:r.earnedAt,usedAt:new Date().toISOString(),usedInOrderId:a})}catch(r){throw console.error("Error using cashback:",r),r}},async expireCashback(t){try{return await g.updateTransaction(t,{status:"EXPIRED"})}catch(a){throw console.error("Error expiring cashback:",a),a}},async cancelCashback(t,a){try{return await g.updateTransaction(t,{status:"CANCELLED",cancelledAt:new Date().toISOString(),cancellationReason:a})}catch(s){throw console.error("Error cancelling cashback:",s),s}},async processExpiredCashbacks(t){try{const a=new Date().toISOString(),{data:s,error:r}=await C.from("CashbackTransaction").select("id").eq("userId",t).eq("status","AVAILABLE").lt("expiresAt",a);if(r)throw r;const i=s,u=i.map(n=>g.expireCashback(n.id));return await Promise.all(u),i.length}catch(a){throw console.error("Error processing expired cashbacks:",a),a}},async getStats(t,a){try{const s=await g.listRules(t),r=s.length,i=s.filter(x=>x.status==="ACTIVE").length;let u=C.from("CashbackTransaction").select("*").eq("userId",t);a&&(u=u.gte("createdAt",a.from).lte("createdAt",a.to));const{data:n,error:h}=await u;if(h)throw h;const l=n,c=l.filter(x=>x.status!=="CANCELLED").reduce((x,w)=>x+w.amount,0),m=l.filter(x=>x.status==="USED").reduce((x,w)=>x+w.amount,0),p=l.filter(x=>x.status==="AVAILABLE").reduce((x,w)=>x+w.amount,0),d=l.filter(x=>x.status==="EXPIRED").reduce((x,w)=>x+w.amount,0),E=[...new Set(l.map(x=>x.customerId))].length,f=E>0?c/E:0,k={};for(const x of s){const w=l.filter(y=>y.cashbackId===x.id),_=[...new Set(w.map(y=>y.customerId))];k[x.id]={ruleId:x.id,ruleName:x.name,totalEarned:w.filter(y=>y.status!=="CANCELLED").reduce((y,v)=>y+v.amount,0),totalUsed:w.filter(y=>y.status==="USED").reduce((y,v)=>y+v.amount,0),totalCustomers:_.length}}return{totalRules:r,activeRules:i,totalEarned:c,totalUsed:m,totalAvailable:p,totalExpired:d,customersWithCashback:E,averageCashbackPerCustomer:f,byRule:k}}catch(s){throw console.error("Error getting cashback stats:",s),s}},async getTopCustomers(t,a=10,s="available"){try{const{data:r,error:i}=await C.from("CashbackTransaction").select("customerId, amount, status").eq("userId",t);if(i)throw i;const u=r,n=new Map;u.forEach(c=>{n.has(c.customerId)||n.set(c.customerId,{customerId:c.customerId,totalEarned:0,available:0,used:0});const m=n.get(c.customerId);c.status!=="CANCELLED"&&(m.totalEarned+=c.amount),c.status==="AVAILABLE"&&(m.available+=c.amount),c.status==="USED"&&(m.used+=c.amount)});const h=Array.from(n.values()),l=s==="earned"?"totalEarned":"available";return h.sort((c,m)=>m[l]-c[l]).slice(0,a)}catch(r){throw console.error("Error getting top customers:",r),r}},async calculateCashback(t,a,s,r){try{const u=(await g.listRules(t,{active:!0})).sort((n,h)=>{const l=n.type==="PERCENTAGE"?a*n.value/100:n.value;return(h.type==="PERCENTAGE"?a*h.value/100:h.value)-l});for(const n of u){if(n.minOrderValue&&a<n.minOrderValue||n.validFrom&&new Date(n.validFrom)>new Date||n.validUntil&&new Date(n.validUntil)<new Date||n.applicableToProducts&&n.applicableToProducts.length>0&&r&&!r.some(c=>n.applicableToProducts.includes(c))||n.excludedProducts&&n.excludedProducts.length>0&&r&&r.some(c=>n.excludedProducts.includes(c))||n.maxUsesPerCustomer&&(await g.getTransactions(t,{customerId:s})).filter(m=>m.cashbackId===n.id&&m.status!=="CANCELLED").length>=n.maxUsesPerCustomer||n.firstPurchaseOnly&&(await g.getTransactions(t,{customerId:s})).length>0)continue;let h=n.type==="PERCENTAGE"?a*n.value/100:n.value;return n.maxCashbackAmount&&h>n.maxCashbackAmount&&(h=n.maxCashbackAmount),{applicable:!0,amount:h,rule:n}}return{applicable:!1,amount:0,reason:"Nenhuma regra de cashback aplicável"}}catch(i){throw console.error("Error calculating cashback:",i),i}}};/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=Ne("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);var U="Tabs",[Qe]=ke(U,[ie]),le=ie(),[Ye,K]=Qe(U),de=b.forwardRef((t,a)=>{const{__scopeTabs:s,value:r,onValueChange:i,defaultValue:u,orientation:n="horizontal",dir:h,activationMode:l="automatic",...c}=t,m=Te(h),[p,d]=Ae({prop:r,onChange:i,defaultProp:u??"",caller:U});return e.jsx(Ye,{scope:s,baseId:Ie(),value:p,onValueChange:d,orientation:n,dir:m,activationMode:l,children:e.jsx(B.div,{dir:m,"data-orientation":n,...c,ref:a})})});de.displayName=U;var ue="TabsList",he=b.forwardRef((t,a)=>{const{__scopeTabs:s,loop:r=!0,...i}=t,u=K(ue,s),n=le(s);return e.jsx(Re,{asChild:!0,...n,orientation:u.orientation,dir:u.dir,loop:r,children:e.jsx(B.div,{role:"tablist","aria-orientation":u.orientation,...i,ref:a})})});he.displayName=ue;var me="TabsTrigger",xe=b.forwardRef((t,a)=>{const{__scopeTabs:s,value:r,disabled:i=!1,...u}=t,n=K(me,s),h=le(s),l=be(n.baseId,r),c=fe(n.baseId,r),m=r===n.value;return e.jsx(De,{asChild:!0,...h,focusable:!i,active:m,children:e.jsx(B.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":c,"data-state":m?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:l,...u,ref:a,onMouseDown:$(t.onMouseDown,p=>{!i&&p.button===0&&p.ctrlKey===!1?n.onValueChange(r):p.preventDefault()}),onKeyDown:$(t.onKeyDown,p=>{[" ","Enter"].includes(p.key)&&n.onValueChange(r)}),onFocus:$(t.onFocus,()=>{const p=n.activationMode!=="manual";!m&&!i&&p&&n.onValueChange(r)})})})});xe.displayName=me;var ge="TabsContent",pe=b.forwardRef((t,a)=>{const{__scopeTabs:s,value:r,forceMount:i,children:u,...n}=t,h=K(ge,s),l=be(h.baseId,r),c=fe(h.baseId,r),m=r===h.value,p=b.useRef(m);return b.useEffect(()=>{const d=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(d)},[]),e.jsx(Se,{present:i||m,children:({present:d})=>e.jsx(B.div,{"data-state":m?"active":"inactive","data-orientation":h.orientation,role:"tabpanel","aria-labelledby":l,hidden:!d,id:c,tabIndex:0,...n,ref:a,style:{...t.style,animationDuration:p.current?"0s":void 0},children:d&&u})})});pe.displayName=ge;function be(t,a){return`${t}-trigger-${a}`}function fe(t,a){return`${t}-content-${a}`}var Ze=de,ve=he,je=xe,Ce=pe;const ea=Ze,Ee=b.forwardRef(({className:t,...a},s)=>e.jsx(ve,{ref:s,className:X("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...a}));Ee.displayName=ve.displayName;const H=b.forwardRef(({className:t,...a},s)=>e.jsx(je,{ref:s,className:X("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...a}));H.displayName=je.displayName;const z=b.forwardRef(({className:t,...a},s)=>e.jsx(Ce,{ref:s,className:X("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...a}));z.displayName=Ce.displayName;const ja=()=>{const[t,a]=b.useState([]),[s,r]=b.useState(null),[i,u]=b.useState([]),[n,h]=b.useState(!0),[l,c]=b.useState(!1),[m,p]=b.useState(null),[d,N]=b.useState({name:"",description:"",type:"PERCENTAGE",value:0,status:"ACTIVE",firstPurchaseOnly:!1}),{toast:E}=Pe(),f=Ve(o=>o.user);b.useEffect(()=>{f!=null&&f.id&&k()},[f==null?void 0:f.id]);const k=async()=>{try{h(!0);const[o,j,D]=await Promise.all([g.listRules(f.id),g.getStats(f.id),g.getTopCustomers(f.id,10,"available")]);a(o),r(j),u(D)}catch(o){console.error("Erro ao carregar dados:",o),E({title:"Erro ao carregar dados",description:o.message,variant:"destructive"})}finally{h(!1)}},x=async()=>{try{if(!(f!=null&&f.id))return;if(!d.name||!d.value){E({title:"Campos obrigatórios",description:"Preencha nome e valor do cashback",variant:"destructive"});return}const o={...d,userId:f.id};m?(await g.updateRule(m.id,d),E({title:"Regra atualizada com sucesso!"})):(await g.createRule(o),E({title:"Regra criada com sucesso!"})),c(!1),p(null),N({name:"",description:"",type:"PERCENTAGE",value:0,status:"ACTIVE",firstPurchaseOnly:!1}),k()}catch(o){console.error("Erro ao salvar:",o),E({title:"Erro ao salvar",description:o.message,variant:"destructive"})}},w=o=>{p(o),N(o),c(!0)},_=async o=>{if(confirm("Deseja realmente excluir esta regra?"))try{await g.deleteRule(o),E({title:"Regra excluída com sucesso!"}),k()}catch(j){console.error("Erro ao excluir:",j),E({title:"Erro ao excluir",description:j.message,variant:"destructive"})}},y=async(o,j)=>{try{await g.toggleRule(o,j),E({title:j?"Regra ativada!":"Regra desativada!"}),k()}catch(D){console.error("Erro ao alternar status:",D),E({title:"Erro ao alternar status",description:D.message,variant:"destructive"})}},v=o=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o),we=o=>{const j={ACTIVE:{label:"Ativo",variant:"default",icon:Q},INACTIVE:{label:"Inativo",variant:"secondary",icon:G},EXPIRED:{label:"Expirado",variant:"destructive",icon:G},SCHEDULED:{label:"Agendado",variant:"secondary",icon:G}};return j[o]||j.INACTIVE};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Cashback"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Crie regras de cashback e fidelize seus clientes"})]}),e.jsxs(R,{onClick:()=>c(!0),children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Nova Regra"]})]}),s&&e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(S,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(V,{className:"text-sm font-medium",children:"Regras Ativas"}),e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s.activeRules}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["de ",s.totalRules," regras"]})]})]}),e.jsxs(S,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(V,{className:"text-sm font-medium",children:"Total Distribuído"}),e.jsx($e,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:v(s.totalEarned)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Cashback total gerado"})]})]}),e.jsxs(S,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(V,{className:"text-sm font-medium",children:"Disponível"}),e.jsx(He,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:v(s.totalAvailable)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aguardando uso"})]})]}),e.jsxs(S,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(V,{className:"text-sm font-medium",children:"Clientes Ativos"}),e.jsx(ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s.customersWithCashback}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Média: ",v(s.averageCashbackPerCustomer)]})]})]})]}),e.jsxs(ea,{defaultValue:"rules",className:"space-y-4",children:[e.jsxs(Ee,{children:[e.jsx(H,{value:"rules",children:"Regras"}),e.jsx(H,{value:"customers",children:"Top Clientes"})]}),e.jsx(z,{value:"rules",className:"space-y-4",children:e.jsxs(S,{children:[e.jsxs(P,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Regras de Cashback"}),e.jsxs(W,{children:[t.length," regra(s) cadastrada(s)"]})]}),e.jsxs(R,{variant:"outline",size:"sm",onClick:k,children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]}),e.jsx(L,{children:n?e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"h-12 w-full"}),e.jsx(O,{className:"h-12 w-full"}),e.jsx(O,{className:"h-12 w-full"})]}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(ce,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhuma regra cadastrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Crie sua primeira regra de cashback"}),e.jsxs(R,{onClick:()=>c(!0),children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Criar Regra"]})]}):e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(T,{children:"Nome"}),e.jsx(T,{children:"Tipo"}),e.jsx(T,{children:"Valor"}),e.jsx(T,{children:"Status"}),e.jsx(T,{children:"Primeira Compra"}),e.jsx(T,{children:"Criado em"}),e.jsx(T,{className:"text-right",children:"Ações"})]})}),e.jsx(ee,{children:t.map(o=>{const j=we(o.status),D=j.icon;return e.jsxs(M,{children:[e.jsx(A,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:o.name}),o.description&&e.jsx("div",{className:"text-sm text-muted-foreground",children:o.description})]})}),e.jsx(A,{children:e.jsx(J,{variant:"outline",children:o.type==="PERCENTAGE"?"Percentual":"Valor Fixo"})}),e.jsxs(A,{children:[e.jsx("div",{className:"font-medium",children:o.type==="PERCENTAGE"?`${o.value}%`:v(o.value)}),o.minOrderValue&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Min: ",v(o.minOrderValue)]})]}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(J,{variant:j.variant,className:"gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),j.label]}),e.jsx(oe,{checked:o.status==="ACTIVE",onCheckedChange:ye=>y(o.id,ye)})]})}),e.jsx(A,{children:o.firstPurchaseOnly?e.jsx(Q,{className:"h-4 w-4 text-green-600"}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(A,{children:We(new Date(o.createdAt),"dd/MM/yyyy",{locale:Je})}),e.jsx(A,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>w(o),children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>_(o.id),children:e.jsx(Ke,{className:"h-4 w-4 text-red-600"})})]})})]},o.id)})})]})})]})}),e.jsx(z,{value:"customers",className:"space-y-4",children:e.jsxs(S,{children:[e.jsxs(P,{children:[e.jsx(V,{children:"Clientes com Mais Cashback"}),e.jsx(W,{children:"Top 10 clientes com cashback disponível"})]}),e.jsx(L,{children:n?e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"h-12 w-full"}),e.jsx(O,{className:"h-12 w-full"})]}):i.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhum cliente com cashback ainda"}):e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(T,{children:"Cliente"}),e.jsx(T,{children:"Total Ganho"}),e.jsx(T,{children:"Disponível"}),e.jsx(T,{children:"Usado"})]})}),e.jsx(ee,{children:i.map(o=>e.jsxs(M,{children:[e.jsx(A,{children:e.jsxs("div",{className:"font-mono text-sm",children:[o.customerId.substring(0,8),"..."]})}),e.jsx(A,{children:e.jsx("div",{className:"font-medium",children:v(o.totalEarned)})}),e.jsx(A,{children:e.jsx("div",{className:"font-medium text-green-600",children:v(o.available)})}),e.jsx(A,{children:e.jsx("div",{className:"text-muted-foreground",children:v(o.used)})})]},o.customerId))})]})})]})})]}),e.jsx(Fe,{open:l,onOpenChange:c,children:e.jsxs(qe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Oe,{children:[e.jsx(Me,{children:m?"Editar Regra":"Nova Regra de Cashback"}),e.jsx(Ge,{children:"Configure os parâmetros da regra de cashback"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"name",children:"Nome da Regra *"}),e.jsx(F,{id:"name",value:d.name,onChange:o=>N({...d,name:o.target.value}),placeholder:"Ex: Cashback 5% em todas as compras"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"description",children:"Descrição"}),e.jsx(F,{id:"description",value:d.description||"",onChange:o=>N({...d,description:o.target.value}),placeholder:"Descrição opcional"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"type",children:"Tipo *"}),e.jsxs(ae,{value:d.type,onValueChange:o=>N({...d,type:o}),children:[e.jsx(se,{children:e.jsx(te,{})}),e.jsxs(re,{children:[e.jsx(q,{value:"PERCENTAGE",children:"Percentual"}),e.jsx(q,{value:"FIXED_AMOUNT",children:"Valor Fixo"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(I,{htmlFor:"value",children:["Valor * ",d.type==="PERCENTAGE"&&"(%)"]}),e.jsx(F,{id:"value",type:"number",step:"0.01",value:d.value,onChange:o=>N({...d,value:parseFloat(o.target.value)}),placeholder:d.type==="PERCENTAGE"?"5":"10.00"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"minOrderValue",children:"Valor Mínimo do Pedido"}),e.jsx(F,{id:"minOrderValue",type:"number",step:"0.01",value:d.minOrderValue||"",onChange:o=>N({...d,minOrderValue:parseFloat(o.target.value)}),placeholder:"0.00"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"maxCashbackAmount",children:"Cashback Máximo"}),e.jsx(F,{id:"maxCashbackAmount",type:"number",step:"0.01",value:d.maxCashbackAmount||"",onChange:o=>N({...d,maxCashbackAmount:parseFloat(o.target.value)}),placeholder:"0.00"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"status",children:"Status"}),e.jsxs(ae,{value:d.status,onValueChange:o=>N({...d,status:o}),children:[e.jsx(se,{children:e.jsx(te,{})}),e.jsxs(re,{children:[e.jsx(q,{value:"ACTIVE",children:"Ativo"}),e.jsx(q,{value:"INACTIVE",children:"Inativo"}),e.jsx(q,{value:"SCHEDULED",children:"Agendado"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{id:"firstPurchaseOnly",checked:d.firstPurchaseOnly,onCheckedChange:o=>N({...d,firstPurchaseOnly:o})}),e.jsx(I,{htmlFor:"firstPurchaseOnly",className:"cursor-pointer",children:"Apenas primeira compra do cliente"})]}),d.type==="PERCENTAGE"&&d.value>0&&e.jsxs(Ue,{children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs(_e,{children:["Exemplo: Em uma compra de R$ 100,00, o cliente receberá"," ",v(100*(d.value/100))," de cashback",d.maxCashbackAmount&&` (limitado a ${v(d.maxCashbackAmount)})`]})]})]}),e.jsxs(Be,{children:[e.jsx(R,{variant:"outline",onClick:()=>{c(!1),p(null),N({name:"",description:"",type:"PERCENTAGE",value:0,status:"ACTIVE",firstPurchaseOnly:!1})},children:"Cancelar"}),e.jsx(R,{onClick:x,children:"Salvar"})]})]})})]})};export{ja as default};
