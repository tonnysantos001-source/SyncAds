import{j as e}from"./vendor-ui-D3JNL6pE.js";import{r as s}from"./vendor-react-X41Bjl18.js";import{g as t,s as a,C as r,a as i,b as l,v as n,c as d,a0 as o,t as c,J as x,d as m,S as g,I as h,e as j}from"./index-CCMizExq.js";import{T as p,a as y,b as u,c as b,d as N,e as f}from"./table-BcS_hPiv.js";import{S as v}from"./SuperAdminLayout-DPmnEOXd.js";import{m as w}from"./vendor-animation-DtB50Lbk.js";import"./vendor-supabase-HUq0BeMy.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-DqG_mm-v.js";import"./vendor-icons-C9d2sOc_.js";function k(){const{toast:k}=t(),[C,I]=s.useState([]),[A,S]=s.useState(""),[T,M]=s.useState(!0);s.useEffect(()=>{E()},[]);const E=async()=>{try{const{data:e,error:s}=await a.from("User").select("id, name, email, plan, createdAt").order("createdAt",{ascending:!1});if(s)throw s;const t=(e||[]).map(e=>e.id),{data:r}=await a.from("ChatConversation").select("userId, id").in("userId",t),i=(r||[]).map(e=>e.id),{data:l}=await a.from("ChatMessage").select("conversationId").in("conversationId",i),n=new Map;(r||[]).forEach(e=>{const s=(l||[]).filter(s=>s.conversationId===e.id).length,t=n.get(e.userId)||0;n.set(e.userId,t+s)});const{data:d}=await a.from("AiUsage").select("userId, totalTokens, estimatedCost, createdAt").in("userId",t).order("createdAt",{ascending:!1}),o=new Map;(d||[]).forEach(e=>{o.has(e.userId)||o.set(e.userId,e)});const{data:c}=await a.from("GlobalAiConnection").select("provider").eq("isActive",!0).limit(1).maybeSingle(),x=(e||[]).map(e=>{const s=o.get(e.id);return{clientId:e.id,clientName:e.name||"Sem nome",clientSlug:e.email||"",plan:e.plan||"FREE",totalMessages:n.get(e.id)||0,totalTokens:s?.totalTokens||0,estimatedCost:s?.estimatedCost||0,aiProvider:c?.provider||"N/A",lastUsed:s?.createdAt||null}});I(x)}catch(e){k({title:"Erro ao carregar uso de IA",description:e.message,variant:"destructive"})}finally{M(!1)}},R=C.filter(e=>e.clientName.toLowerCase().includes(A.toLowerCase())||e.clientSlug.toLowerCase().includes(A.toLowerCase())),U={totalMessages:C.reduce((e,s)=>e+s.totalMessages,0),totalTokens:C.reduce((e,s)=>e+s.totalTokens,0),totalCost:C.reduce((e,s)=>e+s.estimatedCost,0),avgMessagesPerClient:C.length>0?C.reduce((e,s)=>e+s.totalMessages,0)/C.length:0},L=s=>{const t={FREE:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100",STARTER:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",PRO:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",ENTERPRISE:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200"};return e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${t[s]||t.FREE}`,children:s})},P=s=>{const t={openai:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",anthropic:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",google:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200","N/A":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100"};return e.jsx(j,{variant:"outline",className:t[s]||t["N/A"],children:s.toUpperCase()})};return T?e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsx(v,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent",children:"Uso de IA"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Acompanhe o uso de inteligência artificial por cliente"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(r,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-300",children:"Total de Mensagens"}),e.jsx(n,{className:"h-4 w-4 text-blue-400"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:U.totalMessages.toLocaleString("pt-BR")}),e.jsx("p",{className:"text-xs text-gray-400",children:"Todas conversas com IA"})]})]})}),e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(r,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-300",children:"Total de Tokens"}),e.jsx(o,{className:"h-4 w-4 text-amber-400"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[(U.totalTokens/1e3).toFixed(1),"K"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Tokens processados"})]})]})}),e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(r,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-300",children:"Custo Estimado"}),e.jsx(c,{className:"h-4 w-4 text-green-400"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:["R$"," ",U.totalCost.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Custo com APIs"})]})]})}),e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsxs(r,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-300",children:"Média por Usuário"}),e.jsx(x,{className:"h-4 w-4 text-purple-400"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:Math.round(U.avgMessagesPerClient)}),e.jsx("p",{className:"text-xs text-gray-400",children:"Mensagens / usuário"})]})]})})]}),e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:e.jsxs(r,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsx(i,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(l,{className:"text-white",children:"Uso de IA por Usuário"}),e.jsx(m,{className:"text-gray-400",children:"Detalhes de mensagens, tokens e custos"})]})})}),e.jsxs(d,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx(h,{placeholder:"Buscar usuário...",value:A,onChange:e=>S(e.target.value),className:"pl-10 bg-gray-800 border-gray-700 text-white placeholder:text-gray-500"})]})}),e.jsx("div",{className:"border border-gray-700/50 rounded-lg overflow-hidden",children:e.jsxs(p,{children:[e.jsx(y,{children:e.jsxs(u,{className:"border-gray-700/50 hover:bg-gray-800/50",children:[e.jsx(b,{className:"text-gray-300 font-semibold",children:"Cliente"}),e.jsx(b,{className:"text-gray-300 font-semibold",children:"Plano"}),e.jsx(b,{className:"text-gray-300 font-semibold",children:"Provider"}),e.jsx(b,{className:"text-gray-300 font-semibold",children:"Mensagens"}),e.jsx(b,{className:"text-gray-300 font-semibold",children:"Tokens"}),e.jsx(b,{className:"text-gray-300 font-semibold",children:"Custo"}),e.jsx(b,{className:"text-gray-300 font-semibold",children:"Último Uso"})]})}),e.jsx(N,{children:0===R.length?e.jsx(u,{children:e.jsx(f,{colSpan:7,className:"text-center py-8 text-gray-500",children:"Nenhum dado de uso encontrado"})}):R.map((s,t)=>e.jsxs(w.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*t},className:"border-gray-700/50 hover:bg-gray-800/50 transition-colors",children:[e.jsx(f,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.clientName}),e.jsx("div",{className:"text-sm text-gray-400",children:s.clientSlug})]})}),e.jsx(f,{children:L(s.plan)}),e.jsx(f,{children:P(s.aiProvider)}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(n,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-white",children:s.totalMessages})]})}),e.jsx(f,{children:e.jsx("span",{className:"text-sm text-white",children:s.totalTokens.toLocaleString("pt-BR")})}),e.jsx(f,{children:e.jsxs("span",{className:"font-semibold text-green-400",children:["R$"," ",s.estimatedCost.toLocaleString("pt-BR",{minimumFractionDigits:2})]})}),e.jsx(f,{children:s.lastUsed?e.jsx("span",{className:"text-sm text-gray-400",children:new Date(s.lastUsed).toLocaleDateString("pt-BR")}):e.jsx("span",{className:"text-sm text-gray-500",children:"Nunca"})})]},s.clientId))})]})})]})]})})]})})}export{k as default};
