import{a as $,r as d,s as h,j as e,i as F,C as l,h as i,e as g,f as u}from"./index-CMAMdGP8.js";import{D as X}from"./dollar-sign-C2Mhr-ze.js";import{S as H}from"./shopping-cart-C1yUDp_x.js";import{T as G}from"./trending-up-D6xwn0eC.js";import{C as K}from"./credit-card-xJ3ivElB.js";import{A as W}from"./activity-BOu8fPT3.js";import{A as Z}from"./arrow-up-right-CAbt2Bs_.js";import{A as J}from"./arrow-down-right-r-4NMhvS.js";import{R as Q,C as _,X as ee,Y as te,T as se}from"./generateCategoricalChart-pa5fHNAp.js";import{A as ae,a as re}from"./AreaChart-DgsT0z74.js";import{E as w}from"./eye-lhu20xtl.js";import{C as ne}from"./circle-check-Uy57hKZ0.js";import{C as oe}from"./clock-DwWOeHi4.js";import{C as ce}from"./circle-x-2eZRabft.js";import{P as le}from"./package-DsdR3eXv.js";import{T as ie}from"./trending-down-BKmxhS6M.js";import{U as de}from"./users-DDgKC8uU.js";const Re=()=>{const o=$(t=>t.user),[C,v]=d.useState(!0),[k,A]=d.useState([]),[p,D]=d.useState([]),[b,R]=d.useState([]),[f,O]=d.useState("week"),[r,m]=d.useState({totalRevenue:0,revenueChange:0,totalOrders:0,ordersChange:0,conversionRate:0,conversionChange:0,averageOrderValue:0,aovChange:0,onlineNow:0,checkoutViews:0,checkoutAbandonment:0,topProducts:[]});d.useEffect(()=>{if(o!=null&&o.id){S();const t=setInterval(()=>{y()},3e4);return()=>clearInterval(t)}},[o==null?void 0:o.id,f]);const S=async()=>{try{v(!0),await Promise.all([P(),T(),M(),E(),I(),V(),y()])}catch(t){console.error("Erro ao carregar dashboard:",t)}finally{v(!1)}},P=async()=>{try{const{data:t}=await h.from("Order").select("total, createdAt").eq("userId",o.id).eq("status","paid").gte("createdAt",j()).order("createdAt",{ascending:!1});if(t&&t.length>0){const s=t.reduce((n,c)=>n+(c.total||0),0),a=U(t);m(n=>({...n,totalRevenue:s,revenueChange:a}))}}catch(t){console.error("Erro ao carregar receita:",t)}},T=async()=>{try{const{data:t}=await h.from("Order").select("id, createdAt, total").eq("userId",o.id).gte("createdAt",j()).order("createdAt",{ascending:!1});if(t){const s=t.length,a=L(t),n=t.reduce((N,Y)=>N+(Y.total||0),0),c=s>0?n/s:0;m(N=>({...N,totalOrders:s,ordersChange:a,averageOrderValue:c,aovChange:5.2}))}}catch(t){console.error("Erro ao carregar pedidos:",t)}},M=async()=>{try{m(a=>({...a,conversionRate:3.2,conversionChange:.8,checkoutViews:1247,checkoutAbandonment:68.5}))}catch(t){console.error("Erro ao carregar conversão:",t)}},E=async()=>{try{const{data:t}=await h.from("Order").select("total, createdAt").eq("userId",o.id).eq("status","paid").gte("createdAt",j()).order("createdAt",{ascending:!0});if(t){const s=q(t);A(s)}}catch(t){console.error("Erro ao carregar gráfico:",t)}},I=async()=>{try{const{data:t}=await h.from("Order").select("id, customerName, total, status, createdAt, paymentMethod").eq("userId",o.id).order("createdAt",{ascending:!1}).limit(5);if(t){const s=t.map(a=>({id:a.id,customer:a.customerName||"Cliente",amount:a.total||0,status:a.status==="paid"?"approved":a.status==="pending"?"pending":"failed",time:z(a.createdAt),paymentMethod:a.paymentMethod||"Cartão"}));R(s)}}catch(t){console.error("Erro ao carregar transações:",t)}},V=async()=>{try{const t=[{name:"Produto A",sales:45,revenue:4500},{name:"Produto B",sales:32,revenue:3200},{name:"Produto C",sales:28,revenue:2800},{name:"Produto D",sales:21,revenue:2100}];m(s=>({...s,topProducts:t}))}catch(t){console.error("Erro ao carregar produtos:",t)}},y=async()=>{try{const t=[{id:"1",page:"Checkout - Pagamento",timeOnPage:45,device:"mobile"},{id:"2",page:"Checkout - Dados Pessoais",timeOnPage:120,device:"desktop"},{id:"3",page:"Produto - Fones XYZ",timeOnPage:30,device:"mobile"}];D(t),m(s=>({...s,onlineNow:t.length}))}catch(t){console.error("Erro ao carregar dados em tempo real:",t)}},j=()=>{const t=new Date;switch(f){case"today":return new Date(t.setHours(0,0,0,0)).toISOString();case"week":return new Date(t.setDate(t.getDate()-7)).toISOString();case"month":return new Date(t.setMonth(t.getMonth()-1)).toISOString();case"year":return new Date(t.setFullYear(t.getFullYear()-1)).toISOString();default:return new Date(t.setDate(t.getDate()-7)).toISOString()}},U=t=>12.5,L=t=>8.3,q=t=>{const s={};return t.forEach(a=>{const n=new Date(a.createdAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"});s[n]=(s[n]||0)+(a.total||0)}),Object.entries(s).map(([a,n])=>({date:a,revenue:n,orders:Math.floor(Math.random()*20)+5}))},z=t=>{const s=new Date(t),n=new Date().getTime()-s.getTime(),c=Math.floor(n/6e4);return c<1?"Agora":c<60?`${c}m atrás`:c<1440?`${Math.floor(c/60)}h atrás`:s.toLocaleDateString("pt-BR")},x=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),B=[{title:"Receita Total",value:x(r.totalRevenue),change:r.revenueChange,trend:r.revenueChange>=0?"up":"down",icon:e.jsx(X,{className:"h-5 w-5"})},{title:"Pedidos",value:r.totalOrders,change:r.ordersChange,trend:r.ordersChange>=0?"up":"down",icon:e.jsx(H,{className:"h-5 w-5"})},{title:"Taxa de Conversão",value:r.conversionRate,change:r.conversionChange,trend:r.conversionChange>=0?"up":"down",icon:e.jsx(G,{className:"h-5 w-5"}),suffix:"%"},{title:"Ticket Médio",value:x(r.averageOrderValue),change:r.aovChange,trend:r.aovChange>=0?"up":"down",icon:e.jsx(K,{className:"h-5 w-5"})}];return C?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-pink-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Visão geral das suas métricas de vendas"})]}),e.jsx("div",{className:"flex gap-2",children:["today","week","month","year"].map(t=>e.jsxs("button",{onClick:()=>O(t),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${f===t?"bg-pink-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:[t==="today"&&"Hoje",t==="week"&&"7 dias",t==="month"&&"30 dias",t==="year"&&"1 ano"]},t))})]}),e.jsx(l,{className:"bg-gradient-to-br from-pink-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(W,{className:"h-8 w-8 animate-pulse"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm font-medium",children:"Usuários Online Agora"}),e.jsx("p",{className:"text-4xl font-bold mt-1",children:r.onlineNow}),e.jsxs("p",{className:"text-white/80 text-xs mt-1",children:[p.filter(t=>t.page.includes("Checkout")).length," ","no checkout"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium",children:"Ao Vivo"})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:B.map((t,s)=>e.jsx(l,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"h-12 w-12 bg-pink-100 rounded-lg flex items-center justify-center text-pink-600",children:t.icon}),e.jsxs("div",{className:`flex items-center gap-1 text-sm font-medium ${t.trend==="up"?"text-green-600":"text-red-600"}`,children:[t.trend==="up"?e.jsx(Z,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"}),Math.abs(t.change),"%"]})]}),e.jsx("p",{className:"text-gray-600 text-sm font-medium mb-1",children:t.title}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[t.prefix,t.value,t.suffix]})]})},s))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(l,{className:"lg:col-span-2",children:[e.jsx(g,{children:e.jsx(u,{className:"text-lg font-semibold",children:"Receita ao Longo do Tempo"})}),e.jsx(i,{children:e.jsx(Q,{width:"100%",height:300,children:e.jsxs(ae,{data:k,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ec4899",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#ec4899",stopOpacity:0})]})}),e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(ee,{dataKey:"date",tick:{fill:"#666",fontSize:12}}),e.jsx(te,{tick:{fill:"#666",fontSize:12}}),e.jsx(se,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),e.jsx(re,{type:"monotone",dataKey:"revenue",stroke:"#ec4899",strokeWidth:2,fillOpacity:1,fill:"url(#colorRevenue)"})]})})})]}),e.jsxs(l,{children:[e.jsx(g,{children:e.jsxs(u,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-pink-600"}),"Atividade em Tempo Real"]})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[p.map(t=>e.jsxs("div",{className:"flex items-start gap-3 pb-4 border-b last:border-0 last:pb-0",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full mt-2 animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.page}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[t.timeOnPage,"s na página"]}),e.jsx("span",{className:"text-xs text-gray-400",children:"•"}),e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:t.device})]})]})]},t.id)),p.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Nenhum usuário online no momento"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(g,{children:e.jsx(u,{className:"text-lg font-semibold",children:"Transações Recentes"})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[b.map(t=>e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b last:border-0 last:pb-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ${t.status==="approved"?"bg-green-100":t.status==="pending"?"bg-yellow-100":"bg-red-100"}`,children:[t.status==="approved"&&e.jsx(ne,{className:"h-5 w-5 text-green-600"}),t.status==="pending"&&e.jsx(oe,{className:"h-5 w-5 text-yellow-600"}),t.status==="failed"&&e.jsx(ce,{className:"h-5 w-5 text-red-600"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.customer}),e.jsx("p",{className:"text-xs text-gray-500",children:t.time})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold text-gray-900",children:x(t.amount)}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:t.paymentMethod})]})]},t.id)),b.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Nenhuma transação recente"})]})})]}),e.jsxs(l,{children:[e.jsx(g,{children:e.jsxs(u,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-pink-600"}),"Produtos Mais Vendidos"]})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[r.topProducts.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"h-8 w-8 bg-gradient-to-br from-pink-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-sm",children:s+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.sales," vendas"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-sm font-bold text-gray-900",children:x(t.revenue)})})]},s)),r.topProducts.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Nenhum produto vendido ainda"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(l,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(w,{className:"h-5 w-5 text-blue-600"}),e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Visualizações do Checkout"})]}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:r.checkoutViews}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Últimos 7 dias"})]})}),e.jsx(l,{className:"bg-gradient-to-br from-amber-50 to-amber-100 border-amber-200",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ie,{className:"h-5 w-5 text-amber-600"}),e.jsx("p",{className:"text-sm font-medium text-amber-900",children:"Taxa de Abandono"})]}),e.jsxs("p",{className:"text-3xl font-bold text-amber-900",children:[r.checkoutAbandonment,"%"]}),e.jsx("p",{className:"text-xs text-amber-700 mt-1",children:"Oportunidade de melhoria"})]})}),e.jsx(l,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(de,{className:"h-5 w-5 text-green-600"}),e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Novos Clientes"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:Math.floor(r.totalOrders*.65)}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"65% dos pedidos"})]})})]})]})};export{Re as default};
