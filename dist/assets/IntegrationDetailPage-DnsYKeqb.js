import{j as e}from"./vendor-ui-DkUuACDy.js";import{k as t,f as a,r as s}from"./vendor-react-X41Bjl18.js";import{s as r,f as o,l as i,g as n,B as c,C as d,a as u,b as l,d as h,e as p,c as m,I as x}from"./index-CEALE7TY.js";import{L as g}from"./label-BafUdBzj.js";import{A as y,b as f}from"./alert-CiJ1nMXE.js";import{F as w,ad as j,u as v,J as S,ae as N,v as b,o as A,at as T,au as C,av as I,aw as k,E,L as q}from"./vendor-icons-DTdRnryx.js";import"./vendor-supabase-BQxDPPjR.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-animation-DQ3cvw6m.js";import"./vendor-query-Bf3pI66S.js";const O={async startOAuth(e){try{const t=await r.auth.getUser(),a=t.data.user?.id;if(!a)throw new Error("User not authenticated");return(await fetch(`https://your-project.supabase.co/functions/v1/shopify-oauth?action=install&shop=${e}&userId=${a}`,{headers:{Authorization:`Bearer ${(await r.auth.getSession()).data.session?.access_token}`}})).json()}catch(t){throw t}},async connect(e,t,a,s){try{const i=await r.auth.getSession(),n=await r.auth.getUser(),c=n.data.user?.id;if(!c)return{success:!1,error:"User not authenticated"};e.includes(".myshopify.com")||(e=`${e}.myshopify.com`);const d=e.replace(".myshopify.com","");try{const a=await fetch("https://your-project.supabase.co/functions/v1/shopify-oauth?action=validate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.data.session?.access_token}`},body:JSON.stringify({shopDomain:e,accessToken:t})}),s=await a.json();if(!s.success)return{success:!1,error:s.error||"Erro ao validar credenciais com Shopify"}}catch(o){return{success:!1,error:"Erro ao validar credenciais. Verifique se estão corretas."}}const{data:u,error:l}=await r.from("ShopifyIntegration").upsert({userId:c,shopName:d,shopDomain:e,accessToken:t,apiKey:a,apiSecret:s,scope:"read_products,write_products,read_orders,write_orders,read_customers,write_customers",isActive:!0,updatedAt:(new Date).toISOString()}).select().single();return l?{success:!1,error:l.message}:{success:!0,data:u}}catch(i){return{success:!1,error:i.message||"Erro desconhecido"}}},async testConnection(e,t){try{const a=await r.auth.getSession(),s=e.includes(".myshopify.com")?e:`${e}.myshopify.com`,o=await fetch("https://your-project.supabase.co/functions/v1/shopify-oauth?action=validate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.data.session?.access_token}`},body:JSON.stringify({shopDomain:s,accessToken:t})}),i=await o.json();return i.success?{success:!0,message:i.message||"Conectado com sucesso",data:i.data}:{success:!1,message:i.error||"Erro ao validar credenciais"}}catch(a){return{success:!1,message:`Erro ao conectar com Shopify: ${a.message}`}}},async getActiveIntegration(){return this.getStatus()},async getStatus(){try{const e=await r.auth.getUser(),t=e.data.user?.id;if(!t)return null;const{data:a,error:s}=await r.from("ShopifyIntegration").select("*").eq("userId",t).eq("isActive",!0).single();if(s&&"PGRST116"!==s.code)throw s;return a}catch(e){return null}},async sync(e="sync-all"){try{const t=await this.getStatus();if(!t)throw new Error("No integration found");const a=await r.auth.getSession();return(await fetch("https://your-project.supabase.co/functions/v1/shopify-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.data.session?.access_token}`},body:JSON.stringify({integrationId:t.id,action:e})})).json()}catch(t){throw t}},async disconnect(){try{const e=await r.auth.getUser(),t=e.data.user?.id;if(!t)throw new Error("User not authenticated");const{error:a}=await r.from("ShopifyIntegration").update({isActive:!1,updatedAt:(new Date).toISOString()}).eq("userId",t).eq("isActive",!0);if(a)throw a;return{success:!0}}catch(e){throw e}},async getStats(){try{const e=await r.auth.getUser(),t=e.data.user?.id;if(!t)return null;const[a,s,o]=await Promise.all([this.getStatus(),r.from("ShopifyProduct").select("id",{count:"exact",head:!0}).eq("userId",t),r.from("ShopifyOrder").select("id",{count:"exact",head:!0}).eq("userId",t)]);return{connected:!!a,shopName:a?.shopName,lastSync:a?.lastSyncAt,productsCount:s.count||0,ordersCount:o.count||0}}catch(e){return null}},async syncProducts(){try{const e=await this.getActiveIntegration();if(!e)throw new Error("Nenhuma integração Shopify ativa encontrada");const t=`https://${e.shopName}.myshopify.com`,a=[];let s=null;do{const r=s?`${t}/admin/api/2023-10/products.json?limit=250&page_info=${s}`:`${t}/admin/api/2023-10/products.json?limit=250`,o=await fetch(r,{headers:{"X-Shopify-Access-Token":e.accessToken,"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Erro ao buscar produtos: ${o.statusText}`);const i=await o.json();a.push(...i.products);const n=o.headers.get("Link");if(s=null,n){const e=n.match(/<[^>]*page_info=([^&>]+)/);e&&(s=e[1])}}while(s);const{error:o}=await r.from("ShopifyProduct").upsert(a.map(t=>({id:t.id,organizationId:e.organizationId,title:t.title,handle:t.handle,description:t.body_html,vendor:t.vendor,productType:t.product_type,tags:t.tags?t.tags.split(",").map(e=>e.trim()):[],status:t.status,shopifyData:t,createdAt:t.created_at,updatedAt:t.updated_at})),{onConflict:"id,organizationId"});if(o)throw o;return await r.from("ShopifyIntegration").update({lastSyncAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}).eq("id",e.id),{success:!0,message:`${a.length} produtos sincronizados com sucesso`,data:{productCount:a.length,lastSyncAt:(new Date).toISOString()}}}catch(e){throw e}},async getProducts(e){try{let t=r.from("ShopifyProduct").select("*").order("updatedAt",{ascending:!1});e?.status&&(t=t.eq("status",e.status)),e?.vendor&&(t=t.eq("vendor",e.vendor)),e?.productType&&(t=t.eq("productType",e.productType)),e?.search&&(t=t.or(`title.ilike.%${e.search}%,handle.ilike.%${e.search}%`));const{data:a,error:s}=await t;if(s)throw s;return a}catch(t){throw t}},async createOrder(e){try{const t=await this.getActiveIntegration();if(!t)throw new Error("Nenhuma integração Shopify ativa encontrada");const a=`https://${t.shopName}.myshopify.com`,s={order:{line_items:e.lineItems,customer:e.customer,shipping_address:e.shippingAddress,billing_address:e.billingAddress,note:e.note,tags:e.tags?.join(", "),financial_status:"pending",send_receipt:!0,send_fulfillment_receipt:!1}},r=await fetch(`${a}/admin/api/2023-10/orders.json`,{method:"POST",headers:{"X-Shopify-Access-Token":t.accessToken,"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const e=await r.json();throw new Error(`Erro ao criar pedido: ${e.errors||r.statusText}`)}return{success:!0,message:"Pedido criado com sucesso no Shopify",data:(await r.json()).order}}catch(t){throw t}},async getOrders(e){try{const t=await this.getActiveIntegration();if(!t)throw new Error("Nenhuma integração Shopify ativa encontrada");let a=`${`https://${t.shopName}.myshopify.com`}/admin/api/2023-10/orders.json?limit=${e?.limit||50}`;e?.status&&(a+=`&status=${e.status}`),e?.financialStatus&&(a+=`&financial_status=${e.financialStatus}`),e?.startDate&&(a+=`&created_at_min=${e.startDate}`),e?.endDate&&(a+=`&created_at_max=${e.endDate}`);const s=await fetch(a,{headers:{"X-Shopify-Access-Token":t.accessToken,"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Erro ao buscar pedidos: ${s.statusText}`);return(await s.json()).orders}catch(t){throw t}},async setupWebhooks(){try{const t=await this.getActiveIntegration();if(!t)throw new Error("Nenhuma integração Shopify ativa encontrada");const a=`https://${t.shopName}.myshopify.com`,s=`${Deno.env.get("SUPABASE_URL")}/functions/v1/shopify-webhook`,r=[{topic:"orders/create",address:s,format:"json"},{topic:"orders/updated",address:s,format:"json"},{topic:"orders/paid",address:s,format:"json"},{topic:"orders/cancelled",address:s,format:"json"}],o=[];for(const i of r)try{const e=await fetch(`${a}/admin/api/2023-10/webhooks.json`,{method:"POST",headers:{"X-Shopify-Access-Token":t.accessToken,"Content-Type":"application/json"},body:JSON.stringify({webhook:i})});if(e.ok){const t=await e.json();o.push({topic:i.topic,success:!0,webhookId:t.webhook.id})}else o.push({topic:i.topic,success:!1,error:e.statusText})}catch(e){o.push({topic:i.topic,success:!1,error:e.message})}return{success:!0,message:"Webhooks configurados",data:o}}catch(e){throw e}}},P={async connect(e,t,a,s="vtexcommercestable"){try{const o=await r.auth.getSession(),i=await fetch("https://your-project.supabase.co/functions/v1/vtex-connect",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.data.session?.access_token}`},body:JSON.stringify({accountName:e,appKey:t,appToken:a,environment:s})});return await i.json()}catch(o){throw new Error(o.message||"Failed to connect to VTEX")}},async getStatus(){try{const{data:e}=await r.auth.getUser();if(!e.user)throw new Error("Not authenticated");const{data:t,error:a}=await r.from("VtexIntegration").select("*").eq("userId",e.user.id).eq("isActive",!0).single();if(a&&"PGRST116"!==a.code)throw a;return t}catch(e){return null}},async sync(e="sync-all"){try{const t=await this.getStatus();if(!t)throw new Error("No active VTEX integration found");const a=await r.auth.getSession(),s=await fetch("https://your-project.supabase.co/functions/v1/vtex-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.data.session?.access_token}`},body:JSON.stringify({integrationId:t.id,action:e})});return await s.json()}catch(t){throw new Error(t.message||"Failed to sync VTEX data")}},async disconnect(){try{const{data:e}=await r.auth.getUser();if(!e.user)throw new Error("Not authenticated");const{error:t}=await r.from("VtexIntegration").update({isActive:!1,updatedAt:(new Date).toISOString()}).eq("userId",e.user.id).eq("isActive",!0);if(t)throw t;return{success:!0}}catch(e){throw new Error(e.message||"Failed to disconnect VTEX")}},async getProducts(e=50){try{const{data:t}=await r.auth.getUser();if(!t.user)throw new Error("Not authenticated");const{data:a,error:s}=await r.from("VtexProduct").select("*").eq("userId",t.user.id).order("updatedAt",{ascending:!1}).limit(e);if(s)throw s;return a||[]}catch(t){throw new Error(t.message||"Failed to fetch VTEX products")}},async getOrders(e=50){try{const{data:t}=await r.auth.getUser();if(!t.user)throw new Error("Not authenticated");const{data:a,error:s}=await r.from("VtexOrder").select("*").eq("userId",t.user.id).order("createdAt",{ascending:!1}).limit(e);if(s)throw s;return a||[]}catch(t){throw new Error(t.message||"Failed to fetch VTEX orders")}},async getStats(){try{const{data:e}=await r.auth.getUser();if(!e.user)throw new Error("Not authenticated");const t=await this.getStatus(),{count:a}=await r.from("VtexProduct").select("id",{count:"exact",head:!0}).eq("userId",e.user.id),{count:s}=await r.from("VtexOrder").select("id",{count:"exact",head:!0}).eq("userId",e.user.id);return{connected:!!t,accountName:t?.accountName,lastSync:t?.lastSyncAt,productsCount:a||0,ordersCount:s||0}}catch(e){return{connected:!1,productsCount:0,ordersCount:0}}}},_={async connect(e,t,a){try{const s=await r.auth.getSession(),o=await fetch("https://your-project.supabase.co/functions/v1/nuvemshop-connect",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.data.session?.access_token}`},body:JSON.stringify({storeId:e,storeName:t,accessToken:a})});return await o.json()}catch(s){throw new Error(s.message||"Failed to connect to Nuvemshop")}},async getStatus(){try{const{data:e}=await r.auth.getUser();if(!e.user)return null;const{data:t,error:a}=await r.from("NuvemshopIntegration").select("*").eq("userId",e.user.id).eq("isActive",!0).single();if(a&&"PGRST116"!==a.code)throw a;return t}catch(e){return null}},async sync(e="sync-all"){try{const t=await this.getStatus();if(!t)throw new Error("No active integration");const a=await r.auth.getSession(),s=await fetch("https://your-project.supabase.co/functions/v1/nuvemshop-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.data.session?.access_token}`},body:JSON.stringify({integrationId:t.id,action:e})});return await s.json()}catch(t){throw new Error(t.message||"Failed to sync")}},async disconnect(){try{const{data:e}=await r.auth.getUser();if(!e.user)throw new Error("Not authenticated");const{error:t}=await r.from("NuvemshopIntegration").update({isActive:!1,updatedAt:(new Date).toISOString()}).eq("userId",e.user.id).eq("isActive",!0);if(t)throw t;return{success:!0}}catch(e){throw new Error(e.message||"Failed to disconnect")}},async getProducts(e=50){try{const{data:t}=await r.auth.getUser();if(!t.user)return[];const{data:a,error:s}=await r.from("NuvemshopProduct").select("*").eq("userId",t.user.id).order("updatedAt",{ascending:!1}).limit(e);if(s)throw s;return a||[]}catch(t){return[]}},async getOrders(e=50){try{const{data:t}=await r.auth.getUser();if(!t.user)return[];const{data:a,error:s}=await r.from("NuvemshopOrder").select("*").eq("userId",t.user.id).order("createdAt",{ascending:!1}).limit(e);if(s)throw s;return a||[]}catch(t){return[]}}},$={async connect(e,t,a){try{const s=await r.auth.getSession(),o=await fetch("https://your-project.supabase.co/functions/v1/woocommerce-connect",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.data.session?.access_token}`},body:JSON.stringify({siteUrl:e,consumerKey:t,consumerSecret:a})});return await o.json()}catch(s){throw new Error(s.message||"Failed to connect to WooCommerce")}},async getStatus(){try{const{data:e}=await r.auth.getUser();if(!e.user)return null;const{data:t,error:a}=await r.from("WooCommerceIntegration").select("*").eq("userId",e.user.id).eq("isActive",!0).single();if(a&&"PGRST116"!==a.code)throw a;return t}catch(e){return null}},async sync(e="sync-all"){try{const t=await this.getStatus();if(!t)throw new Error("No active integration");const a=await r.auth.getSession(),s=await fetch("https://your-project.supabase.co/functions/v1/woocommerce-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.data.session?.access_token}`},body:JSON.stringify({integrationId:t.id,action:e})});return await s.json()}catch(t){throw new Error(t.message||"Failed to sync")}},async disconnect(){try{const{data:e}=await r.auth.getUser();if(!e.user)throw new Error("Not authenticated");const{error:t}=await r.from("WooCommerceIntegration").update({isActive:!1,updatedAt:(new Date).toISOString()}).eq("userId",e.user.id).eq("isActive",!0);if(t)throw t;return{success:!0}}catch(e){throw new Error(e.message||"Failed to disconnect")}},async getProducts(e=50){try{const{data:t}=await r.auth.getUser();if(!t.user)return[];const{data:a,error:s}=await r.from("WooCommerceProduct").select("*").eq("userId",t.user.id).order("updatedAt",{ascending:!1}).limit(e);if(s)throw s;return a||[]}catch(t){return[]}},async getOrders(e=50){try{const{data:t}=await r.auth.getUser();if(!t.user)return[];const{data:a,error:s}=await r.from("WooCommerceOrder").select("*").eq("userId",t.user.id).order("createdAt",{ascending:!1}).limit(e);if(s)throw s;return a||[]}catch(t){return[]}}},D={async startOAuth(){const e=await r.auth.getSession(),t=await fetch("https://your-project.supabase.co/functions/v1/mercadolivre-oauth?action=start",{headers:{Authorization:`Bearer ${e.data.session?.access_token}`}});return await t.json()},async getStatus(){const{data:e}=await r.auth.getUser();if(!e.user)return null;const{data:t}=await r.from("MercadoLivreIntegration").select("*").eq("userId",e.user.id).eq("isActive",!0).single();return t},async sync(){const e=await this.getStatus();if(!e)throw new Error("No active integration");const t=await r.auth.getSession(),a=await fetch("https://your-project.supabase.co/functions/v1/mercadolivre-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.data.session?.access_token}`},body:JSON.stringify({integrationId:e.id})});return await a.json()},async disconnect(){const{data:e}=await r.auth.getUser();if(!e.user)throw new Error("Not authenticated");const{error:t}=await r.from("MercadoLivreIntegration").update({isActive:!1}).eq("userId",e.user.id);if(t)throw t;return{success:!0}}},U={shopify:{id:"shopify",name:"Shopify",icon:j,description:"Conecte sua loja Shopify para sincronizar produtos, pedidos e clientes automaticamente.",longDescription:"A integração com Shopify permite sincronizar automaticamente todos os seus produtos, pedidos, clientes e dados de estoque entre sua loja e o SyncAds. Com isso, você pode gerenciar tudo em um só lugar.",fields:[{id:"shopDomain",label:"Domínio da Loja",placeholder:"minhaloja.myshopify.com",type:"text",required:!0,helpText:"Digite o domínio da sua loja Shopify"},{id:"accessToken",label:"Access Token",placeholder:"shpat_xxxxxxxxxxxxx",type:"password",required:!0,helpText:"Token de acesso da Admin API"},{id:"apiKey",label:"API Key",placeholder:"xxxxxxxxxxxxx",type:"text",required:!0,helpText:"Client ID do seu App"},{id:"apiSecret",label:"API Secret",placeholder:"shpss_xxxxxxxxxxxxx",type:"password",required:!0,helpText:"Client Secret do seu App"}],manual:[{step:1,title:"Configure as Credenciais",description:"Preencha os campos acima com as credenciais do seu App Shopify"},{step:2,title:"Instale o Script no Tema",description:"Adicione o script de checkout no arquivo theme.liquid da sua loja",link:"https://syncads-dun.vercel.app/shopify-checkout-redirect.js",linkText:"Ver Script"}]},vtex:{id:"vtex",name:"VTEX",icon:N,description:"Integre sua loja VTEX para gerenciar produtos e pedidos em tempo real.",longDescription:"A integração VTEX permite que você sincronize automaticamente produtos, pedidos e estoque da sua loja VTEX com o SyncAds.",fields:[{id:"accountName",label:"Account Name",placeholder:"minhaloja",type:"text",required:!0,helpText:"Nome da sua conta VTEX"},{id:"appKey",label:"App Key",placeholder:"vtexappkey-xxxxx",type:"text",required:!0,helpText:"Chave de aplicação VTEX"},{id:"appToken",label:"App Token",placeholder:"xxxxxxxxxxxxx",type:"password",required:!0,helpText:"Token de acesso da aplicação"}],manual:[{step:1,title:"Acesse o Admin VTEX",description:"Entre no painel administrativo da sua loja VTEX"},{step:2,title:"Gere App Key e App Token",description:'Vá em "Configurações da Conta" > "Chaves de aplicação" > "Gerenciar minhas chaves"'},{step:3,title:"Configure Permissões",description:"Crie uma nova chave com permissões de Catalog, Orders e OMS"}]},nuvemshop:{id:"nuvemshop",name:"Nuvemshop",icon:S,description:"Conecte sua loja Nuvemshop para sincronização automática de dados.",longDescription:"Sincronize produtos, pedidos e clientes da sua Nuvemshop automaticamente.",fields:[{id:"storeId",label:"Store ID",placeholder:"123456",type:"text",required:!0,helpText:"ID da sua loja Nuvemshop"},{id:"storeName",label:"Nome da Loja",placeholder:"Minha Loja",type:"text",required:!1,helpText:"Nome da sua loja (opcional)"},{id:"accessToken",label:"Access Token",placeholder:"xxxxxxxxxxxxx",type:"password",required:!0,helpText:"Token de acesso gerado no admin"}],manual:[{step:1,title:"Acesse Aplicativos",description:"No admin da Nuvemshop, vá em 'Meus aplicativos'"},{step:2,title:"Gere Access Token",description:"Crie um novo aplicativo e copie o Access Token gerado"}]},woocommerce:{id:"woocommerce",name:"WooCommerce",icon:v,description:"Integre sua loja WooCommerce com facilidade.",longDescription:"Conecte sua loja WooCommerce para sincronizar produtos, pedidos e estoque.",fields:[{id:"siteUrl",label:"URL do Site",placeholder:"https://minhaloja.com",type:"url",required:!0,helpText:"URL completa do seu site WooCommerce"},{id:"consumerKey",label:"Consumer Key",placeholder:"ck_xxxxxxxxxxxxx",type:"text",required:!0,helpText:"Chave do consumidor da API REST"},{id:"consumerSecret",label:"Consumer Secret",placeholder:"cs_xxxxxxxxxxxxx",type:"password",required:!0,helpText:"Segredo do consumidor da API REST"}],manual:[{step:1,title:"Acesse WooCommerce",description:"No WordPress admin, vá em WooCommerce > Configurações > Avançado > API REST"},{step:2,title:"Crie Chaves API",description:"Clique em 'Adicionar chave' e gere Consumer Key e Consumer Secret"}]},"mercado-livre":{id:"mercado-livre",name:"Mercado Livre",icon:j,description:"Conecte sua conta do Mercado Livre.",longDescription:"Integração OAuth com Mercado Livre para gerenciar anúncios e vendas.",fields:[],manual:[{step:1,title:"Conectar via OAuth",description:"Clique em 'Conectar' para autorizar via OAuth do Mercado Livre"}]}},V=()=>{const{integrationId:r}=t(),j=a(),v=o(e=>e.user),{isIntegrationConnected:N,loadIntegrations:V}=i(),{toast:z}=n(),[X,F]=s.useState(!1),[L,B]=s.useState(!1),[K,W]=s.useState({}),[J,M]=s.useState({}),R=r?U[r]:null;if(s.useEffect(()=>{r&&F(N(r))},[r,N]),!R)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-4",children:[e.jsx(w,{className:"h-16 w-16 text-red-500"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Integração não encontrada"}),e.jsx(c,{onClick:()=>j("/integrations"),children:"Voltar para Integrações"})]});const G=R.icon;return e.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto pb-8",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>j("/integrations"),children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Voltar"]})}),e.jsxs(d,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-primary/10",children:e.jsx(G,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx(l,{className:"text-2xl",children:R.name}),e.jsx(h,{className:"mt-1",children:R.description})]})]}),e.jsx("div",{children:X?e.jsxs(p,{className:"bg-green-500 hover:bg-green-600 text-white gap-1",children:[e.jsx(A,{className:"h-3 w-3"}),"Ativo"]}):e.jsxs(p,{variant:"outline",className:"bg-red-500/10 text-red-700 border-red-500/20 gap-1",children:[e.jsx(w,{className:"h-3 w-3"}),"Inativo"]})})]})}),R.longDescription&&e.jsx(m,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:R.longDescription})})]}),"shopify"===R.id&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs(d,{className:"border-2 border-blue-200",children:[e.jsx(u,{className:"pb-3",children:e.jsxs(l,{className:"text-base flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-blue-600"}),"Passo 1: Baixar Script"]})}),e.jsxs(m,{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Baixe o arquivo"," ",e.jsx("code",{className:"bg-gray-100 px-1 rounded text-xs",children:"shopify-checkout-redirect.js"})," ","e faça upload em: ",e.jsx("strong",{children:"Assets"})," →"," ",e.jsx("strong",{children:"Add a new asset"})," no editor do seu tema Shopify."]}),e.jsxs(c,{variant:"default",className:"w-full gap-2 bg-blue-600 hover:bg-blue-700",onClick:()=>window.open("https://syncads-dun.vercel.app/shopify-checkout-redirect.js","_blank"),children:[e.jsx(T,{className:"h-4 w-4"}),"Abrir Script"]})]})]}),e.jsxs(d,{className:"border-2 border-green-200",children:[e.jsx(u,{className:"pb-3",children:e.jsxs(l,{className:"text-base flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5 text-green-600"}),"Passo 2: Inserir no Tema"]})}),e.jsxs(m,{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Abra ",e.jsx("strong",{children:"Layout/theme.liquid"})," e cole este código logo ",e.jsx("strong",{children:"acima da tag"})," ",e.jsx("code",{className:"bg-gray-100 px-1 rounded text-xs",children:"</body>"})," ","no final do arquivo."]}),e.jsx("div",{className:"bg-gray-900 rounded p-2 mb-2",children:e.jsx("code",{className:"text-xs text-green-400 font-mono break-all",children:"<script src=\"{{ 'shopify-checkout-redirect.js' | asset_url }}\" defer><\/script>"})}),e.jsxs(c,{variant:"default",className:"w-full gap-2 bg-green-600 hover:bg-green-700",onClick:()=>{navigator.clipboard.writeText("<script src=\"{{ 'shopify-checkout-redirect.js' | asset_url }}\" defer><\/script>"),z({title:"✅ Código Copiado!",description:"Cole no theme.liquid acima da tag </body>"})},children:[e.jsx(C,{className:"h-4 w-4"}),"Copiar Código"]})]})]})]}),R.manual.length>0&&!X&&"shopify"!==R.id&&e.jsxs(y,{className:"bg-blue-50 border-blue-200",children:[e.jsx(I,{className:"h-4 w-4 text-blue-600"}),e.jsx(f,{className:"text-sm space-y-3",children:R.manual.map((t,a)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-blue-600 text-white text-xs font-bold flex items-center justify-center",children:t.step}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-900 font-medium text-xs",children:t.title}),e.jsx("p",{className:"text-gray-600 text-xs",children:t.description}),t.link&&e.jsxs("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800 font-medium mt-1",children:[t.linkText,e.jsx(T,{className:"h-3 w-3"})]})]})]},t.step))})]}),!X&&R.fields.length>0&&e.jsxs(d,{children:[e.jsxs(u,{children:[e.jsx(l,{className:"text-lg",children:"Credenciais"}),e.jsx(h,{children:"Preencha todos os campos obrigatórios para conectar"})]}),e.jsx(m,{className:"space-y-4",children:R.fields.map(t=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:t.id,children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:t.id,type:"password"===t.type?K[t.id]?"text":"password":t.type,placeholder:t.placeholder,value:J[t.id]||"",onChange:e=>{return a=t.id,s=e.target.value,void M(e=>({...e,[a]:s}));var a,s},className:"pr-10"}),"password"===t.type&&e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 px-2",onClick:()=>W(e=>({...e,[t.id]:!e[t.id]})),children:K[t.id]?e.jsx(k,{className:"h-4 w-4"}):e.jsx(E,{className:"h-4 w-4"})})]}),t.helpText&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.helpText})]},t.id))})]}),e.jsx(d,{children:e.jsx(m,{className:"pt-6",children:e.jsx("div",{className:"flex gap-3",children:X?e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:async()=>{if(v){B(!0);try{"shopify"===R.id&&await O.disconnect(),F(!1),M({}),z({title:"Desconectado",description:`${R.name} foi desconectado.`}),await V(v.id)}catch(e){z({title:"Erro",description:"Não foi possível desconectar.",variant:"destructive"})}finally{B(!1)}}},disabled:L,variant:"destructive",className:"flex-1",children:L?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Desconectando..."]}):"Desconectar"}),e.jsx(c,{variant:"outline",onClick:()=>j("/integrations"),children:"Voltar"})]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:async()=>{if(!v)return;const e=R.fields.filter(e=>e.required&&!J[e.id]).map(e=>e.label);if(e.length>0)z({title:"Campos obrigatórios",description:`Preencha: ${e.join(", ")}`,variant:"destructive"});else{B(!0);try{let e;if("shopify"===R.id&&(e=await O.connect(J.shopDomain,J.accessToken,J.apiKey,J.apiSecret)),"vtex"===R.id&&(e=await P.connect(J.accountName,J.appKey,J.appToken)),"nuvemshop"===R.id&&(e=await _.connect(J.storeId,J.storeName||"Minha Loja",J.accessToken)),"woocommerce"===R.id&&(e=await $.connect(J.siteUrl,J.consumerKey,J.consumerSecret)),"mercado-livre"===R.id&&(e=await D.startOAuth(),e.success&&e.authUrl))return void(window.location.href=e.authUrl);if(!e||!e.success)throw new Error(e?.error||"Erro ao conectar");F(!0),z({title:"✅ Conectado com Sucesso!",description:`${R.name} foi conectado com sucesso.`}),await V(v.id)}catch(t){z({title:"❌ Erro ao Conectar",description:t.message||"Verifique suas credenciais e tente novamente.",variant:"destructive"})}finally{B(!1)}}},disabled:L,className:"flex-1 bg-green-600 hover:bg-green-700",children:L?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Conectando..."]}):"Conectar"}),e.jsx(c,{variant:"outline",onClick:()=>j("/integrations"),children:"Cancelar"})]})})})})]})};export{V as default};
