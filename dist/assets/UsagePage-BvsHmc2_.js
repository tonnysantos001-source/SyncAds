import{f as I,r as g,s as h,j as e,g as o,h as c,i as d,l as x,k as L,t as B,I as D,n as U}from"./index-CprDA-zF.js";import{T as z,a as F,b as p,c as i,d as q,e as r}from"./table-31tT46lw.js";import{S as N}from"./SuperAdminLayout-Cyqe5MyZ.js";import{M as y}from"./message-square-Dm9HUJif.js";import{Z as H}from"./zap-8KyEEMbi.js";import{D as O}from"./dollar-sign-C4skc1wo.js";import{T as $}from"./trending-up-QsdKb6rm.js";import"./Logo-CFGPlz53.js";function _(){const{toast:v}=I(),[l,C]=g.useState([]),[u,T]=g.useState(""),[k,w]=g.useState(!0);g.useEffect(()=>{S()},[]);const S=async()=>{try{const{data:s,error:t}=await h.from("Organization").select("*").order("createdAt",{ascending:!1});if(t)throw t;const R=(s||[]).map(async n=>{var b;const{count:P}=await h.from("ChatMessage").select("*, conversation:ChatConversation!inner(*)",{count:"exact",head:!0}).eq("conversation.organizationId",n.id),{data:a}=await h.from("AiUsage").select("*").eq("organizationId",n.id).order("createdAt",{ascending:!1}).limit(1).single(),{data:j}=await h.from("OrganizationAiConnection").select("*, globalAi:GlobalAiConnection(*)").eq("organizationId",n.id).limit(1).single();return{clientId:n.id,clientName:n.name,clientSlug:n.slug,plan:n.plan,totalMessages:P||0,totalTokens:(a==null?void 0:a.totalTokens)||0,estimatedCost:(a==null?void 0:a.estimatedCost)||0,aiProvider:((b=j==null?void 0:j.globalAi)==null?void 0:b.provider)||"N/A",lastUsed:(a==null?void 0:a.createdAt)||null}}),E=await Promise.all(R);C(E)}catch(s){v({title:"Erro ao carregar uso de IA",description:s.message,variant:"destructive"})}finally{w(!1)}},f=l.filter(s=>s.clientName.toLowerCase().includes(u.toLowerCase())||s.clientSlug.toLowerCase().includes(u.toLowerCase())),m={totalMessages:l.reduce((s,t)=>s+t.totalMessages,0),totalTokens:l.reduce((s,t)=>s+t.totalTokens,0),totalCost:l.reduce((s,t)=>s+t.estimatedCost,0),avgMessagesPerClient:l.length>0?l.reduce((s,t)=>s+t.totalMessages,0)/l.length:0},A=s=>{const t={FREE:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100",STARTER:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",PRO:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",ENTERPRISE:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200"};return e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${t[s]||t.FREE}`,children:s})},M=s=>{const t={openai:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",anthropic:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",google:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200","N/A":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100"};return e.jsx(U,{variant:"outline",className:t[s]||t["N/A"],children:s.toUpperCase()})};return k?e.jsx(N,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsx(N,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Uso de IA"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Acompanhe o uso de inteligência artificial por cliente"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(o,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total de Mensagens"}),e.jsx(y,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.totalMessages.toLocaleString("pt-BR")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Todas conversas com IA"})]})]}),e.jsxs(o,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total de Tokens"}),e.jsx(H,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(m.totalTokens/1e3).toFixed(1),"K"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tokens processados"})]})]}),e.jsxs(o,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Custo Estimado"}),e.jsx(O,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["R$ ",m.totalCost.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Custo com APIs"})]})]}),e.jsxs(o,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Média por Cliente"}),e.jsx($,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Math.round(m.avgMessagesPerClient)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mensagens / cliente"})]})]})]}),e.jsxs(o,{children:[e.jsx(c,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(d,{children:"Uso de IA por Cliente"}),e.jsx(L,{children:"Detalhes de mensagens, tokens e custos"})]})})}),e.jsxs(x,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(D,{placeholder:"Buscar cliente...",value:u,onChange:s=>T(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(z,{children:[e.jsx(F,{children:e.jsxs(p,{children:[e.jsx(i,{children:"Cliente"}),e.jsx(i,{children:"Plano"}),e.jsx(i,{children:"Provider"}),e.jsx(i,{children:"Mensagens"}),e.jsx(i,{children:"Tokens"}),e.jsx(i,{children:"Custo"}),e.jsx(i,{children:"Último Uso"})]})}),e.jsx(q,{children:f.length===0?e.jsx(p,{children:e.jsx(r,{colSpan:7,className:"text-center py-8 text-gray-500",children:"Nenhum dado de uso encontrado"})}):f.map(s=>e.jsxs(p,{children:[e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.clientName}),e.jsx("div",{className:"text-sm text-gray-500",children:s.clientSlug})]})}),e.jsx(r,{children:A(s.plan)}),e.jsx(r,{children:M(s.aiProvider)}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:s.totalMessages})]})}),e.jsx(r,{children:e.jsx("span",{className:"text-sm",children:s.totalTokens.toLocaleString("pt-BR")})}),e.jsx(r,{children:e.jsxs("span",{className:"font-semibold text-green-600",children:["R$ ",s.estimatedCost.toLocaleString("pt-BR",{minimumFractionDigits:2})]})}),e.jsx(r,{children:s.lastUsed?e.jsx("span",{className:"text-sm text-gray-600",children:new Date(s.lastUsed).toLocaleDateString("pt-BR")}):e.jsx("span",{className:"text-sm text-gray-400",children:"Nunca"})})]},s.clientId))})]})})]})]})]})})}export{_ as default};
