import{f as G,r as x,s as p,C as D,j as e,g as h,h as j,i as f,l as g,ar as R,k as X,o as L,I as v,B as V}from"./index-CZgJ-4C2.js";import{L as m}from"./label-u0VuXyVD.js";import{S as _}from"./switch-CG03vLUP.js";import{S as z,a as H,b as U,c as Y,d as I}from"./select-DBjLqm7t.js";import{A as C,b as F,a as k}from"./alert-BYmxbjhT.js";import{S as J}from"./separator-DvCO4VRb.js";import{u as K}from"./useOptimizedSelectors-DmWkSZCh.js";import{D as Q}from"./dollar-sign-Cg7Cbx19.js";import{P as W}from"./percent-Da6_Xa1I.js";import{C as Z}from"./circle-check-B_AxeeWZ.js";import{C as ee}from"./circle-x-jVfLYsDM.js";import{C as se}from"./circle-alert-B_tE1Hi2.js";import"./index-79n6afC3.js";import"./settingsStore-CgDXkzRu.js";const y=[{key:"CREDIT_CARD",label:"Cartão de Crédito",icon:D,color:"bg-blue-500",description:"Desconto para pagamentos com cartão de crédito"},{key:"PIX",label:"PIX",icon:Q,color:"bg-green-500",description:"Desconto para pagamentos via PIX (mais comum)"},{key:"BOLETO",label:"Boleto Bancário",icon:D,color:"bg-orange-500",description:"Desconto para pagamentos com boleto bancário"},{key:"DEBIT_CARD",label:"Cartão de Débito",icon:D,color:"bg-purple-500",description:"Desconto para pagamentos com cartão de débito"}],je=()=>{const{toast:r}=G(),{user:n}=K(),[$,w]=x.useState(!0),[N,E]=x.useState(!1),[u,O]=x.useState([]),[b,P]=x.useState({});x.useEffect(()=>{n!=null&&n.id&&A()},[n==null?void 0:n.id]);const A=async()=>{if(n!=null&&n.id)try{w(!0);const{data:t,error:i}=await p.from("PaymentMethodDiscount").select("*").eq("userId",n.id).order("createdAt",{ascending:!1});if(i)throw i;O(t||[]);const a={};y.forEach(s=>{var c,S;const o=(t||[]).find(q=>q.paymentMethod===s.key);o?a[s.key]={discountType:o.discountType,discountValue:o.discountValue.toString(),minPurchaseAmount:((c=o.minPurchaseAmount)==null?void 0:c.toString())||"0",maxDiscountAmount:((S=o.maxDiscountAmount)==null?void 0:S.toString())||"",description:o.description||"",isActive:o.isActive}:a[s.key]={discountType:"PERCENTAGE",discountValue:"",minPurchaseAmount:"0",maxDiscountAmount:"",description:"",isActive:!0}}),P(a)}catch(t){console.error("Erro ao carregar descontos:",t),r({title:"Erro ao carregar descontos",description:t.message,variant:"destructive"})}finally{w(!1)}},M=async t=>{var a;if(!(n!=null&&n.id))return;const i=b[t];if(!i||!i.discountValue){r({title:"Valor obrigatório",description:"Informe o valor do desconto",variant:"destructive"});return}E(!0);try{const s=u.find(c=>c.paymentMethod===t),o={userId:n.id,paymentMethod:t,discountType:i.discountType,discountValue:parseFloat(i.discountValue),minPurchaseAmount:parseFloat(i.minPurchaseAmount||"0"),maxDiscountAmount:i.maxDiscountAmount?parseFloat(i.maxDiscountAmount):null,description:i.description||null,isActive:i.isActive,updatedAt:new Date().toISOString()};if(s){const{error:c}=await p.from("PaymentMethodDiscount").update(o).eq("id",s.id);if(c)throw c}else{const{error:c}=await p.from("PaymentMethodDiscount").insert(o);if(c)throw c}r({title:"Desconto salvo!",description:`Desconto para ${(a=y.find(c=>c.key===t))==null?void 0:a.label} configurado com sucesso`}),await A()}catch(s){console.error("Erro ao salvar desconto:",s),r({title:"Erro ao salvar",description:s.message,variant:"destructive"})}finally{E(!1)}},B=async(t,i)=>{var a;if(window.confirm(`Tem certeza que deseja remover o desconto de ${(a=y.find(s=>s.key===i))==null?void 0:a.label}?`))try{const{error:s}=await p.from("PaymentMethodDiscount").delete().eq("id",t);if(s)throw s;r({title:"Desconto removido!",description:"O desconto foi removido com sucesso"}),await A()}catch(s){console.error("Erro ao remover desconto:",s),r({title:"Erro ao remover",description:s.message,variant:"destructive"})}},l=(t,i,a)=>{P(s=>({...s,[t]:{...s[t]||{discountType:"PERCENTAGE",discountValue:"",minPurchaseAmount:"0",maxDiscountAmount:"",description:"",isActive:!0},[i]:a}}))},T=(t,i=100)=>{const a=b[t];if(!a||!a.discountValue)return 0;const s=parseFloat(a.discountValue);let o=0;if(a.discountType==="PERCENTAGE"?o=i*s/100:o=s,a.maxDiscountAmount){const c=parseFloat(a.maxDiscountAmount);o=Math.min(o,c)}return o},d={total:u.length,active:u.filter(t=>t.isActive).length,inactive:u.filter(t=>!t.isActive).length};return $?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Carregando descontos..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Descontos por Forma de Pagamento"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Configure descontos automáticos baseados na forma de pagamento escolhida pelo cliente no checkout"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(h,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total de Descontos"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d.total===0?"Nenhum desconto configurado":`${d.total} ${d.total===1?"método configurado":"métodos configurados"}`})]})]}),e.jsxs(h,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Descontos Ativos"}),e.jsx(Z,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.active}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aplicados no checkout"})]})]}),e.jsxs(h,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Descontos Inativos"}),e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.inactive}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pausados temporariamente"})]})]})]}),e.jsxs(C,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(F,{children:"Como funciona"}),e.jsx(k,{children:"Os descontos configurados aqui serão aplicados automaticamente no checkout público quando o cliente selecionar a forma de pagamento. O desconto será exibido de forma clara antes da finalização da compra."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Configurar Descontos"}),y.map(t=>{const i=t.icon,a=u.find(o=>o.paymentMethod===t.key),s=b[t.key];return e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${t.color} flex items-center justify-center`,children:e.jsx(i,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(f,{className:"text-lg",children:t.label}),e.jsx(X,{children:t.description})]})]}),a&&e.jsx(L,{variant:a.isActive?"default":"secondary",children:a.isActive?"Ativo":"Inativo"})]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Tipo de Desconto"}),e.jsxs(z,{value:(s==null?void 0:s.discountType)||"PERCENTAGE",onValueChange:o=>l(t.key,"discountType",o),children:[e.jsx(H,{children:e.jsx(U,{})}),e.jsxs(Y,{children:[e.jsx(I,{value:"PERCENTAGE",children:"Porcentagem (%)"}),e.jsx(I,{value:"FIXED_AMOUNT",children:"Valor Fixo (R$)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{children:["Valor do Desconto ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{type:"number",placeholder:"0",value:(s==null?void 0:s.discountValue)||"",onChange:o=>l(t.key,"discountValue",o.target.value),min:"0",step:"0.01"}),e.jsx("span",{className:"text-muted-foreground font-medium",children:(s==null?void 0:s.discountType)==="PERCENTAGE"?"%":"R$"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Valor Mínimo da Compra"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{type:"number",placeholder:"0.00",value:(s==null?void 0:s.minPurchaseAmount)||"0",onChange:o=>l(t.key,"minPurchaseAmount",o.target.value),min:"0",step:"0.01"}),e.jsx("span",{className:"text-muted-foreground font-medium",children:"R$"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Desconto só se aplica acima deste valor"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Desconto Máximo (Opcional)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{type:"number",placeholder:"Sem limite",value:(s==null?void 0:s.maxDiscountAmount)||"",onChange:o=>l(t.key,"maxDiscountAmount",o.target.value),min:"0",step:"0.01"}),e.jsx("span",{className:"text-muted-foreground font-medium",children:"R$"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Limite máximo do desconto em reais"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Descrição (Opcional)"}),e.jsx(v,{placeholder:"Ex: Desconto especial para pagamento à vista",value:(s==null?void 0:s.description)||"",onChange:o=>l(t.key,"description",o.target.value)})]}),(s==null?void 0:s.discountValue)&&e.jsxs(C,{className:"border-blue-200 bg-blue-50",children:[e.jsx(R,{className:"h-4 w-4 text-blue-600"}),e.jsx(F,{className:"text-blue-900",children:"Preview do Desconto"}),e.jsxs(k,{className:"text-blue-800",children:[e.jsxs("p",{className:"mb-2",children:["Para uma compra de R$ 100,00, o desconto será de"," ",e.jsxs("strong",{children:["R$"," ",T(t.key,100).toFixed(2)]})]}),e.jsxs("p",{children:["Total a pagar:"," ",e.jsxs("strong",{children:["R$"," ",(100-T(t.key,100)).toFixed(2)]})]})]})]}),e.jsx(J,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{children:"Status do Desconto"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s!=null&&s.isActive?"Desconto será aplicado no checkout":"Desconto pausado temporariamente"})]}),e.jsx(_,{checked:(s==null?void 0:s.isActive)??!0,onCheckedChange:o=>l(t.key,"isActive",o)})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[a&&e.jsx(V,{variant:"outline",onClick:()=>B(a.id,t.key),disabled:N,children:"Remover"}),e.jsx(V,{onClick:()=>M(t.key),disabled:N||!(s!=null&&s.discountValue),className:"bg-pink-600 hover:bg-pink-700",children:N?"Salvando...":"Salvar Desconto"})]})]})]},t.key)})]}),e.jsxs(C,{className:"border-pink-200 bg-pink-50",children:[e.jsx(se,{className:"h-4 w-4 text-pink-600"}),e.jsxs(k,{className:"text-pink-900",children:[e.jsx("strong",{children:"Dica:"})," Descontos para PIX geralmente aumentam a taxa de conversão. Recomendamos oferecer entre 3% a 10% de desconto."]})]})]})};export{je as default};
