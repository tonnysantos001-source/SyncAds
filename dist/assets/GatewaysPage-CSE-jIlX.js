var F=Object.defineProperty;var V=(s,t,a)=>t in s?F(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var h=(s,t,a)=>V(s,typeof t!="symbol"?t+"":t,a);import{f as W,u as U,r as g,s as A,j as e,B as f,I as S,g as y,h as v,i as N,C as I,l as j,d as T,a5 as D,k as z,n as B,X as H}from"./index-ByzMTT6f.js";import{L as w}from"./label-CuHAI9a5.js";import{D as q,f as $,a as X,b as Y,c as J,d as Z,e as Q}from"./dialog-CeyjT-Su.js";import{S as ee,a as se,b as ae,c as te,d as re}from"./select-JmhgiyI4.js";import{S as K}from"./SuperAdminLayout-CekgAJmD.js";import{g as ie}from"./gatewaysApi-BTWMJDgk.js";import{P}from"./plus-DvZtkO7-.js";import"./index-B83duujC.js";import"./Logo-DXZAO5xd.js";import"./message-square-BuANM4Ev.js";import"./dollar-sign-d3wzOFzB.js";class le extends Error{constructor(a){super(a.message);h(this,"type");h(this,"userMessage");h(this,"details");h(this,"code");h(this,"statusCode");h(this,"retryable");this.name="CustomError",this.type=a.type,this.userMessage=a.userMessage,this.details=a.details,this.code=a.code,this.statusCode=a.statusCode||500,this.retryable=a.retryable||!1}}function k(s){var t,a,l;return s!=null&&s.code?ne(s):s!=null&&s.response?ce(s):(t=s==null?void 0:s.message)!=null&&t.includes("fetch")||(a=s==null?void 0:s.message)!=null&&a.includes("network")?{type:"NETWORK_ERROR",message:s.message,userMessage:"Erro de conex√£o. Verifique sua internet.",retryable:!0}:(l=s==null?void 0:s.message)!=null&&l.includes("timeout")?{type:"TIMEOUT",message:s.message,userMessage:"A opera√ß√£o demorou muito. Tente novamente.",retryable:!0}:s instanceof le?{type:s.type,message:s.message,userMessage:s.userMessage,details:s.details,code:s.code,statusCode:s.statusCode,retryable:s.retryable}:{type:"UNKNOWN_ERROR",message:(s==null?void 0:s.message)||"Erro desconhecido",userMessage:"Algo deu errado. Tente novamente.",details:s,retryable:!1}}function ne(s){const t=s.code,a=s.message||"";return t==="PGRST301"||a.includes("JWT")?{type:"SESSION_EXPIRED",message:a,userMessage:"Sua sess√£o expirou. Fa√ßa login novamente.",code:t,statusCode:401,retryable:!1}:t==="PGRST116"||a.includes("not found")?{type:"NOT_FOUND",message:a,userMessage:"Registro n√£o encontrado.",code:t,statusCode:404,retryable:!1}:t==="23505"||a.includes("duplicate")||a.includes("already exists")?{type:"DUPLICATE_ENTRY",message:a,userMessage:"Este registro j√° existe.",code:t,statusCode:409,retryable:!1}:a.includes("permission denied")||a.includes("RLS")?{type:"FORBIDDEN",message:a,userMessage:"Voc√™ n√£o tem permiss√£o para esta a√ß√£o.",code:t,statusCode:403,retryable:!1}:{type:"DATABASE_ERROR",message:a,userMessage:"Erro ao acessar o banco de dados.",code:t,statusCode:500,retryable:!0}}function ce(s){var m,d;const t=(m=s.response)==null?void 0:m.status,a=(d=s.response)==null?void 0:d.data,l=(a==null?void 0:a.message)||(a==null?void 0:a.error)||s.message;switch(t){case 400:return{type:"VALIDATION_ERROR",message:l,userMessage:"Dados inv√°lidos. Verifique os campos.",statusCode:400,details:a,retryable:!1};case 401:return{type:"UNAUTHORIZED",message:l,userMessage:"Voc√™ precisa fazer login.",statusCode:401,retryable:!1};case 403:return{type:"FORBIDDEN",message:l,userMessage:"Voc√™ n√£o tem permiss√£o para esta a√ß√£o.",statusCode:403,retryable:!1};case 404:return{type:"NOT_FOUND",message:l,userMessage:"Recurso n√£o encontrado.",statusCode:404,retryable:!1};case 409:return{type:"DUPLICATE_ENTRY",message:l,userMessage:"Este registro j√° existe.",statusCode:409,retryable:!1};case 429:return{type:"RATE_LIMIT_EXCEEDED",message:l,userMessage:"Muitas requisi√ß√µes. Aguarde um momento.",statusCode:429,retryable:!0};case 500:case 502:case 503:case 504:return{type:"API_ERROR",message:l,userMessage:"Erro no servidor. Tente novamente em alguns instantes.",statusCode:t,retryable:!0};default:return{type:"API_ERROR",message:l,userMessage:"Erro na comunica√ß√£o com o servidor.",statusCode:t,details:a,retryable:!0}}}class oe{constructor(){h(this,"logs",[]);h(this,"maxLogs",100)}log(t,a){const l={timestamp:new Date().toISOString(),type:t.type,message:t.message,userMessage:t.userMessage,details:t.details,code:t.code,statusCode:t.statusCode,userId:a==null?void 0:a.userId,organizationId:a==null?void 0:a.organizationId,url:window.location.href,userAgent:navigator.userAgent};this.logs.unshift(l),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(0,this.maxLogs))}getLogs(t=20){return this.logs.slice(0,t)}clear(){this.logs=[]}sendToSentry(t){}}const de=new oe;function ue(s,t){const a=k(s);return de.log(a,t),a}async function me(s,t={}){const{maxRetries:a=3,delayMs:l=1e3,backoff:m=!0}=t;let d;for(let x=0;x<=a;x++)try{return await s()}catch(p){if(d=p,!k(p).retryable)throw p;if(x===a)break;const n=m?l*Math.pow(2,x):l;await new Promise(u=>setTimeout(u,n)),console.log(`üîÑ Retry attempt ${x+1}/${a}`)}throw d}function ge(){const{toast:s}=W(),{user:t,organization:a}=U(),l=g.useCallback((i,n)=>{const u=ue(i,{userId:t==null?void 0:t.id,organizationId:a==null?void 0:a.id});return s({title:"Erro",description:n||u.userMessage,variant:"destructive"}),u},[s,t,a]),m=g.useCallback(i=>{s({title:"Sucesso",description:i})},[s]),d=g.useCallback(i=>{s({title:"Aten√ß√£o",description:i,variant:"default"})},[s]),x=g.useCallback(i=>{s({title:"Informa√ß√£o",description:i})},[s]),p=g.useCallback(async(i,n)=>{try{const C=await(n!=null&&n.retry?()=>me(i,n.retry):i)();return n!=null&&n.successMessage&&m(n.successMessage),C}catch(u){return l(u,n==null?void 0:n.errorMessage),null}},[l,m]);return{showError:l,showSuccess:m,showWarning:d,showInfo:x,executeWithErrorHandling:p}}const O=[{value:"stripe",label:"Stripe",icon:"üí≥"},{value:"mercadopago",label:"Mercado Pago",icon:"üáßüá∑"},{value:"pagseguro",label:"PagSeguro",icon:"üîí"},{value:"paypal",label:"PayPal",icon:"üÖøÔ∏è"},{value:"asaas",label:"Asaas",icon:"üí∞"}];function Se(){const{showError:s,executeWithErrorHandling:t}=ge(),[a,l]=g.useState([]),[m,d]=g.useState(!1),[x,p]=g.useState(!0),[i,n]=g.useState({name:"",provider:"",publicKey:"",secretKey:""});g.useEffect(()=>{u()},[]);const u=async()=>{p(!0);const r=await t(async()=>{const o=await ie.list();return await Promise.all(o.map(async c=>{var M,R;try{const{count:L}=await A.from("Transaction").select("*",{count:"exact",head:!0}).eq("gatewayId",c.id);return{id:c.id,name:c.name,provider:c.type,publicKey:((M=c.apiKey)==null?void 0:M.slice(0,20))+"***"||"N/A",isActive:c.isActive,createdAt:c.createdAt,transactionsCount:L||0}}catch{return{id:c.id,name:c.name,provider:c.type,publicKey:((R=c.apiKey)==null?void 0:R.slice(0,20))+"***"||"N/A",isActive:c.isActive,createdAt:c.createdAt,transactionsCount:0}}}))},{errorMessage:"N√£o foi poss√≠vel carregar os gateways"});r&&l(r),p(!1)},C=async()=>{if(!i.name||!i.provider||!i.publicKey||!i.secretKey){s(new Error("Campos obrigat√≥rios"),"Preencha todos os campos");return}await t(async()=>{const{data:o,error:b}=await A.from("Gateway").insert({name:i.name,type:i.provider,apiKey:i.publicKey,secretKey:i.secretKey,isActive:!0,createdAt:new Date().toISOString()}).select().single();if(b)throw b;return o},{successMessage:`${i.name} foi configurado com sucesso.`,errorMessage:"N√£o foi poss√≠vel adicionar o gateway"})&&(d(!1),n({name:"",provider:"",publicKey:"",secretKey:""}),u())},G=async(r,o)=>{await t(async()=>{const{error:c}=await A.from("Gateway").update({isActive:o,updatedAt:new Date().toISOString()}).eq("id",r);if(c)throw c;return!0},{successMessage:o?"Gateway ativado":"Gateway desativado",errorMessage:"N√£o foi poss√≠vel atualizar o status"})&&u()},_=r=>O.find(o=>o.value===r)||{label:r,icon:"üí≥"},E={total:a.length,active:a.filter(r=>r.isActive).length,totalTransactions:a.reduce((r,o)=>r+(o.transactionsCount||0),0)};return x?e.jsx(K,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsx(K,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Gateways de Pagamento"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Gerencie os meios de recebimento dos clientes"})]}),e.jsxs(q,{open:m,onOpenChange:d,children:[e.jsx($,{asChild:!0,children:e.jsxs(f,{className:"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Adicionar Gateway"]})}),e.jsxs(X,{className:"sm:max-w-[500px]",children:[e.jsxs(Y,{children:[e.jsx(J,{children:"Adicionar Gateway de Pagamento"}),e.jsx(Z,{children:"Configure um novo meio de recebimento"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"name",children:"Nome do Gateway"}),e.jsx(S,{id:"name",placeholder:"Ex: Stripe Principal",value:i.name,onChange:r=>n({...i,name:r.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"provider",children:"Provider"}),e.jsxs(ee,{value:i.provider,onValueChange:r=>n({...i,provider:r}),children:[e.jsx(se,{children:e.jsx(ae,{placeholder:"Selecione um provider"})}),e.jsx(te,{children:O.map(r=>e.jsx(re,{value:r.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:r.icon}),e.jsx("span",{children:r.label})]})},r.value))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"publicKey",children:"Public Key"}),e.jsx(S,{id:"publicKey",placeholder:"pk_test_...",value:i.publicKey,onChange:r=>n({...i,publicKey:r.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"secretKey",children:"Secret Key"}),e.jsx(S,{id:"secretKey",type:"password",placeholder:"sk_test_...",value:i.secretKey,onChange:r=>n({...i,secretKey:r.target.value})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Esta chave ser√° armazenada de forma segura e criptografada"})]})]}),e.jsxs(Q,{children:[e.jsx(f,{variant:"outline",onClick:()=>d(!1),children:"Cancelar"}),e.jsx(f,{className:"bg-gradient-to-r from-blue-500 to-purple-500",onClick:C,children:"Adicionar Gateway"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(y,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Gateways Configurados"}),e.jsx(I,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:E.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total de meios de pagamento"})]})]}),e.jsxs(y,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Gateways Ativos"}),e.jsx(T,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:E.active}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recebendo pagamentos"})]})]}),e.jsxs(y,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Transa√ß√µes"}),e.jsx(D,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:E.totalTransactions}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total processadas"})]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:a.length===0?e.jsx(y,{className:"col-span-full",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(I,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Nenhum gateway configurado"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Adicione seu primeiro gateway de pagamento"}),e.jsxs(f,{className:"bg-gradient-to-r from-blue-500 to-purple-500",onClick:()=>d(!0),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Adicionar Gateway"]})]})}):a.map(r=>{const o=_(r.provider);return e.jsxs(y,{className:"relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 transform translate-x-16 -translate-y-16 rounded-full ${r.isActive?"bg-green-500/10":"bg-gray-500/10"}`}),e.jsx(v,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:o.icon}),e.jsxs("div",{children:[e.jsx(N,{className:"text-lg",children:r.name}),e.jsx(z,{children:o.label})]})]}),e.jsx(B,{variant:r.isActive?"default":"outline",children:r.isActive?"Ativo":"Inativo"})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Public Key"}),e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded block overflow-hidden text-ellipsis",children:r.publicKey})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Transa√ß√µes"}),e.jsx("span",{className:"font-medium",children:r.transactionsCount||0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"outline",className:"flex-1",size:"sm",onClick:()=>{},children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Configurar"]}),e.jsx(f,{variant:r.isActive?"destructive":"default",size:"sm",onClick:()=>G(r.id,!r.isActive),children:r.isActive?e.jsx(H,{className:"h-4 w-4"}):e.jsx(T,{className:"h-4 w-4"})})]})]})]},r.id)})})]})})}export{Se as default};
