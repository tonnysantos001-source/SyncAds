import{ab as b,e as y,r as g,j as e,N as j,O as N,s as k}from"./index-D8guZDJX.js";import{i as S,I as C}from"./integrationsService-DPbD00Dg.js";import{C as E}from"./circle-x-DkIcOdtZ.js";function F(){const[s]=b(),t=y(),[n,a]=g.useState("loading"),[i,r]=g.useState("Processing your connection...");return g.useEffect(()=>{(async()=>{var d;try{const o=s.get("shop"),c=s.get("code"),h=s.get("hmac");if(o&&c&&h){a("loading"),r("Conectando com Shopify...");try{const m=await k.auth.getSession(),p=await(await fetch(`https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/shopify-oauth?action=callback&shop=${o}&code=${c}&hmac=${h}`,{headers:{Authorization:`Bearer ${(d=m.data.session)==null?void 0:d.access_token}`}})).json();if(p.success){a("success"),r("Shopify conectada! Sincronizando dados..."),setTimeout(()=>t("/integrations"),2e3);return}else throw new Error(p.error||"Erro ao conectar Shopify")}catch(m){a("error"),r(`Erro ao conectar Shopify: ${m.message}`),setTimeout(()=>t("/integrations"),3e3);return}}const l=s.get("state"),x=s.get("error");if(x)throw new Error(x);if(!c||!l)throw new Error("Missing code or state parameter");const f=await S.handleOAuthCallback(c,l),w=C[f.slug];a("success"),r(`${w.name} connected successfully!`);const u=JSON.parse(atob(l));localStorage.setItem(`oauth_success_${u.platform}_${u.userId}`,"true"),setTimeout(()=>{window.opener?window.close():t("/chat")},2e3)}catch(o){console.error("OAuth callback error:",o),a("error"),r(o.message||"Failed to connect integration"),setTimeout(()=>{window.opener?window.close():t("/chat")},3e3)}})()},[s,t]),e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"text-center p-8 bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md",children:[n==="loading"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-16 w-16 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Processing..."}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:i})]}),n==="success"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-16 w-16 text-green-600 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2 text-green-600",children:"Success!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:i}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Closing this window..."})]}),n==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-16 w-16 text-red-600 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2 text-red-600",children:"Error"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:i}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Redirecting..."})]})]})})}export{F as IntegrationCallbackPage};
