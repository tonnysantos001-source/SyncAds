import{j as e}from"./vendor-ui-D3JNL6pE.js";import{r as a}from"./vendor-react-X41Bjl18.js";import{g as t,s as i,C as s,a as r,b as l,e as o,c as n,B as d,I as c}from"./index-CcnE6iB9.js";import{L as x}from"./label-DRhYgpu_.js";import{S as m}from"./switch-BbgEHatN.js";import{D as p,a as h,b as u,c as g,d as v,f}from"./dialog-D5vk7TCD.js";import{A as j,b,a as y}from"./alert-C046Vyt2.js";import{S as w}from"./separator-cD5RKad-.js";import{u as N}from"./useOptimizedSelectors-hGQGczva.js";import{m as k}from"./vendor-animation-DtB50Lbk.js";import{aI as C,Z as A,E as P,k as I,I as X,o as O,_,aN as S,b3 as E,Q as T,Y as F}from"./vendor-icons-DiMyZvwG.js";import"./vendor-supabase-HUq0BeMy.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-DqG_mm-v.js";import"./settingsStore-Cd4Vfi_V.js";const K={FACEBOOK:{platform:"FACEBOOK",name:"Meta Ads (Facebook/Instagram)",description:"Pixel do Meta para rastreamento de convers√µes no Facebook e Instagram",icon:"üìò",color:"#1877F2",documentation:"https://developers.facebook.com/docs/meta-pixel",requiredFields:["pixelId"],availableEvents:["page_view","add_to_cart","purchase","initiate_checkout","view_content","search","add_payment_info","complete_registration"]},TIKTOK:{platform:"TIKTOK",name:"TikTok Ads",description:"Pixel do TikTok para rastreamento de convers√µes e cria√ß√£o de p√∫blicos",icon:"üéµ",color:"#000000",documentation:"https://ads.tiktok.com/help/article?aid=10000357",requiredFields:["pixelId"],availableEvents:["page_view","add_to_cart","purchase","initiate_checkout","view_content","search","add_payment_info","complete_registration"]},GOOGLE_ADS:{platform:"GOOGLE_ADS",name:"Google Ads",description:"Tag de convers√£o do Google Ads para remarketing e medi√ß√£o",icon:"üîç",color:"#4285F4",documentation:"https://support.google.com/google-ads/answer/6331314",requiredFields:["pixelId"],availableEvents:["page_view","add_to_cart","purchase","begin_checkout","view_item","search","add_payment_info","sign_up"]}},G=(e,a)=>{switch(e){case"FACEBOOK":return/^\d{15,16}$/.test(a);case"TIKTOK":return/^[A-Z0-9]{15,20}$/.test(a);case"GOOGLE_ADS":return/^AW-\d{9,11}$/.test(a)||/^G-[A-Z0-9]{10}$/.test(a);default:return!1}},D=({title:a,value:t,icon:i,color:o,delay:d=0,subtitle:c})=>e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:d},children:e.jsxs(s,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${o} opacity-10 rounded-full blur-3xl`}),e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:a}),e.jsx("div",{className:`p-2 rounded-lg ${o} bg-opacity-10`,children:e.jsx(i,{className:`h-5 w-5 ${o.replace("bg-","text-")}`})})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:t}),c&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:c})]})]})}),q=()=>{const{pixelConfigs:q,loading:L,creating:z,updating:B,deleting:$,stats:M,createPixelConfig:R,updatePixelConfig:W,deletePixelConfig:Z,togglePixelConfig:V,hasPixelForPlatform:Q}=(()=>{const{user:e}=N(),{toast:s}=t(),[r,l]=a.useState([]),[o,n]=a.useState([]),[d,c]=a.useState(!0),[x,m]=a.useState(!1),[p,h]=a.useState(!1),[u,g]=a.useState(!1),v=async()=>{try{const{data:e,error:a}=await i.from("Pixel").select("*").eq("isActive",!0).order("platform");if(a)throw a;l(e||[])}catch(e){s({title:"Erro ao carregar pixels",description:e.message,variant:"destructive"})}},f=async()=>{if(e?.id)try{c(!0);const{data:a,error:t}=await i.from("PixelConfig").select("*").eq("userId",e.id).order("createdAt",{ascending:!1});if(t)throw t;n(a||[])}catch(a){s({title:"Erro ao carregar configura√ß√µes",description:a.message,variant:"destructive"})}finally{c(!1)}},j={total:o.length,active:o.filter(e=>e.isActive).length,inactive:o.filter(e=>!e.isActive).length,byPlatform:{facebook:o.filter(e=>"FACEBOOK"===e.platform).length,tiktok:o.filter(e=>"TIKTOK"===e.platform).length,google:o.filter(e=>"GOOGLE_ADS"===e.platform).length}};return a.useEffect(()=>{v()},[]),a.useEffect(()=>{e?.id&&f()},[e?.id]),{pixels:r,pixelConfigs:o,loading:d,creating:x,updating:p,deleting:u,stats:j,createPixelConfig:async a=>{if(!e?.id)return s({title:"Erro",description:"Usu√°rio n√£o autenticado",variant:"destructive"}),null;try{m(!0);const{data:t,error:r}=await i.from("PixelConfig").insert({userId:e.id,platform:a.platform,pixelId:a.pixelId,name:a.name,accessToken:a.accessToken,isActive:a.isActive??!0,events:a.events||["page_view","add_to_cart","purchase","initiate_checkout"],config:a.config||{}}).select().single();if(r)throw r;return s({title:"Pixel cadastrado!",description:`O pixel ${a.name||a.platform} foi cadastrado com sucesso.`}),await f(),t}catch(t){return s({title:"Erro ao cadastrar pixel",description:t.message,variant:"destructive"}),null}finally{m(!1)}},updatePixelConfig:async(e,a)=>{try{h(!0);const{data:t,error:r}=await i.from("PixelConfig").update({...a,updatedAt:(new Date).toISOString()}).eq("id",e).select().single();if(r)throw r;return s({title:"Pixel atualizado!",description:"As configura√ß√µes do pixel foram atualizadas com sucesso."}),await f(),t}catch(t){return s({title:"Erro ao atualizar pixel",description:t.message,variant:"destructive"}),null}finally{h(!1)}},deletePixelConfig:async e=>{try{g(!0);const{error:a}=await i.from("PixelConfig").delete().eq("id",e);if(a)throw a;return s({title:"Pixel removido!",description:"A configura√ß√£o do pixel foi removida com sucesso."}),await f(),!0}catch(a){return s({title:"Erro ao remover pixel",description:a.message,variant:"destructive"}),!1}finally{g(!1)}},togglePixelConfig:async(e,a)=>{try{const{error:t}=await i.from("PixelConfig").update({isActive:a,updatedAt:(new Date).toISOString()}).eq("id",e);if(t)throw t;return s({title:a?"Pixel ativado!":"Pixel desativado!",description:a?"O pixel est√° agora rastreando eventos.":"O pixel foi pausado temporariamente."}),await f(),!0}catch(t){return s({title:"Erro ao alterar status",description:t.message,variant:"destructive"}),!1}},fetchPixelConfigs:f,fetchPixels:v,hasPixelForPlatform:e=>o.some(a=>a.platform===e),getPixelConfigByPlatform:e=>o.find(a=>a.platform===e),getActivePixelConfigs:()=>o.filter(e=>e.isActive)}})(),[U,Y]=a.useState(!1),[H,J]=a.useState(!1),[ee,ae]=a.useState(null),[te,ie]=a.useState(null),[se,re]=a.useState(""),[le,oe]=a.useState({platform:"FACEBOOK",pixelId:"",name:"",isActive:!0,events:["page_view","add_to_cart","purchase","initiate_checkout"]}),[ne,de]=a.useState(null),ce=()=>{Y(!1),J(!1),ae(null),ie(null),de(null)},xe=q.filter(e=>e.pixelId.toLowerCase().includes(se.toLowerCase())||e.name?.toLowerCase().includes(se.toLowerCase())||e.platform.toLowerCase().includes(se.toLowerCase()));return L?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Carregando pixels..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(k.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600 bg-clip-text text-transparent",children:"Pixels de Rastreamento"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mt-2",children:"Gerencie seus pixels do Meta, TikTok e Google Ads integrados com sua Shopify"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-4",children:[e.jsx(D,{title:"Total de Pixels",value:M.total,icon:C,color:"bg-indigo-500",delay:.1,subtitle:"Pixels configurados"}),e.jsx(D,{title:"Pixels Ativos",value:M.active,icon:A,color:"bg-green-500",delay:.2,subtitle:"Rastreando eventos"}),e.jsx(D,{title:"Pixels Inativos",value:M.inactive,icon:P,color:"bg-gray-500",delay:.3,subtitle:"Pausados"}),e.jsx(D,{title:"Plataformas",value:3,icon:I,color:"bg-purple-500",delay:.4,subtitle:"Meta, TikTok, Google"})]}),e.jsxs(j,{children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx(b,{children:"Integra√ß√£o com Shopify"}),e.jsx(y,{children:"Os pixels cadastrados aqui ser√£o automaticamente integrados ao seu checkout da Shopify para rastreamento de convers√µes."})]}),e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:"Plataformas Dispon√≠veis"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:Object.values(K).map(a=>{const t=Q(a.platform);return e.jsxs(s,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(r,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-2xl",style:{backgroundColor:a.color+"20"},children:a.icon}),e.jsxs("div",{children:[e.jsx(l,{className:"text-lg",children:a.name}),t&&e.jsxs(o,{variant:"secondary",className:"mt-1",children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),"Configurado"]})]})]})})}),e.jsxs(n,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("a",{href:a.documentation,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),"Documenta√ß√£o"]}),e.jsxs(d,{size:"sm",onClick:()=>(e=>{ae(e),oe({platform:e,pixelId:"",name:"",isActive:!0,events:K[e].availableEvents.slice(0,4)}),de(null),Y(!0)})(a.platform),disabled:z,variant:t?"outline":"default",children:[e.jsx(S,{className:"w-4 h-4 mr-1"}),t?"Adicionar Outro":"Cadastrar Pixel"]})]})]})]},a.platform)})})]}),e.jsx(w,{}),e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:"Pixels Cadastrados"}),e.jsx(c,{type:"text",placeholder:"Buscar pixels...",value:se,onChange:e=>re(e.target.value),className:"max-w-xs border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg"})]}),0===xe.length?e.jsx(s,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:e.jsxs(n,{className:"py-12 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 mb-4 mx-auto w-fit",children:e.jsx(C,{className:"w-12 h-12 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum pixel cadastrado"}),e.jsx("p",{className:"text-muted-foreground mb-4 max-w-md mx-auto",children:se?"Nenhum pixel encontrado com esse filtro.":"Cadastre seu primeiro pixel para come√ßar a rastrear convers√µes e otimizar suas campanhas."})]})}):e.jsx("div",{className:"space-y-4",children:xe.map((a,t)=>{const i=K[a.platform];return e.jsx(k.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.05*t},children:e.jsx(s,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-xl flex-shrink-0",style:{backgroundColor:i.color+"20"},children:i.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:a.name||i.name}),e.jsx(o,{variant:a.isActive?"default":"secondary",children:a.isActive?"Ativo":"Inativo"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Pixel ID: ",a.pixelId]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.events.slice(0,4).map(a=>e.jsx(o,{variant:"outline",className:"text-xs",children:a},a)),a.events.length>4&&e.jsxs(o,{variant:"outline",className:"text-xs",children:["+",a.events.length-4]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{size:"icon",variant:"ghost",onClick:()=>V(a.id,!a.isActive),disabled:B,className:"hover:bg-green-50 hover:text-green-600 dark:hover:bg-green-950",children:e.jsx(E,{className:"w-4 h-4 "+(a.isActive?"text-green-600":"text-gray-400")})}),e.jsx(d,{size:"icon",variant:"ghost",onClick:()=>(e=>{ie(e),oe({platform:e.platform,pixelId:e.pixelId,name:e.name||"",isActive:e.isActive,events:e.events}),de(null),J(!0)})(a),disabled:B,className:"hover:bg-blue-50 hover:text-blue-600 dark:hover:bg-blue-950",children:e.jsx(T,{className:"w-4 h-4"})}),e.jsx(d,{size:"icon",variant:"ghost",onClick:()=>(async e=>{window.confirm("Tem certeza que deseja remover este pixel? Esta a√ß√£o n√£o pode ser desfeita.")&&await Z(e)})(a.id),disabled:$,className:"hover:bg-red-50 hover:text-red-600 dark:hover:bg-red-950",children:e.jsx(F,{className:"w-4 h-4"})})]})]})})})},a.id)})})]}),e.jsx(p,{open:U,onOpenChange:Y,children:e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsxs(g,{children:["Cadastrar Pixel"," ",ee&&K[ee].name]}),e.jsx(v,{children:"Configure um novo pixel para rastrear convers√µes na sua loja Shopify."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"pixelId",children:["Pixel ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{id:"pixelId",placeholder:"FACEBOOK"===ee?"1234567890123456":"TIKTOK"===ee?"CXXXXXXXXXXXXXXXXX":"AW-1234567890 ou G-XXXXXXXXXX",value:le.pixelId,onChange:e=>oe({...le,pixelId:e.target.value})}),ee&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Formato esperado:"," ","FACEBOOK"===ee&&"15-16 d√≠gitos","TIKTOK"===ee&&"C√≥digo alfanum√©rico de 15-20 caracteres","GOOGLE_ADS"===ee&&"AW-XXXXXXXXXX ou G-XXXXXXXXXX"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"name",children:"Nome (Opcional)"}),e.jsx(c,{id:"name",placeholder:"Ex: Pixel Principal, Pixel de Remarketing...",value:le.name,onChange:e=>oe({...le,name:e.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{id:"isActive",checked:le.isActive,onCheckedChange:e=>oe({...le,isActive:e})}),e.jsx(x,{htmlFor:"isActive",children:"Ativar pixel imediatamente"})]}),ne&&e.jsx(j,{variant:"destructive",children:e.jsx(y,{children:ne})})]}),e.jsxs(f,{children:[e.jsx(d,{variant:"outline",onClick:ce,children:"Cancelar"}),e.jsx(d,{onClick:async()=>{if(!G(le.platform,le.pixelId))return void de("ID de pixel inv√°lido para esta plataforma. Verifique o formato correto.");await R(le)&&ce()},disabled:z||!le.pixelId,children:z?"Cadastrando...":"Cadastrar Pixel"})]})]})}),e.jsx(p,{open:H,onOpenChange:J,children:e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(g,{children:"Editar Pixel"}),e.jsx(v,{children:"Atualize as configura√ß√µes do seu pixel."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-pixelId",children:"Pixel ID"}),e.jsx(c,{id:"edit-pixelId",value:le.pixelId,onChange:e=>oe({...le,pixelId:e.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-name",children:"Nome"}),e.jsx(c,{id:"edit-name",placeholder:"Nome do pixel",value:le.name,onChange:e=>oe({...le,name:e.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{id:"edit-isActive",checked:le.isActive,onCheckedChange:e=>oe({...le,isActive:e})}),e.jsx(x,{htmlFor:"edit-isActive",children:"Pixel ativo"})]}),ne&&e.jsx(j,{variant:"destructive",children:e.jsx(y,{children:ne})})]}),e.jsxs(f,{children:[e.jsx(d,{variant:"outline",onClick:ce,children:"Cancelar"}),e.jsx(d,{onClick:async()=>{if(!te)return;if(le.pixelId&&le.pixelId!==te.pixelId&&!G(le.platform,le.pixelId))return void de("ID de pixel inv√°lido para esta plataforma. Verifique o formato correto.");await W(te.id,{pixelId:le.pixelId,name:le.name,isActive:le.isActive,events:le.events})&&ce()},disabled:B,children:B?"Salvando...":"Salvar Altera√ß√µes"})]})]})})]})};export{q as default};
