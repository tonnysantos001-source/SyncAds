import{j as e}from"./vendor-ui-Ba0j3nT4.js";import{r as a}from"./vendor-react-X41Bjl18.js";import{g as r,f as s,B as t,C as i,a as o,b as l,c as d,d as n,I as c,e as m}from"./index-D0_lz_P6.js";import{T as p,a as x,b as u,c as h,d as g,e as j}from"./table-BAHfzHV2.js";import{D as v,b as y,c as f,d as b,e as k,f as N}from"./dialog-BG-ObMIF.js";import{L as w}from"./label-DBFVh0rn.js";import{T as S}from"./textarea-M1WgktvW.js";import{S as C,a as A,b as P,c as I,d as E}from"./select-BCkXVaAK.js";import{p as T}from"./productsApi-Cko5x_Rj.js";import{a as F}from"./shopifySync-DFJwmXVn.js";import{S as z}from"./skeleton-DmBDcXpC.js";import{A as V,b as R,a as q}from"./alert-Dbq-QpHT.js";import{m as D}from"./vendor-animation-mzn7-F4O.js";import{R as L,aN as B,ae as O,J as K,aX as U,D as H,S as M,Q as $,Y as G}from"./vendor-icons-BvRy6l6m.js";import"./vendor-supabase-D-IBGfoY.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-DXIrutT_.js";const J=()=>{const[J,Q]=a.useState([]),[X,Y]=a.useState([]),[W,Z]=a.useState(!0),[_,ee]=a.useState(!1),[ae,re]=a.useState(""),[se,te]=a.useState("all"),[ie,oe]=a.useState(!1),[le,de]=a.useState(null),[ne,ce]=a.useState({totalProducts:0,totalOrders:0,lastSync:null}),{toast:me}=r(),pe=s(e=>e.user),[xe,ue]=a.useState({name:"",description:"",price:0,comparePrice:0,sku:"",stock:0,categoryId:"",status:"ACTIVE"}),he={total:J.length,active:J.filter(e=>"ACTIVE"===e.status).length,totalValue:J.reduce((e,a)=>e+a.price*a.stock,0)};a.useEffect(()=>{pe?.id&&(ge(),je())},[pe?.id]),a.useEffect(()=>{ye()},[ae,se,J]);const ge=async()=>{if(pe?.id)try{Z(!0);const e=await T.listFromShopify(pe.id);Q(e),Y(e)}catch(e){me({title:"Erro ao carregar produtos",description:e.message,variant:"destructive"})}finally{Z(!1)}else Z(!1)},je=async()=>{if(pe?.id)try{const e=await F.getSyncStats(pe.id);ce(e)}catch(e){}},ve=async()=>{if(pe?.id)try{ee(!0),me({title:"Sincronizando...",description:"Buscando produtos da Shopify"});const e=await F.syncProducts(pe.id,pe.organizationId||pe.id);e.success?(me({title:"Sincronização concluída!",description:e.message}),await ge(),await je()):me({title:"Shopify não configurada",description:"Configure a integração Shopify em Integrações",variant:"destructive"})}catch(e){me({title:"Shopify não disponível",description:"Configure a integração em Integrações > Shopify",variant:"destructive"})}finally{ee(!1)}else me({title:"Erro",description:"Faça login para sincronizar",variant:"destructive"})},ye=()=>{let e=J;ae&&(e=e.filter(e=>e.name.toLowerCase().includes(ae.toLowerCase())||e.sku?.toLowerCase().includes(ae.toLowerCase())||e.description?.toLowerCase().includes(ae.toLowerCase()))),"all"!==se&&(e=e.filter(e=>e.status===se)),Y(e)},fe=()=>{de(null),ue({name:"",description:"",price:0,comparePrice:0,sku:"",stock:0,categoryId:"",status:"ACTIVE"})},be=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(D.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-purple-600 via-pink-600 to-cyan-600 bg-clip-text text-transparent",children:"Produtos"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium",children:"Gerencie o catálogo completo de produtos da sua loja"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{onClick:ve,disabled:_,className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white border-0 hover:from-purple-600 hover:to-pink-600 transition-all duration-300 shadow-lg hover:shadow-xl disabled:opacity-50",children:[e.jsx(L,{className:"mr-2 h-4 w-4 "+(_?"animate-spin":"")}),_?"Sincronizando...":"Sincronizar Shopify"]}),e.jsxs(t,{onClick:()=>{fe(),oe(!0)},className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white border-0 hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg hover:shadow-xl",children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"Adicionar Produto"]})]})]}),ne.lastSync&&e.jsx(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.1},children:e.jsxs(V,{className:"border-0 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 backdrop-blur-sm",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx(R,{children:"Integração Shopify Ativa"}),e.jsxs(q,{children:["Última sincronização:"," ",new Date(ne.lastSync).toLocaleString("pt-BR")," •",ne.totalProducts," produtos importados"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:e.jsxs(i,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-purple-500 opacity-10 rounded-full blur-3xl"}),e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total de Produtos"}),e.jsx("div",{className:"p-2 rounded-lg bg-purple-500 bg-opacity-10",children:e.jsx(K,{className:"h-4 w-4 text-purple-500"})})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-purple-600 to-pink-500 bg-clip-text text-transparent",children:he.total}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[he.active," ativos"]})]})]})}),e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},children:e.jsxs(i,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-pink-500 opacity-10 rounded-full blur-3xl"}),e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Produtos Ativos"}),e.jsx("div",{className:"p-2 rounded-lg bg-pink-500 bg-opacity-10",children:e.jsx(U,{className:"h-4 w-4 text-pink-500"})})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-pink-600 to-rose-500 bg-clip-text text-transparent",children:he.active}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Disponíveis para venda"})]})]})}),e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:e.jsxs(i,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-cyan-500 opacity-10 rounded-full blur-3xl"}),e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Valor Total"}),e.jsx("div",{className:"p-2 rounded-lg bg-cyan-500 bg-opacity-10",children:e.jsx(H,{className:"h-4 w-4 text-cyan-500"})})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-cyan-600 to-blue-500 bg-clip-text text-transparent",children:be(he.totalValue)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Estoque valorizado"})]})]})})]}),e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},children:e.jsxs(i,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsxs(o,{children:[e.jsx(l,{className:"text-lg font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Filtros"}),e.jsx(n,{className:"dark:text-gray-400",children:"Busque e filtre produtos"})]}),e.jsx(d,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(c,{placeholder:"Buscar por nome, SKU ou descrição...",value:ae,onChange:e=>re(e.target.value),className:"pl-10 border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm dark:text-white dark:placeholder:text-gray-500"})]})}),e.jsxs(C,{value:se,onValueChange:te,children:[e.jsx(A,{className:"w-full md:w-[200px] border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm dark:text-white",children:e.jsx(P,{placeholder:"Status"})}),e.jsxs(I,{children:[e.jsx(E,{value:"all",children:"Todos os Status"}),e.jsx(E,{value:"ACTIVE",children:"Ativo"}),e.jsx(E,{value:"DRAFT",children:"Rascunho"}),e.jsx(E,{value:"ARCHIVED",children:"Arquivado"})]})]})]})})]})}),e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:e.jsxs(i,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsxs(o,{children:[e.jsxs(l,{className:"text-xl font-bold bg-gradient-to-r from-purple-600 to-cyan-600 bg-clip-text text-transparent",children:["Catálogo (",X.length,")"]}),e.jsx(n,{className:"dark:text-gray-400",children:X.length===J.length?"Mostrando todos os produtos":`Mostrando ${X.length} de ${J.length} produtos`})]}),e.jsx(d,{children:W?e.jsxs("div",{className:"space-y-4",children:[e.jsx(z,{className:"h-12 w-full"}),e.jsx(z,{className:"h-12 w-full"}),e.jsx(z,{className:"h-12 w-full"})]}):0===X.length?e.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:"flex flex-col items-center justify-center h-64",children:[e.jsx(K,{className:"h-16 w-16 text-muted-foreground mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground text-center mb-4 dark:text-gray-300",children:ae||"all"!==se?"Nenhum produto encontrado com os filtros aplicados":"Nenhum produto cadastrado"}),!ae&&"all"===se&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{onClick:ve,variant:"outline",disabled:_,children:[e.jsx(L,{className:"mr-2 h-4 w-4 "+(_?"animate-spin":"")}),"Sincronizar Shopify"]}),e.jsxs(t,{onClick:()=>{fe(),oe(!0)},children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"Adicionar Primeiro Produto"]})]})]}):e.jsx("div",{className:"rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:e.jsxs(p,{children:[e.jsx(x,{children:e.jsxs(u,{className:"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-gray-800 dark:to-gray-800 hover:from-purple-100 hover:to-pink-100 dark:hover:from-gray-700 dark:hover:to-gray-700",children:[e.jsx(h,{children:"Imagem"}),e.jsx(h,{className:"font-semibold dark:text-gray-300",children:"Produto"}),e.jsx(h,{className:"font-semibold dark:text-gray-300",children:"SKU"}),e.jsx(h,{className:"font-semibold dark:text-gray-300",children:"Preço"}),e.jsx(h,{className:"font-semibold dark:text-gray-300",children:"Estoque"}),e.jsx(h,{className:"font-semibold dark:text-gray-300",children:"Status"}),e.jsx(h,{className:"text-right font-semibold dark:text-gray-300",children:"Ações"}),e.jsx(h,{children:"Ações"})]})}),e.jsx(g,{children:X.map((a,r)=>{const s=a.metadata?.images||[],i=s.length>0?s[0]?.src||s[0]:null;return e.jsxs(D.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.05*r},className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gradient-to-r hover:from-purple-50/50 hover:to-pink-50/50 dark:hover:from-gray-800/50 dark:hover:to-gray-800/50 transition-all duration-200",children:[e.jsx(j,{children:i?e.jsx("img",{src:i,alt:a.name,className:"w-12 h-12 object-cover rounded-md border"}):e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-100 to-pink-100 dark:from-purple-900/20 dark:to-pink-900/20 rounded-md flex items-center justify-center",children:e.jsx(K,{className:"h-6 w-6 text-muted-foreground"})})}),e.jsx(j,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:a.name}),a.description&&e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",children:a.description}),a.metadata?.shopifyId&&e.jsxs(m,{variant:"outline",className:"mt-1 bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 text-purple-700 dark:text-purple-300 border-purple-300 dark:border-purple-700",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),"Shopify"]})]})}),e.jsx(j,{children:e.jsx("code",{className:"text-xs bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 px-2 py-1 rounded dark:text-gray-300",children:a.sku||"N/A"})}),e.jsx(j,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:be(a.price)}),a.comparePrice&&a.comparePrice>a.price&&e.jsx("div",{className:"text-xs text-muted-foreground line-through",children:be(a.comparePrice)})]})}),e.jsx(j,{children:e.jsxs(m,{variant:a.stock>10?"default":a.stock>0?"warning":"destructive",children:[a.stock," un."]})}),e.jsx(j,{children:e.jsx(m,{variant:"ACTIVE"===a.status?"default":"DRAFT"===a.status?"secondary":"outline",children:"ACTIVE"===a.status?"Ativo":"DRAFT"===a.status?"Rascunho":"Arquivado"})}),e.jsx(j,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>(e=>{de(e),ue({name:e.name,description:e.description||"",price:e.price,comparePrice:e.comparePrice||0,sku:e.sku||"",stock:e.stock,categoryId:e.categoryId||"",status:e.status}),oe(!0)})(a),className:"hover:bg-gradient-to-r hover:from-purple-50 hover:to-pink-50 dark:hover:from-gray-800 dark:hover:to-gray-800",children:e.jsx($,{className:"h-4 w-4"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Tem certeza que deseja excluir este produto?"))try{await T.delete(e),me({title:"Produto excluído",description:"O produto foi removido do catálogo."}),ge()}catch(a){me({title:"Erro ao excluir produto",description:a.message,variant:"destructive"})}})(a.id),className:"hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400",children:e.jsx(G,{className:"h-4 w-4"})})]})})]},a.id)})})]})})})]})}),e.jsx(v,{open:ie,onOpenChange:oe,children:e.jsxs(y,{className:"max-w-2xl",children:[e.jsxs(f,{children:[e.jsx(b,{children:le?"Editar Produto":"Novo Produto"}),e.jsx(k,{children:le?"Atualize as informações do produto":"Adicione um novo produto ao catálogo"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),pe?.id)try{le?(await T.update(le.id,xe),me({title:"Produto atualizado!",description:"As alterações foram salvas com sucesso."})):(await T.create({...xe,userId:pe.id,organizationId:pe.organizationId||pe.id,slug:xe.name.toLowerCase().replace(/\s+/g,"-"),lowStockThreshold:5,trackStock:!0,isFeatured:!1,isActive:"ACTIVE"===xe.status}),me({title:"Produto criado!",description:"O produto foi adicionado ao catálogo."})),oe(!1),fe(),ge()}catch(a){me({title:"Erro ao salvar produto",description:a.message||"Tente novamente",variant:"destructive"})}else me({title:"Erro",description:"Você precisa estar logado",variant:"destructive"})},children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"name",children:"Nome do Produto *"}),e.jsx(c,{id:"name",value:xe.name,onChange:e=>ue({...xe,name:e.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"description",children:"Descrição"}),e.jsx(S,{id:"description",value:xe.description,onChange:e=>ue({...xe,description:e.target.value}),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"price",children:"Preço *"}),e.jsx(c,{id:"price",type:"number",step:"0.01",value:xe.price,onChange:e=>ue({...xe,price:parseFloat(e.target.value)}),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"comparePrice",children:"Preço Comparação"}),e.jsx(c,{id:"comparePrice",type:"number",step:"0.01",value:xe.comparePrice,onChange:e=>ue({...xe,comparePrice:parseFloat(e.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"sku",children:"SKU"}),e.jsx(c,{id:"sku",value:xe.sku,onChange:e=>ue({...xe,sku:e.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"stock",children:"Estoque *"}),e.jsx(c,{id:"stock",type:"number",value:xe.stock,onChange:e=>ue({...xe,stock:parseInt(e.target.value)}),required:!0})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"status",children:"Status"}),e.jsxs(C,{value:xe.status,onValueChange:e=>ue({...xe,status:e}),children:[e.jsx(A,{children:e.jsx(P,{})}),e.jsxs(I,{children:[e.jsx(E,{value:"ACTIVE",children:"Ativo"}),e.jsx(E,{value:"DRAFT",children:"Rascunho"}),e.jsx(E,{value:"ARCHIVED",children:"Arquivado"})]})]})]})]}),e.jsxs(N,{children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>oe(!1),children:"Cancelar"}),e.jsxs(t,{type:"submit",children:[le?"Atualizar":"Criar"," Produto"]})]})]})]})})]})};export{J as default};
