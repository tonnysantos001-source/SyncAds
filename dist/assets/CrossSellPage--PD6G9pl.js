import{r as o,f as _,u as J,j as e,B as d,I as p,g as f,h as v,i as C,D as A,l as N,S as K,n as W}from"./index-DWWt1LWg.js";import{T as Y,a as Z,b as I,c as u,d as ee,e as m}from"./table-D7siHGXS.js";import{D as se,f as te,a as ae,b as re,c as ie,e as oe}from"./dialog-B1YSxr_2.js";import{L as n}from"./label-BxO9yO0s.js";import{S as w,a as D,b as V,c as k,d as T}from"./select-CHYs4Z_o.js";import{T as le}from"./textarea-8pL1mF7f.js";import{m as h}from"./marketingApi-BAXQNmap.js";import{p as de}from"./productsApi-BDXfpybl.js";import{S as z}from"./skeleton-DGSyvdNt.js";import{P as R}from"./plus-BnDSbtJe.js";import{P as ne}from"./percent-C_pLH5Ry.js";import{S as ce}from"./square-pen-CJdHFXXw.js";import{T as ue}from"./trash-2-tQ2ogrmz.js";import"./index-B7MyOJke.js";const Ee=()=>{const[g,F]=o.useState([]),[P,G]=o.useState([]),[B,L]=o.useState(!0),[y,q]=o.useState(""),[H,c]=o.useState(!1),[x,S]=o.useState(null),{toast:l}=_(),r=J(s=>s.user),[a,i]=o.useState({name:"",triggerProductId:"",suggestedProductIds:[],discountType:"PERCENTAGE",discountValue:0,isActive:!0});o.useEffect(()=>{j()},[]);const j=async()=>{try{if(!(r!=null&&r.organizationId))return;const[s,t]=await Promise.all([h.crossSells.getAll(r.organizationId),de.list()]);F(s),G(t)}catch(s){l({title:"Erro ao carregar",description:s.message,variant:"destructive"})}finally{L(!1)}},O=async s=>{s.preventDefault();try{if(!(r!=null&&r.organizationId))return;x?(await h.crossSells.update(x.id,a),l({title:"Cross-sell atualizado!"})):(await h.crossSells.create({...a,organizationId:r.organizationId}),l({title:"Cross-sell criado!",description:"Configure produtos sugeridos para aumentar as vendas."})),c(!1),E(),j()}catch(t){l({title:"Erro",description:t.message,variant:"destructive"})}},$=async s=>{if(confirm("Tem certeza que deseja deletar este cross-sell?"))try{await h.crossSells.delete(s),l({title:"Cross-sell deletado"}),j()}catch(t){l({title:"Erro ao deletar",description:t.message,variant:"destructive"})}},M=s=>{S(s),i({name:s.name||"",triggerProductId:s.triggerProductId||"",suggestedProductIds:s.suggestedProductIds||[],discountType:s.discountType||"PERCENTAGE",discountValue:s.discountValue||0,isActive:s.isActive??!0}),c(!0)},E=()=>{S(null),i({name:"",triggerProductId:"",suggestedProductIds:[],discountType:"PERCENTAGE",discountValue:0,isActive:!0})},Q=s=>{const t=P.find(X=>X.id===s);return(t==null?void 0:t.name)||"Produto não encontrado"},b=g.filter(s=>{var t;return(t=s.name)==null?void 0:t.toLowerCase().includes(y.toLowerCase())}),U=g.filter(s=>s.isActive).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Cross-Sell"}),e.jsx("p",{className:"text-muted-foreground",children:"Sugira produtos complementares e aumente o ticket médio"})]}),e.jsxs(se,{open:H,onOpenChange:c,children:[e.jsx(te,{asChild:!0,children:e.jsxs(d,{onClick:E,children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Criar Cross-Sell"]})}),e.jsxs(ae,{className:"max-w-2xl",children:[e.jsx(re,{children:e.jsx(ie,{children:x?"Editar Cross-Sell":"Novo Cross-Sell"})}),e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Nome da Campanha"}),e.jsx(p,{value:a.name,onChange:s=>i({...a,name:s.target.value}),placeholder:"Ex: Combo Produto + Acessório",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Produto Gatilho"}),e.jsxs(w,{value:a.triggerProductId,onValueChange:s=>i({...a,triggerProductId:s}),children:[e.jsx(D,{children:e.jsx(V,{placeholder:"Selecione o produto que ativa a sugestão"})}),e.jsx(k,{children:P.map(s=>e.jsx(T,{value:s.id,children:s.name},s.id))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Quando este produto for adicionado ao carrinho, os produtos sugeridos aparecerão"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Produtos Sugeridos (IDs separados por vírgula)"}),e.jsx(le,{value:a.suggestedProductIds.join(", "),onChange:s=>i({...a,suggestedProductIds:s.target.value.split(",").map(t=>t.trim()).filter(Boolean)}),placeholder:"Ex: prod-123, prod-456",rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Digite os IDs dos produtos que serão sugeridos como complementares"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Tipo de Desconto"}),e.jsxs(w,{value:a.discountType,onValueChange:s=>i({...a,discountType:s}),children:[e.jsx(D,{children:e.jsx(V,{})}),e.jsxs(k,{children:[e.jsx(T,{value:"PERCENTAGE",children:"Percentual (%)"}),e.jsx(T,{value:"FIXED_AMOUNT",children:"Valor Fixo (R$)"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Valor do Desconto"}),e.jsx(p,{type:"number",step:"0.01",min:"0",value:a.discountValue,onChange:s=>i({...a,discountValue:parseFloat(s.target.value)||0}),placeholder:a.discountType==="PERCENTAGE"?"10":"50.00"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:a.isActive,onChange:s=>i({...a,isActive:s.target.checked}),className:"h-4 w-4"}),e.jsx(n,{htmlFor:"isActive",className:"cursor-pointer",children:"Ativo"})]})]}),e.jsxs(oe,{className:"mt-6",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",children:x?"Atualizar":"Criar"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(f,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Total de Cross-Sells"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:g.length})})]}),e.jsxs(f,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Ativos"}),e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:U})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(p,{placeholder:"Buscar cross-sells...",value:y,onChange:s=>q(s.target.value),className:"pl-9"})]}),e.jsxs(f,{children:[e.jsx(v,{children:e.jsx(C,{children:"Lista de Cross-Sells"})}),e.jsx(N,{children:B?e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{className:"h-12 w-full"}),e.jsx(z,{className:"h-12 w-full"})]}):b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"h-12 w-12 text-muted-foreground mb-4 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhum cross-sell encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Comece criando o primeiro cross-sell para aumentar suas vendas"}),e.jsxs(d,{onClick:()=>c(!0),children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Criar Primeiro Cross-Sell"]})]}):e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(I,{children:[e.jsx(u,{children:"Nome"}),e.jsx(u,{children:"Produto Gatilho"}),e.jsx(u,{children:"Desconto"}),e.jsx(u,{children:"Status"}),e.jsx(u,{className:"text-right",children:"Ações"})]})}),e.jsx(ee,{children:b.map(s=>{var t;return e.jsxs(I,{children:[e.jsx(m,{className:"font-medium",children:s.name}),e.jsx(m,{className:"text-sm",children:Q(s.triggerProductId)}),e.jsx(m,{children:s.discountType==="PERCENTAGE"?`${s.discountValue}%`:`R$ ${(t=s.discountValue)==null?void 0:t.toFixed(2)}`}),e.jsx(m,{children:e.jsx(W,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativo":"Inativo"})}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>M(s),children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>$(s.id),children:e.jsx(ue,{className:"h-4 w-4"})})]})})]},s.id)})})]})})]})]})};export{Ee as default};
