import{c as $,s as x,r as h,f as J,u as W,j as e,g as N,h as P,i as D,S as F,l as y,P as Y,Q as Z,I as ee,B as k,ad as se,o as M,a6 as te}from"./index-C_eriggx.js";import{S as ae,a as re,b as le,c as ie,d as v}from"./select-C1MSRSOx.js";import{s as ne}from"./shopifySync-BGf5_sOl.js";import{S as O}from"./skeleton-BDfB0X9Q.js";import{D as de,a as ce,b as oe,c as me,d as xe,e as ue}from"./dialog-Zl2ngXfj.js";import{D as he}from"./dollar-sign-BJa0KTOj.js";import{S as I}from"./shopping-bag-DrodE4Pu.js";import{T as fe}from"./tag-udHOj7RU.js";import{M as pe}from"./mail-6Wz7lkwA.js";import{C as ge}from"./calendar-CPA1pvFv.js";import{E as je}from"./eye-tzzW3dzz.js";import{f as Ne,p as ye}from"./pt-BR-BQ5kKd2v.js";import"./index-zSyKqmgW.js";import"./index-CQJQNuQj.js";import"./constructFrom-rJN6zrQ_.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=$("PackageX",[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["path",{d:"m17 13 5 5m-5 0 5-5",key:"im3w4b"}]]),B={async getAll(a){const{data:i,error:r}=await x.from("Order").select(`
        *,
        items:OrderItem(*),
        history:OrderHistory(*)
      `).eq("userId",a).order("createdAt",{ascending:!1});if(r)throw r;return i},async getById(a){const{data:i,error:r}=await x.from("Order").select(`
        *,
        items:OrderItem(*),
        history:OrderHistory(*)
      `).eq("id",a).single();if(r)throw r;return i},async getByCustomer(a){const{data:i,error:r}=await x.from("Order").select(`
        *,
        items:OrderItem(*)
      `).eq("customerId",a).order("createdAt",{ascending:!1});if(r)throw r;return i},async create(a){const{data:i,error:r}=await x.from("Order").insert(a).select().single();if(r)throw r;return i},async update(a,i){const{data:r,error:c}=await x.from("Order").update({...i,updatedAt:new Date().toISOString()}).eq("id",a).select().single();if(c)throw c;return r},async updatePaymentStatus(a,i,r){const c={paymentStatus:i};r&&(c.paidAt=r);const{data:f,error:g}=await x.from("Order").update(c).eq("id",a).select().single();if(g)throw g;return f},async updateFulfillmentStatus(a,i,r){const c={fulfillmentStatus:i,...r},{data:f,error:g}=await x.from("Order").update(c).eq("id",a).select().single();if(g)throw g;return f},async cancel(a,i){const r={paymentStatus:"CANCELLED",fulfillmentStatus:"CANCELLED",cancelledAt:new Date().toISOString()},{data:c,error:f}=await x.from("Order").update(r).eq("id",a).select().single();if(f)throw f;return c&&await B.addHistory(a,"ORDER_CANCELLED",i||"Order cancelled"),c},async delete(a){const{error:i}=await x.from("Order").delete().eq("id",a);if(i)throw i}},ke=()=>{const[a,i]=h.useState([]),[r,c]=h.useState([]),[f,g]=h.useState(!0),[C,L]=h.useState(!1),[j,z]=h.useState(""),[w,G]=h.useState("all"),[l,H]=h.useState(null),{toast:b}=J(),u=W(s=>s.user);h.useEffect(()=>{R()},[]),h.useEffect(()=>{U()},[j,w,a]);const R=async()=>{try{if(!(u!=null&&u.id))return;const s=await B.getAll(u.id),{data:d}=await x.from("ShopifyOrder").select("*").eq("userId",u.id).order("createdAt",{ascending:!1}),o=(d||[]).map(t=>{var S,A,E,q;return{id:t.id.toString(),userId:t.userId,orderNumber:((S=t.orderNumber)==null?void 0:S.toString())||t.id.toString(),customerId:((A=t.customerData)==null?void 0:A.id)||"shopify-customer",cartId:void 0,customerEmail:t.email||"",customerName:t.name||((E=t.customerData)==null?void 0:E.first_name)+" "+((q=t.customerData)==null?void 0:q.last_name)||"Cliente",customerPhone:t.phone,shippingAddress:t.shippingAddress||{},billingAddress:t.billingAddress||{},items:t.lineItems||{},subtotal:parseFloat(t.subtotalPrice||0),discount:0,shipping:0,tax:parseFloat(t.totalTax||0),total:parseFloat(t.totalPrice||0),currency:t.currency||"BRL",paymentMethod:"CREDIT_CARD",paymentStatus:t.financialStatus==="paid"?"PAID":t.financialStatus==="pending"?"PENDING":"FAILED",fulfillmentStatus:t.fulfillmentStatus==="fulfilled"?"DELIVERED":"PENDING",createdAt:t.createdAt,updatedAt:t.updatedAt}}),p=[...s,...o].filter((t,S,A)=>S===A.findIndex(E=>E.orderNumber===t.orderNumber));i(p),c(p)}catch(s){console.error("Erro ao carregar pedidos:",s),b({title:"Erro ao carregar pedidos",description:s.message,variant:"destructive"})}finally{g(!1)}},V=async()=>{try{if(L(!0),b({title:"Sincronizando com Shopify..."}),!(u!=null&&u.id))return;await ne.syncOrders(u.id),b({title:"✅ Pedidos sincronizados com sucesso!"}),await R()}catch(s){console.error("Erro ao sincronizar:",s),b({title:"Erro ao sincronizar",description:s.message,variant:"destructive"})}finally{L(!1)}},U=()=>{let s=a;j&&(s=s.filter(d=>d.orderNumber.toLowerCase().includes(j.toLowerCase())||d.customerName.toLowerCase().includes(j.toLowerCase())||d.customerEmail.toLowerCase().includes(j.toLowerCase()))),w!=="all"&&(s=s.filter(d=>d.paymentStatus===w)),c(s)},m=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),_=s=>({PENDING:{label:"Pendente",variant:"secondary",color:"bg-yellow-100 text-yellow-800"},PROCESSING:{label:"Processando",variant:"default",color:"bg-blue-100 text-blue-800"},PAID:{label:"Pago",variant:"default",color:"bg-green-100 text-green-800"},FAILED:{label:"Falhou",variant:"destructive",color:"bg-red-100 text-red-800"},REFUNDED:{label:"Reembolsado",variant:"secondary",color:"bg-gray-100 text-gray-800"},CANCELLED:{label:"Cancelado",variant:"secondary",color:"bg-gray-100 text-gray-800"}})[s]||{label:"Desconhecido",variant:"secondary",color:"bg-gray-100 text-gray-800"},T=s=>{if(!s.items)return[];if(Array.isArray(s.items))return s.items;if(typeof s.items=="object"&&!Array.isArray(s.items)){const d=s.items;return Array.isArray(d.items)?d.items:[d]}return[]},Q=a.filter(s=>s.paymentStatus==="PAID").reduce((s,d)=>s+d.total,0),X=a.filter(s=>s.paymentStatus==="PENDING").length,K=a.filter(s=>s.paymentStatus==="PAID").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Pedidos"}),e.jsx("p",{className:"text-muted-foreground",children:"Visualize e gerencie todos os pedidos da sua loja"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(N,{children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Total de Pedidos"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Todos os pedidos"})]})]}),e.jsxs(N,{children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Pedidos Pagos"}),e.jsx(Y,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:K}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pagamentos confirmados"})]})]}),e.jsxs(N,{children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Pedidos Pendentes"}),e.jsx(ve,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:X}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aguardando pagamento"})]})]}),e.jsxs(N,{children:[e.jsxs(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Receita Total"}),e.jsx(he,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:m(Q)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pedidos pagos"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ee,{placeholder:"Buscar por número, cliente ou email...",value:j,onChange:s=>z(s.target.value),className:"pl-9"})]}),e.jsxs(ae,{value:w,onValueChange:G,children:[e.jsx(re,{className:"w-full sm:w-[200px]",children:e.jsx(le,{placeholder:"Status"})}),e.jsxs(ie,{children:[e.jsx(v,{value:"all",children:"Todos os Status"}),e.jsx(v,{value:"PENDING",children:"Pendente"}),e.jsx(v,{value:"PROCESSING",children:"Processando"}),e.jsx(v,{value:"PAID",children:"Pago"}),e.jsx(v,{value:"FAILED",children:"Falhou"}),e.jsx(v,{value:"REFUNDED",children:"Reembolsado"}),e.jsx(v,{value:"CANCELLED",children:"Cancelado"})]})]}),e.jsxs(k,{onClick:V,disabled:C,variant:"outline",className:"w-full sm:w-auto",children:[e.jsx(se,{className:`h-4 w-4 mr-2 ${C?"animate-spin":""}`}),C?"Sincronizando...":"Sincronizar Shopify"]})]}),f?e.jsxs("div",{className:"space-y-4",children:[e.jsx(O,{className:"h-32 w-full"}),e.jsx(O,{className:"h-32 w-full"}),e.jsx(O,{className:"h-32 w-full"})]}):r.length===0?e.jsx(N,{children:e.jsxs(y,{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(F,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum pedido encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:j||w!=="all"?"Tente ajustar os filtros de busca":"Os pedidos aparecerão aqui assim que forem criados"})]})}):e.jsx("div",{className:"grid gap-4",children:r.map(s=>{const d=_(s.paymentStatus),o=T(s);return e.jsx(N,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:e.jsx(y,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsx("div",{className:"lg:w-48 p-4 bg-gray-50 flex items-center justify-center",children:o.length>0?e.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full",children:[o.slice(0,4).map((n,p)=>e.jsx("div",{className:"aspect-square bg-white rounded-lg border overflow-hidden",children:n.image?e.jsx("img",{src:n.image,alt:n.name||"Produto",className:"w-full h-full object-cover",onError:t=>{t.target.src="https://via.placeholder.com/100?text=Produto"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:e.jsx(I,{className:"h-8 w-8 text-gray-400"})})},p)),o.length>4&&e.jsxs("div",{className:"aspect-square bg-gray-200 rounded-lg flex items-center justify-center text-xs font-medium text-gray-600",children:["+",o.length-4]})]}):e.jsx("div",{className:"flex items-center justify-center h-24",children:e.jsx(I,{className:"h-12 w-12 text-gray-400"})})}),e.jsx("div",{className:"flex-1 p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"font-mono text-lg font-bold",children:["#",s.orderNumber]}),e.jsx(M,{className:d.color,children:d.label}),o.length>0&&e.jsxs(M,{variant:"outline",className:"gap-1",children:[e.jsx(fe,{className:"h-3 w-3"}),o.length," ",o.length===1?"item":"itens"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.customerName})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:s.customerEmail})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{children:Ne(new Date(s.createdAt),"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:ye})})]})]}),o.length>0&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Produtos:"}),e.jsxs("div",{className:"space-y-1",children:[o.slice(0,3).map((n,p)=>e.jsxs("div",{className:"text-sm flex justify-between",children:[e.jsxs("span",{children:[n.quantity,"x"," ",n.name||"Produto sem nome"]}),e.jsx("span",{className:"font-medium",children:m((n.price||0)*(n.quantity||1))})]},p)),o.length>3&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["E mais ",o.length-3," produto(s)..."]})]})]})]}),e.jsxs("div",{className:"lg:text-right space-y-3 lg:min-w-[200px]",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:m(s.total)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.paymentMethod||"Método não definido"})]}),e.jsxs(de,{children:[e.jsx(ce,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"w-full",onClick:()=>H(s),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Ver Detalhes"]})}),e.jsxs(oe,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(me,{children:[e.jsxs(xe,{children:["Detalhes do Pedido #",s.orderNumber]}),e.jsx(ue,{children:"Informações completas do pedido"})]}),l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Cliente"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Nome:"})," ",l.customerName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",l.customerEmail]}),l.customerPhone&&e.jsxs("p",{children:[e.jsx("strong",{children:"Telefone:"})," ",l.customerPhone]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Produtos"}),e.jsx("div",{className:"space-y-3",children:T(l).map((n,p)=>e.jsxs("div",{className:"flex gap-3 p-3 bg-gray-50 rounded-lg",children:[n.image?e.jsx("img",{src:n.image,alt:n.name||"Produto",className:"w-16 h-16 object-cover rounded",onError:t=>{t.target.src="https://via.placeholder.com/100?text=Produto"}}):e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded flex items-center justify-center",children:e.jsx(I,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:n.name||"Produto sem nome"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Quantidade: ",n.quantity]}),n.sku&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["SKU: ",n.sku]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:m((n.price||0)*(n.quantity||1))}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[m(n.price||0)," ","/ un"]})]})]},p))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Resumo Financeiro"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:m(l.subtotal)})]}),l.discount>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Desconto:"}),e.jsxs("span",{children:["-",m(l.discount)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Frete:"}),e.jsx("span",{children:m(l.shipping)})]}),l.tax>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Impostos:"}),e.jsx("span",{children:m(l.tax)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-base pt-2 border-t",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-blue-600",children:m(l.total)})]})]})]}),l.shippingAddress&&Object.keys(l.shippingAddress).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Endereço de Entrega"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[l.shippingAddress.street,","," ",l.shippingAddress.number]}),l.shippingAddress.complement&&e.jsx("p",{children:l.shippingAddress.complement}),e.jsxs("p",{children:[l.shippingAddress.neighborhood," ","-"," ",l.shippingAddress.city,"/",l.shippingAddress.state]}),e.jsxs("p",{children:["CEP:"," ",l.shippingAddress.zipCode]})]})]})]})]})]})]})]})})]})})},s.id)})}),r.length>10&&e.jsx(N,{children:e.jsxs(y,{className:"p-4 text-center text-sm text-muted-foreground",children:["Mostrando ",r.length," pedidos"]})})]})};export{ke as default};
