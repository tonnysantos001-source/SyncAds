import{c as w,f as E,r as u,t as D,j as e,g as i,h as c,i as d,l as o,C as P,k as A,S as L,I as k,n as I}from"./index-DmbEu-AZ.js";import{T as B,a as F,b as j,c as n,d as M,e as r}from"./table-xtx-_sWY.js";import{S as p}from"./SuperAdminLayout-CDntrcXF.js";import{D as $}from"./dollar-sign-CXqzgN7J.js";import{T as V}from"./trending-up-D_Lh96X2.js";import{C as O}from"./calendar-DMDC-yt5.js";import"./Logo-C5aWkpWM.js";import"./message-square-c_9H5MXO.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=w("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);function Y(){const{toast:f}=E(),[l,R]=u.useState([]),[h,b]=u.useState(""),[N,v]=u.useState(!0);u.useEffect(()=>{y()},[]);const y=async()=>{try{const{data:t,error:a}=await D.from("Organization").select("*").order("createdAt",{ascending:!1});if(a)throw a;const m={FREE:0,STARTER:49.9,PRO:199.9,ENTERPRISE:999.9},S=(t||[]).map(s=>({clientId:s.id,clientName:s.name,clientSlug:s.slug,plan:s.plan,status:s.status,mrr:s.status==="ACTIVE"&&m[s.plan]||0,totalRevenue:0,lastPayment:null,nextPayment:s.status==="ACTIVE"?new Date(Date.now()+30*24*60*60*1e3).toISOString():null}));R(S)}catch(t){f({title:"Erro ao carregar faturamento",description:t.message,variant:"destructive"})}finally{v(!1)}},g=l.filter(t=>t.clientName.toLowerCase().includes(h.toLowerCase())||t.clientSlug.toLowerCase().includes(h.toLowerCase())),x={totalMRR:l.reduce((t,a)=>t+a.mrr,0),activeClients:l.filter(t=>t.status==="ACTIVE").length,totalRevenue:l.reduce((t,a)=>t+a.totalRevenue,0),avgRevenuePerClient:l.length>0?l.reduce((t,a)=>t+a.mrr,0)/l.filter(t=>t.status==="ACTIVE").length:0},C=t=>{const a={FREE:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100",STARTER:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",PRO:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",ENTERPRISE:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200"};return e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${a[t]||a.FREE}`,children:t})},T=t=>{const a={ACTIVE:{variant:"default",label:"Ativo"},TRIAL:{variant:"secondary",label:"Trial"},SUSPENDED:{variant:"destructive",label:"Suspenso"},CANCELLED:{variant:"outline",label:"Cancelado"}},m=a[t]||a.TRIAL;return e.jsx(I,{variant:m.variant,children:m.label})};return N?e.jsx(p,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsx(p,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Faturamento"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Acompanhe a receita e pagamentos dos clientes"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(i,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"MRR Total"}),e.jsx($,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["R$ ",x.totalMRR.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receita mensal recorrente"})]})]}),e.jsxs(i,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Clientes Pagantes"}),e.jsx(V,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.activeClients}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Com plano ativo"})]})]}),e.jsxs(i,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Ticket Médio"}),e.jsx(P,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["R$ ",x.avgRevenuePerClient.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Por cliente"})]})]}),e.jsxs(i,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"ARR Projetado"}),e.jsx(U,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["R$ ",(x.totalMRR*12).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receita anual"})]})]})]}),e.jsxs(i,{children:[e.jsx(c,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(d,{children:"Faturamento por Cliente"}),e.jsx(A,{children:"Detalhes de pagamento e receita"})]})})}),e.jsxs(o,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(k,{placeholder:"Buscar cliente...",value:h,onChange:t=>b(t.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(B,{children:[e.jsx(F,{children:e.jsxs(j,{children:[e.jsx(n,{children:"Cliente"}),e.jsx(n,{children:"Plano"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"MRR"}),e.jsx(n,{children:"Receita Total"}),e.jsx(n,{children:"Próximo Pagamento"})]})}),e.jsx(M,{children:g.length===0?e.jsx(j,{children:e.jsx(r,{colSpan:6,className:"text-center py-8 text-gray-500",children:"Nenhum dado de faturamento encontrado"})}):g.map(t=>e.jsxs(j,{children:[e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.clientName}),e.jsx("div",{className:"text-sm text-gray-500",children:t.clientSlug})]})}),e.jsx(r,{children:C(t.plan)}),e.jsx(r,{children:T(t.status)}),e.jsx(r,{children:e.jsxs("span",{className:"font-semibold text-green-600",children:["R$ ",t.mrr.toLocaleString("pt-BR",{minimumFractionDigits:2})]})}),e.jsxs(r,{children:["R$ ",t.totalRevenue.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx(r,{children:t.nextPayment?e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(O,{className:"h-4 w-4 text-gray-400"}),new Date(t.nextPayment).toLocaleDateString("pt-BR")]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})})]},t.clientId))})]})})]})]})]})})}export{Y as default};
