import{r as i,f as W,u as Y,j as e,B as x,I as f,g,h as v,i as N,l as C,D as Z,S as ee,n as b}from"./index-DWWt1LWg.js";import{T as se,a as te,b as V,c,d as ae,e as d}from"./table-D7siHGXS.js";import{D as re,f as ie,a as ne,b as le,c as oe,e as ce}from"./dialog-B1YSxr_2.js";import{L as l}from"./label-BxO9yO0s.js";import{S as A,a as B,b as S,c as D,d as m}from"./select-CHYs4Z_o.js";import{T as de}from"./textarea-8pL1mF7f.js";import{m as T}from"./marketingApi-BAXQNmap.js";import{p as ue}from"./productsApi-BDXfpybl.js";import{S as k}from"./skeleton-DGSyvdNt.js";import{P as z}from"./plus-BnDSbtJe.js";import{T as R}from"./trending-up-lku-fS7z.js";import{D as xe}from"./dollar-sign-DfxqAQIS.js";import{S as he}from"./square-pen-CJdHFXXw.js";import{T as me}from"./trash-2-tQ2ogrmz.js";import"./index-B7MyOJke.js";const Oe=()=>{const[h,F]=i.useState([]),[O,H]=i.useState([]),[P,y]=i.useState([]),[L,U]=i.useState(!0),[o,q]=i.useState(""),[G,j]=i.useState(!1),[p,I]=i.useState(null),{toast:u}=W(),n=Y(s=>s.user),[t,r]=i.useState({name:"",productId:"",title:"",description:"",discountType:"PERCENTAGE",discountValue:0,position:"CHECKOUT",isActive:!0});i.useEffect(()=>{E()},[]),i.useEffect(()=>{K()},[o,h]);const E=async()=>{try{if(!(n!=null&&n.organizationId))return;const[s,a]=await Promise.all([T.orderBumps.getAll(n.organizationId),ue.list()]);F(s),H(a),y(s)}catch(s){u({title:"Erro ao carregar",description:s.message,variant:"destructive"})}finally{U(!1)}},K=()=>{if(!o){y(h);return}const s=h.filter(a=>a.name.toLowerCase().includes(o.toLowerCase())||a.title.toLowerCase().includes(o.toLowerCase()));y(s)},$=async s=>{s.preventDefault();try{if(!(n!=null&&n.organizationId))return;p?(await T.orderBumps.update(p.id,t),u({title:"Order Bump atualizado!"})):(await T.orderBumps.create({...t,organizationId:n.organizationId}),u({title:"Order Bump criado!",description:"A oferta está pronta para uso."})),j(!1),w(),E()}catch(a){u({title:"Erro",description:a.message,variant:"destructive"})}},M=async s=>{if(confirm("Tem certeza que deseja deletar este order bump?"))try{await T.orderBumps.delete(s),u({title:"Order Bump deletado"}),E()}catch(a){u({title:"Erro ao deletar",description:a.message,variant:"destructive"})}},X=s=>{I(s),r({name:s.name,productId:s.productId,title:s.title,description:s.description||"",discountType:s.discountType||"PERCENTAGE",discountValue:s.discountValue||0,position:s.position,isActive:s.isActive}),j(!0)},w=()=>{I(null),r({name:"",productId:"",title:"",description:"",discountType:"PERCENTAGE",discountValue:0,position:"CHECKOUT",isActive:!0})},_=h.filter(s=>s.isActive).length,J=s=>{const a=O.find(Q=>Q.id===s);return(a==null?void 0:a.name)||"Produto não encontrado"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Order Bumps"}),e.jsx("p",{className:"text-muted-foreground",children:"Ofertas especiais exibidas durante o checkout"})]}),e.jsxs(re,{open:G,onOpenChange:j,children:[e.jsx(ie,{asChild:!0,children:e.jsxs(x,{onClick:w,children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Criar Order Bump"]})}),e.jsxs(ne,{className:"max-w-2xl",children:[e.jsx(le,{children:e.jsx(oe,{children:p?"Editar Order Bump":"Novo Order Bump"})}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{children:"Nome Interno *"}),e.jsx(f,{value:t.name,onChange:s=>r({...t,name:s.target.value}),placeholder:"Ex: Acessório Premium",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{children:"Produto *"}),e.jsxs(A,{value:t.productId,onValueChange:s=>r({...t,productId:s}),required:!0,children:[e.jsx(B,{children:e.jsx(S,{placeholder:"Selecione o produto"})}),e.jsx(D,{children:O.map(s=>e.jsxs(m,{value:s.id,children:[s.name," - R$ ",s.price.toFixed(2)]},s.id))})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{children:"Título da Oferta *"}),e.jsx(f,{value:t.title,onChange:s=>r({...t,title:s.target.value}),placeholder:"Ex: Adicione Proteção Estendida",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{children:"Descrição"}),e.jsx(de,{value:t.description,onChange:s=>r({...t,description:s.target.value}),placeholder:"Descreva a oferta...",rows:3})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Tipo de Desconto"}),e.jsxs(A,{value:t.discountType,onValueChange:s=>r({...t,discountType:s}),children:[e.jsx(B,{children:e.jsx(S,{})}),e.jsxs(D,{children:[e.jsx(m,{value:"PERCENTAGE",children:"Porcentagem"}),e.jsx(m,{value:"FIXED_AMOUNT",children:"Valor Fixo"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Valor do Desconto"}),e.jsx(f,{type:"number",step:"0.01",value:t.discountValue,onChange:s=>r({...t,discountValue:parseFloat(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Posição *"}),e.jsxs(A,{value:t.position,onValueChange:s=>r({...t,position:s}),children:[e.jsx(B,{children:e.jsx(S,{})}),e.jsxs(D,{children:[e.jsx(m,{value:"CHECKOUT",children:"Checkout"}),e.jsx(m,{value:"CART",children:"Carrinho"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.isActive,onChange:s=>r({...t,isActive:s.target.checked}),className:"rounded"}),e.jsx(l,{children:"Ativo"})]})]}),e.jsxs(ce,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),e.jsx(x,{type:"submit",children:p?"Atualizar":"Criar"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(g,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total de Order Bumps"}),e.jsx(R,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:h.length})})]}),e.jsxs(g,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Ativos"}),e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:_})})]}),e.jsxs(g,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Taxa Conversão"}),e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:"-"})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(f,{placeholder:"Buscar order bumps...",value:o,onChange:s=>q(s.target.value),className:"pl-9"})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(N,{children:"Lista de Order Bumps"})}),e.jsx(C,{children:L?e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{className:"h-12 w-full"}),e.jsx(k,{className:"h-12 w-full"})]}):P.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(R,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhum order bump encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:o?"Tente ajustar sua busca":"Comece criando seu primeiro order bump"}),!o&&e.jsxs(x,{onClick:w,children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Criar Primeiro Order Bump"]})]}):e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(V,{children:[e.jsx(c,{children:"Nome"}),e.jsx(c,{children:"Produto"}),e.jsx(c,{children:"Título"}),e.jsx(c,{children:"Desconto"}),e.jsx(c,{children:"Posição"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Ações"})]})}),e.jsx(ae,{children:P.map(s=>e.jsxs(V,{children:[e.jsx(d,{className:"font-medium",children:s.name}),e.jsx(d,{children:J(s.productId)}),e.jsx(d,{children:s.title}),e.jsx(d,{children:s.discountValue?s.discountType==="PERCENTAGE"?`${s.discountValue}%`:`R$ ${s.discountValue.toFixed(2)}`:"-"}),e.jsx(d,{children:e.jsx(b,{variant:"outline",children:s.position==="CHECKOUT"?"Checkout":"Carrinho"})}),e.jsx(d,{children:e.jsx(b,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativo":"Inativo"})}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>X(s),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>M(s.id),children:e.jsx(me,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})]})};export{Oe as default};
