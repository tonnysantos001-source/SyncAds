import{c as me,r as o,b as he,u as ue,j as e,B as c,a6 as K,d as w,e as b,f as k,h as C,g as Z,S as xe,I as g,o as z}from"./index-CurQCjv1.js";import{T as pe,a as je,b as G,c as m,d as ge,e as h}from"./table-NgKfF-Ho.js";import{D as fe,b as ve,c as ye,d as Ne,e as Se,f as we}from"./dialog-Bh_5VG6P.js";import{L as u}from"./label-BvN8-3bF.js";import{T as be}from"./textarea-B01ftEOM.js";import{S as J,a as Q,b as W,c as X,d as x}from"./select-BGGe4r2k.js";import{p as T}from"./productsApi-DSLLy4PR.js";import{a as Y}from"./shopifySync-DMtENPGw.js";import{S as V}from"./skeleton-KytUVP5t.js";import{A as ke,b as Ce,a as Pe}from"./alert-BDppkwXe.js";import{P as _}from"./plus-sm2wkxUO.js";import{S as ee}from"./shopping-bag-CnSpxo5Y.js";import{P as L}from"./package-CNF2O9Zm.js";import{D as Ae}from"./dollar-sign-B7h_y5Ek.js";import{S as Te}from"./square-pen-DwL0yt9D.js";import{T as Ie}from"./trash-2-B17ahRq-.js";import"./x-j8W6nHBD.js";import"./index-DoOV3b-C.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=me("Boxes",[["path",{d:"M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z",key:"lc1i9w"}],["path",{d:"m7 16.5-4.74-2.85",key:"1o9zyk"}],["path",{d:"m7 16.5 5-3",key:"va8pkn"}],["path",{d:"M7 16.5v5.17",key:"jnp8gn"}],["path",{d:"M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z",key:"8zsnat"}],["path",{d:"m17 16.5-5-3",key:"8arw3v"}],["path",{d:"m17 16.5 4.74-2.85",key:"8rfmw"}],["path",{d:"M17 16.5v5.17",key:"k6z78m"}],["path",{d:"M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z",key:"1xygjf"}],["path",{d:"M12 8 7.26 5.15",key:"1vbdud"}],["path",{d:"m12 8 4.74-2.85",key:"3rx089"}],["path",{d:"M12 13.5V8",key:"1io7kd"}]]),We=()=>{const[d,se]=o.useState([]),[f,R]=o.useState([]),[ae,I]=o.useState(!0),[v,B]=o.useState(!1),[n,te]=o.useState(""),[p,re]=o.useState("all"),[ie,j]=o.useState(!1),[y,q]=o.useState(null),[D,oe]=o.useState({totalProducts:0,totalOrders:0,lastSync:null}),{toast:i}=he(),a=ue(s=>s.user),[t,l]=o.useState({name:"",description:"",price:0,comparePrice:0,sku:"",stock:0,categoryId:"",status:"ACTIVE"}),P={total:d.length,active:d.filter(s=>s.status==="ACTIVE").length,totalValue:d.reduce((s,r)=>s+r.price*r.stock,0)};o.useEffect(()=>{a!=null&&a.id&&(A(),M())},[a==null?void 0:a.id]),o.useEffect(()=>{le()},[n,p,d]);const A=async()=>{if(!(a!=null&&a.id)){I(!1);return}try{I(!0);const s=await T.listFromShopify(a.id);se(s),R(s)}catch(s){console.error("Erro ao carregar produtos:",s),i({title:"Erro ao carregar produtos",description:s.message,variant:"destructive"})}finally{I(!1)}},M=async()=>{if(a!=null&&a.id)try{const s=await Y.getSyncStats(a.id);oe(s)}catch(s){console.debug("Sync stats não disponíveis:",s)}},H=async()=>{if(!(a!=null&&a.id)){i({title:"Erro",description:"Faça login para sincronizar",variant:"destructive"});return}try{B(!0),i({title:"Sincronizando...",description:"Buscando produtos da Shopify"});const s=await Y.syncProducts(a.id,a.organizationId||a.id);s.success?(i({title:"Sincronização concluída!",description:s.message}),await A(),await M()):i({title:"Shopify não configurada",description:"Configure a integração Shopify em Integrações",variant:"destructive"})}catch{i({title:"Shopify não disponível",description:"Configure a integração em Integrações > Shopify",variant:"destructive"})}finally{B(!1)}},le=()=>{let s=d;n&&(s=s.filter(r=>{var N,S;return r.name.toLowerCase().includes(n.toLowerCase())||((N=r.sku)==null?void 0:N.toLowerCase().includes(n.toLowerCase()))||((S=r.description)==null?void 0:S.toLowerCase().includes(n.toLowerCase()))})),p!=="all"&&(s=s.filter(r=>r.status===p)),R(s)},ne=async s=>{if(s.preventDefault(),!(a!=null&&a.id)){i({title:"Erro",description:"Você precisa estar logado",variant:"destructive"});return}try{y?(await T.update(y.id,t),i({title:"Produto atualizado!",description:"As alterações foram salvas com sucesso."})):(await T.create({...t,userId:a.id,organizationId:a.organizationId||a.id,slug:t.name.toLowerCase().replace(/\s+/g,"-"),lowStockThreshold:5,trackStock:!0,isFeatured:!1,isActive:t.status==="ACTIVE"}),i({title:"Produto criado!",description:"O produto foi adicionado ao catálogo."})),j(!1),E(),A()}catch(r){console.error("Erro ao salvar:",r),i({title:"Erro ao salvar produto",description:r.message||"Tente novamente",variant:"destructive"})}},ce=s=>{q(s),l({name:s.name,description:s.description||"",price:s.price,comparePrice:s.comparePrice||0,sku:s.sku||"",stock:s.stock,categoryId:s.categoryId||"",status:s.status}),j(!0)},de=async s=>{if(confirm("Tem certeza que deseja excluir este produto?"))try{await T.delete(s),i({title:"Produto excluído",description:"O produto foi removido do catálogo."}),A()}catch(r){i({title:"Erro ao excluir produto",description:r.message,variant:"destructive"})}},E=()=>{q(null),l({name:"",description:"",price:0,comparePrice:0,sku:"",stock:0,categoryId:"",status:"ACTIVE"})},F=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Produtos"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Gerencie o catálogo completo de produtos da sua loja"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:H,variant:"outline",disabled:v,children:[e.jsx(K,{className:`mr-2 h-4 w-4 ${v?"animate-spin":""}`}),v?"Sincronizando...":"Sincronizar Shopify"]}),e.jsxs(c,{onClick:()=>{E(),j(!0)},children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Adicionar Produto"]})]})]}),D.lastSync&&e.jsxs(ke,{children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx(Ce,{children:"Integração Shopify Ativa"}),e.jsxs(Pe,{children:["Última sincronização:"," ",new Date(D.lastSync).toLocaleString("pt-BR")," •",D.totalProducts," produtos importados"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(w,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Total de Produtos"}),e.jsx(L,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:P.total}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[P.active," ativos"]})]})]}),e.jsxs(w,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Produtos Ativos"}),e.jsx(De,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:P.active}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Disponíveis para venda"})]})]}),e.jsxs(w,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Valor Total"}),e.jsx(Ae,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:F(P.totalValue)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Estoque valorizado"})]})]})]}),e.jsxs(w,{children:[e.jsxs(b,{children:[e.jsx(k,{children:"Filtros"}),e.jsx(Z,{children:"Busque e filtre produtos"})]}),e.jsx(C,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(g,{placeholder:"Buscar por nome, SKU ou descrição...",value:n,onChange:s=>te(s.target.value),className:"pl-10 border-gray-200 bg-white/80 backdrop-blur-sm"})]})}),e.jsxs(J,{value:p,onValueChange:re,children:[e.jsx(Q,{className:"w-full md:w-[200px]",children:e.jsx(W,{placeholder:"Status"})}),e.jsxs(X,{children:[e.jsx(x,{value:"all",children:"Todos os Status"}),e.jsx(x,{value:"ACTIVE",children:"Ativo"}),e.jsx(x,{value:"DRAFT",children:"Rascunho"}),e.jsx(x,{value:"ARCHIVED",children:"Arquivado"})]})]})]})})]}),e.jsxs(w,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg",children:[e.jsxs(b,{children:[e.jsxs(k,{children:["Catálogo (",f.length,")"]}),e.jsx(Z,{children:f.length===d.length?"Mostrando todos os produtos":`Mostrando ${f.length} de ${d.length} produtos`})]}),e.jsx(C,{children:ae?e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{className:"h-12 w-full"}),e.jsx(V,{className:"h-12 w-full"}),e.jsx(V,{className:"h-12 w-full"})]}):f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(L,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground text-center mb-4",children:n||p!=="all"?"Nenhum produto encontrado com os filtros aplicados":"Nenhum produto cadastrado"}),!n&&p==="all"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:H,variant:"outline",disabled:v,children:[e.jsx(K,{className:`mr-2 h-4 w-4 ${v?"animate-spin":""}`}),"Sincronizar Shopify"]}),e.jsxs(c,{onClick:()=>{E(),j(!0)},children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Adicionar Primeiro Produto"]})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(pe,{children:[e.jsx(je,{children:e.jsxs(G,{children:[e.jsx(m,{children:"Imagem"}),e.jsx(m,{children:"Produto"}),e.jsx(m,{children:"SKU"}),e.jsx(m,{children:"Preço"}),e.jsx(m,{children:"Estoque"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Ações"})]})}),e.jsx(ge,{children:f.map(s=>{var S,O,U,$;const r=((S=s.metadata)==null?void 0:S.images)||[],N=r.length>0?((O=r[0])==null?void 0:O.src)||r[0]:null;return e.jsxs(G,{children:[e.jsx(h,{children:N?e.jsx("img",{src:N,alt:s.name,className:"w-12 h-12 object-cover rounded-md border"}):e.jsx("div",{className:"w-12 h-12 bg-muted rounded-md flex items-center justify-center",children:e.jsx(L,{className:"h-6 w-6 text-muted-foreground"})})}),e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",children:s.description}),((U=s.metadata)==null?void 0:U.shopifyId)&&e.jsxs(z,{variant:"outline",className:"mt-1",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"Shopify"]})]})}),e.jsx(h,{children:e.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:s.sku||"N/A"})}),e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:F(s.price)}),s.comparePrice&&s.comparePrice>s.price&&e.jsx("div",{className:"text-xs text-muted-foreground line-through",children:F(s.comparePrice)})]})}),e.jsx(h,{children:e.jsxs(z,{variant:s.stock>10?"default":s.stock>0?"warning":"destructive",children:[s.stock," un."]})}),e.jsx(h,{children:e.jsx(z,{variant:s.status==="ACTIVE"?"default":s.status==="DRAFT"?"secondary":"outline",children:s.status==="ACTIVE"?"Ativo":s.status==="DRAFT"?"Rascunho":"Arquivado"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>ce(s),children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>de(s.id),disabled:!!(($=s.metadata)!=null&&$.shopifyId),children:e.jsx(Ie,{className:"h-4 w-4"})})]})})]},s.id)})})]})})})]}),e.jsx(fe,{open:ie,onOpenChange:j,children:e.jsxs(ve,{className:"max-w-2xl",children:[e.jsxs(ye,{children:[e.jsx(Ne,{children:y?"Editar Produto":"Novo Produto"}),e.jsx(Se,{children:y?"Atualize as informações do produto":"Adicione um novo produto ao catálogo"})]}),e.jsxs("form",{onSubmit:ne,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"name",children:"Nome do Produto *"}),e.jsx(g,{id:"name",value:t.name,onChange:s=>l({...t,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"description",children:"Descrição"}),e.jsx(be,{id:"description",value:t.description,onChange:s=>l({...t,description:s.target.value}),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"price",children:"Preço *"}),e.jsx(g,{id:"price",type:"number",step:"0.01",value:t.price,onChange:s=>l({...t,price:parseFloat(s.target.value)}),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"comparePrice",children:"Preço Comparação"}),e.jsx(g,{id:"comparePrice",type:"number",step:"0.01",value:t.comparePrice,onChange:s=>l({...t,comparePrice:parseFloat(s.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"sku",children:"SKU"}),e.jsx(g,{id:"sku",value:t.sku,onChange:s=>l({...t,sku:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"stock",children:"Estoque *"}),e.jsx(g,{id:"stock",type:"number",value:t.stock,onChange:s=>l({...t,stock:parseInt(s.target.value)}),required:!0})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"status",children:"Status"}),e.jsxs(J,{value:t.status,onValueChange:s=>l({...t,status:s}),children:[e.jsx(Q,{children:e.jsx(W,{})}),e.jsxs(X,{children:[e.jsx(x,{value:"ACTIVE",children:"Ativo"}),e.jsx(x,{value:"DRAFT",children:"Rascunho"}),e.jsx(x,{value:"ARCHIVED",children:"Arquivado"})]})]})]})]}),e.jsxs(we,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),e.jsxs(c,{type:"submit",children:[y?"Atualizar":"Criar"," Produto"]})]})]})]})})]})};export{We as default};
