import{c as oe,b as ne,r as c,s as b,j as e,M as k,an as ce,d as F,e as te,f as se,n as S,h as K,B as u,I as P}from"./index-BlhzBD62.js";import{L as C}from"./label-D4RezkQY.js";import{S as U}from"./switch-iEIUiEkV.js";import{D as V,b as W,c as H,d as J,e as Q,f as Y}from"./dialog-C4bJnssC.js";import{A as M,b as de,a as $}from"./alert-riT2SFRN.js";import{S as xe}from"./separator-D5-FpqqJ.js";import{u as me}from"./useOptimizedSelectors--VeW4l3p.js";import{T as ee}from"./target-5zf_M4uJ.js";import{Z as pe}from"./zap-CPuOAH6g.js";import{E as he}from"./eye-B5cn9qGK.js";import{C as ue}from"./chart-column-D7y3W9Qw.js";import{C as ge}from"./circle-check-BtjHD-jd.js";import{E as fe}from"./external-link-BGkOhRwB.js";import{P as ve}from"./plus-N3OQEaO_.js";import{S as je}from"./square-pen-uZpLbmaN.js";import{T as ye}from"./trash-2-BwOz_mdi.js";import"./index-B1RRfdq-.js";import"./x-CJOvJHTG.js";import"./settingsStore-xm40UElp.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=oe("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),Ce=()=>{const{user:r}=me(),{toast:l}=ne(),[g,x]=c.useState([]),[d,p]=c.useState([]),[G,A]=c.useState(!0),[L,I]=c.useState(!1),[q,O]=c.useState(!1),[w,X]=c.useState(!1),j=async()=>{try{const{data:t,error:s}=await b.from("Pixel").select("*").eq("isActive",!0).order("platform");if(s)throw s;x(t||[])}catch(t){console.error("Error fetching pixels:",t),l({title:"Erro ao carregar pixels",description:t.message,variant:"destructive"})}},o=async()=>{if(r!=null&&r.id)try{A(!0);const{data:t,error:s}=await b.from("PixelConfig").select("*").eq("userId",r.id).order("createdAt",{ascending:!1});if(s)throw s;p(t||[])}catch(t){console.error("Error fetching pixel configs:",t),l({title:"Erro ao carregar configura√ß√µes",description:t.message,variant:"destructive"})}finally{A(!1)}},E=async t=>{if(!(r!=null&&r.id))return l({title:"Erro",description:"Usu√°rio n√£o autenticado",variant:"destructive"}),null;try{I(!0);const{data:s,error:n}=await b.from("PixelConfig").insert({userId:r.id,platform:t.platform,pixelId:t.pixelId,name:t.name,accessToken:t.accessToken,isActive:t.isActive??!0,events:t.events||["page_view","add_to_cart","purchase","initiate_checkout"],config:t.config||{}}).select().single();if(n)throw n;return l({title:"Pixel cadastrado!",description:`O pixel ${t.name||t.platform} foi cadastrado com sucesso.`}),await o(),s}catch(s){return console.error("Error creating pixel config:",s),l({title:"Erro ao cadastrar pixel",description:s.message,variant:"destructive"}),null}finally{I(!1)}},N=async(t,s)=>{try{O(!0);const{data:n,error:v}=await b.from("PixelConfig").update({...s,updatedAt:new Date().toISOString()}).eq("id",t).select().single();if(v)throw v;return l({title:"Pixel atualizado!",description:"As configura√ß√µes do pixel foram atualizadas com sucesso."}),await o(),n}catch(n){return console.error("Error updating pixel config:",n),l({title:"Erro ao atualizar pixel",description:n.message,variant:"destructive"}),null}finally{O(!1)}},_=async t=>{try{X(!0);const{error:s}=await b.from("PixelConfig").delete().eq("id",t);if(s)throw s;return l({title:"Pixel removido!",description:"A configura√ß√£o do pixel foi removida com sucesso."}),await o(),!0}catch(s){return console.error("Error deleting pixel config:",s),l({title:"Erro ao remover pixel",description:s.message,variant:"destructive"}),!1}finally{X(!1)}},f=async(t,s)=>{try{const{error:n}=await b.from("PixelConfig").update({isActive:s,updatedAt:new Date().toISOString()}).eq("id",t);if(n)throw n;return l({title:s?"Pixel ativado!":"Pixel desativado!",description:s?"O pixel est√° agora rastreando eventos.":"O pixel foi pausado temporariamente."}),await o(),!0}catch(n){return console.error("Error toggling pixel config:",n),l({title:"Erro ao alterar status",description:n.message,variant:"destructive"}),!1}},B=t=>d.some(s=>s.platform===t),i=t=>d.find(s=>s.platform===t),m=()=>d.filter(t=>t.isActive),y={total:d.length,active:d.filter(t=>t.isActive).length,inactive:d.filter(t=>!t.isActive).length,byPlatform:{facebook:d.filter(t=>t.platform==="FACEBOOK").length,tiktok:d.filter(t=>t.platform==="TIKTOK").length,google:d.filter(t=>t.platform==="GOOGLE_ADS").length}};return c.useEffect(()=>{j()},[]),c.useEffect(()=>{r!=null&&r.id&&o()},[r==null?void 0:r.id]),{pixels:g,pixelConfigs:d,loading:G,creating:L,updating:q,deleting:w,stats:y,createPixelConfig:E,updatePixelConfig:N,deletePixelConfig:_,togglePixelConfig:f,fetchPixelConfigs:o,fetchPixels:j,hasPixelForPlatform:B,getPixelConfigByPlatform:i,getActivePixelConfigs:m}},T={FACEBOOK:{platform:"FACEBOOK",name:"Meta Ads (Facebook/Instagram)",description:"Pixel do Meta para rastreamento de convers√µes no Facebook e Instagram",icon:"üìò",color:"#1877F2",documentation:"https://developers.facebook.com/docs/meta-pixel",requiredFields:["pixelId"],availableEvents:["page_view","add_to_cart","purchase","initiate_checkout","view_content","search","add_payment_info","complete_registration"]},TIKTOK:{platform:"TIKTOK",name:"TikTok Ads",description:"Pixel do TikTok para rastreamento de convers√µes e cria√ß√£o de p√∫blicos",icon:"üéµ",color:"#000000",documentation:"https://ads.tiktok.com/help/article?aid=10000357",requiredFields:["pixelId"],availableEvents:["page_view","add_to_cart","purchase","initiate_checkout","view_content","search","add_payment_info","complete_registration"]},GOOGLE_ADS:{platform:"GOOGLE_ADS",name:"Google Ads",description:"Tag de convers√£o do Google Ads para remarketing e medi√ß√£o",icon:"üîç",color:"#4285F4",documentation:"https://support.google.com/google-ads/answer/6331314",requiredFields:["pixelId"],availableEvents:["page_view","add_to_cart","purchase","begin_checkout","view_item","search","add_payment_info","sign_up"]}},ae=(r,l)=>{switch(r){case"FACEBOOK":return/^\d{15,16}$/.test(l);case"TIKTOK":return/^[A-Z0-9]{15,20}$/.test(l);case"GOOGLE_ADS":return/^AW-\d{9,11}$/.test(l)||/^G-[A-Z0-9]{10}$/.test(l);default:return!1}},D=({title:r,value:l,icon:g,color:x,delay:d=0,subtitle:p})=>e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:d},children:e.jsxs(F,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${x} opacity-10 rounded-full blur-3xl`}),e.jsxs(te,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(se,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:r}),e.jsx("div",{className:`p-2 rounded-lg ${x} bg-opacity-10`,children:e.jsx(g,{className:`h-5 w-5 ${x.replace("bg-","text-")}`})})]}),e.jsxs(K,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:l}),p&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:p})]})]})}),ze=()=>{const{pixelConfigs:r,loading:l,creating:g,updating:x,deleting:d,stats:p,createPixelConfig:G,updatePixelConfig:A,deletePixelConfig:L,togglePixelConfig:I,hasPixelForPlatform:q}=Ce(),[O,w]=c.useState(!1),[X,j]=c.useState(!1),[o,E]=c.useState(null),[N,_]=c.useState(null),[f,B]=c.useState(""),[i,m]=c.useState({platform:"FACEBOOK",pixelId:"",name:"",isActive:!0,events:["page_view","add_to_cart","purchase","initiate_checkout"]}),[y,t]=c.useState(null),s=a=>{E(a),m({platform:a,pixelId:"",name:"",isActive:!0,events:T[a].availableEvents.slice(0,4)}),t(null),w(!0)},n=a=>{_(a),m({platform:a.platform,pixelId:a.pixelId,name:a.name||"",isActive:a.isActive,events:a.events}),t(null),j(!0)},v=()=>{w(!1),j(!1),E(null),_(null),t(null)},ie=async()=>{if(!ae(i.platform,i.pixelId)){t("ID de pixel inv√°lido para esta plataforma. Verifique o formato correto.");return}await G(i)&&v()},re=async()=>{if(!N)return;if(i.pixelId&&i.pixelId!==N.pixelId&&!ae(i.platform,i.pixelId)){t("ID de pixel inv√°lido para esta plataforma. Verifique o formato correto.");return}await A(N.id,{pixelId:i.pixelId,name:i.name,isActive:i.isActive,events:i.events})&&v()},le=async a=>{window.confirm("Tem certeza que deseja remover este pixel? Esta a√ß√£o n√£o pode ser desfeita.")&&await L(a)},R=r.filter(a=>{var h;return a.pixelId.toLowerCase().includes(f.toLowerCase())||((h=a.name)==null?void 0:h.toLowerCase().includes(f.toLowerCase()))||a.platform.toLowerCase().includes(f.toLowerCase())});return l?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Carregando pixels..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(k.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600 bg-clip-text text-transparent",children:"Pixels de Rastreamento"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mt-2",children:"Gerencie seus pixels do Meta, TikTok e Google Ads integrados com sua Shopify"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-4",children:[e.jsx(D,{title:"Total de Pixels",value:p.total,icon:ee,color:"bg-indigo-500",delay:.1,subtitle:"Pixels configurados"}),e.jsx(D,{title:"Pixels Ativos",value:p.active,icon:pe,color:"bg-green-500",delay:.2,subtitle:"Rastreando eventos"}),e.jsx(D,{title:"Pixels Inativos",value:p.inactive,icon:he,color:"bg-gray-500",delay:.3,subtitle:"Pausados"}),e.jsx(D,{title:"Plataformas",value:3,icon:ue,color:"bg-purple-500",delay:.4,subtitle:"Meta, TikTok, Google"})]}),e.jsxs(M,{children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(de,{children:"Integra√ß√£o com Shopify"}),e.jsx($,{children:"Os pixels cadastrados aqui ser√£o automaticamente integrados ao seu checkout da Shopify para rastreamento de convers√µes."})]}),e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:"Plataformas Dispon√≠veis"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:Object.values(T).map(a=>{const h=q(a.platform);return e.jsxs(F,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(te,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-2xl",style:{backgroundColor:a.color+"20"},children:a.icon}),e.jsxs("div",{children:[e.jsx(se,{className:"text-lg",children:a.name}),h&&e.jsxs(S,{variant:"secondary",className:"mt-1",children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"Configurado"]})]})]})})}),e.jsxs(K,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("a",{href:a.documentation,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3"}),"Documenta√ß√£o"]}),e.jsxs(u,{size:"sm",onClick:()=>s(a.platform),disabled:g,variant:h?"outline":"default",children:[e.jsx(ve,{className:"w-4 h-4 mr-1"}),h?"Adicionar Outro":"Cadastrar Pixel"]})]})]})]},a.platform)})})]}),e.jsx(xe,{}),e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:"Pixels Cadastrados"}),e.jsx(P,{type:"text",placeholder:"Buscar pixels...",value:f,onChange:a=>B(a.target.value),className:"max-w-xs border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg"})]}),R.length===0?e.jsx(F,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:e.jsxs(K,{className:"py-12 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 mb-4 mx-auto w-fit",children:e.jsx(ee,{className:"w-12 h-12 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum pixel cadastrado"}),e.jsx("p",{className:"text-muted-foreground mb-4 max-w-md mx-auto",children:f?"Nenhum pixel encontrado com esse filtro.":"Cadastre seu primeiro pixel para come√ßar a rastrear convers√µes e otimizar suas campanhas."})]})}):e.jsx("div",{className:"space-y-4",children:R.map((a,h)=>{const z=T[a.platform];return e.jsx(k.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:h*.05},children:e.jsx(F,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:e.jsx(K,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-xl flex-shrink-0",style:{backgroundColor:z.color+"20"},children:z.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:a.name||z.name}),e.jsx(S,{variant:a.isActive?"default":"secondary",children:a.isActive?"Ativo":"Inativo"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Pixel ID: ",a.pixelId]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.events.slice(0,4).map(Z=>e.jsx(S,{variant:"outline",className:"text-xs",children:Z},Z)),a.events.length>4&&e.jsxs(S,{variant:"outline",className:"text-xs",children:["+",a.events.length-4]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{size:"icon",variant:"ghost",onClick:()=>I(a.id,!a.isActive),disabled:x,className:"hover:bg-green-50 hover:text-green-600 dark:hover:bg-green-950",children:e.jsx(be,{className:`w-4 h-4 ${a.isActive?"text-green-600":"text-gray-400"}`})}),e.jsx(u,{size:"icon",variant:"ghost",onClick:()=>n(a),disabled:x,className:"hover:bg-blue-50 hover:text-blue-600 dark:hover:bg-blue-950",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx(u,{size:"icon",variant:"ghost",onClick:()=>le(a.id),disabled:d,className:"hover:bg-red-50 hover:text-red-600 dark:hover:bg-red-950",children:e.jsx(ye,{className:"w-4 h-4"})})]})]})})})},a.id)})})]}),e.jsx(V,{open:O,onOpenChange:w,children:e.jsxs(W,{children:[e.jsxs(H,{children:[e.jsxs(J,{children:["Cadastrar Pixel"," ",o&&T[o].name]}),e.jsx(Q,{children:"Configure um novo pixel para rastrear convers√µes na sua loja Shopify."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"pixelId",children:["Pixel ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(P,{id:"pixelId",placeholder:o==="FACEBOOK"?"1234567890123456":o==="TIKTOK"?"CXXXXXXXXXXXXXXXXX":"AW-1234567890 ou G-XXXXXXXXXX",value:i.pixelId,onChange:a=>m({...i,pixelId:a.target.value})}),o&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Formato esperado:"," ",o==="FACEBOOK"&&"15-16 d√≠gitos",o==="TIKTOK"&&"C√≥digo alfanum√©rico de 15-20 caracteres",o==="GOOGLE_ADS"&&"AW-XXXXXXXXXX ou G-XXXXXXXXXX"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"name",children:"Nome (Opcional)"}),e.jsx(P,{id:"name",placeholder:"Ex: Pixel Principal, Pixel de Remarketing...",value:i.name,onChange:a=>m({...i,name:a.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{id:"isActive",checked:i.isActive,onCheckedChange:a=>m({...i,isActive:a})}),e.jsx(C,{htmlFor:"isActive",children:"Ativar pixel imediatamente"})]}),y&&e.jsx(M,{variant:"destructive",children:e.jsx($,{children:y})})]}),e.jsxs(Y,{children:[e.jsx(u,{variant:"outline",onClick:v,children:"Cancelar"}),e.jsx(u,{onClick:ie,disabled:g||!i.pixelId,children:g?"Cadastrando...":"Cadastrar Pixel"})]})]})}),e.jsx(V,{open:X,onOpenChange:j,children:e.jsxs(W,{children:[e.jsxs(H,{children:[e.jsx(J,{children:"Editar Pixel"}),e.jsx(Q,{children:"Atualize as configura√ß√µes do seu pixel."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"edit-pixelId",children:"Pixel ID"}),e.jsx(P,{id:"edit-pixelId",value:i.pixelId,onChange:a=>m({...i,pixelId:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"edit-name",children:"Nome"}),e.jsx(P,{id:"edit-name",placeholder:"Nome do pixel",value:i.name,onChange:a=>m({...i,name:a.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{id:"edit-isActive",checked:i.isActive,onCheckedChange:a=>m({...i,isActive:a})}),e.jsx(C,{htmlFor:"edit-isActive",children:"Pixel ativo"})]}),y&&e.jsx(M,{variant:"destructive",children:e.jsx($,{children:y})})]}),e.jsxs(Y,{children:[e.jsx(u,{variant:"outline",onClick:v,children:"Cancelar"}),e.jsx(u,{onClick:re,disabled:x,children:x?"Salvando...":"Salvar Altera√ß√µes"})]})]})})]})};export{ze as default};
