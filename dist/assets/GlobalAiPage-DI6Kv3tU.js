import{r as d,d as $,s as m,j as e,B as n,I as v,C as I,e as V,f as W,n as Q,g as Y,h as E}from"./index-89ZtezY2.js";import{D as w,a as _,b as O,c as T,d as P,e as G,f as R}from"./dialog-CR0Q-Fiq.js";import{L as p}from"./label-CwItJBRK.js";import{T as J}from"./textarea-BhN-cWRx.js";import{S as Z,a as ee,b as ae,c as se,d as c}from"./select-YgYbYyjO.js";import{S}from"./SuperAdminLayout-DPbWayit.js";import"./index-Coe4DC2d.js";function de(){var A,C;const[N,y]=d.useState([]),[U,k]=d.useState(!0),[D,j]=d.useState(!1),[L,f]=d.useState(!1),[i,h]=d.useState(null),{toast:o}=$(),[r,x]=d.useState({name:"",provider:"OPENAI",apiKey:"",baseUrl:"",model:"",maxTokens:4096,temperature:.7});d.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:a,error:s}=await m.from("GlobalAiConnection").select("*").order("createdAt",{ascending:!1});if(s)throw s;y(a||[])}catch(a){o({title:"Erro ao carregar dados",description:a.message,variant:"destructive"})}finally{k(!1)}},K=async()=>{try{const{data:{user:a},error:s}=await m.auth.getUser();if(s||!a)throw new Error("Voc√™ precisa estar autenticado. Fa√ßa login novamente.");console.log("‚úÖ Usu√°rio autenticado:",a.id,a.email);const{error:t}=await m.from("GlobalAiConnection").insert({name:r.name,provider:r.provider,apiKey:r.apiKey,baseUrl:r.baseUrl||null,model:r.model||null,maxTokens:r.maxTokens,temperature:r.temperature,isActive:!0});if(t)throw console.error("‚ùå Erro RLS:",t),t;o({title:"‚úÖ IA adicionada!",description:`${r.name} foi criada com sucesso.`}),j(!1),g(),x({name:"",provider:"OPENAI",apiKey:"",baseUrl:"",model:"",maxTokens:4096,temperature:.7})}catch(a){o({title:"Erro ao criar IA",description:a.message,variant:"destructive"})}},F=async(a,s)=>{try{const{error:t}=await m.from("GlobalAiConnection").update({isActive:!s}).eq("id",a);if(t)throw t;o({title:"Status atualizado",description:`IA ${s?"desativada":"ativada"}.`}),g()}catch(t){o({title:"Erro ao atualizar status",description:t.message,variant:"destructive"})}},M=async a=>{try{if(!a.apiKey||a.apiKey.length<10)throw new Error("API Key inv√°lida ou muito curta");o({title:"üß™ Validando configura√ß√£o...",description:`Verificando ${a.provider}`});const{error:s}=await m.from("GlobalAiConnection").update({isActive:!0}).eq("id",a.id);if(s)throw s;y(t=>t.map(l=>l.id===a.id?{...l,isActive:!0}:l)),o({title:"‚úÖ Configura√ß√£o v√°lida!",description:`${a.provider} configurada e ativada. Teste no chat para confirmar funcionamento.`})}catch(s){console.error("Valida√ß√£o falhou:",s),o({title:"‚ùå Erro na valida√ß√£o",description:s.message,variant:"destructive"})}},z=async(a,s)=>{if(confirm(`Tem certeza que deseja remover "${s}"?

Esta a√ß√£o n√£o pode ser desfeita.`))try{const{error:t}=await m.from("GlobalAiConnection").delete().eq("id",a);if(t)throw t;o({title:"üóëÔ∏è IA removida!",description:`${s} foi removida com sucesso.`}),g()}catch(t){o({title:"Erro ao remover IA",description:t.message,variant:"destructive"})}},H=a=>{h(a),f(!0)},q=async()=>{if(i)try{const{error:a}=await m.from("GlobalAiConnection").update({systemPrompt:i.systemPrompt,initialGreetings:i.initialGreetings}).eq("id",i.id);if(a)throw a;o({title:"‚úÖ Configura√ß√£o salva!",description:"Prompt e mensagens iniciais atualizados."}),f(!1),g()}catch(a){o({title:"Erro ao salvar configura√ß√£o",description:a.message,variant:"destructive"})}},B=a=>{const s={OPENAI:"bg-green-100 text-green-800",ANTHROPIC:"bg-orange-100 text-orange-800",GOOGLE:"bg-blue-100 text-blue-800",OPENROUTER:"bg-indigo-100 text-indigo-800",GROQ:"bg-red-100 text-red-800",COHERE:"bg-purple-100 text-purple-800",MISTRAL:"bg-amber-100 text-amber-800",PERPLEXITY:"bg-cyan-100 text-cyan-800",TOGETHER:"bg-pink-100 text-pink-800",FIREWORKS:"bg-yellow-100 text-yellow-800"};return e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s[a]||"bg-gray-100 text-gray-800"}`,children:a})},u={OPENAI:{model:"gpt-4o-mini",baseUrl:"https://api.openai.com/v1",description:"GPT-4, GPT-3.5, DALL-E, Whisper"},ANTHROPIC:{model:"claude-3-5-sonnet-20241022",baseUrl:"https://api.anthropic.com/v1",description:"Claude 3.5 Sonnet, Claude 3 Opus"},GOOGLE:{model:"gemini-2.0-flash-exp",baseUrl:"https://generativelanguage.googleapis.com/v1",description:"Gemini Pro, Gemini Flash"},OPENROUTER:{model:"openai/gpt-4-turbo",baseUrl:"https://openrouter.ai/api/v1",description:"Acesso a 200+ modelos (OpenAI, Anthropic, Google, Meta, etc)"},GROQ:{model:"llama-3.3-70b-versatile",baseUrl:"https://api.groq.com/openai/v1",description:"Llama 3.3, Mixtral - Ultra r√°pido"},COHERE:{model:"command-r-plus",baseUrl:"https://api.cohere.ai/v1",description:"Command R+, Command R"},MISTRAL:{model:"mistral-large-latest",baseUrl:"https://api.mistral.ai/v1",description:"Mistral Large, Mistral Medium"},PERPLEXITY:{model:"llama-3.1-sonar-large-128k-online",baseUrl:"https://api.perplexity.ai",description:"Sonar Online - IA com busca web"},TOGETHER:{model:"meta-llama/Meta-Llama-3.1-405B-Instruct-Turbo",baseUrl:"https://api.together.xyz/v1",description:"Llama, Qwen, DeepSeek"},FIREWORKS:{model:"accounts/fireworks/models/llama-v3p1-405b-instruct",baseUrl:"https://api.fireworks.ai/inference/v1",description:"Modelos open source otimizados"}};return U?e.jsx(S,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-76px)]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})})}):e.jsx(S,{children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Conex√µes de IA Globais"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Adicionar e gerenciar IAs que ser√£o atribu√≠das √†s organiza√ß√µes"})]}),e.jsxs(w,{open:D,onOpenChange:j,children:[e.jsx(_,{asChild:!0,children:e.jsxs(n,{children:[e.jsx(Plus,{className:"h-4 w-4 mr-2"}),"Nova IA"]})}),e.jsxs(O,{className:"sm:max-w-[500px]",children:[e.jsxs(T,{children:[e.jsx(P,{children:"Nova Conex√£o de IA"}),e.jsx(G,{children:"Adicionar uma nova IA global ao sistema"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"name",children:"Nome"}),e.jsx(v,{id:"name",placeholder:"OpenAI GPT-4",value:r.name,onChange:a=>x({...r,name:a.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"provider",children:"Provider"}),e.jsxs(Z,{value:r.provider,onValueChange:a=>{const s=u[a];x({...r,provider:a,model:(s==null?void 0:s.model)||"",baseUrl:(s==null?void 0:s.baseUrl)||""})},children:[e.jsx(ee,{children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(c,{value:"OPENAI",children:"ü§ñ OpenAI"}),e.jsx(c,{value:"ANTHROPIC",children:"üß† Anthropic (Claude)"}),e.jsx(c,{value:"GOOGLE",children:"üîµ Google (Gemini)"}),e.jsx(c,{value:"OPENROUTER",children:"üåê OpenRouter (200+ modelos)"}),e.jsx(c,{value:"GROQ",children:"‚ö° Groq (Ultra r√°pido)"}),e.jsx(c,{value:"MISTRAL",children:"üá´üá∑ Mistral AI"}),e.jsx(c,{value:"COHERE",children:"üíú Cohere"}),e.jsx(c,{value:"PERPLEXITY",children:"üîç Perplexity (Web)"}),e.jsx(c,{value:"TOGETHER",children:"ü§ù Together AI"}),e.jsx(c,{value:"FIREWORKS",children:"üéÜ Fireworks AI"})]})]}),u[r.provider]&&e.jsx("p",{className:"text-xs text-gray-500",children:u[r.provider].description})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"apiKey",children:"API Key"}),e.jsx(v,{id:"apiKey",type:"password",placeholder:"sk-...",value:r.apiKey,onChange:a=>x({...r,apiKey:a.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"model",children:"Modelo"}),e.jsx(v,{id:"model",placeholder:((A=u[r.provider])==null?void 0:A.model)||"gpt-4-turbo",value:r.model,onChange:a=>x({...r,model:a.target.value})}),e.jsx("p",{className:"text-xs text-gray-500",children:r.provider==="OPENROUTER"?"Formato: provider/model (ex: openai/gpt-4-turbo, anthropic/claude-3-5-sonnet)":"Nome do modelo a ser usado"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"baseUrl",children:"Base URL"}),e.jsx(v,{id:"baseUrl",placeholder:((C=u[r.provider])==null?void 0:C.baseUrl)||"https://api.openai.com/v1",value:r.baseUrl,onChange:a=>x({...r,baseUrl:a.target.value})}),e.jsx("p",{className:"text-xs text-gray-500",children:"URL da API do provider"})]})]}),e.jsxs(R,{children:[e.jsx(n,{variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),e.jsx(n,{onClick:K,children:"Criar IA"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 mt-6",children:[N.map(a=>e.jsxs(I,{className:"bg-white border-gray-200",children:[e.jsx(V,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-purple-50 p-3 rounded-lg",children:e.jsx(Bot,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{children:a.name}),a.isActive&&e.jsx(Q,{className:"bg-green-500",children:"‚úì Testada"})]}),e.jsxs(Y,{className:"mt-1 flex items-center gap-2",children:[B(a.provider),a.model&&e.jsxs("span",{className:"text-sm",children:["‚Ä¢ ",a.model]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>H(a),title:"Configurar prompt e mensagens",children:[e.jsx(Settings2,{className:"h-4 w-4 mr-2"}),"Configurar"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>M(a),title:"Testar conex√£o com a IA",children:[e.jsx(TestTube2,{className:"h-4 w-4 mr-2"}),"Testar"]}),e.jsx(n,{size:"sm",variant:a.isActive?"outline":"default",onClick:()=>F(a.id,a.isActive),children:a.isActive?"Desativar":"Ativar"}),e.jsx(n,{size:"sm",variant:"destructive",onClick:()=>z(a.id,a.name),title:"Remover IA",children:e.jsx(Trash2,{className:"h-4 w-4"})})]})]})}),e.jsx(E,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"API Key"}),e.jsxs("div",{className:"font-mono text-xs mt-1",children:[a.apiKey.substring(0,10),"..."]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Max Tokens"}),e.jsx("div",{className:"font-medium mt-1",children:a.maxTokens})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Temperature"}),e.jsx("div",{className:"font-medium mt-1",children:a.temperature})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Criada em"}),e.jsx("div",{className:"font-medium mt-1",children:new Date(a.createdAt).toLocaleDateString("pt-BR")})]})]})})]},a.id)),N.length===0&&e.jsx(I,{children:e.jsxs(E,{className:"py-12 text-center",children:[e.jsx(Bot,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Nenhuma IA configurada"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Adicione sua primeira conex√£o de IA para come√ßar"}),e.jsxs(n,{onClick:()=>j(!0),children:[e.jsx(Plus,{className:"h-4 w-4 mr-2"}),"Adicionar IA"]})]})})]}),e.jsx(w,{open:L,onOpenChange:f,children:e.jsxs(O,{className:"sm:max-w-[700px] max-h-[80vh] overflow-y-auto",children:[e.jsxs(T,{children:[e.jsxs(P,{children:["Configurar IA: ",i==null?void 0:i.name]}),e.jsx(G,{children:"Configure o prompt de sistema e mensagens iniciais da IA"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"systemPrompt",children:"Prompt de Sistema"}),e.jsx(J,{id:"systemPrompt",value:(i==null?void 0:i.systemPrompt)||"",onChange:a=>h(s=>s?{...s,systemPrompt:a.target.value}:null),rows:12,className:"font-mono text-sm",placeholder:"Digite o prompt de sistema que define o comportamento da IA..."}),e.jsx("p",{className:"text-xs text-gray-500",children:"Este prompt define a personalidade, capacidades e comportamento da IA. Seja espec√≠fico sobre o que a IA pode fazer."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Mensagens Iniciais"}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>{const a=[...(i==null?void 0:i.initialGreetings)||[],"Nova mensagem inicial"];h(s=>s?{...s,initialGreetings:a}:null)},children:[e.jsx(Plus,{className:"h-4 w-4 mr-1"}),"Adicionar"]})]}),e.jsx("div",{className:"space-y-2",children:((i==null?void 0:i.initialGreetings)||[]).map((a,s)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{value:a,onChange:t=>{const l=[...(i==null?void 0:i.initialGreetings)||[]];l[s]=t.target.value,h(b=>b?{...b,initialGreetings:l}:null)},placeholder:`Mensagem inicial ${s+1}`}),e.jsx(n,{size:"icon",variant:"ghost",onClick:()=>{const t=((i==null?void 0:i.initialGreetings)||[]).filter((l,b)=>b!==s);h(l=>l?{...l,initialGreetings:t}:null)},children:e.jsx(X,{className:"h-4 w-4"})})]},s))}),e.jsx("p",{className:"text-xs text-gray-500",children:"A IA escolher√° aleatoriamente uma dessas mensagens para saudar novos usu√°rios."})]})]}),e.jsxs(R,{children:[e.jsx(n,{variant:"outline",onClick:()=>f(!1),children:"Cancelar"}),e.jsx(n,{onClick:q,children:"Salvar Configura√ß√£o"})]})]})})]})})}export{de as default};
