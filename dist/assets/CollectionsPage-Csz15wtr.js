import{c as K,s as x,r as u,d as Q,a as W,j as e,B as f,I as k,C as A,e as I,f as D,h as T,N as E,S as X,n as Y}from"./index-BpgP6qTW.js";import{T as Z,a as _,b as ee,c as b,d as re,e as v}from"./table-CUMwv-bd.js";import{D as te,a as ae,b as se,c as oe,d as ie,f as le}from"./dialog-M5jkG9Rw.js";import{L as N}from"./label-Bn_SoVD1.js";import{T as ne}from"./textarea-DPAAG8T4.js";import{p as P}from"./productsApi-BYSf0XkF.js";import{S as O}from"./skeleton-t1k4h4KY.js";import{P as F}from"./plus-CppycZcY.js";import{P as de}from"./package-Bl_K9hFP.js";import{S as ce}from"./square-pen-CZtaAIw-.js";import{T as ue}from"./trash-2-k3ErfRlj.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=K("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),he={async listFromShopify(i,a){try{let o=x.from("ShopifyCollection").select("*").eq("userId",i).order("updatedAt",{ascending:!1});(a==null?void 0:a.published)!==void 0&&(o=o.eq("published",a.published)),a!=null&&a.search&&(o=o.or(`title.ilike.%${a.search}%,handle.ilike.%${a.search}%`));const{data:t,error:l}=await o;if(l)throw l;return(t||[]).map(s=>{var c;return{id:String(s.id),userId:s.userId,name:s.title,slug:s.handle,description:s.description||s.bodyHtml,imageUrl:((c=s.image)==null?void 0:c.src)||null,productsCount:s.productsCount||0,published:s.published,metadata:{shopifyId:s.id,shopifyData:s.shopifyData,sortOrder:s.sortOrder,publishedScope:s.publishedScope,image:s.image},createdAt:s.createdAt,updatedAt:s.updatedAt}})}catch(o){throw console.error("Error listing Shopify collections:",o),o}},async getById(i,a){var o;try{const{data:t,error:l}=await x.from("ShopifyCollection").select("*").eq("userId",i).eq("id",a).single();return l?(console.error("Error getting Shopify collection:",l),null):t?{id:String(t.id),userId:t.userId,name:t.title,slug:t.handle,description:t.description||t.bodyHtml,imageUrl:((o=t.image)==null?void 0:o.src)||null,productsCount:t.productsCount||0,published:t.published,metadata:{shopifyId:t.id,shopifyData:t.shopifyData,sortOrder:t.sortOrder,publishedScope:t.publishedScope,image:t.image},createdAt:t.createdAt,updatedAt:t.updatedAt}:null}catch(t){return console.error("Error getting Shopify collection:",t),null}},async getCollectionProducts(i,a){var o,t;try{const{data:l,error:s}=await x.from("ShopifyCollection").select("shopifyData").eq("userId",i).eq("id",a).single();if(s||!l)return console.error("Collection not found"),[];const c=((t=(o=l.shopifyData)==null?void 0:o.products)==null?void 0:t.map(S=>S.id))||[];if(c.length===0)return[];const{data:C,error:h}=await x.from("ShopifyProduct").select("*").eq("userId",i).in("id",c);if(h)throw h;return C||[]}catch(l){return console.error("Error getting collection products:",l),[]}},async count(i){try{const{count:a,error:o}=await x.from("ShopifyCollection").select("*",{count:"exact",head:!0}).eq("userId",i);if(o)throw o;return a||0}catch(a){return console.error("Error counting Shopify collections:",a),0}},async getStats(i){try{const{data:a,error:o}=await x.from("ShopifyCollection").select("published, productsCount").eq("userId",i);if(o)throw o;const t=(a==null?void 0:a.length)||0,l=(a==null?void 0:a.filter(c=>c.published).length)||0,s=(a==null?void 0:a.reduce((c,C)=>c+(C.productsCount||0),0))||0;return{total:t,published:l,draft:t-l,totalProducts:s,averageProducts:t>0?Math.round(s/t):0}}catch(a){return console.error("Error getting collection stats:",a),{total:0,published:0,draft:0,totalProducts:0,averageProducts:0}}}},Se=()=>{const[i,a]=u.useState([]),[o,t]=u.useState([]),[l,s]=u.useState(!0),[c,C]=u.useState(!1),[h,S]=u.useState(""),[B,y]=u.useState(!1),[j,q]=u.useState(null),{toast:g}=Q(),n=W(r=>r.user),[d,p]=u.useState({name:"",slug:"",description:"",isActive:!0});u.useEffect(()=>{n!=null&&n.id&&w()},[n==null?void 0:n.id]),u.useEffect(()=>{R()},[h,i]);const w=async()=>{if(!(n!=null&&n.id)){s(!1);return}try{s(!0);const r=await he.listFromShopify(n.id);a(r),t(r)}catch(r){console.error("Erro ao carregar coleções:",r),g({title:"Erro ao carregar coleções",description:r.message,variant:"destructive"})}finally{s(!1)}},R=()=>{if(!h){t(i);return}const r=i.filter(m=>m.name.toLowerCase().includes(h.toLowerCase())||m.slug.toLowerCase().includes(h.toLowerCase()));t(r)},U=r=>r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),$=r=>{p({...d,name:r,slug:j?d.slug:U(r)})},M=async r=>{r.preventDefault();try{if(!(n!=null&&n.organizationId))return;j?(await P.collections.update(j.id,d),g({title:"Coleção atualizada!"})):(await P.collections.create({...d,organizationId:n.organizationId}),g({title:"Coleção criada!",description:"A coleção está pronta para receber produtos."})),y(!1),z(),w()}catch(m){g({title:"Erro",description:m.message,variant:"destructive"})}},V=async r=>{if(confirm("Tem certeza que deseja deletar esta coleção?"))try{await P.collections.delete(r),g({title:"Coleção deletada"}),w()}catch(m){g({title:"Erro ao deletar",description:m.message,variant:"destructive"})}},G=r=>{q(r),p({name:r.name,slug:r.slug,description:r.description||"",isActive:r.isActive}),y(!0)},z=()=>{q(null),p({name:"",slug:"",description:"",isActive:!0})},J=i.filter(r=>r.isActive).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Coleções de Produtos"}),e.jsx("p",{className:"text-muted-foreground",children:"Organize seus produtos em coleções"})]}),e.jsxs(te,{open:B,onOpenChange:y,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(f,{onClick:z,children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Criar Coleção"]})}),e.jsxs(se,{children:[e.jsx(oe,{children:e.jsx(ie,{children:j?"Editar Coleção":"Nova Coleção"})}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Nome da Coleção"}),e.jsx(k,{value:d.name,onChange:r=>$(r.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Slug (URL)"}),e.jsx(k,{value:d.slug,onChange:r=>p({...d,slug:r.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Descrição"}),e.jsx(ne,{value:d.description,onChange:r=>p({...d,description:r.target.value})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d.isActive,onChange:r=>p({...d,isActive:r.target.checked})}),e.jsx(N,{children:"Ativa"})]})]}),e.jsxs(le,{className:"mt-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>y(!1),children:"Cancelar"}),e.jsx(f,{type:"submit",children:j?"Atualizar":"Criar"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(A,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Total de Coleções"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl font-bold",children:i.length})})]}),e.jsxs(A,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Coleções Ativas"}),e.jsx(de,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl font-bold",children:J})})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(k,{placeholder:"Buscar coleções...",value:h,onChange:r=>S(r.target.value),className:"pl-9 border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm dark:text-white dark:placeholder:text-gray-500"})]}),e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},children:e.jsxs(A,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsx(I,{children:e.jsx(D,{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-fuchsia-600 bg-clip-text text-transparent",children:"Lista de Coleções"})}),e.jsx(T,{children:l?e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"h-12 w-full"}),e.jsx(O,{className:"h-12 w-full"})]}):o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"h-12 w-12 text-muted-foreground mb-4 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhuma coleção encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Comece criando a primeira coleção"}),e.jsxs(f,{onClick:()=>y(!0),children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Criar Primeira Coleção"]})]}):e.jsx("div",{className:"rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:e.jsxs(Z,{children:[e.jsx(_,{children:e.jsxs(ee,{className:"bg-gradient-to-r from-indigo-50 to-fuchsia-50 dark:from-gray-800 dark:to-gray-800 hover:from-indigo-100 hover:to-fuchsia-100 dark:hover:from-gray-700 dark:hover:to-gray-700",children:[e.jsx(b,{className:"font-semibold dark:text-gray-300",children:"Nome"}),e.jsx(b,{className:"font-semibold dark:text-gray-300",children:"Slug"}),e.jsx(b,{className:"font-semibold dark:text-gray-300",children:"Produtos"}),e.jsx(b,{className:"font-semibold dark:text-gray-300",children:"Status"}),e.jsx(b,{className:"text-right font-semibold dark:text-gray-300",children:"Ações"})]})}),e.jsx(re,{children:o.map((r,m)=>{var L;return e.jsxs(E.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:m*.05},className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gradient-to-r hover:from-indigo-50/50 hover:to-fuchsia-50/50 dark:hover:from-gray-800/50 dark:hover:to-gray-800/50 transition-all duration-200",children:[e.jsx(v,{className:"font-medium",children:r.name}),e.jsx(v,{className:"text-sm text-muted-foreground",children:r.slug}),e.jsxs(v,{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:r.productCount||0}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"produtos"})]}),e.jsx(v,{children:e.jsx(Y,{variant:r.isActive?"default":"secondary",children:r.isActive?"Ativa":"Inativa"})}),e.jsx(v,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>G(r),className:"hover:bg-gradient-to-r hover:from-indigo-50 hover:to-violet-50 dark:hover:from-gray-800 dark:hover:to-gray-800",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>V(r.id),disabled:!!((L=r.metadata)!=null&&L.shopifyId),className:"hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400 disabled:opacity-50",children:e.jsx(ue,{className:"h-4 w-4"})})]})})]},r.id)})})]})})})]})})]})};export{Se as default};
