import{s as c,c as Z,r as u,b as ee,u as se,j as e,d as j,e as D,f as E,h as N,S as te,I as ae,B as R,a6 as re,o as F,_ as T}from"./index-C14FxL5X.js";import{S as le,a as de,b as ie,c as ne,d as g}from"./select-DFqVoMCh.js";import{s as oe}from"./shopifySync-DtxVvPM3.js";import{S as I}from"./skeleton-D1zU9U_J.js";import{D as ce,a as me,b as xe,c as ue,d as he,e as fe}from"./dialog-BccfhY2b.js";import{S as M}from"./shopping-cart-BAvfKas7.js";import{P as pe}from"./package-J0yViNqz.js";import{D as ge}from"./dollar-sign-B62SaG22.js";import{M as q}from"./mail-C_PiNCm0.js";import{C as B}from"./calendar-BJ4CTpRZ.js";import{E as je}from"./eye--TUpuoJr.js";import{P as Ne}from"./phone-DXCAQ9At.js";import{S as be}from"./shopping-bag-CPn6hgT4.js";import{M as ye}from"./map-pin-bQfMhqE-.js";import{f as z,p as H}from"./pt-BR-BQ5kKd2v.js";import"./index-Ca1HAPI1.js";import"./x-KmGBjaf8.js";import"./constructFrom-rJN6zrQ_.js";const G={async getAll(a){const{data:d,error:l}=await c.from("Order").select(`
        *,
        items:OrderItem(*),
        history:OrderHistory(*)
      `).eq("userId",a).order("createdAt",{ascending:!1});if(l)throw l;return d},async getById(a){const{data:d,error:l}=await c.from("Order").select(`
        *,
        items:OrderItem(*),
        history:OrderHistory(*)
      `).eq("id",a).single();if(l)throw l;return d},async getByCustomer(a){const{data:d,error:l}=await c.from("Order").select(`
        *,
        items:OrderItem(*)
      `).eq("customerId",a).order("createdAt",{ascending:!1});if(l)throw l;return d},async create(a){const{data:d,error:l}=await c.from("Order").insert(a).select().single();if(l)throw l;return d},async update(a,d){const{data:l,error:n}=await c.from("Order").update({...d,updatedAt:new Date().toISOString()}).eq("id",a).select().single();if(n)throw n;return l},async updatePaymentStatus(a,d,l){const n={paymentStatus:d};l&&(n.paidAt=l);const{data:h,error:f}=await c.from("Order").update(n).eq("id",a).select().single();if(f)throw f;return h},async updateFulfillmentStatus(a,d,l){const n={fulfillmentStatus:d,...l},{data:h,error:f}=await c.from("Order").update(n).eq("id",a).select().single();if(f)throw f;return h},async cancel(a,d){const l={paymentStatus:"CANCELLED",fulfillmentStatus:"CANCELLED",cancelledAt:new Date().toISOString()},{data:n,error:h}=await c.from("Order").update(l).eq("id",a).select().single();if(h)throw h;return n&&await G.addHistory(a,"ORDER_CANCELLED",d||"Order cancelled"),n},async delete(a){const{error:d}=await c.from("Order").delete().eq("id",a);if(d)throw d}};/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=Z("PackageX",[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["path",{d:"m17 13 5 5m-5 0 5-5",key:"im3w4b"}]]),He=()=>{const[a,d]=u.useState([]),[l,n]=u.useState([]),[h,f]=u.useState(!0),[C,O]=u.useState(!1),[p,V]=u.useState(""),[b,_]=u.useState("all"),[r,U]=u.useState(null),{toast:y}=ee(),m=se(s=>s.user);u.useEffect(()=>{k()},[]),u.useEffect(()=>{K()},[p,b,a]);const k=async()=>{try{if(!(m!=null&&m.id))return;const s=await G.getAll(m.id),{data:i}=await c.from("ShopifyOrder").select("*").eq("userId",m.id).order("createdAt",{ascending:!1}),v=(i||[]).map(t=>{var S,A,P,L;return{id:t.id.toString(),userId:t.userId,orderNumber:((S=t.orderNumber)==null?void 0:S.toString())||t.id.toString(),customerId:((A=t.customerData)==null?void 0:A.id)||"shopify-customer",cartId:void 0,customerEmail:t.email||"",customerName:t.name||((P=t.customerData)==null?void 0:P.first_name)+" "+((L=t.customerData)==null?void 0:L.last_name)||"Cliente",customerPhone:t.phone,shippingAddress:t.shippingAddress||{},billingAddress:t.billingAddress||{},items:t.lineItems||{},subtotal:parseFloat(t.subtotalPrice||0),discount:0,shipping:0,tax:parseFloat(t.totalTax||0),total:parseFloat(t.totalPrice||0),currency:t.currency||"BRL",paymentMethod:"CREDIT_CARD",paymentStatus:t.financialStatus==="paid"?"PAID":t.financialStatus==="pending"?"PENDING":"FAILED",fulfillmentStatus:t.fulfillmentStatus==="fulfilled"?"DELIVERED":"PENDING",createdAt:t.createdAt,updatedAt:t.updatedAt}}),w=[...s,...v].filter((t,S,A)=>S===A.findIndex(P=>P.orderNumber===t.orderNumber));d(w),n(w)}catch(s){console.error("Erro ao carregar pedidos:",s),y({title:"Erro ao carregar pedidos",description:s.message,variant:"destructive"})}finally{f(!1)}},X=async()=>{try{if(O(!0),y({title:"Sincronizando com Shopify..."}),!(m!=null&&m.id))return;await oe.syncOrders(m.id),y({title:"✅ Pedidos sincronizados com sucesso!"}),await k()}catch(s){console.error("Erro ao sincronizar:",s),y({title:"Erro ao sincronizar",description:s.message,variant:"destructive"})}finally{O(!1)}},K=()=>{let s=a;p&&(s=s.filter(i=>i.orderNumber.toLowerCase().includes(p.toLowerCase())||i.customerName.toLowerCase().includes(p.toLowerCase())||i.customerEmail.toLowerCase().includes(p.toLowerCase()))),b!=="all"&&(s=s.filter(i=>i.paymentStatus===b)),n(s)},x=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),Q=s=>({PENDING:{label:"Pendente",variant:"secondary",color:"bg-yellow-100 text-yellow-800"},PROCESSING:{label:"Processando",variant:"default",color:"bg-blue-100 text-blue-800"},PAID:{label:"Pago",variant:"default",color:"bg-green-100 text-green-800"},FAILED:{label:"Falhou",variant:"destructive",color:"bg-red-100 text-red-800"},REFUNDED:{label:"Reembolsado",variant:"secondary",color:"bg-gray-100 text-gray-800"},CANCELLED:{label:"Cancelado",variant:"secondary",color:"bg-gray-100 text-gray-800"}})[s]||{label:"Desconhecido",variant:"secondary",color:"bg-gray-100 text-gray-800"},$=s=>{if(!s.items)return[];if(Array.isArray(s.items))return s.items;if(typeof s.items=="object"&&!Array.isArray(s.items)){const i=s.items;return Array.isArray(i.items)?i.items:[i]}return[]},J=a.filter(s=>s.paymentStatus==="PAID").reduce((s,i)=>s+i.total,0),W=a.filter(s=>s.paymentStatus==="PENDING").length,Y=a.filter(s=>s.paymentStatus==="PAID").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Pedidos"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Visualize e gerencie todos os pedidos da sua loja"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-4",children:[e.jsxs(j,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Total de Pedidos"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Todos os pedidos"})]})]}),e.jsxs(j,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Pedidos Pagos"}),e.jsx(pe,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Y}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pagamentos confirmados"})]})]}),e.jsxs(j,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Pedidos Pendentes"}),e.jsx(ve,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:W}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aguardando pagamento"})]})]}),e.jsxs(j,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Receita Total"}),e.jsx(ge,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x(J)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pedidos pagos"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 w-full",children:[e.jsx(te,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ae,{placeholder:"Buscar por número, cliente ou email...",value:p,onChange:s=>V(s.target.value),className:"pl-9 border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm dark:text-white dark:placeholder:text-gray-500"})]}),e.jsxs(le,{value:b,onValueChange:_,children:[e.jsx(de,{className:"w-full sm:w-[200px] border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm dark:text-white dark:placeholder:text-gray-500",children:e.jsx(ie,{placeholder:"Status"})}),e.jsxs(ne,{children:[e.jsx(g,{value:"all",children:"Todos os Status"}),e.jsx(g,{value:"PENDING",children:"Pendente"}),e.jsx(g,{value:"PROCESSING",children:"Processando"}),e.jsx(g,{value:"PAID",children:"Pago"}),e.jsx(g,{value:"FAILED",children:"Falhou"}),e.jsx(g,{value:"REFUNDED",children:"Reembolsado"}),e.jsx(g,{value:"CANCELLED",children:"Cancelado"})]})]}),e.jsxs(R,{onClick:X,disabled:C,variant:"outline",className:"w-full sm:w-auto bg-white/80 backdrop-blur-sm border-gray-200 hover:bg-gradient-to-r hover:from-blue-500 hover:to-purple-500 hover:text-white hover:border-transparent transition-all duration-300",children:[e.jsx(re,{className:`h-4 w-4 mr-2 ${C?"animate-spin":""}`}),C?"Sincronizando...":"Sincronizar Shopify"]})]}),h?e.jsxs("div",{className:"space-y-4",children:[e.jsx(I,{className:"h-24 w-full"}),e.jsx(I,{className:"h-24 w-full"}),e.jsx(I,{className:"h-24 w-full"})]}):l.length===0?e.jsx(j,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:e.jsxs(N,{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(M,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum pedido encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:p||b!=="all"?"Tente ajustar os filtros de busca":"Os pedidos aparecerão aqui assim que forem criados"})]})}):e.jsx("div",{className:"grid gap-4",children:l.map(s=>{const i=Q(s.paymentStatus),v=$(s);return e.jsx(j,{className:"overflow-hidden border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"font-mono text-lg font-bold",children:["#",s.orderNumber]}),e.jsx(F,{className:i.color,children:i.label})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(T,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.customerName})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:s.customerEmail})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:z(new Date(s.createdAt),"dd/MM/yyyy 'às' HH:mm",{locale:H})})]})]}),e.jsxs("div",{className:"sm:text-right space-y-3 sm:min-w-[180px]",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x(s.total)})]}),e.jsxs(ce,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(R,{variant:"outline",size:"sm",className:"w-full",onClick:()=>U(s),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Ver Detalhes"]})}),e.jsxs(xe,{className:"max-w-3xl max-h-[85vh] overflow-y-auto",children:[e.jsxs(ue,{children:[e.jsxs(he,{className:"text-2xl",children:["Pedido #",s.orderNumber]}),e.jsx(fe,{children:"Informações completas do pedido"})]}),r&&e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg",children:"Status"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(F,{className:i.color,children:i.label})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg",children:"Informações do Cliente"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(T,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Nome"}),e.jsx("div",{className:"font-medium",children:r.customerName})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Email"}),e.jsx("div",{className:"font-medium",children:r.customerEmail})]})]}),r.customerPhone&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Telefone"}),e.jsx("div",{className:"font-medium",children:r.customerPhone})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(B,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Data do Pedido"}),e.jsx("div",{className:"font-medium",children:z(new Date(r.createdAt),"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:H})})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 text-lg",children:["Produtos (",v.length,")"]}),e.jsx("div",{className:"space-y-3",children:v.map((o,w)=>e.jsxs("div",{className:"flex gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[o.image?e.jsx("img",{src:o.image,alt:o.name||"Produto",className:"w-20 h-20 object-cover rounded-lg border",onError:t=>{t.target.src="https://via.placeholder.com/100?text=Produto"}}):e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center border",children:e.jsx(be,{className:"h-10 w-10 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-base",children:o.name||"Produto sem nome"}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["Quantidade: ",o.quantity]}),o.sku&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["SKU: ",o.sku]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-lg",children:x((o.price||0)*(o.quantity||1))}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[x(o.price||0)," / un"]})]})]},w))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg",children:"Resumo Financeiro"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:x(r.subtotal)})]}),r.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Desconto:"}),e.jsxs("span",{className:"font-medium",children:["-",x(r.discount)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Frete:"}),e.jsx("span",{className:"font-medium",children:x(r.shipping)})]}),r.tax>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Impostos:"}),e.jsx("span",{className:"font-medium",children:x(r.tax)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t border-gray-200",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-blue-600",children:x(r.total)})]})]})]}),r.shippingAddress&&r.shippingAddress.street&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg",children:"Endereço de Entrega"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-medium",children:[r.shippingAddress.street,","," ",r.shippingAddress.number]}),r.shippingAddress.complement&&e.jsx("p",{className:"text-sm text-muted-foreground",children:r.shippingAddress.complement}),e.jsxs("p",{className:"text-sm",children:[r.shippingAddress.neighborhood," ","-"," ",r.shippingAddress.city,"/",r.shippingAddress.state]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["CEP:"," ",r.shippingAddress.zipCode]})]})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-lg",children:"Pagamento"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Método de Pagamento"}),e.jsx("div",{className:"font-medium",children:r.paymentMethod||"Não especificado"})]})]})]})]})]})]})]})})},s.id)})})]})};export{He as default};
