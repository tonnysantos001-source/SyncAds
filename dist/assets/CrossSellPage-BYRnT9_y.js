import{c as Q,r,b as W,u as Y,j as e,M as v,B as u,I as S,S as ee,d as G,e as F,f as q,h as M,n as se}from"./index-BRIrW7EO.js";import{T as ae,a as te,b as re,c as x,d as ie,e as h}from"./table-CGotto0H.js";import{D as le,a as oe,b as de,c as ne,d as ce,f as ue}from"./dialog-Dp3Bzs4j.js";import{L as m}from"./label-BONfVAaL.js";import{S as E,a as A,b as I,c as D,d as N}from"./select-Ro0pY7Li.js";import{m as C}from"./marketingApi-iOWEg-b2.js";import{p as xe}from"./productsApi-CSMsCJL6.js";import{S as V}from"./skeleton-ChZg9grH.js";import{P as R}from"./plus-DFKdZ2p-.js";import{Z as he}from"./zap-DXJPU8WT.js";import{T as me}from"./target-BVI1KK5j.js";import{D as ge}from"./dollar-sign-04xbIBtq.js";import{S as je}from"./shopping-cart-BZygAPBr.js";import{S as pe}from"./square-pen-CNqj1ej3.js";import{T as ve}from"./trash-2-DKzHufWG.js";import"./x-XiR2kzjK.js";import"./index-CARSpSrE.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=Q("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),w=({title:i,value:P,icon:g,color:j,delay:y=0,subtitle:d})=>e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:y},children:e.jsxs(G,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${j} opacity-10 rounded-full blur-3xl`}),e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(q,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:i}),e.jsx("div",{className:`p-2 rounded-lg ${j} bg-opacity-10`,children:e.jsx(g,{className:`h-5 w-5 ${j.replace("bg-","text-")}`})})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:P}),d&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:d})]})]})}),Fe=()=>{const[i,P]=r.useState([]),[g,j]=r.useState([]),[y,d]=r.useState([]),[L,$]=r.useState(!0),[n,B]=r.useState(""),[O,p]=r.useState(!1),[b,z]=r.useState(null),{toast:c}=W(),l=Y(s=>s.user),[a,o]=r.useState({name:"",triggerProductId:"",suggestedProductIds:[],discountType:"PERCENTAGE",discountValue:0,isActive:!0});r.useEffect(()=>{T()},[]),r.useEffect(()=>{H()},[n,i]);const T=async()=>{try{if(!(l!=null&&l.organizationId))return;const[s,t]=await Promise.all([C.crossSells.getAll(l.organizationId),xe.list()]);P(s),j(t),d(s)}catch(s){c({title:"Erro ao carregar",description:s.message,variant:"destructive"})}finally{$(!1)}},H=()=>{if(!n){d(i);return}const s=i.filter(t=>t.name.toLowerCase().includes(n.toLowerCase()));d(s)},Z=async s=>{s.preventDefault();try{if(!(l!=null&&l.organizationId))return;b?(await C.crossSells.update(b.id,a),c({title:"Cross-sell atualizado!"})):(await C.crossSells.create({...a,organizationId:l.organizationId}),c({title:"Cross-sell criado!"})),p(!1),k(),T()}catch(t){c({title:"Erro",description:t.message,variant:"destructive"})}},U=async s=>{if(confirm("Tem certeza que deseja deletar este cross-sell?"))try{await C.crossSells.delete(s),c({title:"Cross-sell deletado"}),T()}catch(t){c({title:"Erro ao deletar",description:t.message,variant:"destructive"})}},X=s=>{z(s),o({name:s.name,triggerProductId:s.triggerProductId,suggestedProductIds:s.suggestedProductIds||[],discountType:s.discountType||"PERCENTAGE",discountValue:s.discountValue||0,isActive:s.isActive}),p(!0)},k=()=>{z(null),o({name:"",triggerProductId:"",suggestedProductIds:[],discountType:"PERCENTAGE",discountValue:0,isActive:!0})},_=i.filter(s=>s.isActive).length,J=i.length>0?"18.3%":"-",K=s=>{const t=g.find(f=>f.id===s);return(t==null?void 0:t.name)||"Produto não encontrado"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-cyan-600 to-teal-600 bg-clip-text text-transparent",children:"Cross-Sell"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mt-2",children:"Produtos complementares sugeridos durante a compra"})]}),e.jsxs(le,{open:O,onOpenChange:p,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(u,{onClick:k,size:"lg",className:"shadow-lg hover:shadow-xl transition-all",children:[e.jsx(R,{className:"mr-2 h-5 w-5"}),"Criar Cross-Sell"]})}),e.jsxs(de,{className:"max-w-2xl",children:[e.jsx(ne,{children:e.jsx(ce,{children:b?"Editar Cross-Sell":"Novo Cross-Sell"})}),e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(m,{children:"Nome Interno *"}),e.jsx(S,{value:a.name,onChange:s=>o({...a,name:s.target.value}),placeholder:"Ex: Combo Acessórios",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(m,{children:"Produto Gatilho *"}),e.jsxs(E,{value:a.triggerProductId,onValueChange:s=>o({...a,triggerProductId:s}),required:!0,children:[e.jsx(A,{children:e.jsx(I,{placeholder:"Produto que ativa o cross-sell"})}),e.jsx(D,{children:g.map(s=>e.jsx(N,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(m,{children:"Produtos Sugeridos *"}),e.jsxs(E,{value:a.suggestedProductIds[0]||"",onValueChange:s=>o({...a,suggestedProductIds:[s]}),required:!0,children:[e.jsx(A,{children:e.jsx(I,{placeholder:"Selecione os produtos"})}),e.jsx(D,{children:g.map(s=>e.jsxs(N,{value:s.id,children:[s.name," - R$ ",s.price.toFixed(2)]},s.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Produtos que serão sugeridos junto com a compra"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Tipo de Desconto"}),e.jsxs(E,{value:a.discountType,onValueChange:s=>o({...a,discountType:s}),children:[e.jsx(A,{children:e.jsx(I,{})}),e.jsxs(D,{children:[e.jsx(N,{value:"PERCENTAGE",children:"Porcentagem"}),e.jsx(N,{value:"FIXED_AMOUNT",children:"Valor Fixo"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Valor do Desconto"}),e.jsx(S,{type:"number",step:"0.01",value:a.discountValue,onChange:s=>o({...a,discountValue:parseFloat(s.target.value)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.isActive,onChange:s=>o({...a,isActive:s.target.checked}),className:"rounded"}),e.jsx(m,{children:"Ativo"})]})]}),e.jsxs(ue,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancelar"}),e.jsx(u,{type:"submit",children:b?"Atualizar":"Criar"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-4",children:[e.jsx(w,{title:"Total de Cross-Sells",value:i.length,icon:ye,color:"bg-blue-500",delay:.1,subtitle:"Ofertas criadas"}),e.jsx(w,{title:"Cross-Sells Ativos",value:_,icon:he,color:"bg-green-500",delay:.2,subtitle:"Atualmente em uso"}),e.jsx(w,{title:"Taxa de Conversão",value:J,icon:me,color:"bg-cyan-500",delay:.3,subtitle:"Média de aceitação"}),e.jsx(w,{title:"Receita Extra",value:"-",icon:ge,color:"bg-teal-500",delay:.4,subtitle:"Gerada por cross-sells"})]}),e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.5},className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(S,{placeholder:"Buscar cross-sells...",value:n,onChange:s=>B(s.target.value),className:"pl-9 border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg"})]}),e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:e.jsxs(G,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsx(F,{children:e.jsx(q,{className:"text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:"Lista de Cross-Sells"})}),e.jsx(M,{children:L?e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"h-12 w-full"}),e.jsx(V,{className:"h-12 w-full"}),e.jsx(V,{className:"h-12 w-full"})]}):y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-gradient-to-br from-blue-500 to-teal-500 mb-4",children:e.jsx(je,{className:"h-12 w-12 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhum cross-sell encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-md",children:n?"Tente ajustar sua busca":"Comece criando seu primeiro cross-sell e aumente o valor do carrinho"}),!n&&e.jsxs(u,{onClick:()=>{k(),p(!0)},size:"lg",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Criar Primeiro Cross-Sell"]})]}):e.jsx("div",{className:"rounded-md border border-gray-200 dark:border-gray-800",children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs(re,{className:"hover:bg-transparent",children:[e.jsx(x,{children:"Nome"}),e.jsx(x,{children:"Produto Gatilho"}),e.jsx(x,{children:"Produtos Sugeridos"}),e.jsx(x,{children:"Desconto"}),e.jsx(x,{children:"Status"}),e.jsx(x,{className:"text-right",children:"Ações"})]})}),e.jsx(ie,{children:y.map((s,t)=>{var f;return e.jsxs(v.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:t*.05},className:"hover:bg-gray-50/50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx(h,{className:"font-medium",children:s.name}),e.jsx(h,{className:"text-sm text-gray-600 dark:text-gray-400",children:K(s.triggerProductId)}),e.jsxs(h,{className:"text-sm text-gray-600 dark:text-gray-400",children:[((f=s.suggestedProductIds)==null?void 0:f.length)||0," ","produto(s)"]}),e.jsx(h,{children:s.discountValue?s.discountType==="PERCENTAGE"?`${s.discountValue}%`:`R$ ${s.discountValue.toFixed(2)}`:"-"}),e.jsx(h,{children:e.jsx(se,{variant:s.isActive?"default":"secondary",className:s.isActive?"bg-green-500 hover:bg-green-600":"",children:s.isActive?"Ativo":"Inativo"})}),e.jsx(h,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>X(s),className:"hover:bg-blue-50 hover:text-blue-600 dark:hover:bg-blue-950",children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>U(s.id),className:"hover:bg-red-50 hover:text-red-600 dark:hover:bg-red-950",children:e.jsx(ve,{className:"h-4 w-4"})})]})})]},s.id)})})]})})})]})})]})};export{Fe as default};
