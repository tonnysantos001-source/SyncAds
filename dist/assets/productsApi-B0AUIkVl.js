import{s as c}from"./index-BxV7uozX.js";const I={async list(o){try{let r=c.from("Product").select("*, Category(*)").order("createdAt",{ascending:!1});o!=null&&o.status&&(r=r.eq("status",o.status)),o!=null&&o.categoryId&&(r=r.eq("categoryId",o.categoryId)),o!=null&&o.search&&(r=r.or(`name.ilike.%${o.search}%,sku.ilike.%${o.search}%`));const{data:t,error:e}=await r;if(e)throw e;return t}catch(r){throw console.error("Error listing products:",r),r}},async listFromShopify(o,r){try{let t=c.from("ShopifyProduct").select("*").eq("userId",o).order("updatedAt",{ascending:!1});r!=null&&r.status&&(t=t.eq("status",r.status)),r!=null&&r.search&&(t=t.or(`title.ilike.%${r.search}%,handle.ilike.%${r.search}%`));const{data:e,error:d}=await t;if(d)throw d;return(e||[]).map(a=>{var s,n,i,u,h,y,g,p,w,m;return{id:String(a.id),userId:a.userId,name:a.title,slug:a.handle,description:a.description,shortDescription:(s=a.description)==null?void 0:s.substring(0,200),price:((u=(i=(n=a.shopifyData)==null?void 0:n.variants)==null?void 0:i[0])==null?void 0:u.price)||0,comparePrice:((g=(y=(h=a.shopifyData)==null?void 0:h.variants)==null?void 0:y[0])==null?void 0:g.compare_at_price)||0,sku:((m=(w=(p=a.shopifyData)==null?void 0:p.variants)==null?void 0:w[0])==null?void 0:m.sku)||"",stock:a.totalInventory||0,lowStockThreshold:10,trackStock:!0,status:a.status==="active"?"ACTIVE":a.status==="draft"?"DRAFT":"ARCHIVED",isFeatured:!1,tags:a.tags||[],metadata:{shopifyId:a.id,shopifyData:a.shopifyData,images:a.images,vendor:a.vendor,productType:a.productType},createdAt:a.createdAt,updatedAt:a.updatedAt}})}catch(t){throw console.error("Error listing Shopify products:",t),t}},async getById(o){try{const{data:r,error:t}=await c.from("Product").select("*, Category(*), ProductVariant(*), ProductImage(*)").eq("id",o).single();if(t)throw t;return r}catch(r){throw console.error("Error getting product:",r),r}},async create(o){try{const{data:r,error:t}=await c.from("Product").insert(o).select().single();if(t)throw t;return r}catch(r){throw console.error("Error creating product:",r),r}},async update(o,r){try{const{data:t,error:e}=await c.from("Product").update({...r,updatedAt:new Date().toISOString()}).eq("id",o).select().single();if(e)throw e;return t}catch(t){throw console.error("Error updating product:",t),t}},async delete(o){try{const{error:r}=await c.from("Product").delete().eq("id",o);if(r)throw r}catch(r){throw console.error("Error deleting product:",r),r}},async updateStock(o,r){try{const{data:t,error:e}=await c.from("Product").update({stock:r,updatedAt:new Date().toISOString()}).eq("id",o).select().single();if(e)throw e;return t}catch(t){throw console.error("Error updating stock:",t),t}}};export{I as p};
