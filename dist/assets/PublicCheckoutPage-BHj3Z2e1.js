import{m as X,e as q,f as M,r as i,j as e,v as D,g as u,l as j,B as g,h as v,i as f,I as o,C as V,s as _}from"./index-Bgc-gs-j.js";import{L as l}from"./label-DitOAO3n.js";import{S as R}from"./separator-BsJLPvvk.js";import{c as H,S as Q}from"./checkoutApi-DfDHivdu.js";import{C as U}from"./circle-alert-DEHEphr7.js";import{F as W}from"./file-text-C0yqzWn8.js";const se=()=>{const{orderId:b}=X(),C=q(),{toast:m}=M(),[t,I]=i.useState(null),[y,F]=i.useState(null),[A,w]=i.useState(!0),[k,P]=i.useState(!1),[n,E]=i.useState(1),[c,p]=i.useState({name:"",email:"",phone:"",document:""}),[r,d]=i.useState({street:"",number:"",complement:"",neighborhood:"",city:"",state:"",zipCode:""}),[x,N]=i.useState("PIX"),[S,$]=i.useState(1);i.useEffect(()=>{b&&T()},[b]);const T=async()=>{try{w(!0),I({orderId:b,products:[{id:"1",name:"Produto Exemplo",price:99.9,quantity:1,image:"https://via.placeholder.com/100x100"}],total:99.9,subtotal:89.9,tax:10,shipping:0,discount:0});try{const a=await H.loadCustomization("default-org-id");F(a)}catch{console.log("Usando personalização padrão"),F({theme:{backgroundColor:"#FFFFFF",primaryButtonBackgroundColor:"#FF0080",primaryButtonTextColor:"#FFFFFF",checkoutButtonBackgroundColor:"#0FBA00",fontFamily:"Arial"}})}}catch(s){console.error("Erro ao carregar dados do checkout:",s),m({title:"Erro ao carregar checkout",description:"Não foi possível carregar os dados do pedido",variant:"destructive"})}finally{w(!1)}},z=()=>{if(n===1&&(!c.name||!c.email||!c.phone)){m({title:"Dados incompletos",description:"Preencha todos os campos obrigatórios",variant:"destructive"});return}if(n===2&&(!r.street||!r.number||!r.neighborhood||!r.city||!r.state||!r.zipCode)){m({title:"Endereço incompleto",description:"Preencha todos os campos do endereço",variant:"destructive"});return}E(s=>s+1)},L=()=>{E(s=>s-1)},O=async()=>{if(t){P(!0);try{const s={orderId:t.orderId,gatewayId:"default-gateway",paymentMethod:x,amount:t.total,currency:"BRL",customerData:c,billingAddress:r,installments:S,metadata:{source:"public-checkout",products:t.products}},{data:a,error:B}=await _.functions.invoke("process-payment",{body:s});if(B)throw new Error(B.message);if(a.success)m({title:"Pagamento processado!",description:"Seu pagamento foi processado com sucesso",variant:"default"}),C(`/checkout/success/${a.data.transactionId}`);else throw new Error(a.message)}catch(s){console.error("Erro no pagamento:",s),m({title:"Erro no pagamento",description:s.message,variant:"destructive"})}finally{P(!1)}}};if(A)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando checkout..."})]})});if(!t)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(u,{className:"w-full max-w-md",children:e.jsxs(j,{className:"p-6 text-center",children:[e.jsx(U,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Pedido não encontrado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"O pedido solicitado não foi encontrado."}),e.jsx(g,{onClick:()=>C("/"),children:"Voltar ao início"})]})})});const h=(y==null?void 0:y.theme)||{};return e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:h.backgroundColor||"#FFFFFF",fontFamily:h.fontFamily||"Arial"},children:[e.jsx("div",{className:"bg-white border-b border-gray-200 py-4",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Finalizar Compra"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${n>=1?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"}`,children:"1"}),e.jsx("span",{className:"text-sm",children:"Dados"})]}),e.jsx("div",{className:"w-8 h-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${n>=2?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"}`,children:"2"}),e.jsx("span",{className:"text-sm",children:"Endereço"})]}),e.jsx("div",{className:"w-8 h-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${n>=3?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"}`,children:"3"}),e.jsx("span",{className:"text-sm",children:"Pagamento"})]})]})]})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[n===1&&e.jsxs(u,{children:[e.jsx(v,{children:e.jsx(f,{children:"Informações Pessoais"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",children:"Nome completo *"}),e.jsx(o,{id:"name",value:c.name,onChange:s=>p(a=>({...a,name:s.target.value})),placeholder:"Seu nome completo"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"email",children:"E-mail *"}),e.jsx(o,{id:"email",type:"email",value:c.email,onChange:s=>p(a=>({...a,email:s.target.value})),placeholder:"seu@email.com"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"phone",children:"Telefone/WhatsApp *"}),e.jsx(o,{id:"phone",value:c.phone,onChange:s=>p(a=>({...a,phone:s.target.value})),placeholder:"(11) 99999-9999"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"document",children:"CPF"}),e.jsx(o,{id:"document",value:c.document,onChange:s=>p(a=>({...a,document:s.target.value})),placeholder:"000.000.000-00"})]})]})]}),n===2&&e.jsxs(u,{children:[e.jsx(v,{children:e.jsx(f,{children:"Endereço de Entrega"})}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{htmlFor:"street",children:"Rua/Avenida *"}),e.jsx(o,{id:"street",value:r.street,onChange:s=>d(a=>({...a,street:s.target.value})),placeholder:"Nome da rua"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"number",children:"Número *"}),e.jsx(o,{id:"number",value:r.number,onChange:s=>d(a=>({...a,number:s.target.value})),placeholder:"123"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"complement",children:"Complemento"}),e.jsx(o,{id:"complement",value:r.complement,onChange:s=>d(a=>({...a,complement:s.target.value})),placeholder:"Apto 45"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"neighborhood",children:"Bairro *"}),e.jsx(o,{id:"neighborhood",value:r.neighborhood,onChange:s=>d(a=>({...a,neighborhood:s.target.value})),placeholder:"Centro"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"city",children:"Cidade *"}),e.jsx(o,{id:"city",value:r.city,onChange:s=>d(a=>({...a,city:s.target.value})),placeholder:"São Paulo"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"state",children:"Estado *"}),e.jsx(o,{id:"state",value:r.state,onChange:s=>d(a=>({...a,state:s.target.value})),placeholder:"SP",maxLength:2})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"zipCode",children:"CEP *"}),e.jsx(o,{id:"zipCode",value:r.zipCode,onChange:s=>d(a=>({...a,zipCode:s.target.value})),placeholder:"00000-000"})]})]})})]}),n===3&&e.jsxs(u,{children:[e.jsx(v,{children:e.jsx(f,{children:"Forma de Pagamento"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${x==="PIX"?"border-blue-500 bg-blue-50":"border-gray-300"}`,onClick:()=>N("PIX"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"PIX"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pagamento instantâneo"})]})]})}),e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${x==="CREDIT_CARD"?"border-blue-500 bg-blue-50":"border-gray-300"}`,onClick:()=>N("CREDIT_CARD"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Cartão de Crédito"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visa, Mastercard, Elo"})]})]})}),e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${x==="BOLETO"?"border-blue-500 bg-blue-50":"border-gray-300"}`,onClick:()=>N("BOLETO"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Boleto Bancário"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pagamento em até 3 dias úteis"})]})]})})]}),x==="CREDIT_CARD"&&e.jsxs("div",{children:[e.jsx(l,{htmlFor:"installments",children:"Parcelas"}),e.jsx("select",{id:"installments",value:S,onChange:s=>$(Number(s.target.value)),className:"w-full mt-2 px-3 py-2 border border-gray-300 rounded-lg",children:[1,2,3,4,5,6,7,8,9,10,11,12].map(s=>e.jsxs("option",{value:s,children:[s,"x de R$ ",(t.total/s).toFixed(2)]},s))})]})]})]}),e.jsxs("div",{className:"flex justify-between mt-6",children:[n>1&&e.jsx(g,{variant:"outline",onClick:L,children:"Voltar"}),e.jsx("div",{className:"ml-auto",children:n<3?e.jsx(g,{onClick:z,style:{backgroundColor:h.primaryButtonBackgroundColor||"#FF0080",color:h.primaryButtonTextColor||"#FFFFFF"},children:"Continuar"}):e.jsx(g,{onClick:O,disabled:k,style:{backgroundColor:h.checkoutButtonBackgroundColor||"#0FBA00",color:"#FFFFFF"},children:k?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-4 w-4 animate-spin mr-2"}),"Processando..."]}):"Finalizar Compra"})})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(u,{className:"sticky top-4",children:[e.jsx(v,{children:e.jsx(f,{children:"Resumo do Pedido"})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[t.products.map(s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover rounded-lg"}):e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qtd: ",s.quantity]})]}),e.jsxs("div",{className:"text-sm font-medium",children:["R$ ",(s.price*s.quantity).toFixed(2)]})]},s.id)),e.jsx(R,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["R$ ",t.subtotal.toFixed(2)]})]}),t.tax>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Taxa"}),e.jsxs("span",{children:["R$ ",t.tax.toFixed(2)]})]}),t.shipping>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Frete"}),e.jsxs("span",{children:["R$ ",t.shipping.toFixed(2)]})]}),t.discount&&t.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{children:["-R$ ",t.discount.toFixed(2)]})]}),e.jsx(R,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["R$ ",t.total.toFixed(2)]})]})]})]})})]})})]})})]})};export{se as default};
