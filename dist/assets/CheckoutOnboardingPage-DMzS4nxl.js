import{j as e}from"./vendor-ui-D3JNL6pE.js";import{f as t,r as a}from"./vendor-react-X41Bjl18.js";import{f as i,s as r}from"./index-DW7xxQPV.js";import{A as s,a as o}from"./alert-CvY0LE17.js";import{r as n,g as d,b9 as c,D as l,bd as m,L as u,av as g}from"./vendor-icons-BvRy6l6m.js";import"./vendor-supabase-HUq0BeMy.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-animation-DtB50Lbk.js";import"./vendor-query-DqG_mm-v.js";function h(){const h=i(e=>e.user),p=t(),[x,f]=a.useState([]),[b,y]=a.useState(!0),[v,w]=a.useState(null),[j,N]=a.useState(!1),[k,S]=a.useState(null);a.useEffect(()=>{h?.id?q():(w("UsuÃ¡rio nÃ£o encontrado. Redirecionando..."),setTimeout(()=>p("/login"),1500))},[h?.id]);const q=async()=>{if(!h?.id)return w("UsuÃ¡rio nÃ£o encontrado. Redirecionando para login..."),void setTimeout(()=>p("/login"),1500);y(!0),w(null);try{if(!(await(async()=>{try{const{data:{session:e},error:t}=await r.auth.getSession();if(t)throw t;return!!e||(w("SessÃ£o expirada. Redirecionando para login..."),setTimeout(()=>p("/login"),1500),!1)}catch(e){return w("Erro ao verificar sessÃ£o. Por favor, faÃ§a login novamente."),!1}})()))return void y(!1);const[e,t,a,i,s]=await Promise.all([C().catch(e=>!1),I().catch(e=>!1),V().catch(e=>!1),A().catch(e=>!1),D().catch(e=>!1)]);f([{id:"email-verification",title:"VerificaÃ§Ã£o de Email",description:"Verifique seu endereÃ§o de email para ativar todos os recursos",icon:n,completed:e,route:"/settings/email-verification"},{id:"billing",title:"Faturamento",description:"Configure seu plano e mÃ©todo de pagamento",icon:d,completed:t,route:"/billing"},{id:"domain",title:"DomÃ­nio",description:"Verifique seu domÃ­nio. Deve ser o mesmo utilizado na shopify, woocommerce ou na sua landing page.",icon:c,completed:a,route:"/checkout/domain"},{id:"gateway",title:"Gateway",description:"Configure os meios de pagamentos que serÃ£o exibidos em sua loja.",icon:l,completed:i,route:"/checkout/gateways"},{id:"shipping",title:"Frete",description:"Crie mÃ©todos de entrega para ser exibido no seu checkout.",icon:m,completed:s,route:"/checkout/shipping"}]),w(null)}catch(e){let t="Erro ao carregar configuraÃ§Ãµes. ";e?.message?.includes("JWT")||e?.message?.includes("token")?(t+="Problema de autenticaÃ§Ã£o. Por favor, faÃ§a login novamente.",setTimeout(()=>{i.getState().logout(),p("/login")},2e3)):"PGRST116"===e?.code?t+="Nenhum dado encontrado.":e?.message?.includes("Failed to fetch")?t+="Erro de conexÃ£o. Verifique sua internet.":t+=e?.message||"Erro desconhecido.",w(t);f([{id:"email-verification",title:"VerificaÃ§Ã£o de Email",description:"Verifique seu endereÃ§o de email para ativar todos os recursos",icon:n,completed:!1,route:"/settings/email-verification"},{id:"billing",title:"Faturamento",description:"Configure seu plano e mÃ©todo de pagamento",icon:d,completed:!1,route:"/billing"},{id:"domain",title:"DomÃ­nio",description:"Verifique seu domÃ­nio. Deve ser o mesmo utilizado na shopify, woocommerce ou na sua landing page.",icon:c,completed:!1,route:"/checkout/domain"},{id:"gateway",title:"Gateway",description:"Configure os meios de pagamentos que serÃ£o exibidos em sua loja.",icon:l,completed:!1,route:"/checkout/gateways"},{id:"shipping",title:"Frete",description:"Crie mÃ©todos de entrega para ser exibido no seu checkout.",icon:m,completed:!1,route:"/checkout/shipping"}])}finally{y(!1)}},C=async()=>{if(!h?.id)return!1;try{const{data:e,error:t}=await r.from("User").select("emailVerified").eq("id",h.id).single();if(t)throw t;return!0===e?.emailVerified}catch(e){throw e}},I=async()=>{if(!h?.id)return!1;try{const{data:e,error:t}=await r.from("User").select("currentPlanId, planId").eq("id",h.id).single();if(t)throw t;if(e?.currentPlanId||e?.planId)return!0;const{data:a,error:i}=await r.from("Subscription").select("id, status").eq("userId",h.id).eq("status","active").maybeSingle();if(i&&!i.message.includes("does not exist"))throw i;return!!a}catch(e){throw e}},V=async()=>{if(!h?.id)return!1;try{const{data:e,error:t}=await r.from("User").select("domain, domainVerified").eq("id",h.id).single();if(t)throw t;return!(!e?.domain||!e?.domainVerified)}catch(e){throw e}},A=async()=>{if(!h?.id)return!1;try{const{data:e,error:t}=await r.from("GatewayConfig").select("id, isActive").eq("userId",h.id).eq("isActive",!0).limit(1);if(t)throw t;return(e?.length||0)>0}catch(e){throw e}},D=async()=>{if(!h?.id)return!1;try{const{data:e,error:t}=await r.from("ShippingMethod").select("id").eq("userId",h.id).limit(1);if(t){if(t.message.includes("does not exist"))return!1;throw t}return(e?.length||0)>0}catch(e){if(e?.message?.includes("does not exist"))return!1;throw e}};if(b)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen gap-4",children:[e.jsx(u,{className:"h-8 w-8 animate-spin text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Carregando suas configuraÃ§Ãµes..."})]});if(v)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen gap-4 p-6",children:[e.jsxs(s,{variant:"destructive",className:"max-w-md",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx(o,{children:v})]}),e.jsx("button",{onClick:()=>{w(null),y(!0),q()},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"Tentar Novamente"}),e.jsx("button",{onClick:()=>p("/login"),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Voltar para Login"})]});const P=h?.name||h?.email?.split("@")[0]||"usuÃ¡rio";return e.jsxs("div",{className:"p-6 sm:p-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["OlÃ¡ ",P,","]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Seja bem vindo"})]}),e.jsx("div",{className:"mb-6",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Para ativar seu checkout vocÃª precisa concluir todos passos abaixo:"})}),e.jsx("div",{className:"space-y-4",children:x.map(t=>{const a=t.icon;return e.jsxs("div",{className:"flex items-start gap-4 p-4 border-2 rounded-lg bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 cursor-pointer hover:border-gray-300 dark:hover:border-gray-600 transition-all",onClick:()=>p(t.route),children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(a,{className:"h-8 w-8 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.description})]}),e.jsx("div",{className:"flex-shrink-0 pt-1",children:e.jsx("div",{className:"h-3 w-3 rounded-full "+(t.completed?"bg-green-500":"bg-red-500"),title:t.completed?"ConcluÃ­do":"Pendente"})})]},t.id)})}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-600 dark:text-gray-400",children:["Caso tenha alguma dÃºvida,"," ",e.jsx("button",{onClick:()=>p("/help"),className:"underline hover:text-gray-900 dark:hover:text-white",children:"visite nossa central de ajuda"}),"."]}),e.jsxs("div",{className:"fixed bottom-6 right-6 z-50 flex flex-col gap-2",children:[e.jsx("button",{className:"rounded-full bg-pink-500 hover:bg-pink-600 text-white px-6 py-3 shadow-lg transition-colors",onClick:()=>p("/chat"),children:"Precisa de ajuda?"}),e.jsx("button",{className:"rounded-full bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 shadow-lg transition-colors text-sm",onClick:async()=>{const e={timestamp:(new Date).toISOString(),user:{id:h?.id,email:h?.email,name:h?.name,isSuperAdmin:h?.isSuperAdmin,plan:h?.plan},authStore:{isAuthenticated:i.getState().isAuthenticated,isInitialized:i.getState().isInitialized},localStorage:{authStorage:localStorage.getItem("auth-storage")},supabase:{}};try{const{data:{session:a},error:i}=await r.auth.getSession();e.supabase.session={hasSession:!!a,userId:a?.user?.id,expiresAt:a?.expires_at?new Date(1e3*a.expires_at).toISOString():null,error:i?.message};const{data:s,error:o}=await r.from("User").select("id, email, name, emailVerified, plan, isSuperAdmin").eq("id",h?.id).single();e.supabase.user={found:!!s,data:s,error:o?.message};try{const{data:t,error:a}=await r.from("Subscription").select("id, status").eq("userId",h?.id).eq("status","active").maybeSingle();e.supabase.billing={hasActiveSubscription:!!t,error:a?.message}}catch(t){e.supabase.billing={error:t.message}}try{const{data:t,error:a}=await r.from("User").select("domain, domainVerified").eq("id",h?.id).single();e.supabase.domain={domain:t?.domain,verified:t?.domainVerified,error:a?.message}}catch(t){e.supabase.domain={error:t.message}}try{const{data:t,error:a}=await r.from("GatewayConfig").select("id, isActive").eq("userId",h?.id).eq("isActive",!0);e.supabase.gateways={count:t?.length||0,error:a?.message}}catch(t){e.supabase.gateways={error:t.message}}}catch(t){e.error=t.message}S(e),N(!0)},children:"ðŸ” DiagnÃ³stico"})]}),j&&k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-4xl w-full max-h-[80vh] overflow-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"InformaÃ§Ãµes de DiagnÃ³stico"}),e.jsx("button",{onClick:()=>N(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"âœ•"})]}),e.jsx("pre",{className:"bg-gray-100 dark:bg-gray-900 p-4 rounded text-xs overflow-auto",children:JSON.stringify(k,null,2)}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(JSON.stringify(k,null,2)),alert("DiagnÃ³stico copiado para Ã¡rea de transferÃªncia!")},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Copiar"}),e.jsx("button",{onClick:()=>N(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Fechar"})]})]})})]})}export{h as default};
