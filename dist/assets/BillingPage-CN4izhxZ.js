import{j as e}from"./vendor-ui-DAyDU-p2.js";import{r as a}from"./vendor-react-BDwqAlkB.js";import{g as s,s as r,r as t,G as i,J as l,U as n,C as o,a as d,B as c,v as m,L as x,I as g,c as h,e as u,V as b,b as p}from"./index-Bc1oLC4s.js";import{T as y,a as j,b as v,c as f,d as N,e as w}from"./table-BHMaDDj7.js";import{S as A}from"./SuperAdminLayout-DHtcfpG2.js";import{S as C,a as S,b as I,c as R,d as L}from"./select-DU-a5icj.js";import{m as k}from"./vendor-animation-x8f1c1kX.js";import{f as F}from"./vendor-utils-Dl0_yMKq.js";import{p as M}from"./pt-BR-BbSwNUOy.js";import"./vendor-supabase-rKXMzPQL.js";import"./vendor-query-D3VdSFIC.js";import"./vendor-icons-CzCc3fGi.js";const P=({title:a,value:s,description:r,icon:t,gradient:i,delay:l=0})=>e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:l},whileHover:{scale:1.02},children:e.jsxs(o,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl hover:border-gray-600 transition-all group cursor-pointer relative overflow-hidden",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${i} opacity-10 group-hover:opacity-20 transition-opacity`}),e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2 relative z-10",children:[e.jsx(p,{className:"text-sm font-medium text-gray-300",children:a}),e.jsx("div",{className:`p-2.5 rounded-xl bg-gradient-to-br ${i} shadow-lg`,children:e.jsx(t,{className:"h-4 w-4 text-white"})})]}),e.jsxs(h,{className:"relative z-10",children:[e.jsx("div",{className:"text-3xl font-bold text-white mb-1",children:s}),e.jsx("p",{className:"text-xs text-gray-400",children:r})]})]})});function B(){const{toast:p}=s(),[B,T]=a.useState(!0),[U,V]=a.useState(""),[z,E]=a.useState("all"),[$,G]=a.useState("subscriptions"),[_,q]=a.useState([]),[D,H]=a.useState([]),[J,K]=a.useState({totalRevenue:0,monthlyRevenue:0,activeSubscriptions:0,totalInvoices:0,paidInvoices:0,pendingInvoices:0});a.useEffect(()=>{O()},[]);const O=async()=>{try{T(!0);const{data:e,error:a}=await r.from("Subscription").select("*").order("createdAt",{ascending:!1});if(a)throw a;const s=[...new Set(e?.map(e=>e.userId)||[])],{data:t}=await r.from("User").select("id, name, email").in("id",s),i=[...new Set(e?.map(e=>e.planId)||[])],{data:l}=await r.from("Plan").select("id, name, price, maxAiMessages").in("id",i),n=(e||[]).map(e=>({...e,user:t?.find(a=>a.id===e.userId),plan:l?.find(a=>a.id===e.planId)})),{data:o,error:d}=await r.from("Invoice").select("*").order("createdAt",{ascending:!1});if(d)throw d;const c=[...new Set(o?.map(e=>e.userId)||[])],{data:m}=await r.from("User").select("id, name, email").in("id",c),x=(o||[]).map(e=>({...e,user:m?.find(a=>a.id===e.userId)}));q(n),H(x);const g=n.filter(e=>"active"===e.status).length,h=n.filter(e=>"active"===e.status).reduce((e,a)=>e+(a.plan?.price||0),0),u=x.filter(e=>"paid"===e.status).length,b=x.filter(e=>"open"===e.status||"draft"===e.status).length,p=x.filter(e=>"paid"===e.status).reduce((e,a)=>e+a.amount,0);K({totalRevenue:p,monthlyRevenue:h,activeSubscriptions:g,totalInvoices:x.length,paidInvoices:u,pendingInvoices:b})}catch(e){p({title:"Erro ao carregar dados",description:e.message||"Não foi possível carregar os dados de faturamento.",variant:"destructive"})}finally{T(!1)}},Q=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e/100),W=e=>{if(!e)return"-";try{return F(new Date(e),"dd/MM/yyyy",{locale:M})}catch{return"-"}},X=a=>{const s={active:{label:"Ativa",className:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 text-green-300 border-green-500/30 border"},trialing:{label:"Trial",className:"bg-gradient-to-r from-blue-500/20 to-cyan-500/20 text-blue-300 border-blue-500/30 border"},past_due:{label:"Atrasada",className:"bg-gradient-to-r from-orange-500/20 to-red-500/20 text-orange-300 border-orange-500/30 border"},canceled:{label:"Cancelada",className:"bg-gradient-to-r from-gray-500/20 to-gray-600/20 text-gray-300 border-gray-500/30 border"},paid:{label:"Paga",className:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 text-green-300 border-green-500/30 border"},open:{label:"Aberta",className:"bg-gradient-to-r from-blue-500/20 to-cyan-500/20 text-blue-300 border-blue-500/30 border"},draft:{label:"Rascunho",className:"bg-gradient-to-r from-gray-500/20 to-gray-600/20 text-gray-300 border-gray-500/30 border"},void:{label:"Cancelada",className:"bg-gradient-to-r from-red-500/20 to-orange-500/20 text-red-300 border-red-500/30 border"}}[a]||{label:a,className:"bg-gradient-to-r from-gray-500/20 to-gray-600/20 text-gray-300 border-gray-500/30 border"};return e.jsx(u,{className:s.className,children:s.label})},Y=_.filter(e=>{const a=e.user?.name?.toLowerCase().includes(U.toLowerCase())||e.user?.email?.toLowerCase().includes(U.toLowerCase())||e.plan?.name?.toLowerCase().includes(U.toLowerCase()),s="all"===z||e.status===z;return a&&s}),Z=D.filter(e=>{const a=e.user?.name?.toLowerCase().includes(U.toLowerCase())||e.user?.email?.toLowerCase().includes(U.toLowerCase())||e.invoiceNumber?.toLowerCase().includes(U.toLowerCase()),s="all"===z||e.status===z;return a&&s});return B?e.jsx(A,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx(k.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-12 h-12 border-4 border-green-500/30 border-t-green-500 rounded-full"})})}):e.jsx(A,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(k.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent",children:"Faturamento"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Gerencie assinaturas e faturas dos clientes"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(P,{title:"Receita Total",value:Q(J.totalRevenue),description:`${J.paidInvoices} faturas pagas`,icon:t,gradient:"from-green-500 to-emerald-500",delay:.1}),e.jsx(P,{title:"MRR",value:Q(J.monthlyRevenue),description:"Receita mensal recorrente",icon:i,gradient:"from-blue-500 to-cyan-500",delay:.2}),e.jsx(P,{title:"Assinaturas Ativas",value:J.activeSubscriptions,description:"Clientes com planos ativos",icon:l,gradient:"from-purple-500 to-pink-500",delay:.3}),e.jsx(P,{title:"Faturas Pendentes",value:J.pendingInvoices,description:"Aguardando pagamento",icon:n,gradient:"from-orange-500 to-red-500",delay:.4})]}),e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:e.jsxs(o,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsx(d,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:()=>G("subscriptions"),className:"subscriptions"===$?"bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white border-0":"bg-gray-800/50 hover:bg-gray-700/50 text-gray-300 border border-gray-700",children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Assinaturas"]}),e.jsxs(c,{onClick:()=>G("invoices"),className:"invoices"===$?"bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white border-0":"bg-gray-800/50 hover:bg-gray-700/50 text-gray-300 border border-gray-700",children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),"Faturas"]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-1 sm:w-64",children:[e.jsx(x,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx(g,{placeholder:"Buscar...",value:U,onChange:e=>V(e.target.value),className:"pl-10 bg-gray-800/50 border-gray-700 text-white placeholder:text-gray-500 focus:border-green-500"})]}),e.jsxs(C,{value:z,onValueChange:E,children:[e.jsx(S,{className:"w-32 bg-gray-800/50 border-gray-700 text-white",children:e.jsx(I,{placeholder:"Status"})}),e.jsxs(R,{className:"bg-gray-900 border-gray-700",children:[e.jsx(L,{value:"all",className:"text-white hover:bg-gray-800",children:"Todos"}),"subscriptions"===$?e.jsxs(e.Fragment,{children:[e.jsx(L,{value:"active",className:"text-white hover:bg-gray-800",children:"Ativa"}),e.jsx(L,{value:"trialing",className:"text-white hover:bg-gray-800",children:"Trial"}),e.jsx(L,{value:"canceled",className:"text-white hover:bg-gray-800",children:"Cancelada"}),e.jsx(L,{value:"past_due",className:"text-white hover:bg-gray-800",children:"Atrasada"})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{value:"paid",className:"text-white hover:bg-gray-800",children:"Paga"}),e.jsx(L,{value:"open",className:"text-white hover:bg-gray-800",children:"Aberta"}),e.jsx(L,{value:"draft",className:"text-white hover:bg-gray-800",children:"Rascunho"}),e.jsx(L,{value:"void",className:"text-white hover:bg-gray-800",children:"Cancelada"})]})]})]})]})]})}),e.jsx(h,{children:"subscriptions"===$?e.jsx("div",{className:"border border-gray-700/50 rounded-lg overflow-hidden",children:e.jsxs(y,{children:[e.jsx(j,{children:e.jsxs(v,{className:"border-gray-700/50 hover:bg-gray-800/50",children:[e.jsx(f,{className:"text-gray-300 font-semibold",children:"Cliente"}),e.jsx(f,{className:"text-gray-300 font-semibold",children:"Plano"}),e.jsx(f,{className:"text-gray-300 font-semibold",children:"Valor"}),e.jsx(f,{className:"text-gray-300 font-semibold",children:"Status"}),e.jsx(f,{className:"text-gray-300 font-semibold",children:"Uso IA"}),e.jsx(f,{className:"text-gray-300 font-semibold",children:"Renovação"}),e.jsx(f,{className:"text-gray-300 font-semibold",children:"Criado em"})]})}),e.jsx(N,{children:0===Y.length?e.jsx(v,{children:e.jsx(w,{colSpan:7,className:"text-center py-12 text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(m,{className:"w-12 h-12 text-gray-600"}),e.jsx("p",{children:"Nenhuma assinatura encontrada"})]})})}):Y.map((a,s)=>e.jsxs(k.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*s},className:"border-gray-700/50 hover:bg-gray-800/50 transition-colors",children:[e.jsx(w,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:a.user?.name||"N/A"}),e.jsx("p",{className:"text-sm text-gray-400",children:a.user?.email||"N/A"})]})}),e.jsx(w,{children:e.jsx(u,{className:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border-purple-500/30 border",children:a.plan?.name||"N/A"})}),e.jsxs(w,{className:"font-semibold text-white",children:[Q(a.plan?.price||0),"/mês"]}),e.jsx(w,{children:X(a.status)}),e.jsx(w,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-white",children:a.usedAiMessages}),e.jsxs("span",{className:"text-gray-400",children:[" ","/"," ",0===a.plan?.maxAiMessages?"∞":a.plan?.maxAiMessages||"N/A"]})]})}),e.jsx(w,{className:"text-sm text-gray-400",children:W(a.currentPeriodEnd)}),e.jsx(w,{className:"text-sm text-gray-400",children:W(a.createdAt)})]},a.id))})]})}):e.jsx("div",{className:"border border-gray-700/50 rounded-lg overflow-hidden",children:e.jsxs(y,{children:[e.jsx(j,{children:e.jsxs(v,{className:"border-gray-700/50 hover:bg-gray-800/50",children:[e.jsx(f,{className:"text-gray-300 font-semibold",children:"Fatura"}),e.jsx(f,{className:"text-gray-300 font-semibold",children:"Cliente"}),e.jsx(f,{className:"text-gray-300 font-semibold",children:"Valor"}),e.jsx(f,{className:"text-gray-300 font-semibold",children:"Status"}),e.jsx(f,{className:"text-gray-300 font-semibold",children:"Pago em"}),e.jsx(f,{className:"text-gray-300 font-semibold",children:"Criado em"}),e.jsx(f,{className:"text-gray-300 font-semibold text-right",children:"Ações"})]})}),e.jsx(N,{children:0===Z.length?e.jsx(v,{children:e.jsx(w,{colSpan:7,className:"text-center py-12 text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(n,{className:"w-12 h-12 text-gray-600"}),e.jsx("p",{children:"Nenhuma fatura encontrada"})]})})}):Z.map((a,s)=>e.jsxs(k.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*s},className:"border-gray-700/50 hover:bg-gray-800/50 transition-colors",children:[e.jsx(w,{className:"font-medium text-white",children:a.invoiceNumber}),e.jsx(w,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:a.user?.name||"N/A"}),e.jsx("p",{className:"text-sm text-gray-400",children:a.user?.email||"N/A"})]})}),e.jsx(w,{className:"font-semibold text-white",children:Q(a.amount)}),e.jsx(w,{children:X(a.status)}),e.jsx(w,{className:"text-sm text-gray-400",children:W(a.paidAt)}),e.jsx(w,{className:"text-sm text-gray-400",children:W(a.createdAt)}),e.jsx(w,{className:"text-right",children:e.jsx(c,{variant:"ghost",size:"icon",className:"hover:bg-gray-700/50 text-gray-400 hover:text-white",children:e.jsx(b,{className:"h-4 w-4"})})})]},a.id))})]})})})]})})]})})}export{B as default};
