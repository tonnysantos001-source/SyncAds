import{j as e}from"./vendor-ui-D3JNL6pE.js";import{r as s}from"./vendor-react-X41Bjl18.js";import{g as a,s as t,H as r,S as l,P as i,v as c,C as n,a as d,b as o,d as x,c as m,T as h,I as g,U as j,w as b,B as u,V as p,W as N,X as y,N as f,Y as v,e as w,Z as C,_ as A,x as S}from"./index-BPTW8-dN.js";import{T as E,a as q,b as D,c as V,d as _,e as T}from"./table-CfmrYguE.js";import{D as M,a as k,b as B,c as I,d as R}from"./dialog-VOSW1lWG.js";import{S as L,a as z,b as O,c as P,d as $}from"./select-w3B3EtAQ.js";import{A as U,a as F,b as H,c as W,d as G,e as X,f as Y,g as Z}from"./alert-dialog-C6QnlO88.js";import{S as J}from"./SuperAdminLayout-CZmY4PFr.js";import{m as K,A as Q}from"./vendor-animation-DtB50Lbk.js";import"./vendor-supabase-HUq0BeMy.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-DqG_mm-v.js";import"./vendor-icons-BvRy6l6m.js";const ee=({title:s,value:a,description:t,icon:r,gradient:l,delay:i=0})=>e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i},whileHover:{scale:1.02},children:e.jsxs(n,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl hover:border-gray-600 transition-all group cursor-pointer relative overflow-hidden",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${l} opacity-10 group-hover:opacity-20 transition-opacity`}),e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2 relative z-10",children:[e.jsx(o,{className:"text-sm font-medium text-gray-300",children:s}),e.jsx("div",{className:`p-2.5 rounded-xl bg-gradient-to-br ${l} shadow-lg`,children:e.jsx(r,{className:"h-4 w-4 text-white"})})]}),e.jsxs(m,{className:"relative z-10",children:[e.jsx("div",{className:"text-3xl font-bold text-white mb-1",children:a}),e.jsx("p",{className:"text-xs text-gray-400",children:t})]})]})}),se=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e);function ae(){const{toast:ae}=a(),[te,re]=s.useState([]),[le,ie]=s.useState(""),[ce,ne]=s.useState(!0),[de,oe]=s.useState(null),[xe,me]=s.useState("recent"),[he,ge]=s.useState(null),[je,be]=s.useState(null);s.useEffect(()=>{ue()},[]);const ue=async()=>{try{ne(!0);const{data:e,error:s}=await t.from("User").select("*").order("createdAt",{ascending:!1});if(s)throw s;const{data:a}=await t.from("SuperAdmin").select("id"),r=new Set((a||[]).map(e=>e.id)),l=(e||[]).filter(e=>!r.has(e.id)),i=await Promise.all(l.map(async e=>{const{count:s}=await t.from("Campaign").select("*",{count:"exact",head:!0}).eq("userId",e.id),{count:a}=await t.from("ChatMessage").select("*",{count:"exact",head:!0}).eq("userId",e.id),{data:r}=await t.from("Order").select("totalAmount").eq("userId",e.id).eq("status","PAID"),l=r?.reduce((e,s)=>e+parseFloat(s.totalAmount||"0"),0)||0,i=r?.length||0,c=i>0?l/i:0;return{...e,_count:{campaigns:s||0,messages:a||0,orders:i},_stats:{totalSales:l,averageOrderValue:c}}}));re(i)}catch(e){ae({title:"Erro ao carregar usuÃ¡rios",description:e.message,variant:"destructive"})}finally{ne(!1)}},pe=te.filter(e=>e.name.toLowerCase().includes(le.toLowerCase())||e.email.toLowerCase().includes(le.toLowerCase())).sort((e,s)=>{switch(xe){case"sales":return(s._stats?.totalSales||0)-(e._stats?.totalSales||0);case"messages":return(s._count?.messages||0)-(e._count?.messages||0);default:return new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime()}}),Ne=s=>{const a={ADMIN:{className:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border-purple-500/30",label:"Admin"},MEMBER:{className:"bg-gradient-to-r from-blue-500/20 to-cyan-500/20 text-blue-300 border-blue-500/30",label:"Membro"},VIEWER:{className:"bg-gradient-to-r from-gray-500/20 to-gray-600/20 text-gray-300 border-gray-500/30",label:"Visualizador"}},t=a[s]||a.MEMBER;return e.jsx(w,{className:`${t.className} border`,children:t.label})},ye=s=>s?e.jsx(w,{className:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 text-green-300 border-green-500/30 border",children:"Ativo"}):e.jsx(w,{className:"bg-gradient-to-r from-red-500/20 to-orange-500/20 text-red-300 border-red-500/30 border",children:"Bloqueado"}),fe=(()=>{const e=te.reduce((e,s)=>e+(s._stats?.totalSales||0),0);return{total:te.length,active:te.filter(e=>e.isActive).length,verified:te.filter(e=>e.emailVerified).length,totalSales:e}})();return ce?e.jsx(J,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx(K.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-12 h-12 border-4 border-purple-500/30 border-t-purple-500 rounded-full"})})}):e.jsxs(J,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(K.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent",children:"Clientes"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Gerencie todos os clientes da plataforma"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(ee,{title:"Total de Clientes",value:fe.total,description:"Todos cadastrados",icon:r,gradient:"from-blue-500 to-cyan-500",delay:.1}),e.jsx(ee,{title:"Clientes Ativos",value:fe.active,description:"Contas ativas",icon:l,gradient:"from-green-500 to-emerald-500",delay:.2}),e.jsx(ee,{title:"Emails Verificados",value:fe.verified,description:"Contas verificadas",icon:i,gradient:"from-purple-500 to-pink-500",delay:.3}),e.jsx(ee,{title:"Total em Vendas",value:se(fe.totalSales),description:"Vendas de todos",icon:c,gradient:"from-orange-500 to-red-500",delay:.4})]}),e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:e.jsxs(n,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsx(d,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(o,{className:"text-white",children:"Todos os Clientes"}),e.jsx(x,{className:"text-gray-400",children:"Lista completa de clientes cadastrados"})]})})}),e.jsxs(m,{children:[e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(h,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx(g,{placeholder:"Buscar por nome ou email...",value:le,onChange:e=>ie(e.target.value),className:"pl-10 bg-gray-800/50 border-gray-700 text-white placeholder:text-gray-500 focus:border-blue-500"})]}),e.jsxs(L,{value:xe,onValueChange:e=>me(e),children:[e.jsxs(z,{className:"w-[220px] bg-gray-800/50 border-gray-700 text-white",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),e.jsx(O,{})]}),e.jsxs(P,{className:"bg-gray-800 border-gray-700",children:[e.jsx($,{value:"recent",className:"text-white focus:bg-gray-700",children:"Mais Recentes"}),e.jsx($,{value:"sales",className:"text-white focus:bg-gray-700",children:"Maiores Vendedores ðŸ’°"}),e.jsx($,{value:"messages",className:"text-white focus:bg-gray-700",children:"Mais Mensagens ðŸ’¬"})]})]})]}),e.jsx("div",{className:"border border-gray-700/50 rounded-lg overflow-hidden",children:e.jsxs(E,{children:[e.jsx(q,{children:e.jsxs(D,{className:"border-gray-700/50 hover:bg-gray-800/50",children:[e.jsx(V,{className:"text-gray-300 font-semibold",children:"Cliente"}),e.jsx(V,{className:"text-gray-300 font-semibold",children:"Email"}),e.jsx(V,{className:"text-gray-300 font-semibold",children:"Role"}),e.jsx(V,{className:"text-gray-300 font-semibold",children:"Status"}),e.jsx(V,{className:"text-gray-300 font-semibold",children:"Total Vendas"}),e.jsx(V,{className:"text-gray-300 font-semibold",children:"Mensagens"}),e.jsx(V,{className:"text-gray-300 font-semibold",children:"AÃ§Ãµes"})]})}),e.jsx(_,{children:0===pe.length?e.jsx(D,{children:e.jsx(T,{colSpan:7,className:"text-center py-12 text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(r,{className:"w-12 h-12 text-gray-600"}),e.jsx("p",{children:"Nenhum cliente encontrado"})]})})}):pe.map((s,a)=>e.jsxs(K.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.02*a},className:"border-gray-700/50 hover:bg-gray-800/50 transition-colors cursor-pointer",onClick:()=>oe(s),children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s._count?.orders||0," pedidos"]})]})]})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm text-gray-400",children:s.email}),s.emailVerified&&e.jsx(l,{className:"w-4 h-4 text-green-400",title:"Email verificado"})]})}),e.jsx(T,{children:Ne(s.role)}),e.jsx(T,{children:ye(s.isActive)}),e.jsx(T,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-white font-bold",children:se(s._stats?.totalSales||0)}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Ticket: ",se(s._stats?.averageOrderValue||0)]})]})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-white font-medium",children:s._count?.messages||0})]})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-2",onClick:e=>e.stopPropagation(),children:[e.jsx(u,{size:"sm",variant:"outline",className:"border-gray-700 hover:bg-blue-500/20 hover:border-blue-500 text-blue-400",onClick:()=>oe(s),children:e.jsx(p,{className:"w-4 h-4"})}),e.jsx(u,{size:"sm",variant:"outline",className:"border-gray-700 "+(s.isActive?"hover:bg-orange-500/20 hover:border-orange-500 text-orange-400":"hover:bg-green-500/20 hover:border-green-500 text-green-400"),onClick:()=>be(s),children:s.isActive?e.jsx(N,{className:"w-4 h-4"}):e.jsx(y,{className:"w-4 h-4"})}),e.jsx(u,{size:"sm",variant:"outline",className:"border-gray-700 hover:bg-red-500/20 hover:border-red-500 text-red-400",onClick:()=>ge(s),children:e.jsx(f,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})]})})]}),e.jsx(Q,{children:de&&e.jsx(M,{open:!!de,onOpenChange:()=>oe(null),children:e.jsxs(k,{className:"bg-gray-900 border-gray-700 text-white max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(B,{children:[e.jsx(I,{className:"text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"Detalhes do Cliente"}),e.jsxs(R,{className:"text-gray-400",children:["InformaÃ§Ãµes completas sobre ",de.name]})]}),e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs(n,{className:"bg-gray-800/50 border-gray-700",children:[e.jsx(d,{children:e.jsxs(o,{className:"text-lg text-white flex items-center gap-2",children:[e.jsx(r,{className:"w-5 h-5 text-blue-400"}),"InformaÃ§Ãµes Pessoais"]})}),e.jsxs(m,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Nome Completo"}),e.jsx("p",{className:"text-white font-medium",children:de.name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-400 flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4"}),"Email"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-white font-medium",children:de.email}),de.emailVerified&&e.jsx(w,{className:"bg-green-500/20 text-green-300 border-green-500/30",children:"Verificado"})]})]}),de.cpf&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"CPF"}),e.jsx("p",{className:"text-white font-medium",children:de.cpf})]}),de.birthDate&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-400 flex items-center gap-1",children:[e.jsx(C,{className:"w-4 h-4"}),"Data de Nascimento"]}),e.jsx("p",{className:"text-white font-medium",children:new Date(de.birthDate).toLocaleDateString("pt-BR")})]})]})]}),de.cep&&e.jsxs(n,{className:"bg-gray-800/50 border-gray-700",children:[e.jsx(d,{children:e.jsxs(o,{className:"text-lg text-white flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-green-400"}),"EndereÃ§o"]})}),e.jsxs(m,{className:"space-y-2",children:[e.jsxs("p",{className:"text-white",children:[de.street,", ",de.number,de.complement&&` - ${de.complement}`]}),e.jsxs("p",{className:"text-gray-400",children:[de.neighborhood," - ",de.city,"/",de.state]}),e.jsxs("p",{className:"text-gray-500",children:["CEP: ",de.cep]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(n,{className:"bg-gradient-to-br from-blue-500/10 to-purple-500/10 border-blue-500/30",children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm text-gray-300",children:"Total em Vendas"})}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:se(de._stats?.totalSales||0)}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[de._count?.orders||0," pedidos realizados"]})]})]}),e.jsxs(n,{className:"bg-gradient-to-br from-orange-500/10 to-red-500/10 border-orange-500/30",children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm text-gray-300",children:"Ticket MÃ©dio"})}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:se(de._stats?.averageOrderValue||0)}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Valor mÃ©dio por pedido"})]})]}),e.jsxs(n,{className:"bg-gradient-to-br from-green-500/10 to-emerald-500/10 border-green-500/30",children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm text-gray-300",children:"Campanhas"})}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:de._count?.campaigns||0}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Campanhas criadas"})]})]}),e.jsxs(n,{className:"bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border-cyan-500/30",children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm text-gray-300",children:"Mensagens IA"})}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:de._count?.messages||0}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Mensagens enviadas"})]})]})]}),e.jsxs(n,{className:"bg-gray-800/50 border-gray-700",children:[e.jsx(d,{children:e.jsxs(o,{className:"text-lg text-white flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5 text-purple-400"}),"Inform aÃ§Ãµes da Conta"]})}),e.jsxs(m,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Status"}),e.jsx("div",{className:"mt-1",children:ye(de.isActive)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Role"}),e.jsx("div",{className:"mt-1",children:Ne(de.role)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Data de Cadastro"}),e.jsx("p",{className:"text-white font-medium",children:new Date(de.createdAt).toLocaleDateString("pt-BR")})]}),de.trialEndsAt&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Trial Termina em"}),e.jsx("p",{className:"text-white font-medium",children:new Date(de.trialEndsAt).toLocaleDateString("pt-BR")})]})]})]})]})]})})}),e.jsx(U,{open:!!he,onOpenChange:()=>ge(null),children:e.jsxs(F,{className:"bg-gray-900 border-gray-700",children:[e.jsxs(H,{children:[e.jsx(W,{className:"text-white",children:"Excluir Cliente"}),e.jsxs(G,{className:"text-gray-400",children:["Tem certeza que deseja excluir ",e.jsx("strong",{className:"text-red-400",children:he?.name}),"? Esta aÃ§Ã£o nÃ£o pode ser desfeita e todos os dados serÃ£o permanentemente removidos."]})]}),e.jsxs(X,{children:[e.jsx(Y,{className:"bg-gray-800 text-white border-gray-700 hover:bg-gray-700",children:"Cancelar"}),e.jsx(Z,{onClick:async()=>{if(he)try{const{error:e}=await t.from("User").delete().eq("id",he.id);if(e)throw e;ae({title:"Cliente excluÃ­do",description:`${he.name} foi removido com sucesso.`}),await ue(),ge(null)}catch(e){ae({title:"Erro ao excluir cliente",description:e.message,variant:"destructive"})}},className:"bg-red-500 hover:bg-red-600 text-white",children:"Excluir"})]})]})}),e.jsx(U,{open:!!je,onOpenChange:()=>be(null),children:e.jsxs(F,{className:"bg-gray-900 border-gray-700",children:[e.jsxs(H,{children:[e.jsxs(W,{className:"text-white",children:[je?.isActive?"Bloquear":"Desbloquear"," Cliente"]}),e.jsxs(G,{className:"text-gray-400",children:["Tem certeza que deseja ",je?.isActive?"bloquear":"desbloquear"," ",e.jsx("strong",{className:"text-blue-400",children:je?.name}),"?",je?.isActive&&" O cliente nÃ£o poderÃ¡ mais acessar a plataforma."]})]}),e.jsxs(X,{children:[e.jsx(Y,{className:"bg-gray-800 text-white border-gray-700 hover:bg-gray-700",children:"Cancelar"}),e.jsx(Z,{onClick:async()=>{if(je)try{const e=!je.isActive,{error:s}=await t.from("User").update({isActive:e}).eq("id",je.id);if(s)throw s;ae({title:e?"Cliente ativado":"Cliente bloqueado",description:`${je.name} foi ${e?"ativado":"bloqueado"} com sucesso.`}),await ue(),be(null)}catch(e){ae({title:"Erro ao alterar status",description:e.message,variant:"destructive"})}},className:(je?.isActive?"bg-orange-500 hover:bg-orange-600":"bg-green-500 hover:bg-green-600")+" text-white",children:je?.isActive?"Bloquear":"Desbloquear"})]})]})})]})}export{ae as default};
