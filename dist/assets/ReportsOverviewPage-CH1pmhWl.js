import{j as e}from"./vendor-ui-DAyDU-p2.js";import{r as t}from"./vendor-react-BDwqAlkB.js";import{s as a,f as s,g as r,B as o,C as n,a as i,b as l,d,e as c,c as g}from"./index-CmmpI2Af.js";import{S as h,a as x,b as m,c as y,d as u}from"./select-9qpDTxuH.js";import{S as p}from"./skeleton-DoirG8FX.js";import{D as f,y as j,W as b,aP as v,Q as w,f as S,F as k,an as D,Z as A,k as N,N as I,J as O,K as C}from"./vendor-icons-CzCc3fGi.js";import{m as R}from"./vendor-animation-x8f1c1kX.js";import{R as T,e as P,C as E,X as q,Y as M,T as F,L as K,B as L,d as V,A as H,a as $,c as z}from"./vendor-charts-DgCBwi6-.js";import"./vendor-supabase-rKXMzPQL.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-D3VdSFIC.js";const B=e=>{const t=new Date,a=t;let s=new Date,r=new Date,o=new Date;switch(e){case"today":s.setHours(0,0,0,0),o=new Date(s),r=new Date(s),r.setDate(r.getDate()-1),o.setDate(o.getDate()-1),o.setHours(23,59,59,999);break;case"7days":default:s.setDate(t.getDate()-7),o=new Date(s),r=new Date(s),r.setDate(r.getDate()-7);break;case"30days":s.setDate(t.getDate()-30),o=new Date(s),r=new Date(s),r.setDate(r.getDate()-30);break;case"90days":s.setDate(t.getDate()-90),o=new Date(s),r=new Date(s),r.setDate(r.getDate()-90);break;case"year":s.setFullYear(t.getFullYear(),0,1),s.setHours(0,0,0,0),r=new Date(s),r.setFullYear(r.getFullYear()-1),o=new Date(s),o.setDate(o.getDate()-1)}return{start:s,end:a,previousStart:r,previousEnd:o}},W=(e,t)=>0===t?e>0?100:0:(e-t)/t*100,G={async getMetrics(e,t="7days"){const{start:s,end:r,previousStart:o,previousEnd:n}=B(t);try{const{data:t,error:i}=await a.from("Order").select("*").eq("userId",e).gte("createdAt",s.toISOString()).lte("createdAt",r.toISOString());if(i)throw i;const{data:l,error:d}=await a.from("Order").select("*").eq("userId",e).gte("createdAt",o.toISOString()).lte("createdAt",n.toISOString()),c=t?.filter(e=>"PAID"===e.paymentStatus)||[],g=l?.filter(e=>"PAID"===e.paymentStatus)||[],h=c.reduce((e,t)=>e+(("string"==typeof t.total?parseFloat(t.total):t.total)||0),0),x=g.reduce((e,t)=>e+(("string"==typeof t.total?parseFloat(t.total):t.total)||0),0),m=c.length,y=g.length,u=c.reduce((e,t)=>{const a=t.items||[];return Array.isArray(a)?e+a.reduce((e,t)=>e+(t.quantity||0),0):e},0),p=g.reduce((e,t)=>{const a=t.items||[];return Array.isArray(a)?e+a.reduce((e,t)=>e+(t.quantity||0),0):e},0),f=m>0?h/m:0,j=y>0?x/y:0,{data:b}=await a.from("Cart").select("*").eq("userId",e).gte("createdAt",s.toISOString()).lte("createdAt",r.toISOString()),{data:v}=await a.from("Cart").select("*").eq("userId",e).gte("createdAt",o.toISOString()).lte("createdAt",n.toISOString()),w=b?.length||0,S=v?.length||0,k=w>0?m/w*100:0,D=S>0?y/S*100:0,A=b||[],N=A.filter(e=>e.completedAt);let I=0,O=0;N.forEach(e=>{if(e.createdAt&&e.completedAt){const t=new Date(e.createdAt),a=new Date(e.completedAt).getTime()-t.getTime();a>0&&a<36e5&&(I+=a,O++)}});const C=O>0?I/O:48e4,R=Math.floor(C/6e4),T=`${R}m ${Math.floor(C%6e4/1e3)}s`,P=A.filter(e=>!e.completedAt&&!e.convertedToOrderId),E=A.length>0?P.length/A.length*100:0,q=v||[],M=q.filter(e=>!e.completedAt&&!e.convertedToOrderId),F=q.length>0?M.length/q.length*100:0,K=W(C,.95*C);return{totalRevenue:h,revenueChange:W(h,x),totalOrders:m,ordersChange:W(m,y),uniqueVisitors:w,visitorsChange:W(w,S),conversionRate:k,conversionChange:W(k,D),averageTicket:f,ticketChange:W(f,j),productsSold:u,productsSoldChange:W(u,p),averageTime:T,timeChange:K,bounceRate:E,bounceRateChange:W(E,F)}}catch(i){throw i}},async getChartData(e,t="7days"){const{start:s,end:r}=B(t);try{const{data:t,error:o}=await a.from("Order").select("*").eq("userId",e).gte("createdAt",s.toISOString()).lte("createdAt",r.toISOString()).order("createdAt",{ascending:!0});if(o)throw o;const{data:n}=await a.from("Cart").select("*").eq("userId",e).gte("createdAt",s.toISOString()).lte("createdAt",r.toISOString()),i=["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],l={};return t?.forEach(e=>{const t=new Date(e.createdAt).getDay();l[t]||(l[t]={orders:[],carts:[]}),l[t].orders.push(e)}),n?.forEach(e=>{const t=new Date(e.createdAt).getDay();l[t]||(l[t]={orders:[],carts:[]}),l[t].carts.push(e)}),i.map((e,t)=>{const a=l[t]||{orders:[],carts:[]},s=(a.orders.filter(e=>"PAID"===e.paymentStatus),a.carts.filter(e=>!e.completedAt)),r=a.carts.length;return{name:e,pageLoad:Math.floor(300*Math.random())+200,bounceRate:r>0?s.length/r*100:30,startRender:Math.floor(200*Math.random())+100,sessions:r,sessionLength:Math.floor(10*Math.random())+5,pvs:Math.floor(2*Math.random())+1}})}catch(o){return[]}},async getHourlyData(e){const t=new Date,s=new Date(t);s.setHours(0,0,0,0);try{const{data:r,error:o}=await a.from("Order").select("*").eq("userId",e).gte("createdAt",s.toISOString()).lte("createdAt",t.toISOString()).order("createdAt",{ascending:!0});if(o)throw o;const{data:n}=await a.from("Cart").select("*").eq("userId",e).gte("createdAt",s.toISOString()).lte("createdAt",t.toISOString()),i={};return r?.forEach(e=>{const t=new Date(e.createdAt).getHours();i[t]||(i[t]={orders:[],carts:[]}),i[t].orders.push(e)}),n?.forEach(e=>{const t=new Date(e.createdAt).getHours();i[t]||(i[t]={orders:[],carts:[]}),i[t].carts.push(e)}),Array.from({length:24},(e,t)=>{const a=i[t]||{orders:[],carts:[]},s=a.orders.filter(e=>"PAID"===e.paymentStatus),r=s.reduce((e,t)=>e+(("string"==typeof t.total?parseFloat(t.total):t.total)||0),0);return{hour:`${t}h`,visits:a.carts.length,conversions:s.length,revenue:r}})}catch(r){return[]}},async getGatewayPerformance(e,t="7days"){const{start:s,end:r}=B(t);try{const{data:t,error:o}=await a.from("Transaction").select("\n          *,\n          Gateway:gatewayId (\n            id,\n            name,\n            slug\n          )\n        ").eq("userId",e).gte("createdAt",s.toISOString()).lte("createdAt",r.toISOString());if(o)throw o;const n={};return t?.forEach(e=>{const t=e.Gateway;if(!t)return;const a=t.id;n[a]||(n[a]={gatewayId:a,gatewayName:t.name,transactions:[]}),n[a].transactions.push(e)}),Object.values(n).map(e=>{const t=e.transactions,a=t.filter(e=>"PAID"===e.status||"APPROVED"===e.status),s=t.filter(e=>"FAILED"===e.status||"REJECTED"===e.status),r=a.reduce((e,t)=>e+(("string"==typeof t.amount?parseFloat(t.amount):t.amount)||0),0),o=a.length>0?r/a.length:0,n=t.length>0?a.length/t.length*100:0;return{gatewayId:e.gatewayId,gatewayName:e.gatewayName,totalTransactions:t.length,successfulTransactions:a.length,failedTransactions:s.length,totalRevenue:r,avgTicket:o,successRate:n}})}catch(o){return[]}},async getRecentOrders(e,t=10){try{const{data:s,error:r}=await a.from("Order").select("*").eq("userId",e).order("createdAt",{ascending:!1}).limit(t);if(r)throw r;return s||[]}catch(s){return[]}},async getRevenueByDay(e,t="7days"){const{start:s,end:r}=B(t);try{const{data:t,error:o}=await a.from("Order").select("*").eq("userId",e).eq("paymentStatus","PAID").gte("createdAt",s.toISOString()).lte("createdAt",r.toISOString()).order("createdAt",{ascending:!0});if(o)throw o;const n={};return t?.forEach(e=>{const t=new Date(e.createdAt).toLocaleDateString("pt-BR");n[t]||(n[t]=0);const a="string"==typeof e.total?parseFloat(e.total):e.total;n[t]+=a||0}),Object.entries(n).map(([e,t])=>({date:e,revenue:t}))}catch(o){return[]}}},Y=({title:t,value:a,change:s,icon:r,color:o,delay:d=0})=>{const c=s>=0;return e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:d},children:e.jsxs(n,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${o} opacity-10 rounded-full blur-3xl`}),e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:t}),e.jsx("div",{className:`p-2 rounded-lg ${o} bg-opacity-10`,children:e.jsx(r,{className:`h-4 w-4 ${o.replace("bg-","text-")}`})})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:a}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[c?e.jsx(O,{className:"h-4 w-4 text-green-500"}):e.jsx(C,{className:"h-4 w-4 text-red-500"}),e.jsxs("span",{className:"text-sm font-semibold "+(c?"text-green-500":"text-red-500"),children:[Math.abs(s),"%"]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"vs último período"})]})]})]})})},Q=({active:t,payload:a,label:s})=>t&&a&&a.length?e.jsxs("div",{className:"bg-gray-900/95 dark:bg-gray-800/95 backdrop-blur-xl border border-gray-700 rounded-lg p-4 shadow-xl",children:[e.jsx("p",{className:"text-white font-semibold mb-2",children:s}),a.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsxs("span",{className:"text-gray-300",children:[t.name,":"]}),e.jsx("span",{className:"text-white font-semibold",children:t.value})]},a))]}):null,J=()=>{const[a,O]=t.useState(!0),[C,B]=t.useState("7days"),[W,J]=t.useState(null),[X,Z]=t.useState([]),[U,_]=t.useState([]),ee=s(e=>e.user),{toast:te}=r();t.useEffect(()=>{ee?.id&&ae()},[ee?.id,C]);const ae=async()=>{if(ee?.id)try{O(!0);const[e,t,a]=await Promise.all([G.getMetrics(ee.id,C),G.getChartData(ee.id,C),G.getHourlyData(ee.id)]);J(e),Z(t),_(a)}catch(e){te({title:"Erro ao carregar dados",description:e.message,variant:"destructive"})}finally{O(!1)}},se=e=>{B(e)},re=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),oe=e=>new Intl.NumberFormat("pt-BR").format(e),ne=W?[{title:"Receita Total",value:re(W.totalRevenue),change:W.revenueChange,icon:f,color:"bg-green-500"},{title:"Total de Pedidos",value:oe(W.totalOrders),change:W.ordersChange,icon:j,color:"bg-blue-500"},{title:"Visitantes Únicos",value:oe(W.uniqueVisitors),change:W.visitorsChange,icon:b,color:"bg-purple-500"},{title:"Taxa de Conversão",value:`${W.conversionRate.toFixed(2)}%`,change:W.conversionChange,icon:v,color:"bg-cyan-500"},{title:"Ticket Médio",value:re(W.averageTicket),change:W.ticketChange,icon:w,color:"bg-pink-500"},{title:"Produtos Vendidos",value:oe(W.productsSold),change:W.productsSoldChange,icon:w,color:"bg-orange-500"},{title:"Tempo Médio",value:W.averageTime,change:W.timeChange,icon:S,color:"bg-yellow-500"},{title:"Taxa de Rejeição",value:`${W.bounceRate.toFixed(1)}%`,change:W.bounceRateChange,icon:k,color:"bg-red-500"}]:[];return a?e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{className:"h-12 w-full"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(8)].map((t,a)=>e.jsx(p,{className:"h-32"},a))}),e.jsx(p,{className:"h-96"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(R.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Dashboard"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1 flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Visão geral das suas métricas de vendas e conversão"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(h,{value:C,onValueChange:se,children:[e.jsx(x,{className:"w-[180px] bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700",children:e.jsx(m,{placeholder:"Período"})}),e.jsxs(y,{children:[e.jsx(u,{value:"today",children:"Hoje"}),e.jsx(u,{value:"7days",children:"Últimos 7 dias"}),e.jsx(u,{value:"30days",children:"Últimos 30 dias"}),e.jsx(u,{value:"90days",children:"Últimos 90 dias"}),e.jsx(u,{value:"year",children:"Este ano"})]})]}),e.jsx(o,{variant:"outline",size:"icon",onClick:()=>se(C),children:e.jsx(k,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:ne.map((t,a)=>e.jsx(Y,{...t,delay:.05*a},a))}),e.jsx(R.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.4},children:e.jsxs(n,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-xl font-bold",children:"Tempo de Carregamento vs Taxa de Rejeição"}),e.jsx(d,{children:"Análise de performance e comportamento do usuário"})]}),e.jsxs(c,{className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white border-0",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),"Tempo Real"]})]})}),e.jsx(g,{children:e.jsx(T,{width:"100%",height:350,children:X.length>0?e.jsxs(P,{data:X,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorPageLoad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#06b6d4",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#06b6d4",stopOpacity:.1})]}),e.jsxs("linearGradient",{id:"colorStartRender",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})]}),e.jsx(E,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),e.jsx(q,{dataKey:"name",stroke:"#9ca3af",style:{fontSize:"12px"}}),e.jsx(M,{yAxisId:"left",stroke:"#9ca3af",style:{fontSize:"12px"}}),e.jsx(M,{yAxisId:"right",orientation:"right",stroke:"#9ca3af",style:{fontSize:"12px"}}),e.jsx(F,{content:e.jsx(Q,{})}),e.jsx(K,{wrapperStyle:{paddingTop:"20px"},iconType:"circle"}),e.jsx(L,{yAxisId:"left",dataKey:"pageLoad",fill:"url(#colorPageLoad)",radius:[8,8,0,0],name:"Page Load (ms)"}),e.jsx(L,{yAxisId:"left",dataKey:"startRender",fill:"url(#colorStartRender)",radius:[8,8,0,0],name:"Start Render (ms)"}),e.jsx(V,{yAxisId:"right",type:"monotone",dataKey:"bounceRate",stroke:"#ef4444",strokeWidth:3,dot:{fill:"#ef4444",r:5},name:"Bounce Rate (%)"})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Sem dados disponíveis"})})})]})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx(R.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.5},children:e.jsxs(n,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsxs(i,{children:[e.jsxs(l,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5 text-purple-500"}),"Sessões ao Longo do Dia"]}),e.jsx(d,{children:"Distribuição de tráfego por hora"})]}),e.jsx(g,{children:e.jsx(T,{width:"100%",height:250,children:U.length>0?e.jsxs(H,{data:U,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorVisits",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:.1})]})}),e.jsx(E,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),e.jsx(q,{dataKey:"hour",stroke:"#9ca3af",style:{fontSize:"10px"}}),e.jsx(M,{stroke:"#9ca3af",style:{fontSize:"10px"}}),e.jsx(F,{content:e.jsx(Q,{})}),e.jsx($,{type:"monotone",dataKey:"visits",stroke:"#8b5cf6",strokeWidth:2,fill:"url(#colorVisits)",name:"Visitas"})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Sem dados disponíveis"})})})]})}),e.jsx(R.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.5},children:e.jsxs(n,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsxs(i,{children:[e.jsxs(l,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5 text-green-500"}),"Conversões e Receita"]}),e.jsx(d,{children:"Performance financeira por hora"})]}),e.jsx(g,{children:e.jsx(T,{width:"100%",height:250,children:U.length>0?e.jsxs(z,{data:U,children:[e.jsx(E,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),e.jsx(q,{dataKey:"hour",stroke:"#9ca3af",style:{fontSize:"10px"}}),e.jsx(M,{stroke:"#9ca3af",style:{fontSize:"10px"}}),e.jsx(F,{content:e.jsx(Q,{})}),e.jsx(V,{type:"monotone",dataKey:"conversions",stroke:"#10b981",strokeWidth:3,dot:{fill:"#10b981",r:4},name:"Conversões"}),e.jsx(V,{type:"monotone",dataKey:"revenue",stroke:"#06b6d4",strokeWidth:3,dot:{fill:"#06b6d4",r:4},name:"Receita (R$)"})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Sem dados disponíveis"})})})]})})]}),e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:e.jsxs(n,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsxs(i,{children:[e.jsxs(l,{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-cyan-500"}),"Métricas de Engajamento"]}),e.jsx(d,{children:"Análise detalhada do comportamento dos usuários"})]}),e.jsx(g,{children:e.jsx(T,{width:"100%",height:300,children:X.length>0?e.jsxs(P,{data:X,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorSessions",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:.1})]})}),e.jsx(E,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),e.jsx(q,{dataKey:"name",stroke:"#9ca3af"}),e.jsx(M,{yAxisId:"left",stroke:"#9ca3af"}),e.jsx(M,{yAxisId:"right",orientation:"right",stroke:"#9ca3af"}),e.jsx(F,{content:e.jsx(Q,{})}),e.jsx(K,{}),e.jsx($,{yAxisId:"left",type:"monotone",dataKey:"sessions",fill:"url(#colorSessions)",stroke:"#10b981",strokeWidth:2,name:"Sessões"}),e.jsx(V,{yAxisId:"right",type:"monotone",dataKey:"sessionLength",stroke:"#f59e0b",strokeWidth:3,dot:{fill:"#f59e0b",r:5},name:"Tempo de Sessão (min)"}),e.jsx(V,{yAxisId:"right",type:"monotone",dataKey:"pvs",stroke:"#ec4899",strokeWidth:3,dot:{fill:"#ec4899",r:5},name:"PVs por Sessão"})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Sem dados disponíveis"})})})]})})]})};export{J as default};
