import{c as ce,n as le,e as oe,f as de,u as me,r as n,s as m,j as e,m as S,g as y,h as $,i as H,l as j,I as z,O as I,B as E,o as A}from"./index-BjAA55p6.js";import{L as q}from"./label-BaCxy0_F.js";import{S as w}from"./switch-DXaeTIBf.js";import{a as xe}from"./gatewaysList-BfxCdpsq.js";import{S as R,a as U,b as X,c as J,d as G}from"./select-BG08TImw.js";import{A as ge}from"./arrow-left-BKfflHUX.js";import{E as pe}from"./external-link-BM6PT7H0.js";import"./index-824r3Wh1.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=ce("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ce=()=>{const{slug:b}=le(),u=oe(),{toast:d}=de(),c=me(a=>a.user),[t,K]=n.useState(null),[Q,V]=n.useState(!0),[N,F]=n.useState(!1),[x,D]=n.useState(!1),[g,C]=n.useState(!1),[p,L]=n.useState("production"),[M,P]=n.useState(null),[B,W]=n.useState(null),[T,O]=n.useState(!1),[l,_]=n.useState({}),[Y,Z]=n.useState(!1),[ee,ae]=n.useState(!1),[se,te]=n.useState(!1);n.useEffect(()=>{b&&re()},[b]);const re=async()=>{try{V(!0);const a=xe(b);if(!a){d({title:"Gateway não encontrado",description:"O gateway solicitado não existe.",variant:"destructive"}),u("/checkout/gateways");return}if(K(a),c!=null&&c.id){const{data:s}=await m.from("Gateway").select("id").eq("slug",a.slug).single();if(s!=null&&s.id){const{data:r,error:v}=await m.from("GatewayConfig").select("*").eq("userId",c.id).eq("gatewayId",s.id).single();!v&&r&&(D(r.isActive||!1),C(r.isVerified??!1),L(r.environment??"production"),P(r.verifiedAt??null),W(r.id),_(r.credentials||{}))}}}catch(a){console.error("Error loading gateway:",a)}finally{V(!1)}},ie=async()=>{if(!(!t||!(c!=null&&c.id)))try{let a=null;F(!0);const s=t.configFields.filter(i=>i.required&&!l[i.name]).map(i=>i.label);if(s.length>0){d({title:"Campos obrigatórios",description:`Preencha os campos: ${s.join(", ")}`,variant:"destructive"});return}const{data:r,error:v}=await m.from("Gateway").select("id, slug, name").eq("slug",t.slug).single();if(v||!(r!=null&&r.id))throw v||new Error("Gateway não encontrado no banco");const{data:k}=await m.from("GatewayConfig").select("id").eq("userId",c.id).eq("gatewayId",r.id).single();if(k){const{error:i}=await m.from("GatewayConfig").update({credentials:l,isActive:x,updatedAt:new Date().toISOString()}).eq("id",k.id);i||(a=k.id)}else{const{data:i}=await m.from("GatewayConfig").select("id").eq("userId",c.id).limit(1),{data:o,error:h}=await m.from("GatewayConfig").insert({userId:c.id,gatewayId:r.id,credentials:l,isActive:x,isDefault:!i||i.length===0}).select("id").single();if(h)throw h;a=(o==null?void 0:o.id)||null}d({title:"Configuração salva!",description:`Gateway ${t.name} foi configurado com sucesso.`});try{const i=a?{configId:a,credentials:l,persistCredentials:!1}:{slug:t.slug,credentials:l,persistCredentials:!1},{data:o,error:h}=await m.functions.invoke("gateway-config-verify",{body:i});if(h)throw h;o!=null&&o.success?d({title:"Credenciais verificadas",description:o.message||"Gateway verificado com sucesso."}):d({title:"Falha na verificação",description:(o==null?void 0:o.message)||"Confira suas credenciais e tente novamente.",variant:"destructive"})}catch(i){d({title:"Erro ao verificar",description:(i==null?void 0:i.message)||"Não foi possível verificar as credenciais.",variant:"destructive"})}u("/checkout/gateways")}catch(a){console.error("Error saving gateway config:",a),d({title:"Erro ao salvar",description:"Não foi possível salvar a configuração.",variant:"destructive"})}finally{F(!1)}},ne=async()=>{if(!(!t||!(c!=null&&c.id)))try{O(!0);const a={};B?(a.configId=B,a.credentials=l,a.persistCredentials=!1):(a.slug=t.slug,a.credentials=l,a.persistCredentials=!1);const{data:s,error:r}=await m.functions.invoke("gateway-config-verify",{body:a});if(r)throw r;s!=null&&s.success?(C(!0),P(s.verifiedAt||new Date().toISOString()),L("production"),d({title:"Verificação bem-sucedida",description:s.message||"Credenciais verificadas com sucesso."})):(C(!1),d({title:"Falha na verificação",description:(s==null?void 0:s.message)||"Não foi possível verificar as credenciais.",variant:"destructive"}))}catch(a){d({title:"Erro na verificação",description:(a==null?void 0:a.message)||"Erro inesperado ao verificar as credenciais.",variant:"destructive"})}finally{O(!1)}},f=(a,s)=>{_(r=>({...r,[a]:s}))};return Q?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(S,{className:"h-8 w-8 animate-spin text-gray-400"})}):t?e.jsxs("div",{className:"p-6 sm:p-8 max-w-5xl mx-auto space-y-6",children:[e.jsxs("button",{onClick:()=>u("/checkout/gateways"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"ver todos gateways"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex items-center justify-center overflow-hidden p-2",children:e.jsx("img",{src:t.logo,alt:`${t.name} logo`,className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:t.name}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:["Integre sua loja ao gateway ",t.name,"."]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(y,{children:[e.jsx($,{children:e.jsx(H,{children:"Informações básicas"})}),e.jsx(j,{className:"space-y-4",children:t.configFields.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(q,{htmlFor:a.name,children:[a.label," ",a.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),a.type==="text"&&e.jsx(z,{id:a.name,type:"text",placeholder:a.placeholder,value:l[a.name]||"",onChange:s=>f(a.name,s.target.value),required:a.required}),a.type==="password"&&e.jsx(z,{id:a.name,type:"password",placeholder:a.placeholder,value:l[a.name]||"",onChange:s=>f(a.name,s.target.value),required:a.required}),a.type==="select"&&a.options&&e.jsxs(R,{value:l[a.name]||"",onValueChange:s=>f(a.name,s),children:[e.jsx(U,{children:e.jsx(X,{placeholder:a.placeholder||"Selecione"})}),e.jsx(J,{children:a.options.map(s=>e.jsx(G,{value:s.value,children:s.label},s.value))})]}),a.type==="checkbox"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:a.name,checked:l[a.name]||!1,onCheckedChange:s=>f(a.name,s)}),e.jsx(q,{htmlFor:a.name,className:"cursor-pointer",children:a.label})]})]},a.name))})]}),t.paymentMethods.length>0&&e.jsxs(y,{children:[e.jsx($,{children:e.jsx(H,{children:"Regras"})}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[t.paymentMethods.includes("credit_card")&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsx("span",{className:"text-sm",children:"Ativar cartão de crédito"}),e.jsx(w,{checked:Y,onCheckedChange:a=>{console.log("Toggle cartão:",a),Z(a)},disabled:!g||p!=="production"}),(!g||p!=="production")&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"Disponível após verificação em produção"})]}),t.paymentMethods.includes("pix")&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsx("span",{className:"text-sm",children:"Ativar pix"}),e.jsx(w,{checked:ee,onCheckedChange:a=>{console.log("Toggle PIX:",a),ae(a)},disabled:!g||p!=="production"}),(!g||p!=="production")&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"Disponível após verificação em produção"})]}),t.paymentMethods.includes("boleto")&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsx("span",{className:"text-sm",children:"Utilizar taxa de juros customizada"}),e.jsx(w,{checked:se,onCheckedChange:a=>{console.log("Toggle boleto:",a),te(a)},disabled:!g||p!=="production"}),(!g||p!=="production")&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"Disponível após verificação em produção"})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(y,{className:I("border-2",x?"border-green-200 bg-green-50 dark:bg-green-950/20":"border-red-200 bg-red-50 dark:bg-red-950/20"),children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(q,{htmlFor:"status",className:"text-base font-semibold",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:I("h-3 w-3 rounded-full",x?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:I("text-sm font-medium",x?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"),children:x?"Ativo":"Inativo"})]})]}),e.jsxs(R,{value:x?"active":"inactive",onValueChange:a=>D(a==="active"),children:[e.jsx(U,{id:"status",children:e.jsx(X,{})}),e.jsxs(J,{children:[e.jsx(G,{value:"active",children:"Ativo"}),e.jsx(G,{value:"inactive",children:"Inativo"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Verificação"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:g&&M?`Verificado em: ${new Date(M).toLocaleString()}`:"Não verificado"}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Ambiente: ",p]})]}),e.jsx(E,{onClick:async()=>{await ne()},disabled:T,className:"gap-2",children:T?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 animate-spin"})," ","Verificando..."]}):"Verificar credenciais"})]}),e.jsxs("a",{href:t.apiDocs,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-pink-600 hover:text-pink-700 dark:text-pink-400 dark:hover:text-pink-300",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:"Está com dúvidas?"}),e.jsxs("span",{className:"underline",children:["Como integrar o gateway ",t.name,"?"]}),e.jsx(pe,{className:"h-3 w-3"})]})]})]})}),e.jsx(y,{children:e.jsxs(j,{className:"p-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Tipo"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[(t.type==="nacional"||t.type==="both")&&e.jsx(A,{variant:"secondary",children:"Nacional"}),(t.type==="global"||t.type==="both")&&e.jsx(A,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:"Global"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Métodos de Pagamento"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:t.paymentMethods.map(a=>e.jsxs(A,{variant:"outline",className:"text-xs",children:[a==="credit_card"&&"Cartão de Crédito",a==="debit_card"&&"Cartão de Débito",a==="pix"&&"Pix",a==="boleto"&&"Boleto",a==="wallet"&&"Carteira Digital"]},a))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Features"}),e.jsx("ul",{className:"mt-1 space-y-1",children:t.features.map((a,s)=>e.jsxs("li",{className:"text-xs text-gray-700 dark:text-gray-300",children:["• ",a]},s))})]})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[e.jsx(E,{variant:"outline",onClick:()=>u("/checkout/gateways"),disabled:N,children:"Cancelar"}),e.jsx(E,{onClick:ie,disabled:N,className:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white",children:N?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando..."]}):"Salvar"})]})]}):null};export{Ce as default};
