import{c as q,r as d,f as Q,u as U,s as J,j as e,g as m,h as u,i as h,l as j,t as K,I as W,B as v,k as Y,n as Z,w as _}from"./index-BFTcrzh6.js";import{T as $,a as ee,b as S,c as i,d as se,e as o}from"./table-9YC3zgwT.js";import{S as ae,a as te,b as re,c as le,d as p}from"./select-Drvt7GOT.js";import{A as ne,b as de}from"./alert-C66WkLka.js";import{S as y}from"./skeleton-DmvgNpfJ.js";import{C as X}from"./clock-BlEq8l1c.js";import{T as ie}from"./trending-up-5lbaytBf.js";import{D as R}from"./dollar-sign-zGStkSMO.js";import{C as I}from"./circle-alert-BlFNKwvJ.js";import{f as C,p as P}from"./pt-BR-COO1Bk_c.js";import"./index-DGeQ81w0.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=q("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),ye=()=>{const[r,L]=d.useState([]),[f,k]=d.useState([]),[B,b]=d.useState(!0),[l,M]=d.useState(""),[c,z]=d.useState("all"),{toast:w}=Q(),n=U(s=>s.user);d.useEffect(()=>{E()},[n==null?void 0:n.organizationId]),d.useEffect(()=>{G()},[l,c,r]);const E=async()=>{try{if(!(n!=null&&n.organizationId))return;b(!0);const{data:s,error:a}=await J.from("Transaction").select(`
          *,
          Order:orderId (
            id,
            orderNumber,
            customerName,
            customerEmail
          )
        `).eq("paymentMethod","PIX").eq("organizationId",n.organizationId).order("createdAt",{ascending:!1});if(a)throw a;const g=(s||[]).map(t=>{var A,D,T;return{id:t.id,orderId:t.orderId,orderNumber:((A=t.Order)==null?void 0:A.orderNumber)||t.orderId.substring(0,8),customerName:((D=t.Order)==null?void 0:D.customerName)||"N/A",customerEmail:((T=t.Order)==null?void 0:T.customerEmail)||"N/A",amount:t.amount,pixCopyPaste:t.pixCopyPaste,pixQrCode:t.pixQrCode,status:t.status,expiresAt:t.pixExpiresAt,paidAt:t.paidAt,createdAt:t.createdAt}});L(g)}catch(s){console.error("Erro ao carregar transações PIX:",s),w({title:"Erro ao carregar transações",description:s.message,variant:"destructive"})}finally{b(!1)}},G=()=>{let s=r;l&&(s=s.filter(a=>a.orderNumber.toLowerCase().includes(l.toLowerCase())||a.customerName.toLowerCase().includes(l.toLowerCase())||a.customerEmail.toLowerCase().includes(l.toLowerCase()))),c!=="all"&&(s=s.filter(a=>a.status===c)),k(s)},x=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),H=s=>{const a={PENDING:{label:"Aguardando Pagamento",variant:"secondary",icon:X},PAID:{label:"Pago",variant:"default",icon:_},EXPIRED:{label:"Expirado",variant:"destructive",icon:I},CANCELLED:{label:"Cancelado",variant:"secondary",icon:I}};return a[s]||a.PENDING},N=r.filter(s=>s.status==="PENDING").reduce((s,a)=>s+a.amount,0),F=r.filter(s=>s.status==="PAID").reduce((s,a)=>s+a.amount,0),V=r.filter(s=>s.status==="EXPIRED").reduce((s,a)=>s+a.amount,0),O=r.length>0?(r.filter(s=>s.status==="PAID").length/r.length*100).toFixed(1):"0";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"PIX Recuperados"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie transações PIX e recupere vendas perdidas"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Aguardando Pagamento"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x(N)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.filter(s=>s.status==="PENDING").length," transação(ões)"]})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"PIX Recuperados"}),e.jsx(ie,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x(F)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.filter(s=>s.status==="PAID").length," pagamentos confirmados"]})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Expirados"}),e.jsx(oe,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x(V)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.filter(s=>s.status==="EXPIRED").length," não recuperados"]})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Taxa de Recuperação"}),e.jsx(R,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[O,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Taxa de conversão de PIX"})]})]})]}),N>0&&e.jsxs(ne,{children:[e.jsx(I,{className:"h-4 w-4"}),e.jsxs(de,{children:["Você tem ",e.jsx("strong",{children:x(N)})," em PIX aguardando pagamento. Considere enviar lembretes para os clientes."]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(K,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(W,{placeholder:"Buscar por pedido, cliente ou email...",value:l,onChange:s=>M(s.target.value),className:"pl-9"})]}),e.jsxs(ae,{value:c,onValueChange:z,children:[e.jsx(te,{className:"w-[200px]",children:e.jsx(re,{placeholder:"Status"})}),e.jsxs(le,{children:[e.jsx(p,{value:"all",children:"Todos"}),e.jsx(p,{value:"PENDING",children:"Aguardando"}),e.jsx(p,{value:"PAID",children:"Pago"}),e.jsx(p,{value:"EXPIRED",children:"Expirado"}),e.jsx(p,{value:"CANCELLED",children:"Cancelado"})]})]}),e.jsx(v,{onClick:E,variant:"outline",children:"Atualizar"})]}),e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(h,{children:"Transações PIX"}),e.jsxs(Y,{children:[f.length," transação(ões) encontrada(s)"]})]}),e.jsx(j,{children:B?e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"h-12 w-full"}),e.jsx(y,{className:"h-12 w-full"}),e.jsx(y,{className:"h-12 w-full"})]}):f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(R,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhum PIX encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l||c!=="all"?"Tente ajustar os filtros":"Aguardando primeira transação PIX"})]}):e.jsxs($,{children:[e.jsx(ee,{children:e.jsxs(S,{children:[e.jsx(i,{children:"Pedido"}),e.jsx(i,{children:"Cliente"}),e.jsx(i,{children:"Valor"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Expira em"}),e.jsx(i,{children:"Data"}),e.jsx(i,{className:"text-right",children:"Ações"})]})}),e.jsx(se,{children:f.map(s=>{const a=H(s.status),g=a.icon;return e.jsxs(S,{children:[e.jsx(o,{children:e.jsxs("div",{className:"font-mono text-sm",children:["#",s.orderNumber]})}),e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customerName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.customerEmail})]})}),e.jsxs(o,{children:[e.jsx("div",{className:"font-medium",children:x(s.amount)}),s.paidAt&&e.jsxs("div",{className:"text-sm text-green-600",children:["Pago em ",C(new Date(s.paidAt),"dd/MM/yyyy HH:mm",{locale:P})]})]}),e.jsx(o,{children:e.jsxs(Z,{variant:a.variant,className:"gap-1",children:[e.jsx(g,{className:"h-3 w-3"}),a.label]})}),e.jsx(o,{children:s.expiresAt?e.jsx("div",{className:"text-sm",children:C(new Date(s.expiresAt),"dd/MM/yyyy HH:mm",{locale:P})}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"-"})}),e.jsx(o,{children:C(new Date(s.createdAt),"dd/MM/yyyy",{locale:P})}),e.jsx(o,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[s.status==="PENDING"&&s.pixCopyPaste&&e.jsx(v,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(s.pixCopyPaste),w({title:"Chave PIX copiada!"})},children:"Copiar PIX"}),e.jsx(v,{variant:"ghost",size:"sm",children:"Ver detalhes"})]})})]},s.id)})})]})})]})]})};export{ye as default};
