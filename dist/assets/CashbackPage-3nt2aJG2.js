import{j as e}from"./vendor-ui-Ba0j3nT4.js";import{r as a}from"./vendor-react-X41Bjl18.js";import{s as t,g as s,f as r,B as i,C as c,a as l,b as n,d as o,c as d,e as u,I as h}from"./index-Cu79CX_l.js";import{L as m}from"./label-JhWrXpMH.js";import{T as x,a as g,b as j,c as p,d as v,e as b}from"./table-Bv-q1F7z.js";import{D as f,b as y,c as C,d as w,e as E,f as N}from"./dialog-Ci2aM2I1.js";import{S as A,a as k,b as I,c as T,d as R}from"./select-Bdx2WqZH.js";import{S as P}from"./switch-D9kgfRsC.js";import{T as D,a as S,b as V,c as L}from"./tabs-CV2nxYT1.js";import{A as O,a as q}from"./alert-BwDN7YAM.js";import{S as F}from"./skeleton-B2jPStel.js";import{m as U}from"./vendor-animation-mzn7-F4O.js";import{aN as B,b1 as G,aj as M,D as z,N as $,R as X,b2 as H,C as W,Q,Y,av as _}from"./vendor-icons-BvRy6l6m.js";import{f as J}from"./vendor-utils-Dl0_yMKq.js";import{p as K}from"./pt-BR-BbSwNUOy.js";import"./vendor-supabase-D-IBGfoY.js";import"./vendor-query-NmUWZ0iG.js";const Z={async createRule(e){try{const{data:a,error:s}=await t.from("Cashback").insert(e).select().single();if(s)throw s;return a}catch(a){throw a}},async updateRule(e,a){try{const{data:s,error:r}=await t.from("Cashback").update({...a,updatedAt:(new Date).toISOString()}).eq("id",e).select().single();if(r)throw r;return s}catch(s){throw s}},async deleteRule(e){try{const{error:a}=await t.from("Cashback").delete().eq("id",e);if(a)throw a}catch(a){throw a}},async listRules(e,a){try{let s=t.from("Cashback").select("*").eq("userId",e).order("createdAt",{ascending:!1});a?.status&&(s=s.eq("status",a.status)),void 0!==a?.active&&(s=a.active?s.eq("status","ACTIVE"):s.neq("status","ACTIVE"));const{data:r,error:i}=await s;if(i)throw i;return r}catch(s){throw s}},async getRuleById(e){try{const{data:a,error:s}=await t.from("Cashback").select("*").eq("id",e).single();if(s)throw s;return a}catch(a){throw a}},async toggleRule(e,a){try{const t=a?"ACTIVE":"INACTIVE";return await Z.updateRule(e,{status:t})}catch(t){throw t}},async createTransaction(e){try{const{data:a,error:s}=await t.from("CashbackTransaction").insert(e).select().single();if(s)throw s;return a}catch(a){throw a}},async updateTransaction(e,a){try{const{data:s,error:r}=await t.from("CashbackTransaction").update({...a,updatedAt:(new Date).toISOString()}).eq("id",e).select().single();if(r)throw r;return s}catch(s){throw s}},async getTransactions(e,a){try{let s=t.from("CashbackTransaction").select("*").eq("userId",e).order("createdAt",{ascending:!1});a?.customerId&&(s=s.eq("customerId",a.customerId)),a?.status&&(s=s.eq("status",a.status)),a?.orderId&&(s=s.eq("orderId",a.orderId)),a?.dateFrom&&(s=s.gte("createdAt",a.dateFrom)),a?.dateTo&&(s=s.lte("createdAt",a.dateTo)),a?.limit&&(s=s.limit(a.limit));const{data:r,error:i}=await s;if(i)throw i;return r}catch(s){throw s}},async getTransactionById(e){try{const{data:a,error:s}=await t.from("CashbackTransaction").select("*").eq("id",e).single();if(s)throw s;return a}catch(a){throw a}},async getAvailableCashback(e){try{const{data:a,error:s}=await t.from("CashbackTransaction").select("amount").eq("customerId",e).eq("status","AVAILABLE");if(s)throw s;return a.reduce((e,a)=>e+a.amount,0)}catch(a){throw a}},async getCustomerCashback(e){try{const{data:a,error:s}=await t.from("CashbackTransaction").select("*").eq("customerId",e).order("createdAt",{ascending:!1});if(s)throw s;const r=a,i=r.filter(e=>"CANCELLED"!==e.status).reduce((e,a)=>e+a.amount,0),c=r.filter(e=>"USED"===e.status).reduce((e,a)=>e+a.amount,0),l=r.filter(e=>"AVAILABLE"===e.status).reduce((e,a)=>e+a.amount,0);return{customerId:e,totalEarned:i,totalUsed:c,available:l,expired:r.filter(e=>"EXPIRED"===e.status).reduce((e,a)=>e+a.amount,0),transactions:r}}catch(a){throw a}},async useCashback(e,a,t){try{const s=await Z.getTransactionById(e);if("AVAILABLE"!==s.status)throw new Error("Cashback não está disponível para uso");const r=t||s.amount;if(r>s.amount)throw new Error("Valor a usar maior que o disponível");if(r===s.amount)return await Z.updateTransaction(e,{status:"USED",usedAt:(new Date).toISOString(),usedInOrderId:a});const i=s.amount-r;return await Z.updateTransaction(e,{amount:i}),await Z.createTransaction({userId:s.userId,customerId:s.customerId,cashbackId:s.cashbackId,orderId:s.orderId,amount:r,status:"USED",earnedAt:s.earnedAt,usedAt:(new Date).toISOString(),usedInOrderId:a})}catch(s){throw s}},async expireCashback(e){try{return await Z.updateTransaction(e,{status:"EXPIRED"})}catch(a){throw a}},async cancelCashback(e,a){try{return await Z.updateTransaction(e,{status:"CANCELLED",cancelledAt:(new Date).toISOString(),cancellationReason:a})}catch(t){throw t}},async processExpiredCashbacks(e){try{const a=(new Date).toISOString(),{data:s,error:r}=await t.from("CashbackTransaction").select("id").eq("userId",e).eq("status","AVAILABLE").lt("expiresAt",a);if(r)throw r;const i=s,c=i.map(e=>Z.expireCashback(e.id));return await Promise.all(c),i.length}catch(a){throw a}},async getStats(e,a){try{const s=await Z.listRules(e),r=s.length,i=s.filter(e=>"ACTIVE"===e.status).length;let c=t.from("CashbackTransaction").select("*").eq("userId",e);a&&(c=c.gte("createdAt",a.from).lte("createdAt",a.to));const{data:l,error:n}=await c;if(n)throw n;const o=l,d=o.filter(e=>"CANCELLED"!==e.status).reduce((e,a)=>e+a.amount,0),u=o.filter(e=>"USED"===e.status).reduce((e,a)=>e+a.amount,0),h=o.filter(e=>"AVAILABLE"===e.status).reduce((e,a)=>e+a.amount,0),m=o.filter(e=>"EXPIRED"===e.status).reduce((e,a)=>e+a.amount,0),x=[...new Set(o.map(e=>e.customerId))].length,g=x>0?d/x:0,j={};for(const e of s){const a=o.filter(a=>a.cashbackId===e.id),t=[...new Set(a.map(e=>e.customerId))];j[e.id]={ruleId:e.id,ruleName:e.name,totalEarned:a.filter(e=>"CANCELLED"!==e.status).reduce((e,a)=>e+a.amount,0),totalUsed:a.filter(e=>"USED"===e.status).reduce((e,a)=>e+a.amount,0),totalCustomers:t.length}}return{totalRules:r,activeRules:i,totalEarned:d,totalUsed:u,totalAvailable:h,totalExpired:m,customersWithCashback:x,averageCashbackPerCustomer:g,byRule:j}}catch(s){throw s}},async getTopCustomers(e,a=10,s="available"){try{const{data:r,error:i}=await t.from("CashbackTransaction").select("customerId, amount, status").eq("userId",e);if(i)throw i;const c=r,l=new Map;c.forEach(e=>{l.has(e.customerId)||l.set(e.customerId,{customerId:e.customerId,totalEarned:0,available:0,used:0});const a=l.get(e.customerId);"CANCELLED"!==e.status&&(a.totalEarned+=e.amount),"AVAILABLE"===e.status&&(a.available+=e.amount),"USED"===e.status&&(a.used+=e.amount)});const n=Array.from(l.values()),o="earned"===s?"totalEarned":"available";return n.sort((e,a)=>a[o]-e[o]).slice(0,a)}catch(r){throw r}},async calculateCashback(e,a,t,s){try{const r=(await Z.listRules(e,{active:!0})).sort((e,t)=>{const s="PERCENTAGE"===e.type?a*e.value/100:e.value;return("PERCENTAGE"===t.type?a*t.value/100:t.value)-s});for(const i of r){if(i.minOrderValue&&a<i.minOrderValue)continue;if(i.validFrom&&new Date(i.validFrom)>new Date)continue;if(i.validUntil&&new Date(i.validUntil)<new Date)continue;if(i.applicableToProducts&&i.applicableToProducts.length>0&&s){if(!s.some(e=>i.applicableToProducts.includes(e)))continue}if(i.excludedProducts&&i.excludedProducts.length>0&&s){if(s.some(e=>i.excludedProducts.includes(e)))continue}if(i.maxUsesPerCustomer){const a=await Z.getTransactions(e,{customerId:t});if(a.filter(e=>e.cashbackId===i.id&&"CANCELLED"!==e.status).length>=i.maxUsesPerCustomer)continue}if(i.firstPurchaseOnly){if((await Z.getTransactions(e,{customerId:t})).length>0)continue}let r="PERCENTAGE"===i.type?a*i.value/100:i.value;return i.maxCashbackAmount&&r>i.maxCashbackAmount&&(r=i.maxCashbackAmount),{applicable:!0,amount:r,rule:i}}return{applicable:!1,amount:0,reason:"Nenhuma regra de cashback aplicável"}}catch(r){throw r}}},ee=({title:a,value:t,icon:s,color:r,delay:i=0,subtitle:o})=>e.jsx(U.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:i},children:e.jsxs(c,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${r} opacity-10 rounded-full blur-3xl`}),e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:a}),e.jsx("div",{className:`p-2 rounded-lg ${r} bg-opacity-10`,children:e.jsx(s,{className:`h-5 w-5 ${r.replace("bg-","text-")}`})})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:t}),o&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:o})]})]})}),ae=()=>{const[t,ae]=a.useState([]),[te,se]=a.useState(null),[re,ie]=a.useState([]),[ce,le]=a.useState(!0),[ne,oe]=a.useState(!1),[de,ue]=a.useState(null),[he,me]=a.useState({name:"",description:"",type:"PERCENTAGE",value:0,status:"ACTIVE",firstPurchaseOnly:!1}),{toast:xe}=s(),ge=r(e=>e.user);a.useEffect(()=>{ge?.id&&je()},[ge?.id]);const je=async()=>{try{le(!0);const[e,a,t]=await Promise.all([Z.listRules(ge.id),Z.getStats(ge.id),Z.getTopCustomers(ge.id,10,"available")]);ae(e),se(a),ie(t)}catch(e){xe({title:"Erro ao carregar dados",description:e.message,variant:"destructive"})}finally{le(!1)}},pe=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(U.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 bg-clip-text text-transparent",children:"Cashback"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mt-2",children:"Recompense seus clientes com cashback automático"})]}),e.jsxs(i,{onClick:()=>oe(!0),size:"lg",className:"shadow-lg hover:shadow-xl transition-all",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),"Nova Regra"]})]}),te&&e.jsxs("div",{className:"grid gap-6 md:grid-cols-4",children:[e.jsx(ee,{title:"Regras Ativas",value:te.activeRules,icon:G,color:"bg-green-500",delay:.1,subtitle:`de ${te.totalRules} regras`}),e.jsx(ee,{title:"Total Distribuído",value:pe(te.totalEarned),icon:M,color:"bg-emerald-500",delay:.2,subtitle:"Cashback total gerado"}),e.jsx(ee,{title:"Disponível",value:pe(te.totalAvailable),icon:z,color:"bg-teal-500",delay:.3,subtitle:"Aguardando uso"}),e.jsx(ee,{title:"Clientes Ativos",value:te.customersWithCashback,icon:$,color:"bg-blue-500",delay:.4,subtitle:`Média: ${pe(te.averageCashbackPerCustomer)}`})]}),e.jsxs(D,{defaultValue:"rules",className:"space-y-4",children:[e.jsxs(S,{children:[e.jsx(V,{value:"rules",children:"Regras"}),e.jsx(V,{value:"customers",children:"Top Clientes"})]}),e.jsx(L,{value:"rules",className:"space-y-4",children:e.jsx(U.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},children:e.jsxs(c,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:"Regras de Cashback"}),e.jsxs(o,{children:[t.length," regra(s) cadastrada(s)"]})]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:je,children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]}),e.jsx(d,{children:ce?e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"h-12 w-full"}),e.jsx(F,{className:"h-12 w-full"}),e.jsx(F,{className:"h-12 w-full"})]}):0===t.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"p-4 rounded-full bg-gradient-to-br from-green-500 to-teal-500 mb-4",children:e.jsx(H,{className:"h-12 w-12 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhuma regra cadastrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-md",children:"Crie sua primeira regra de cashback e fidelize seus clientes"}),e.jsxs(i,{onClick:()=>oe(!0),size:"lg",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Criar Primeira Regra"]})]}):e.jsx("div",{className:"rounded-md border border-gray-200 dark:border-gray-800",children:e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs(j,{className:"hover:bg-transparent",children:[e.jsx(p,{children:"Nome"}),e.jsx(p,{children:"Tipo"}),e.jsx(p,{children:"Valor"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Primeira Compra"}),e.jsx(p,{children:"Criado em"}),e.jsx(p,{className:"text-right",children:"Ações"})]})}),e.jsx(v,{children:t.map((a,t)=>{const s=(e=>{const a={ACTIVE:{label:"Ativo",variant:"default",icon:W},INACTIVE:{label:"Inativo",variant:"secondary",icon:_},EXPIRED:{label:"Expirado",variant:"destructive",icon:_},SCHEDULED:{label:"Agendado",variant:"secondary",icon:_}};return a[e]||a.INACTIVE})(a.status),r=s.icon;return e.jsxs(U.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.05*t},className:"hover:bg-gray-50/50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx(b,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.name}),a.description&&e.jsx("div",{className:"text-sm text-muted-foreground",children:a.description})]})}),e.jsx(b,{children:e.jsx(u,{variant:"outline",className:"font-medium",children:"PERCENTAGE"===a.type?"Percentual":"Valor Fixo"})}),e.jsxs(b,{children:[e.jsx("div",{className:"font-medium",children:"PERCENTAGE"===a.type?`${a.value}%`:pe(a.value)}),a.minOrderValue&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Min: ",pe(a.minOrderValue)]})]}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:s.variant,className:"gap-1",children:[e.jsx(r,{className:"h-3 w-3"}),s.label]}),e.jsx(P,{checked:"ACTIVE"===a.status,onCheckedChange:e=>(async(e,a)=>{try{await Z.toggleRule(e,a),xe({title:a?"Regra ativada!":"Regra desativada!"}),je()}catch(t){xe({title:"Erro ao alternar status",description:t.message,variant:"destructive"})}})(a.id,e)})]})}),e.jsx(b,{children:a.firstPurchaseOnly?e.jsx(W,{className:"h-4 w-4 text-green-600"}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(b,{children:J(new Date(a.createdAt),"dd/MM/yyyy",{locale:K})}),e.jsx(b,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>(e=>{ue(e),me(e),oe(!0)})(a),className:"hover:bg-blue-50 hover:text-blue-600 dark:hover:bg-blue-950",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>(async e=>{if(confirm("Deseja realmente excluir esta regra?"))try{await Z.deleteRule(e),xe({title:"Regra excluída com sucesso!"}),je()}catch(a){xe({title:"Erro ao excluir",description:a.message,variant:"destructive"})}})(a.id),className:"hover:bg-red-50 hover:text-red-600 dark:hover:bg-red-950",children:e.jsx(Y,{className:"h-4 w-4"})})]})})]},a.id)})})]})})})]})})}),e.jsx(L,{value:"customers",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(l,{children:[e.jsx(n,{children:"Clientes com Mais Cashback"}),e.jsx(o,{children:"Top 10 clientes com cashback disponível"})]}),e.jsx(d,{children:ce?e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"h-12 w-full"}),e.jsx(F,{className:"h-12 w-full"})]}):0===re.length?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhum cliente com cashback ainda"}):e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs(j,{children:[e.jsx(p,{children:"Cliente"}),e.jsx(p,{children:"Total Ganho"}),e.jsx(p,{children:"Disponível"}),e.jsx(p,{children:"Usado"})]})}),e.jsx(v,{children:re.map(a=>e.jsxs(j,{children:[e.jsx(b,{children:e.jsxs("div",{className:"font-mono text-sm",children:[a.customerId.substring(0,8),"..."]})}),e.jsx(b,{children:e.jsx("div",{className:"font-medium",children:pe(a.totalEarned)})}),e.jsx(b,{children:e.jsx("div",{className:"font-medium text-green-600",children:pe(a.available)})}),e.jsx(b,{children:e.jsx("div",{className:"text-muted-foreground",children:pe(a.used)})})]},a.customerId))})]})})]})})]}),e.jsx(f,{open:ne,onOpenChange:oe,children:e.jsxs(y,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(C,{children:[e.jsx(w,{children:de?"Editar Regra":"Nova Regra de Cashback"}),e.jsx(E,{children:"Configure os parâmetros da regra de cashback"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"name",children:"Nome da Regra *"}),e.jsx(h,{id:"name",value:he.name,onChange:e=>me({...he,name:e.target.value}),placeholder:"Ex: Cashback 5% em todas as compras"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"description",children:"Descrição"}),e.jsx(h,{id:"description",value:he.description||"",onChange:e=>me({...he,description:e.target.value}),placeholder:"Descrição opcional"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"type",children:"Tipo *"}),e.jsxs(A,{value:he.type,onValueChange:e=>me({...he,type:e}),children:[e.jsx(k,{children:e.jsx(I,{})}),e.jsxs(T,{children:[e.jsx(R,{value:"PERCENTAGE",children:"Percentual"}),e.jsx(R,{value:"FIXED_AMOUNT",children:"Valor Fixo"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(m,{htmlFor:"value",children:["Valor * ","PERCENTAGE"===he.type&&"(%)"]}),e.jsx(h,{id:"value",type:"number",step:"0.01",value:he.value,onChange:e=>me({...he,value:parseFloat(e.target.value)}),placeholder:"PERCENTAGE"===he.type?"5":"10.00"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"minOrderValue",children:"Valor Mínimo do Pedido"}),e.jsx(h,{id:"minOrderValue",type:"number",step:"0.01",value:he.minOrderValue||"",onChange:e=>me({...he,minOrderValue:parseFloat(e.target.value)}),placeholder:"0.00"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"maxCashbackAmount",children:"Cashback Máximo"}),e.jsx(h,{id:"maxCashbackAmount",type:"number",step:"0.01",value:he.maxCashbackAmount||"",onChange:e=>me({...he,maxCashbackAmount:parseFloat(e.target.value)}),placeholder:"0.00"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"status",children:"Status"}),e.jsxs(A,{value:he.status,onValueChange:e=>me({...he,status:e}),children:[e.jsx(k,{children:e.jsx(I,{})}),e.jsxs(T,{children:[e.jsx(R,{value:"ACTIVE",children:"Ativo"}),e.jsx(R,{value:"INACTIVE",children:"Inativo"}),e.jsx(R,{value:"SCHEDULED",children:"Agendado"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{id:"firstPurchaseOnly",checked:he.firstPurchaseOnly,onCheckedChange:e=>me({...he,firstPurchaseOnly:e})}),e.jsx(m,{htmlFor:"firstPurchaseOnly",className:"cursor-pointer",children:"Apenas primeira compra do cliente"})]}),"PERCENTAGE"===he.type&&he.value>0&&e.jsxs(O,{children:[e.jsx(_,{className:"h-4 w-4"}),e.jsxs(q,{children:["Exemplo: Em uma compra de R$ 100,00, o cliente receberá"," ",pe(he.value/100*100)," de cashback",he.maxCashbackAmount&&` (limitado a ${pe(he.maxCashbackAmount)})`]})]})]}),e.jsxs(N,{children:[e.jsx(i,{variant:"outline",onClick:()=>{oe(!1),ue(null),me({name:"",description:"",type:"PERCENTAGE",value:0,status:"ACTIVE",firstPurchaseOnly:!1})},children:"Cancelar"}),e.jsx(i,{onClick:async()=>{try{if(!ge?.id)return;if(!he.name||!he.value)return void xe({title:"Campos obrigatórios",description:"Preencha nome e valor do cashback",variant:"destructive"});const e={...he,userId:ge.id};de?(await Z.updateRule(de.id,he),xe({title:"Regra atualizada com sucesso!"})):(await Z.createRule(e),xe({title:"Regra criada com sucesso!"})),oe(!1),ue(null),me({name:"",description:"",type:"PERCENTAGE",value:0,status:"ACTIVE",firstPurchaseOnly:!1}),je()}catch(e){xe({title:"Erro ao salvar",description:e.message,variant:"destructive"})}},children:"Salvar"})]})]})})]})};export{ae as default};
