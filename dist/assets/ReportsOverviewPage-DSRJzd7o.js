import{r as C,R as w,b7 as He,s as P,a as Ye,d as Ze,j as a,N as $,B as Je,C as H,e as Y,f as Z,g as re,n as Ue,h as J}from"./index-uxpDdXL2.js";import{S as Xe,a as Qe,b as et,c as tt,d as W}from"./select-CRAfHGMf.js";import{S as ge}from"./skeleton-CR0XI5LI.js";import{D as Oe}from"./dollar-sign-Bj5vP1ST.js";import{S as rt}from"./shopping-cart-CnK3sRCk.js";import{U as at}from"./users-D-J6HVCL.js";import{T as ot}from"./target-D-6y9jzX.js";import{P as De}from"./package-DBYFcf3g.js";import{C as nt}from"./clock-DUUDIglH.js";import{A as Pe}from"./activity-Dzisgn0U.js";import{C as st}from"./calendar-DQ_Nu1X-.js";import{Z as it}from"./zap-i0UVJOfg.js";import{S as Ce,a as ct,f as xe,L as G,b as lt,A as dt,i as ae,c as ut,d as Re,E as pt,g as le,e as ft,h as mt,j as ht,k as B,l as yt,u as gt,G as xt,m as vt,n as ke,o as bt,B as be,X as U,Y as z,p as jt,R as oe,C as ne,T as se,q as Ee}from"./generateCategoricalChart-D9evS9KE.js";import{a as je,A as At}from"./AreaChart-DwMMx9il.js";import{L as M,a as wt}from"./LineChart-EONUGkJS.js";import{C as St}from"./chart-column-CIR9TeDN.js";import{E as Ot}from"./eye-BX0gRALx.js";import{A as Dt}from"./arrow-up-right-C3a642zJ.js";import{A as Pt}from"./arrow-down-right-DMA-4C4K.js";import"./index-BcJpzdIa.js";function F(t){"@babel/helpers - typeof";return F=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(t)}function Ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kt(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ze(r.key),r)}}function Et(t,e,o){return e&&kt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function It(t,e,o){return e=de(e),Nt(t,_e()?Reflect.construct(e,o||[],de(t).constructor):e.apply(t,o))}function Nt(t,e){if(e&&(F(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Tt(t)}function Tt(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _e(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_e=function(){return!!t})()}function de(t){return de=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},de(t)}function Rt(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ae(t,e)}function Ae(t,e){return Ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},Ae(t,e)}function Ke(t,e,o){return e=ze(e),e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function ze(t){var e=_t(t,"string");return F(e)=="symbol"?e:e+""}function _t(t,e){if(F(t)!="object"||!t)return t;var o=t[Symbol.toPrimitive];if(o!==void 0){var r=o.call(t,e);if(F(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var pe=function(t){function e(){return Ct(this,e),It(this,e,arguments)}return Rt(e,t),Et(e,[{key:"render",value:function(){return null}}])}(C.Component);Ke(pe,"displayName","ZAxis");Ke(pe,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var Kt=["option","isActive"];function X(){return X=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},X.apply(this,arguments)}function zt(t,e){if(t==null)return{};var o=$t(t,e),r,n;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)r=s[n],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}function $t(t,e){if(t==null)return{};var o={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;o[r]=t[r]}return o}function Bt(t){var e=t.option,o=t.isActive,r=zt(t,Kt);return typeof e=="string"?C.createElement(Ce,X({option:C.createElement(ct,X({type:e},r)),isActive:o,shapeType:"symbols"},r)):C.createElement(Ce,X({option:e,isActive:o,shapeType:"symbols"},r))}function L(t){"@babel/helpers - typeof";return L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(t)}function Q(){return Q=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},Q.apply(this,arguments)}function Ie(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),o.push.apply(o,r)}return o}function D(t){for(var e=1;e<arguments.length;e++){var o=arguments[e]!=null?arguments[e]:{};e%2?Ie(Object(o),!0).forEach(function(r){T(t,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):Ie(Object(o)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))})}return t}function Mt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ne(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Be(r.key),r)}}function Ft(t,e,o){return e&&Ne(t.prototype,e),o&&Ne(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function Lt(t,e,o){return e=ue(e),qt(t,$e()?Reflect.construct(e,o||[],ue(t).constructor):e.apply(t,o))}function qt(t,e){if(e&&(L(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Vt(t)}function Vt(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $e(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return($e=function(){return!!t})()}function ue(t){return ue=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},ue(t)}function Wt(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&we(t,e)}function we(t,e){return we=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},we(t,e)}function T(t,e,o){return e=Be(e),e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function Be(t){var e=Gt(t,"string");return L(e)=="symbol"?e:e+""}function Gt(t,e){if(L(t)!="object"||!t)return t;var o=t[Symbol.toPrimitive];if(o!==void 0){var r=o.call(t,e);if(L(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var fe=function(t){function e(){var o;Mt(this,e);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return o=Lt(this,e,[].concat(n)),T(o,"state",{isAnimationFinished:!1}),T(o,"handleAnimationEnd",function(){o.setState({isAnimationFinished:!0})}),T(o,"handleAnimationStart",function(){o.setState({isAnimationFinished:!1})}),T(o,"id",gt("recharts-scatter-")),o}return Wt(e,t),Ft(e,[{key:"renderSymbolsStatically",value:function(r){var n=this,s=this.props,l=s.shape,p=s.activeShape,i=s.activeIndex,d=xe(this.props,!1);return r.map(function(c,u){var h=i===u,m=h?p:l,f=D(D({},d),c);return w.createElement(G,Q({className:"recharts-scatter-symbol",key:"symbol-".concat(c==null?void 0:c.cx,"-").concat(c==null?void 0:c.cy,"-").concat(c==null?void 0:c.size,"-").concat(u)},lt(n.props,c,u),{role:"img"}),w.createElement(Bt,Q({option:m,isActive:h,key:"symbol-".concat(u)},f)))})}},{key:"renderSymbolsWithAnimation",value:function(){var r=this,n=this.props,s=n.points,l=n.isAnimationActive,p=n.animationBegin,i=n.animationDuration,d=n.animationEasing,c=n.animationId,u=this.state.prevPoints;return w.createElement(dt,{begin:p,duration:i,isActive:l,easing:d,from:{t:0},to:{t:1},key:"pie-".concat(c),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(h){var m=h.t,f=s.map(function(g,j){var y=u&&u[j];if(y){var b=ae(y.cx,g.cx),v=ae(y.cy,g.cy),A=ae(y.size,g.size);return D(D({},g),{},{cx:b(m),cy:v(m),size:A(m)})}var O=ae(0,g.size);return D(D({},g),{},{size:O(m)})});return w.createElement(G,null,r.renderSymbolsStatically(f))})}},{key:"renderSymbols",value:function(){var r=this.props,n=r.points,s=r.isAnimationActive,l=this.state.prevPoints;return s&&n&&n.length&&(!l||!ut(l,n))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(n)}},{key:"renderErrorBar",value:function(){var r=this.props.isAnimationActive;if(r&&!this.state.isAnimationFinished)return null;var n=this.props,s=n.points,l=n.xAxis,p=n.yAxis,i=n.children,d=Re(i,pt);return d?d.map(function(c,u){var h=c.props,m=h.direction,f=h.dataKey;return w.cloneElement(c,{key:"".concat(m,"-").concat(f,"-").concat(s[u]),data:s,xAxis:l,yAxis:p,layout:m==="x"?"vertical":"horizontal",dataPointFormatter:function(j,y){return{x:j.cx,y:j.cy,value:m==="x"?+j.node.x:+j.node.y,errorVal:le(j,y)}}})}):null}},{key:"renderLine",value:function(){var r=this.props,n=r.points,s=r.line,l=r.lineType,p=r.lineJointType,i=xe(this.props,!1),d=xe(s,!1),c,u;if(l==="joint")c=n.map(function(v){return{x:v.cx,y:v.cy}});else if(l==="fitting"){var h=ft(n),m=h.xmin,f=h.xmax,g=h.a,j=h.b,y=function(A){return g*A+j};c=[{x:m,y:y(m)},{x:f,y:y(f)}]}var b=D(D(D({},i),{},{fill:"none",stroke:i&&i.fill},d),{},{points:c});return w.isValidElement(s)?u=w.cloneElement(s,b):mt(s)?u=s(b):u=w.createElement(ht,Q({},b,{type:p})),w.createElement(G,{className:"recharts-scatter-line",key:"recharts-scatter-line"},u)}},{key:"render",value:function(){var r=this.props,n=r.hide,s=r.points,l=r.line,p=r.className,i=r.xAxis,d=r.yAxis,c=r.left,u=r.top,h=r.width,m=r.height,f=r.id,g=r.isAnimationActive;if(n||!s||!s.length)return null;var j=this.state.isAnimationFinished,y=He("recharts-scatter",p),b=i&&i.allowDataOverflow,v=d&&d.allowDataOverflow,A=b||v,O=B(f)?this.id:f;return w.createElement(G,{className:y,clipPath:A?"url(#clipPath-".concat(O,")"):null},b||v?w.createElement("defs",null,w.createElement("clipPath",{id:"clipPath-".concat(O)},w.createElement("rect",{x:b?c:c-h/2,y:v?u:u-m/2,width:b?h:h*2,height:v?m:m*2}))):null,l&&this.renderLine(),this.renderErrorBar(),w.createElement(G,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!g||j)&&yt.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(r,n){return r.animationId!==n.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,prevPoints:n.curPoints}:r.points!==n.curPoints?{curPoints:r.points}:null}}])}(C.PureComponent);T(fe,"displayName","Scatter");T(fe,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!xt.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});T(fe,"getComposedData",function(t){var e=t.xAxis,o=t.yAxis,r=t.zAxis,n=t.item,s=t.displayedData,l=t.xAxisTicks,p=t.yAxisTicks,i=t.offset,d=n.props.tooltipType,c=Re(n.props.children,vt),u=B(e.dataKey)?n.props.dataKey:e.dataKey,h=B(o.dataKey)?n.props.dataKey:o.dataKey,m=r&&r.dataKey,f=r?r.range:pe.defaultProps.range,g=f&&f[0],j=e.scale.bandwidth?e.scale.bandwidth():0,y=o.scale.bandwidth?o.scale.bandwidth():0,b=s.map(function(v,A){var O=le(v,u),R=le(v,h),E=!B(m)&&le(v,m)||"-",q=[{name:B(e.dataKey)?n.props.name:e.name||e.dataKey,unit:e.unit||"",value:O,payload:v,dataKey:u,type:d},{name:B(o.dataKey)?n.props.name:o.name||o.dataKey,unit:o.unit||"",value:R,payload:v,dataKey:h,type:d}];E!=="-"&&q.push({name:r.name||r.dataKey,unit:r.unit||"",value:E,payload:v,dataKey:m,type:d});var V=ke({axis:e,ticks:l,bandSize:j,entry:v,index:A,dataKey:u}),I=ke({axis:o,ticks:p,bandSize:y,entry:v,index:A,dataKey:h}),ee=E!=="-"?r.scale(E):g,_=Math.sqrt(Math.max(ee,0)/Math.PI);return D(D({},v),{},{cx:V,cy:I,x:V-_,y:I-_,xAxis:e,yAxis:o,zAxis:r,width:2*_,height:2*_,size:ee,node:{x:O,y:R,z:E},tooltipPayload:q,tooltipPosition:{x:V,y:I},payload:v},c&&c[A]&&c[A].props)});return D({points:b},i)});var Te=bt({chartName:"ComposedChart",GraphicalChild:[M,je,be,fe],axisComponents:[{axisType:"xAxis",AxisComp:U},{axisType:"yAxis",AxisComp:z},{axisType:"zAxis",AxisComp:pe}],formatAxisMap:jt});const ie=t=>{const e=new Date,o=e;let r=new Date,n=new Date,s=new Date;switch(t){case"today":r.setHours(0,0,0,0),s=new Date(r),n=new Date(r),n.setDate(n.getDate()-1),s.setDate(s.getDate()-1),s.setHours(23,59,59,999);break;case"7days":r.setDate(e.getDate()-7),s=new Date(r),n=new Date(r),n.setDate(n.getDate()-7);break;case"30days":r.setDate(e.getDate()-30),s=new Date(r),n=new Date(r),n.setDate(n.getDate()-30);break;case"90days":r.setDate(e.getDate()-90),s=new Date(r),n=new Date(r),n.setDate(n.getDate()-90);break;case"year":r.setFullYear(e.getFullYear(),0,1),r.setHours(0,0,0,0),n=new Date(r),n.setFullYear(n.getFullYear()-1),s=new Date(r),s.setDate(s.getDate()-1);break;default:r.setDate(e.getDate()-7),s=new Date(r),n=new Date(r),n.setDate(n.getDate()-7)}return{start:r,end:o,previousStart:n,previousEnd:s}},N=(t,e)=>e===0?t>0?100:0:(t-e)/e*100,ve={async getMetrics(t,e="7days"){const{start:o,end:r,previousStart:n,previousEnd:s}=ie(e);try{const{data:l,error:p}=await P.from("Order").select("*").eq("userId",t).gte("createdAt",o.toISOString()).lte("createdAt",r.toISOString());if(p)throw console.error("Erro ao buscar pedidos atuais:",p),p;const{data:i,error:d}=await P.from("Order").select("*").eq("userId",t).gte("createdAt",n.toISOString()).lte("createdAt",s.toISOString());d&&console.error("Erro ao buscar pedidos anteriores:",d);const c=(l==null?void 0:l.filter(x=>x.paymentStatus==="PAID"))||[],u=(i==null?void 0:i.filter(x=>x.paymentStatus==="PAID"))||[],h=c.reduce((x,S)=>{const k=typeof S.total=="string"?parseFloat(S.total):S.total;return x+(k||0)},0),m=u.reduce((x,S)=>{const k=typeof S.total=="string"?parseFloat(S.total):S.total;return x+(k||0)},0),f=c.length,g=u.length,j=c.reduce((x,S)=>{const k=S.items||[];return Array.isArray(k)?x+k.reduce((K,ye)=>K+(ye.quantity||0),0):x},0),y=u.reduce((x,S)=>{const k=S.items||[];return Array.isArray(k)?x+k.reduce((K,ye)=>K+(ye.quantity||0),0):x},0),b=f>0?h/f:0,v=g>0?m/g:0,{data:A}=await P.from("Cart").select("*").eq("userId",t).gte("createdAt",o.toISOString()).lte("createdAt",r.toISOString()),{data:O}=await P.from("Cart").select("*").eq("userId",t).gte("createdAt",n.toISOString()).lte("createdAt",s.toISOString()),R=(A==null?void 0:A.length)||0,E=(O==null?void 0:O.length)||0,q=R>0?f/R*100:0,V=E>0?g/E*100:0,I=A||[],ee=I.filter(x=>x.completedAt);let _=0,me=0;ee.forEach(x=>{if(x.createdAt&&x.completedAt){const S=new Date(x.createdAt),K=new Date(x.completedAt).getTime()-S.getTime();K>0&&K<36e5&&(_+=K,me++)}});const te=me>0?_/me:48e4,Me=Math.floor(te/6e4),Fe=Math.floor(te%6e4/1e3),Le=`${Me}m ${Fe}s`,qe=I.filter(x=>!x.completedAt&&!x.convertedToOrderId),Se=I.length>0?qe.length/I.length*100:0,he=O||[],Ve=he.filter(x=>!x.completedAt&&!x.convertedToOrderId),We=he.length>0?Ve.length/he.length*100:0,Ge=N(te,te*.95);return{totalRevenue:h,revenueChange:N(h,m),totalOrders:f,ordersChange:N(f,g),uniqueVisitors:R,visitorsChange:N(R,E),conversionRate:q,conversionChange:N(q,V),averageTicket:b,ticketChange:N(b,v),productsSold:j,productsSoldChange:N(j,y),averageTime:Le,timeChange:Ge,bounceRate:Se,bounceRateChange:N(Se,We)}}catch(l){throw console.error("Erro ao buscar métricas:",l),l}},async getChartData(t,e="7days"){const{start:o,end:r}=ie(e);try{const{data:n,error:s}=await P.from("Order").select("*").eq("userId",t).gte("createdAt",o.toISOString()).lte("createdAt",r.toISOString()).order("createdAt",{ascending:!0});if(s)throw s;const{data:l}=await P.from("Cart").select("*").eq("userId",t).gte("createdAt",o.toISOString()).lte("createdAt",r.toISOString()),p=["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],i={};return n==null||n.forEach(d=>{const u=new Date(d.createdAt).getDay();i[u]||(i[u]={orders:[],carts:[]}),i[u].orders.push(d)}),l==null||l.forEach(d=>{const u=new Date(d.createdAt).getDay();i[u]||(i[u]={orders:[],carts:[]}),i[u].carts.push(d)}),p.map((d,c)=>{const u=i[c]||{orders:[],carts:[]},h=u.orders.filter(g=>g.paymentStatus==="PAID"),m=u.carts.filter(g=>!g.completedAt),f=u.carts.length;return{name:d,pageLoad:Math.floor(Math.random()*300)+200,bounceRate:f>0?m.length/f*100:30,startRender:Math.floor(Math.random()*200)+100,sessions:f,sessionLength:Math.floor(Math.random()*10)+5,pvs:Math.floor(Math.random()*2)+1}})}catch(n){return console.error("Erro ao buscar dados do gráfico:",n),[]}},async getHourlyData(t){const e=new Date,o=new Date(e);o.setHours(0,0,0,0);try{const{data:r,error:n}=await P.from("Order").select("*").eq("userId",t).gte("createdAt",o.toISOString()).lte("createdAt",e.toISOString()).order("createdAt",{ascending:!0});if(n)throw n;const{data:s}=await P.from("Cart").select("*").eq("userId",t).gte("createdAt",o.toISOString()).lte("createdAt",e.toISOString()),l={};return r==null||r.forEach(p=>{const i=new Date(p.createdAt).getHours();l[i]||(l[i]={orders:[],carts:[]}),l[i].orders.push(p)}),s==null||s.forEach(p=>{const i=new Date(p.createdAt).getHours();l[i]||(l[i]={orders:[],carts:[]}),l[i].carts.push(p)}),Array.from({length:24},(p,i)=>{const d=l[i]||{orders:[],carts:[]},c=d.orders.filter(h=>h.paymentStatus==="PAID"),u=c.reduce((h,m)=>{const f=typeof m.total=="string"?parseFloat(m.total):m.total;return h+(f||0)},0);return{hour:`${i}h`,visits:d.carts.length,conversions:c.length,revenue:u}})}catch(r){return console.error("Erro ao buscar dados horários:",r),[]}},async getGatewayPerformance(t,e="7days"){const{start:o,end:r}=ie(e);try{const{data:n,error:s}=await P.from("Transaction").select(`
          *,
          Gateway:gatewayId (
            id,
            name,
            slug
          )
        `).eq("userId",t).gte("createdAt",o.toISOString()).lte("createdAt",r.toISOString());if(s)throw s;const l={};return n==null||n.forEach(p=>{const i=p.Gateway;if(!i)return;const d=i.id;l[d]||(l[d]={gatewayId:d,gatewayName:i.name,transactions:[]}),l[d].transactions.push(p)}),Object.values(l).map(p=>{const i=p.transactions,d=i.filter(f=>f.status==="PAID"||f.status==="APPROVED"),c=i.filter(f=>f.status==="FAILED"||f.status==="REJECTED"),u=d.reduce((f,g)=>{const j=typeof g.amount=="string"?parseFloat(g.amount):g.amount;return f+(j||0)},0),h=d.length>0?u/d.length:0,m=i.length>0?d.length/i.length*100:0;return{gatewayId:p.gatewayId,gatewayName:p.gatewayName,totalTransactions:i.length,successfulTransactions:d.length,failedTransactions:c.length,totalRevenue:u,avgTicket:h,successRate:m}})}catch(n){return console.error("Erro ao buscar performance dos gateways:",n),[]}},async getRecentOrders(t,e=10){try{const{data:o,error:r}=await P.from("Order").select("*").eq("userId",t).order("createdAt",{ascending:!1}).limit(e);if(r)throw r;return o||[]}catch(o){return console.error("Erro ao buscar pedidos recentes:",o),[]}},async getRevenueByDay(t,e="7days"){const{start:o,end:r}=ie(e);try{const{data:n,error:s}=await P.from("Order").select("*").eq("userId",t).eq("paymentStatus","PAID").gte("createdAt",o.toISOString()).lte("createdAt",r.toISOString()).order("createdAt",{ascending:!0});if(s)throw s;const l={};return n==null||n.forEach(p=>{const i=new Date(p.createdAt).toLocaleDateString("pt-BR");l[i]||(l[i]=0);const d=typeof p.total=="string"?parseFloat(p.total):p.total;l[i]+=d||0}),Object.entries(l).map(([p,i])=>({date:p,revenue:i}))}catch(n){return console.error("Erro ao buscar receita por dia:",n),[]}}},Ht=({title:t,value:e,change:o,icon:r,color:n,delay:s=0})=>{const l=o>=0;return a.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:s},children:a.jsxs(H,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[a.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${n} opacity-10 rounded-full blur-3xl`}),a.jsxs(Y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(Z,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:t}),a.jsx("div",{className:`p-2 rounded-lg ${n} bg-opacity-10`,children:a.jsx(r,{className:`h-4 w-4 ${n.replace("bg-","text-")}`})})]}),a.jsxs(J,{children:[a.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:e}),a.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[l?a.jsx(Dt,{className:"h-4 w-4 text-green-500"}):a.jsx(Pt,{className:"h-4 w-4 text-red-500"}),a.jsxs("span",{className:`text-sm font-semibold ${l?"text-green-500":"text-red-500"}`,children:[Math.abs(o),"%"]}),a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"vs último período"})]})]})]})})},ce=({active:t,payload:e,label:o})=>t&&e&&e.length?a.jsxs("div",{className:"bg-gray-900/95 dark:bg-gray-800/95 backdrop-blur-xl border border-gray-700 rounded-lg p-4 shadow-xl",children:[a.jsx("p",{className:"text-white font-semibold mb-2",children:o}),e.map((r,n)=>a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r.color}}),a.jsxs("span",{className:"text-gray-300",children:[r.name,":"]}),a.jsx("span",{className:"text-white font-semibold",children:r.value})]},n))]}):null,mr=()=>{const[t,e]=C.useState(!0),[o,r]=C.useState("7days"),[n,s]=C.useState(null),[l,p]=C.useState([]),[i,d]=C.useState([]),c=Ye(y=>y.user),{toast:u}=Ze();C.useEffect(()=>{c!=null&&c.id&&h()},[c==null?void 0:c.id,o]);const h=async()=>{if(c!=null&&c.id)try{e(!0);const[y,b,v]=await Promise.all([ve.getMetrics(c.id,o),ve.getChartData(c.id,o),ve.getHourlyData(c.id)]);s(y),p(b),d(v)}catch(y){console.error("Erro ao carregar dashboard:",y),u({title:"Erro ao carregar dados",description:y.message,variant:"destructive"})}finally{e(!1)}},m=y=>{r(y)},f=y=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(y),g=y=>new Intl.NumberFormat("pt-BR").format(y),j=n?[{title:"Receita Total",value:f(n.totalRevenue),change:n.revenueChange,icon:Oe,color:"bg-green-500"},{title:"Total de Pedidos",value:g(n.totalOrders),change:n.ordersChange,icon:rt,color:"bg-blue-500"},{title:"Visitantes Únicos",value:g(n.uniqueVisitors),change:n.visitorsChange,icon:at,color:"bg-purple-500"},{title:"Taxa de Conversão",value:`${n.conversionRate.toFixed(2)}%`,change:n.conversionChange,icon:ot,color:"bg-cyan-500"},{title:"Ticket Médio",value:f(n.averageTicket),change:n.ticketChange,icon:De,color:"bg-pink-500"},{title:"Produtos Vendidos",value:g(n.productsSold),change:n.productsSoldChange,icon:De,color:"bg-orange-500"},{title:"Tempo Médio",value:n.averageTime,change:n.timeChange,icon:nt,color:"bg-yellow-500"},{title:"Taxa de Rejeição",value:`${n.bounceRate.toFixed(1)}%`,change:n.bounceRateChange,icon:Pe,color:"bg-red-500"}]:[];return t?a.jsxs("div",{className:"space-y-6",children:[a.jsx(ge,{className:"h-12 w-full"}),a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(8)].map((y,b)=>a.jsx(ge,{className:"h-32"},b))}),a.jsx(ge,{className:"h-96"})]}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs($.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Dashboard"}),a.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1 flex items-center gap-2",children:[a.jsx(st,{className:"h-4 w-4"}),"Visão geral das suas métricas de vendas e conversão"]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs(Xe,{value:o,onValueChange:m,children:[a.jsx(Qe,{className:"w-[180px] bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700",children:a.jsx(et,{placeholder:"Período"})}),a.jsxs(tt,{children:[a.jsx(W,{value:"today",children:"Hoje"}),a.jsx(W,{value:"7days",children:"Últimos 7 dias"}),a.jsx(W,{value:"30days",children:"Últimos 30 dias"}),a.jsx(W,{value:"90days",children:"Últimos 90 dias"}),a.jsx(W,{value:"year",children:"Este ano"})]})]}),a.jsx(Je,{variant:"outline",size:"icon",onClick:()=>m(o),children:a.jsx(Pe,{className:"h-4 w-4"})})]})]}),a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:j.map((y,b)=>a.jsx(Ht,{...y,delay:b*.05},b))}),a.jsx($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.4},children:a.jsxs(H,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[a.jsx(Y,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(Z,{className:"text-xl font-bold",children:"Tempo de Carregamento vs Taxa de Rejeição"}),a.jsx(re,{children:"Análise de performance e comportamento do usuário"})]}),a.jsxs(Ue,{className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white border-0",children:[a.jsx(it,{className:"h-3 w-3 mr-1"}),"Tempo Real"]})]})}),a.jsx(J,{children:a.jsx(oe,{width:"100%",height:350,children:l.length>0?a.jsxs(Te,{data:l,children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"colorPageLoad",x1:"0",y1:"0",x2:"0",y2:"1",children:[a.jsx("stop",{offset:"5%",stopColor:"#06b6d4",stopOpacity:.8}),a.jsx("stop",{offset:"95%",stopColor:"#06b6d4",stopOpacity:.1})]}),a.jsxs("linearGradient",{id:"colorStartRender",x1:"0",y1:"0",x2:"0",y2:"1",children:[a.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),a.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})]}),a.jsx(ne,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),a.jsx(U,{dataKey:"name",stroke:"#9ca3af",style:{fontSize:"12px"}}),a.jsx(z,{yAxisId:"left",stroke:"#9ca3af",style:{fontSize:"12px"}}),a.jsx(z,{yAxisId:"right",orientation:"right",stroke:"#9ca3af",style:{fontSize:"12px"}}),a.jsx(se,{content:a.jsx(ce,{})}),a.jsx(Ee,{wrapperStyle:{paddingTop:"20px"},iconType:"circle"}),a.jsx(be,{yAxisId:"left",dataKey:"pageLoad",fill:"url(#colorPageLoad)",radius:[8,8,0,0],name:"Page Load (ms)"}),a.jsx(be,{yAxisId:"left",dataKey:"startRender",fill:"url(#colorStartRender)",radius:[8,8,0,0],name:"Start Render (ms)"}),a.jsx(M,{yAxisId:"right",type:"monotone",dataKey:"bounceRate",stroke:"#ef4444",strokeWidth:3,dot:{fill:"#ef4444",r:5},name:"Bounce Rate (%)"})]}):a.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Sem dados disponíveis"})})})]})}),a.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[a.jsx($.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.5},children:a.jsxs(H,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[a.jsxs(Y,{children:[a.jsxs(Z,{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(St,{className:"h-5 w-5 text-purple-500"}),"Sessões ao Longo do Dia"]}),a.jsx(re,{children:"Distribuição de tráfego por hora"})]}),a.jsx(J,{children:a.jsx(oe,{width:"100%",height:250,children:i.length>0?a.jsxs(At,{data:i,children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"colorVisits",x1:"0",y1:"0",x2:"0",y2:"1",children:[a.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.8}),a.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:.1})]})}),a.jsx(ne,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),a.jsx(U,{dataKey:"hour",stroke:"#9ca3af",style:{fontSize:"10px"}}),a.jsx(z,{stroke:"#9ca3af",style:{fontSize:"10px"}}),a.jsx(se,{content:a.jsx(ce,{})}),a.jsx(je,{type:"monotone",dataKey:"visits",stroke:"#8b5cf6",strokeWidth:2,fill:"url(#colorVisits)",name:"Visitas"})]}):a.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Sem dados disponíveis"})})})]})}),a.jsx($.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.5},children:a.jsxs(H,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[a.jsxs(Y,{children:[a.jsxs(Z,{className:"text-lg font-bold flex items-center gap-2",children:[a.jsx(Oe,{className:"h-5 w-5 text-green-500"}),"Conversões e Receita"]}),a.jsx(re,{children:"Performance financeira por hora"})]}),a.jsx(J,{children:a.jsx(oe,{width:"100%",height:250,children:i.length>0?a.jsxs(wt,{data:i,children:[a.jsx(ne,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),a.jsx(U,{dataKey:"hour",stroke:"#9ca3af",style:{fontSize:"10px"}}),a.jsx(z,{stroke:"#9ca3af",style:{fontSize:"10px"}}),a.jsx(se,{content:a.jsx(ce,{})}),a.jsx(M,{type:"monotone",dataKey:"conversions",stroke:"#10b981",strokeWidth:3,dot:{fill:"#10b981",r:4},name:"Conversões"}),a.jsx(M,{type:"monotone",dataKey:"revenue",stroke:"#06b6d4",strokeWidth:3,dot:{fill:"#06b6d4",r:4},name:"Receita (R$)"})]}):a.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Sem dados disponíveis"})})})]})})]}),a.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:a.jsxs(H,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[a.jsxs(Y,{children:[a.jsxs(Z,{className:"text-xl font-bold flex items-center gap-2",children:[a.jsx(Ot,{className:"h-5 w-5 text-cyan-500"}),"Métricas de Engajamento"]}),a.jsx(re,{children:"Análise detalhada do comportamento dos usuários"})]}),a.jsx(J,{children:a.jsx(oe,{width:"100%",height:300,children:l.length>0?a.jsxs(Te,{data:l,children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"colorSessions",x1:"0",y1:"0",x2:"0",y2:"1",children:[a.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.8}),a.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:.1})]})}),a.jsx(ne,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),a.jsx(U,{dataKey:"name",stroke:"#9ca3af"}),a.jsx(z,{yAxisId:"left",stroke:"#9ca3af"}),a.jsx(z,{yAxisId:"right",orientation:"right",stroke:"#9ca3af"}),a.jsx(se,{content:a.jsx(ce,{})}),a.jsx(Ee,{}),a.jsx(je,{yAxisId:"left",type:"monotone",dataKey:"sessions",fill:"url(#colorSessions)",stroke:"#10b981",strokeWidth:2,name:"Sessões"}),a.jsx(M,{yAxisId:"right",type:"monotone",dataKey:"sessionLength",stroke:"#f59e0b",strokeWidth:3,dot:{fill:"#f59e0b",r:5},name:"Tempo de Sessão (min)"}),a.jsx(M,{yAxisId:"right",type:"monotone",dataKey:"pvs",stroke:"#ec4899",strokeWidth:3,dot:{fill:"#ec4899",r:5},name:"PVs por Sessão"})]}):a.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Sem dados disponíveis"})})})]})})]})};export{mr as default};
