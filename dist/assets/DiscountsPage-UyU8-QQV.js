import{j as e}from"./vendor-ui-DkUuACDy.js";import{r as s}from"./vendor-react-X41Bjl18.js";import{g as a,s as t,C as o,a as i,b as r,d as n,e as c,c as l,I as d,B as m}from"./index-hPMilkXu.js";import{L as u}from"./label-4gpQR9-A.js";import{S as x}from"./switch-C0UZcpl8.js";import{S as p,a as h,b as j,c as y,d as g}from"./select-C6L5JfSD.js";import{A as v,a as f,b}from"./alert-DwTaToHW.js";import{S as N}from"./separator-Zp_aXwme.js";import{u as k}from"./useOptimizedSelectors-U8kPLqYJ.js";import{g as D,D as A,aR as w,Z as E,aO as C,I as P,av as T}from"./vendor-icons-DTdRnryx.js";import{m as R}from"./vendor-animation-DQ3cvw6m.js";import"./vendor-supabase-BQxDPPjR.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-Bf3pI66S.js";const V=({title:s,value:a,icon:t,color:n,delay:c=0,subtitle:d})=>e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:c},children:e.jsxs(o,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${n} opacity-10 rounded-full blur-3xl`}),e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:s}),e.jsx("div",{className:`p-2 rounded-lg ${n} bg-opacity-10`,children:e.jsx(t,{className:`h-5 w-5 ${n.replace("bg-","text-")}`})})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:a}),d&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:d})]})]})}),S=[{key:"CREDIT_CARD",label:"Cartão de Crédito",icon:D,color:"bg-blue-500",description:"Desconto para pagamentos com cartão de crédito"},{key:"PIX",label:"PIX",icon:A,color:"bg-green-500",description:"Desconto para pagamentos via PIX (mais comum)"},{key:"BOLETO",label:"Boleto Bancário",icon:D,color:"bg-orange-500",description:"Desconto para pagamentos com boleto bancário"},{key:"DEBIT_CARD",label:"Cartão de Débito",icon:D,color:"bg-purple-500",description:"Desconto para pagamentos com cartão de débito"}],I=()=>{const{toast:D}=a(),{user:A}=k(),[I,$]=s.useState(!0),[M,O]=s.useState(!1),[F,q]=s.useState([]),[G,B]=s.useState({});s.useEffect(()=>{A?.id&&X()},[A?.id]);const X=async()=>{if(A?.id)try{$(!0);const{data:e,error:s}=await t.from("PaymentMethodDiscount").select("*").eq("userId",A.id).order("createdAt",{ascending:!1});if(s)throw s;q(e||[]);const a={};S.forEach(s=>{const t=(e||[]).find(e=>e.paymentMethod===s.key);a[s.key]=t?{discountType:t.discountType,discountValue:t.discountValue.toString(),minPurchaseAmount:t.minPurchaseAmount?.toString()||"0",maxDiscountAmount:t.maxDiscountAmount?.toString()||"",description:t.description||"",isActive:t.isActive}:{discountType:"PERCENTAGE",discountValue:"",minPurchaseAmount:"0",maxDiscountAmount:"",description:"",isActive:!0}}),B(a)}catch(e){D({title:"Erro ao carregar descontos",description:e.message,variant:"destructive"})}finally{$(!1)}},z=(e,s,a)=>{B(t=>({...t,[e]:{...t[e]||{discountType:"PERCENTAGE",discountValue:"",minPurchaseAmount:"0",maxDiscountAmount:"",description:"",isActive:!0},[s]:a}}))},L=(e,s=100)=>{const a=G[e];if(!a||!a.discountValue)return 0;const t=parseFloat(a.discountValue);let o=0;if(o="PERCENTAGE"===a.discountType?s*t/100:t,a.maxDiscountAmount){const e=parseFloat(a.maxDiscountAmount);o=Math.min(o,e)}return o},_={total:F.length,active:F.filter(e=>e.isActive).length,inactive:F.filter(e=>!e.isActive).length};return I?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando descontos..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(R.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Descontos por Forma de Pagamento"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mt-2",children:"Configure descontos automáticos baseados na forma de pagamento escolhida pelo cliente no checkout"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsx(V,{title:"Total de Descontos",value:_.total,icon:w,color:"bg-blue-500",delay:.1,subtitle:0===_.total?"Nenhum configurado":`${_.total} ${1===_.total?"método":"métodos"}`}),e.jsx(V,{title:"Descontos Ativos",value:_.active,icon:E,color:"bg-green-500",delay:.2,subtitle:"Aplicados no checkout"}),e.jsx(V,{title:"Descontos Inativos",value:_.inactive,icon:C,color:"bg-gray-500",delay:.3,subtitle:"Pausados temporariamente"})]}),e.jsxs(v,{children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx(f,{children:"Como funciona"}),e.jsx(b,{children:"Os descontos configurados aqui serão aplicados automaticamente no checkout público quando o cliente selecionar a forma de pagamento. O desconto será exibido de forma clara antes da finalização da compra."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Configurar Descontos"}),S.map((s,a)=>{const k=s.icon,w=F.find(e=>e.paymentMethod===s.key),E=G[s.key];return e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5+.1*a},children:e.jsxs(o,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${s.color} flex items-center justify-center`,children:e.jsx(k,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(r,{className:"text-lg",children:s.label}),e.jsx(n,{children:s.description})]})]}),w&&e.jsx(c,{variant:w.isActive?"default":"secondary",children:w.isActive?"Ativo":"Inativo"})]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Tipo de Desconto"}),e.jsxs(p,{value:E?.discountType||"PERCENTAGE",onValueChange:e=>z(s.key,"discountType",e),children:[e.jsx(h,{children:e.jsx(j,{})}),e.jsxs(y,{children:[e.jsx(g,{value:"PERCENTAGE",children:"Porcentagem (%)"}),e.jsx(g,{value:"FIXED_AMOUNT",children:"Valor Fixo (R$)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{children:["Valor do Desconto"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{type:"number",placeholder:"0",value:E?.discountValue||"",onChange:e=>z(s.key,"discountValue",e.target.value),min:"0",step:"0.01"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300 font-medium",children:"PERCENTAGE"===E?.discountType?"%":"R$"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Valor Mínimo da Compra"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{type:"number",placeholder:"0.00",value:E?.minPurchaseAmount||"0",onChange:e=>z(s.key,"minPurchaseAmount",e.target.value),min:"0",step:"0.01"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300 font-medium",children:"R$"})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Desconto só se aplica acima deste valor"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Desconto Máximo (Opcional)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{type:"number",placeholder:"Sem limite",value:E?.maxDiscountAmount||"",onChange:e=>z(s.key,"maxDiscountAmount",e.target.value),min:"0",step:"0.01"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300 font-medium",children:"R$"})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Limite máximo do desconto em reais"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Descrição (Opcional)"}),e.jsx(d,{placeholder:"Ex: Desconto especial para pagamento à vista",value:E?.description||"",onChange:e=>z(s.key,"description",e.target.value)})]}),E?.discountValue&&e.jsxs(v,{className:"border-blue-200 bg-blue-50",children:[e.jsx(P,{className:"h-4 w-4 text-blue-600"}),e.jsx(f,{className:"text-blue-900",children:"Preview do Desconto"}),e.jsxs(b,{className:"text-blue-800",children:[e.jsxs("p",{className:"mb-2",children:["Para uma compra de R$ 100,00, o desconto será de"," ",e.jsxs("strong",{children:["R$"," ",L(s.key,100).toFixed(2)]})]}),e.jsxs("p",{children:["Total a pagar:"," ",e.jsxs("strong",{children:["R$"," ",(100-L(s.key,100)).toFixed(2)]})]})]})]}),e.jsx(N,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(u,{children:"Status do Desconto"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:E?.isActive?"Desconto será aplicado no checkout":"Desconto pausado temporariamente"})]}),e.jsx(x,{checked:E?.isActive??!0,onCheckedChange:e=>z(s.key,"isActive",e)})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[w&&e.jsx(m,{variant:"outline",onClick:()=>(async(e,s)=>{if(window.confirm(`Tem certeza que deseja remover o desconto de ${S.find(e=>e.key===s)?.label}?`))try{const{error:s}=await t.from("PaymentMethodDiscount").delete().eq("id",e);if(s)throw s;D({title:"Desconto removido!",description:"O desconto foi removido com sucesso"}),await X()}catch(a){D({title:"Erro ao remover",description:a.message,variant:"destructive"})}})(w.id,s.key),disabled:M,children:"Remover"}),e.jsx(m,{onClick:()=>(async e=>{if(!A?.id)return;const s=G[e];if(s&&s.discountValue){O(!0);try{const a=F.find(s=>s.paymentMethod===e),o={userId:A.id,paymentMethod:e,discountType:s.discountType,discountValue:parseFloat(s.discountValue),minPurchaseAmount:parseFloat(s.minPurchaseAmount||"0"),maxDiscountAmount:s.maxDiscountAmount?parseFloat(s.maxDiscountAmount):null,description:s.description||null,isActive:s.isActive,updatedAt:(new Date).toISOString()};if(a){const{error:e}=await t.from("PaymentMethodDiscount").update(o).eq("id",a.id);if(e)throw e}else{const{error:e}=await t.from("PaymentMethodDiscount").insert(o);if(e)throw e}D({title:"Desconto salvo!",description:`Desconto para ${S.find(s=>s.key===e)?.label} configurado com sucesso`}),await X()}catch(a){D({title:"Erro ao salvar",description:a.message,variant:"destructive"})}finally{O(!1)}}else D({title:"Valor obrigatório",description:"Informe o valor do desconto",variant:"destructive"})})(s.key),disabled:M||!E?.discountValue,className:"bg-pink-600 hover:bg-pink-700",children:M?"Salvando...":"Salvar Desconto"})]})]})]})},s.key)})]}),e.jsxs(v,{className:"border-pink-200 bg-pink-50",children:[e.jsx(T,{className:"h-4 w-4 text-pink-600"}),e.jsxs(b,{className:"text-pink-900",children:[e.jsx("strong",{children:"Dica:"})," Descontos para PIX geralmente aumentam a taxa de conversão. Recomendamos oferecer entre 3% a 10% de desconto."]})]})]})};export{I as default};
