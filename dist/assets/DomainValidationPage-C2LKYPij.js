import{j as e}from"./vendor-ui-D3JNL6pE.js";import{f as s,r as a}from"./vendor-react-X41Bjl18.js";import{g as i,s as r,B as t,C as n,a as o,b as c,c as d,I as l,aO as m}from"./index-X3DAL2EH.js";import{L as x}from"./label-DIrmZ_ur.js";import{S as h,a as u,b as j,c as p,d as f}from"./select-CXeQ-gju.js";import{A as v,a as g}from"./alert-IOyd7RMU.js";import{L as N,v as w,a1 as y,ax as b,o as k,_ as C}from"./vendor-icons-C9d2sOc_.js";import"./vendor-supabase-HUq0BeMy.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-animation-DtB50Lbk.js";import"./vendor-query-DqG_mm-v.js";function S(){const{toast:S}=i(),V=s(),[A,D]=a.useState([]),[O,E]=a.useState(!0),[U,I]=a.useState(!1),[R,T]=a.useState(!1),[$,q]=a.useState({subdomain:"checkout",domain:""});a.useEffect(()=>{z()},[]);const z=async()=>{try{const{data:{user:e}}=await r.auth.getUser();if(!e)return;const{data:s}=await r.from("User").select("domain, domainVerified").eq("id",e.id).single();s?.domain&&D([{id:"1",domain:s.domain,subdomain:"checkout",cnameRecord:F(s.domain),verified:s.domainVerified||!1,sslConfigured:!1,createdAt:(new Date).toISOString()}])}catch(e){}finally{E(!1)}},F=e=>{const s=e.split("").reduce((e,s)=>(e<<5)-e+s.charCodeAt(0)|0,0);return`checkout-${Math.abs(s).toString(36)}.syncads.com.br`},M=async()=>{if($.domain)try{const{data:{user:e}}=await r.auth.getUser();if(!e)return;F($.domain);const s=`${$.subdomain}.${$.domain}`,{error:a}=await r.from("User").update({domain:s,domainVerified:!1,domainVerificationToken:crypto.randomUUID(),domainVerificationMethod:"DNS"}).eq("id",e.id);if(a)throw a;S({title:"Domínio cadastrado",description:"Agora você precisa configurar o DNS no seu provedor"}),await z(),I(!1),q({subdomain:"checkout",domain:""})}catch(e){S({title:"Erro",description:"Não foi possível cadastrar o domínio",variant:"destructive"})}else S({title:"Erro",description:"Por favor, preencha o domínio",variant:"destructive"})},P=(e,s)=>{navigator.clipboard.writeText(e),S({title:"Copiado!",description:`${s} copiado para a área de transferência`})};if(O)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-gray-400"})});if(0===A.length)return e.jsx("div",{children:e.jsxs("div",{className:"p-6 sm:p-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Você ainda não tem nenhum domínio cadastrado."}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400 mb-8",children:"Cadastrando seu domínio você aumenta a credibilidade e conversão da sua loja."}),e.jsx(t,{size:"lg",onClick:()=>I(!0),className:"bg-pink-600 hover:bg-pink-700 text-white",children:"CADASTRAR DOMÍNIO"})]}),U&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(n,{className:"w-full max-w-md",children:[e.jsx(o,{children:e.jsx(c,{className:"uppercase text-lg",children:"Adicionar novo domínio"})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Domínio"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{value:$.subdomain,onValueChange:e=>q({...$,subdomain:e}),children:[e.jsx(u,{className:"w-[140px]",children:e.jsx(j,{})}),e.jsxs(p,{children:[e.jsx(f,{value:"checkout",children:"checkout."}),e.jsx(f,{value:"seguro",children:"seguro."}),e.jsx(f,{value:"secure",children:"secure."}),e.jsx(f,{value:"pay",children:"pay."})]})]}),e.jsx(l,{placeholder:"ex.: sualoja.com.br",value:$.domain,onChange:e=>q({...$,domain:e.target.value})})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("p",{children:"• Vincule um domínio que já pertença a você."}),e.jsx("p",{children:"• Não use http, https, www e url da sua loja myshopify."})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(t,{variant:"outline",className:"flex-1",onClick:()=>I(!1),children:"Cancelar"}),e.jsx(t,{className:"flex-1 bg-pink-600 hover:bg-pink-700",onClick:M,children:"Salvar"})]})]})]})})]})});const L=A[0],B=`${L.subdomain}.${L.domain}`;return e.jsx("div",{children:e.jsx("div",{className:"p-6 sm:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>V("/onboarding"),className:"text-pink-600 hover:text-pink-700 mb-4 flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"ver todos os domínios"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"CONFIGURAÇÃO DO DOMÍNIO"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:B})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(n,{children:[e.jsx(o,{children:e.jsx(c,{children:"Cadastrando o apontamento"})}),e.jsxs(d,{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Em seu provedor, na seção de configuração registros DNS, adicione as informações abaixo. Preencha cada campo com as respectivas informações listadas abaixo:"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"text-xs uppercase tracking-wide",children:"Tipo"}),e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>P("CNAME","Tipo"),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"CNAME"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"text-xs uppercase tracking-wide",children:"Nome"}),e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>P(L.subdomain,"Nome"),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),L.subdomain]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"text-xs uppercase tracking-wide",children:"Valor"}),e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>P(L.cnameRecord,"Valor"),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),L.cnameRecord]})]})]}),e.jsxs(v,{children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(g,{children:"Após realizar corretamente os apontamentos acima em seu provedor de domínio, você deve aguardar um tempo para que as informações sejam propagadas. Esse processo costuma levar até 4h."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(t,{variant:"outline",className:"flex-1",onClick:async()=>{try{const{data:{user:e}}=await r.auth.getUser();if(!e)return;const{error:s}=await r.from("User").update({domain:null,domainVerified:!1,domainVerificationToken:null}).eq("id",e.id);if(s)throw s;S({title:"Domínio excluído",description:"O domínio foi removido com sucesso"}),await z()}catch(e){S({title:"Erro",description:"Não foi possível excluir o domínio",variant:"destructive"})}},children:"Excluir domínio"}),e.jsx(t,{className:"flex-1 bg-pink-600 hover:bg-pink-700 text-white",onClick:async()=>{T(!0);try{const{data:{user:e}}=await r.auth.getUser();if(!e)return;const{data:s}=await r.auth.getSession(),a=await fetch(`${m.functionsUrl}/verify-domain`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s?.access_token}`,apikey:"your-anon-key"},body:JSON.stringify({subdomain:L.subdomain,domain:L.domain})}),i=await a.json();if(!a.ok||!i.verified)throw new Error(i.details||i.reason||"Verificação falhou");S({title:"Domínio verificado com sucesso!",description:"Seu domínio está pronto para uso"}),await z()}catch(e){S({title:"Erro",description:e.message||"Não foi possível verificar o domínio. Verifique se o DNS está configurado corretamente.",variant:"destructive"})}finally{T(!1)}},disabled:R||L.verified,children:R?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}),"Verificando..."]}):"VERIFICAR DOMÍNIO"})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n,{children:[e.jsx(o,{children:e.jsx(c,{className:"text-sm",children:"Status"})}),e.jsx(d,{children:e.jsx("div",{className:"flex items-center gap-2",children:L.verified?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-green-500 font-medium",children:"Concluído"})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-yellow-500 font-medium",children:"Pendente"})]})})})]}),e.jsxs(n,{children:[e.jsx(o,{children:e.jsx(c,{className:"text-sm",children:"SSL"})}),e.jsx(d,{children:e.jsx("div",{className:"flex items-center gap-2",children:L.sslConfigured?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-green-500 font-medium",children:"Concluído"})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-yellow-500 font-medium",children:"Pendente"})]})})})]}),e.jsxs(n,{children:[e.jsx(o,{children:e.jsxs(c,{className:"text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-pink-100 flex items-center justify-center",children:e.jsx(b,{className:"h-5 w-5 text-pink-600"})}),"Está com dúvidas?"]})}),e.jsxs(d,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Aprenda como verificar o domínio da sua loja."}),e.jsxs(t,{variant:"link",className:"p-0",children:["Ver tutorial ",e.jsx(C,{className:"h-4 w-4 ml-1"})]})]})]})]})]})]})})})}export{S as default};
