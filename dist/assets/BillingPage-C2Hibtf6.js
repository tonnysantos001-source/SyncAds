import{d as ne,r as u,s as v,j as e,O as y,aa as oe,ak as ce,as as de,au as B,C as D,e as O,B as H,ac as V,at as me,I as xe,h as q,o as z,av as ge,f as he}from"./index-CQ2-MXC2.js";import{T as $,a as G,b as I,c as l,d as W,e as r}from"./table-6mNi2wwQ.js";import{S as _}from"./SuperAdminLayout-DV7MBSJl.js";import{S as ue,a as be,b as ye,c as pe,d as h}from"./select-sqyP70Fp.js";import{f as je,p as fe}from"./pt-BR-BQ5kKd2v.js";import"./index-B61Y-YZA.js";import"./constructFrom-rJN6zrQ_.js";const T=({title:R,value:L,description:N,icon:x,gradient:w,delay:b=0})=>e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:b},whileHover:{scale:1.02},children:e.jsxs(D,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl hover:border-gray-600 transition-all group cursor-pointer relative overflow-hidden",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${w} opacity-10 group-hover:opacity-20 transition-opacity`}),e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2 relative z-10",children:[e.jsx(he,{className:"text-sm font-medium text-gray-300",children:R}),e.jsx("div",{className:`p-2.5 rounded-xl bg-gradient-to-br ${w} shadow-lg`,children:e.jsx(x,{className:"h-4 w-4 text-white"})})]}),e.jsxs(q,{className:"relative z-10",children:[e.jsx("div",{className:"text-3xl font-bold text-white mb-1",children:L}),e.jsx("p",{className:"text-xs text-gray-400",children:N})]})]})});function Te(){const{toast:R}=ne(),[L,N]=u.useState(!0),[x,w]=u.useState(""),[b,J]=u.useState("all"),[C,P]=u.useState("subscriptions"),[K,Q]=u.useState([]),[X,Y]=u.useState([]),[p,Z]=u.useState({totalRevenue:0,monthlyRevenue:0,activeSubscriptions:0,totalInvoices:0,paidInvoices:0,pendingInvoices:0});u.useEffect(()=>{ee()},[]);const ee=async()=>{try{N(!0);const{data:a,error:d}=await v.from("Subscription").select("*").order("createdAt",{ascending:!1});if(d)throw d;const i=[...new Set((a==null?void 0:a.map(t=>t.userId))||[])],{data:s}=await v.from("User").select("id, name, email").in("id",i),m=[...new Set((a==null?void 0:a.map(t=>t.planId))||[])],{data:o}=await v.from("Plan").select("id, name, price, maxAiMessages").in("id",m),c=(a||[]).map(t=>({...t,user:s==null?void 0:s.find(g=>g.id===t.userId),plan:o==null?void 0:o.find(g=>g.id===t.planId)})),{data:n,error:j}=await v.from("Invoice").select("*").order("createdAt",{ascending:!1});if(j)throw j;const ae=[...new Set((n==null?void 0:n.map(t=>t.userId))||[])],{data:k}=await v.from("User").select("id, name, email").in("id",ae),f=(n||[]).map(t=>({...t,user:k==null?void 0:k.find(g=>g.id===t.userId)}));Q(c),Y(f);const te=c.filter(t=>t.status==="active").length,re=c.filter(t=>t.status==="active").reduce((t,g)=>{var U;return t+(((U=g.plan)==null?void 0:U.price)||0)},0),se=f.filter(t=>t.status==="paid").length,ie=f.filter(t=>t.status==="open"||t.status==="draft").length,le=f.filter(t=>t.status==="paid").reduce((t,g)=>t+g.amount,0);Z({totalRevenue:le,monthlyRevenue:re,activeSubscriptions:te,totalInvoices:f.length,paidInvoices:se,pendingInvoices:ie})}catch(a){console.error("Error loading billing data:",a),R({title:"Erro ao carregar dados",description:a.message||"Não foi possível carregar os dados de faturamento.",variant:"destructive"})}finally{N(!1)}},S=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a/100),A=a=>{if(!a)return"-";try{return je(new Date(a),"dd/MM/yyyy",{locale:fe})}catch{return"-"}},E=a=>{const i={active:{label:"Ativa",className:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 text-green-300 border-green-500/30 border"},trialing:{label:"Trial",className:"bg-gradient-to-r from-blue-500/20 to-cyan-500/20 text-blue-300 border-blue-500/30 border"},past_due:{label:"Atrasada",className:"bg-gradient-to-r from-orange-500/20 to-red-500/20 text-orange-300 border-orange-500/30 border"},canceled:{label:"Cancelada",className:"bg-gradient-to-r from-gray-500/20 to-gray-600/20 text-gray-300 border-gray-500/30 border"},paid:{label:"Paga",className:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 text-green-300 border-green-500/30 border"},open:{label:"Aberta",className:"bg-gradient-to-r from-blue-500/20 to-cyan-500/20 text-blue-300 border-blue-500/30 border"},draft:{label:"Rascunho",className:"bg-gradient-to-r from-gray-500/20 to-gray-600/20 text-gray-300 border-gray-500/30 border"},void:{label:"Cancelada",className:"bg-gradient-to-r from-red-500/20 to-orange-500/20 text-red-300 border-red-500/30 border"}}[a]||{label:a,className:"bg-gradient-to-r from-gray-500/20 to-gray-600/20 text-gray-300 border-gray-500/30 border"};return e.jsx(z,{className:i.className,children:i.label})},F=K.filter(a=>{var s,m,o,c,n,j;const d=((m=(s=a.user)==null?void 0:s.name)==null?void 0:m.toLowerCase().includes(x.toLowerCase()))||((c=(o=a.user)==null?void 0:o.email)==null?void 0:c.toLowerCase().includes(x.toLowerCase()))||((j=(n=a.plan)==null?void 0:n.name)==null?void 0:j.toLowerCase().includes(x.toLowerCase())),i=b==="all"||a.status===b;return d&&i}),M=X.filter(a=>{var s,m,o,c,n;const d=((m=(s=a.user)==null?void 0:s.name)==null?void 0:m.toLowerCase().includes(x.toLowerCase()))||((c=(o=a.user)==null?void 0:o.email)==null?void 0:c.toLowerCase().includes(x.toLowerCase()))||((n=a.invoiceNumber)==null?void 0:n.toLowerCase().includes(x.toLowerCase())),i=b==="all"||a.status===b;return d&&i});return L?e.jsx(_,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx(y.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-12 h-12 border-4 border-green-500/30 border-t-green-500 rounded-full"})})}):e.jsx(_,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(y.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent",children:"Faturamento"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Gerencie assinaturas e faturas dos clientes"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(T,{title:"Receita Total",value:S(p.totalRevenue),description:`${p.paidInvoices} faturas pagas`,icon:oe,gradient:"from-green-500 to-emerald-500",delay:.1}),e.jsx(T,{title:"MRR",value:S(p.monthlyRevenue),description:"Receita mensal recorrente",icon:ce,gradient:"from-blue-500 to-cyan-500",delay:.2}),e.jsx(T,{title:"Assinaturas Ativas",value:p.activeSubscriptions,description:"Clientes com planos ativos",icon:de,gradient:"from-purple-500 to-pink-500",delay:.3}),e.jsx(T,{title:"Faturas Pendentes",value:p.pendingInvoices,description:"Aguardando pagamento",icon:B,gradient:"from-orange-500 to-red-500",delay:.4})]}),e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:e.jsxs(D,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsx(O,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(H,{onClick:()=>P("subscriptions"),className:C==="subscriptions"?"bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white border-0":"bg-gray-800/50 hover:bg-gray-700/50 text-gray-300 border border-gray-700",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Assinaturas"]}),e.jsxs(H,{onClick:()=>P("invoices"),className:C==="invoices"?"bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white border-0":"bg-gray-800/50 hover:bg-gray-700/50 text-gray-300 border border-gray-700",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Faturas"]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-1 sm:w-64",children:[e.jsx(me,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx(xe,{placeholder:"Buscar...",value:x,onChange:a=>w(a.target.value),className:"pl-10 bg-gray-800/50 border-gray-700 text-white placeholder:text-gray-500 focus:border-green-500"})]}),e.jsxs(ue,{value:b,onValueChange:J,children:[e.jsx(be,{className:"w-32 bg-gray-800/50 border-gray-700 text-white",children:e.jsx(ye,{placeholder:"Status"})}),e.jsxs(pe,{className:"bg-gray-900 border-gray-700",children:[e.jsx(h,{value:"all",className:"text-white hover:bg-gray-800",children:"Todos"}),C==="subscriptions"?e.jsxs(e.Fragment,{children:[e.jsx(h,{value:"active",className:"text-white hover:bg-gray-800",children:"Ativa"}),e.jsx(h,{value:"trialing",className:"text-white hover:bg-gray-800",children:"Trial"}),e.jsx(h,{value:"canceled",className:"text-white hover:bg-gray-800",children:"Cancelada"}),e.jsx(h,{value:"past_due",className:"text-white hover:bg-gray-800",children:"Atrasada"})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{value:"paid",className:"text-white hover:bg-gray-800",children:"Paga"}),e.jsx(h,{value:"open",className:"text-white hover:bg-gray-800",children:"Aberta"}),e.jsx(h,{value:"draft",className:"text-white hover:bg-gray-800",children:"Rascunho"}),e.jsx(h,{value:"void",className:"text-white hover:bg-gray-800",children:"Cancelada"})]})]})]})]})]})}),e.jsx(q,{children:C==="subscriptions"?e.jsx("div",{className:"border border-gray-700/50 rounded-lg overflow-hidden",children:e.jsxs($,{children:[e.jsx(G,{children:e.jsxs(I,{className:"border-gray-700/50 hover:bg-gray-800/50",children:[e.jsx(l,{className:"text-gray-300 font-semibold",children:"Cliente"}),e.jsx(l,{className:"text-gray-300 font-semibold",children:"Plano"}),e.jsx(l,{className:"text-gray-300 font-semibold",children:"Valor"}),e.jsx(l,{className:"text-gray-300 font-semibold",children:"Status"}),e.jsx(l,{className:"text-gray-300 font-semibold",children:"Uso IA"}),e.jsx(l,{className:"text-gray-300 font-semibold",children:"Renovação"}),e.jsx(l,{className:"text-gray-300 font-semibold",children:"Criado em"})]})}),e.jsx(W,{children:F.length===0?e.jsx(I,{children:e.jsx(r,{colSpan:7,className:"text-center py-12 text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(V,{className:"w-12 h-12 text-gray-600"}),e.jsx("p",{children:"Nenhuma assinatura encontrada"})]})})}):F.map((a,d)=>{var i,s,m,o,c,n;return e.jsxs(y.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:d*.05},className:"border-gray-700/50 hover:bg-gray-800/50 transition-colors",children:[e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:((i=a.user)==null?void 0:i.name)||"N/A"}),e.jsx("p",{className:"text-sm text-gray-400",children:((s=a.user)==null?void 0:s.email)||"N/A"})]})}),e.jsx(r,{children:e.jsx(z,{className:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 border-purple-500/30 border",children:((m=a.plan)==null?void 0:m.name)||"N/A"})}),e.jsxs(r,{className:"font-semibold text-white",children:[S(((o=a.plan)==null?void 0:o.price)||0),"/mês"]}),e.jsx(r,{children:E(a.status)}),e.jsx(r,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-white",children:a.usedAiMessages}),e.jsxs("span",{className:"text-gray-400",children:[" ","/"," ",((c=a.plan)==null?void 0:c.maxAiMessages)===0?"∞":((n=a.plan)==null?void 0:n.maxAiMessages)||"N/A"]})]})}),e.jsx(r,{className:"text-sm text-gray-400",children:A(a.currentPeriodEnd)}),e.jsx(r,{className:"text-sm text-gray-400",children:A(a.createdAt)})]},a.id)})})]})}):e.jsx("div",{className:"border border-gray-700/50 rounded-lg overflow-hidden",children:e.jsxs($,{children:[e.jsx(G,{children:e.jsxs(I,{className:"border-gray-700/50 hover:bg-gray-800/50",children:[e.jsx(l,{className:"text-gray-300 font-semibold",children:"Fatura"}),e.jsx(l,{className:"text-gray-300 font-semibold",children:"Cliente"}),e.jsx(l,{className:"text-gray-300 font-semibold",children:"Valor"}),e.jsx(l,{className:"text-gray-300 font-semibold",children:"Status"}),e.jsx(l,{className:"text-gray-300 font-semibold",children:"Pago em"}),e.jsx(l,{className:"text-gray-300 font-semibold",children:"Criado em"}),e.jsx(l,{className:"text-gray-300 font-semibold text-right",children:"Ações"})]})}),e.jsx(W,{children:M.length===0?e.jsx(I,{children:e.jsx(r,{colSpan:7,className:"text-center py-12 text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(B,{className:"w-12 h-12 text-gray-600"}),e.jsx("p",{children:"Nenhuma fatura encontrada"})]})})}):M.map((a,d)=>{var i,s;return e.jsxs(y.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:d*.05},className:"border-gray-700/50 hover:bg-gray-800/50 transition-colors",children:[e.jsx(r,{className:"font-medium text-white",children:a.invoiceNumber}),e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:((i=a.user)==null?void 0:i.name)||"N/A"}),e.jsx("p",{className:"text-sm text-gray-400",children:((s=a.user)==null?void 0:s.email)||"N/A"})]})}),e.jsx(r,{className:"font-semibold text-white",children:S(a.amount)}),e.jsx(r,{children:E(a.status)}),e.jsx(r,{className:"text-sm text-gray-400",children:A(a.paidAt)}),e.jsx(r,{className:"text-sm text-gray-400",children:A(a.createdAt)}),e.jsx(r,{className:"text-right",children:e.jsx(H,{variant:"ghost",size:"icon",className:"hover:bg-gray-700/50 text-gray-400 hover:text-white",children:e.jsx(ge,{className:"h-4 w-4"})})})]},a.id)})})]})})})]})})]})})}export{Te as default};
