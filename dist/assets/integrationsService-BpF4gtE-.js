var w=Object.defineProperty;var m=(c,e,o)=>e in c?w(c,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[e]=o;var g=(c,e,o)=>m(c,typeof e!="symbol"?e+"":e,o);import{s as r}from"./index-BnKEaS9w.js";var i={};const I={google_ads:{slug:"google_ads",name:"Google Ads",authType:"oauth",icon:"üîç",description:"Gerencie suas campanhas do Google Ads",scopes:["https://www.googleapis.com/auth/adwords"],clientId:i.VITE_GOOGLE_CLIENT_ID,authUrl:"https://accounts.google.com/o/oauth2/v2/auth",tokenUrl:"https://oauth2.googleapis.com/token"},meta_ads:{slug:"meta_ads",name:"Meta Ads",authType:"oauth",icon:"üìò",description:"Conecte suas campanhas do Facebook e Instagram",scopes:["ads_management","ads_read","business_management"],clientId:i.VITE_META_CLIENT_ID,authUrl:"https://www.facebook.com/v18.0/dialog/oauth",tokenUrl:"https://graph.facebook.com/v18.0/oauth/access_token"},facebook_ads:{slug:"facebook_ads",name:"Facebook Ads",authType:"oauth",icon:"üë•",description:"Gerencie an√∫ncios do Facebook",scopes:["ads_management","ads_read"],clientId:i.VITE_META_CLIENT_ID,authUrl:"https://www.facebook.com/v18.0/dialog/oauth",tokenUrl:"https://graph.facebook.com/v18.0/oauth/access_token"},linkedin_ads:{slug:"linkedin_ads",name:"LinkedIn Ads",authType:"oauth",icon:"üíº",description:"Conecte suas campanhas do LinkedIn",scopes:["r_ads","rw_ads","r_organization_social"],clientId:i.VITE_LINKEDIN_CLIENT_ID,authUrl:"https://www.linkedin.com/oauth/v2/authorization",tokenUrl:"https://www.linkedin.com/oauth/v2/accessToken"},google_analytics:{slug:"google_analytics",name:"Google Analytics",authType:"oauth",icon:"üìä",description:"Analise dados do Google Analytics",scopes:["https://www.googleapis.com/auth/analytics.readonly"],clientId:i.VITE_GOOGLE_CLIENT_ID,authUrl:"https://accounts.google.com/o/oauth2/v2/auth",tokenUrl:"https://oauth2.googleapis.com/token"},twitter_ads:{slug:"twitter_ads",name:"Twitter Ads",authType:"oauth",icon:"üê¶",description:"Gerencie campanhas do Twitter/X",scopes:["tweet.read","users.read","offline.access"],clientId:i.VITE_TWITTER_CLIENT_ID,authUrl:"https://twitter.com/i/oauth2/authorize",tokenUrl:"https://api.twitter.com/2/oauth2/token"},tiktok_ads:{slug:"tiktok_ads",name:"TikTok Ads",authType:"oauth",icon:"üéµ",description:"Conecte suas campanhas do TikTok",scopes:["user.info.basic","video.list"],clientId:i.VITE_TIKTOK_CLIENT_ID,authUrl:"https://www.tiktok.com/auth/authorize/",tokenUrl:"https://open-api.tiktok.com/oauth/access_token/"}};class _{constructor(){g(this,"REDIRECT_URI",`${window.location.origin}/integrations/callback`)}async listIntegrations(e){const{data:o,error:t}=await r.from("Integration").select("*").eq("userId",e);if(t)throw t;return o||[]}async getIntegrationStatus(e,o){const{data:t,error:a}=await r.from("Integration").select("*").eq("userId",e).eq("platform",o.toUpperCase()).single();if(a&&a.code!=="PGRST116")throw a;return t}async generateOAuthUrl(e,o){var n;const t=I[e];if(!t||t.authType!=="oauth")throw new Error("Integra√ß√£o n√£o suporta OAuth");if(!t.clientId||t.clientId==="your-google-client-id"||t.clientId==="your-meta-client-id"||t.clientId==="your-linkedin-client-id"||t.clientId==="your-twitter-client-id"||t.clientId==="your-tiktok-client-id")throw new Error(`‚ùå Client ID n√£o configurado para ${t.name}

üìù Para conectar esta integra√ß√£o, voc√™ precisa:
1. Criar uma aplica√ß√£o OAuth no ${t.name}
2. Adicionar o Client ID no arquivo .env
3. Reiniciar o servidor de desenvolvimento

üìñ Consulte OAUTH_SETUP.md para instru√ß√µes detalhadas.`);const a=btoa(JSON.stringify({userId:o,slug:e,timestamp:Date.now(),random:Math.random().toString(36).substring(7)})),l=new Date(Date.now()+10*60*1e3).toISOString(),{error:s}=await r.from("OAuthState").insert({id:crypto.randomUUID(),state:a,userId:o,integrationSlug:e,expiresAt:l,createdAt:new Date().toISOString()});if(s)throw new Error(`Erro ao armazenar state OAuth: ${s.message}`);const d=new URLSearchParams({client_id:t.clientId,redirect_uri:this.REDIRECT_URI,response_type:"code",scope:((n=t.scopes)==null?void 0:n.join(" "))||"",state:a,access_type:"offline",prompt:"consent"});return{authUrl:`${t.authUrl}?${d.toString()}`,state:a}}async handleOAuthCallback(e,o){const{data:t,error:a}=await r.from("OAuthState").select("*").eq("state",o).single();if(a||!t)throw new Error("State inv√°lido ou expirado");const{userId:l,integrationSlug:s}=JSON.parse(atob(o)),d=I[s];if(!d)throw new Error("Integra√ß√£o n√£o encontrada");const u=await fetch(d.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:d.clientId,client_secret:"8b80da29081d73fd7d1037f3cae72d55",code:e,redirect_uri:this.REDIRECT_URI,grant_type:"authorization_code"})});if(!u.ok)throw new Error("Falha ao obter tokens");const n=await u.json();n.expires_in&&new Date(Date.now()+n.expires_in*1e3).toISOString();const{data:h}=await r.from("Integration").select("id").eq("userId",l).eq("platform",s.toUpperCase()).single();if(h)await r.from("Integration").update({credentials:{access_token:n.access_token,refresh_token:n.refresh_token},isConnected:!0,lastSyncAt:new Date().toISOString(),updatedAt:new Date().toISOString()}).eq("id",h.id);else{const{error:p}=await r.from("Integration").insert({id:crypto.randomUUID(),userId:l,platform:s.toUpperCase(),credentials:{access_token:n.access_token,refresh_token:n.refresh_token},isConnected:!0,lastSyncAt:new Date().toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});if(p)throw p}return await r.from("OAuthState").delete().eq("state",o),{success:!0,slug:s}}async connectDirect(e,o,t){throw new Error("Autentica√ß√£o direta requer implementa√ß√£o no backend")}async disconnect(e,o){const{error:t}=await r.from("Integration").delete().eq("userId",e).eq("platform",o.toUpperCase());if(t)throw t}async refreshToken(e){console.log("Refresh token n√£o implementado ainda")}}const T=new _;export{I,T as i};
