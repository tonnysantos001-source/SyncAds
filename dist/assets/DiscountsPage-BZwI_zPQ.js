import{b as L,r as u,s as p,j as e,d as h,e as g,f as j,h as y,an as R,g as X,n as _,I as v,B as V}from"./index-BK7NROci.js";import{L as m}from"./label-DjhnlzGb.js";import{S as z}from"./switch-Ded8dC2z.js";import{S as H,a as U,b as Y,c as J,d as I}from"./select-MWbmR404.js";import{A,b as F,a as w}from"./alert-BlLcDQoW.js";import{S as K}from"./separator-D3gwsqvB.js";import{u as Q}from"./useOptimizedSelectors-je8s2ei0.js";import{C as D}from"./credit-card-DSYqFyVp.js";import{D as W}from"./dollar-sign-B2hgPyrY.js";import{P as Z}from"./percent-DFqNX4Sp.js";import{C as $}from"./circle-check-dcSmKuFD.js";import{C as ee}from"./circle-alert-6KVNQ-_Y.js";import"./index-DZHv0dUK.js";import"./chevron-up-pR9GcTZy.js";import"./settingsStore-Bm7yun2f.js";const f=[{key:"CREDIT_CARD",label:"Cartão de Crédito",icon:D,color:"bg-blue-500",description:"Desconto para pagamentos com cartão de crédito"},{key:"PIX",label:"PIX",icon:W,color:"bg-green-500",description:"Desconto para pagamentos via PIX (mais comum)"},{key:"BOLETO",label:"Boleto Bancário",icon:D,color:"bg-orange-500",description:"Desconto para pagamentos com boleto bancário"},{key:"DEBIT_CARD",label:"Cartão de Débito",icon:D,color:"bg-purple-500",description:"Desconto para pagamentos com cartão de débito"}],ge=()=>{const{toast:c}=L(),{user:r}=Q(),[O,C]=u.useState(!0),[b,E]=u.useState(!1),[x,M]=u.useState([]),[N,P]=u.useState({});u.useEffect(()=>{r!=null&&r.id&&k()},[r==null?void 0:r.id]);const k=async()=>{if(r!=null&&r.id)try{C(!0);const{data:t,error:i}=await p.from("PaymentMethodDiscount").select("*").eq("userId",r.id).order("createdAt",{ascending:!1});if(i)throw i;M(t||[]);const o={};f.forEach(s=>{var n,S;const a=(t||[]).find(G=>G.paymentMethod===s.key);a?o[s.key]={discountType:a.discountType,discountValue:a.discountValue.toString(),minPurchaseAmount:((n=a.minPurchaseAmount)==null?void 0:n.toString())||"0",maxDiscountAmount:((S=a.maxDiscountAmount)==null?void 0:S.toString())||"",description:a.description||"",isActive:a.isActive}:o[s.key]={discountType:"PERCENTAGE",discountValue:"",minPurchaseAmount:"0",maxDiscountAmount:"",description:"",isActive:!0}}),P(o)}catch(t){console.error("Erro ao carregar descontos:",t),c({title:"Erro ao carregar descontos",description:t.message,variant:"destructive"})}finally{C(!1)}},B=async t=>{var o;if(!(r!=null&&r.id))return;const i=N[t];if(!i||!i.discountValue){c({title:"Valor obrigatório",description:"Informe o valor do desconto",variant:"destructive"});return}E(!0);try{const s=x.find(n=>n.paymentMethod===t),a={userId:r.id,paymentMethod:t,discountType:i.discountType,discountValue:parseFloat(i.discountValue),minPurchaseAmount:parseFloat(i.minPurchaseAmount||"0"),maxDiscountAmount:i.maxDiscountAmount?parseFloat(i.maxDiscountAmount):null,description:i.description||null,isActive:i.isActive,updatedAt:new Date().toISOString()};if(s){const{error:n}=await p.from("PaymentMethodDiscount").update(a).eq("id",s.id);if(n)throw n}else{const{error:n}=await p.from("PaymentMethodDiscount").insert(a);if(n)throw n}c({title:"Desconto salvo!",description:`Desconto para ${(o=f.find(n=>n.key===t))==null?void 0:o.label} configurado com sucesso`}),await k()}catch(s){console.error("Erro ao salvar desconto:",s),c({title:"Erro ao salvar",description:s.message,variant:"destructive"})}finally{E(!1)}},q=async(t,i)=>{var o;if(window.confirm(`Tem certeza que deseja remover o desconto de ${(o=f.find(s=>s.key===i))==null?void 0:o.label}?`))try{const{error:s}=await p.from("PaymentMethodDiscount").delete().eq("id",t);if(s)throw s;c({title:"Desconto removido!",description:"O desconto foi removido com sucesso"}),await k()}catch(s){console.error("Erro ao remover desconto:",s),c({title:"Erro ao remover",description:s.message,variant:"destructive"})}},l=(t,i,o)=>{P(s=>({...s,[t]:{...s[t]||{discountType:"PERCENTAGE",discountValue:"",minPurchaseAmount:"0",maxDiscountAmount:"",description:"",isActive:!0},[i]:o}}))},T=(t,i=100)=>{const o=N[t];if(!o||!o.discountValue)return 0;const s=parseFloat(o.discountValue);let a=0;if(o.discountType==="PERCENTAGE"?a=i*s/100:a=s,o.maxDiscountAmount){const n=parseFloat(o.maxDiscountAmount);a=Math.min(a,n)}return a},d={total:x.length,active:x.filter(t=>t.isActive).length,inactive:x.filter(t=>!t.isActive).length};return O?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando descontos..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 dark:from-blue-400 dark:via-purple-400 dark:to-pink-400 bg-clip-text text-transparent",children:"Descontos por Forma de Pagamento"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 font-medium mt-2",children:"Configure descontos automáticos baseados na forma de pagamento escolhida pelo cliente no checkout"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(h,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Total de Descontos"}),e.jsx(Z,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.total}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:d.total===0?"Nenhum desconto configurado":`${d.total} ${d.total===1?"método configurado":"métodos configurados"}`})]})]}),e.jsxs(h,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Descontos Ativos"}),e.jsx($,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.active}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Aplicados no checkout"})]})]}),e.jsxs(h,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Descontos Inativos"}),e.jsx($,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.inactive}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Pausados temporariamente"})]})]})]}),e.jsxs(A,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(F,{children:"Como funciona"}),e.jsx(w,{children:"Os descontos configurados aqui serão aplicados automaticamente no checkout público quando o cliente selecionar a forma de pagamento. O desconto será exibido de forma clara antes da finalização da compra."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Configurar Descontos"}),f.map(t=>{const i=t.icon,o=x.find(a=>a.paymentMethod===t.key),s=N[t.key];return e.jsxs(h,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${t.color} flex items-center justify-center`,children:e.jsx(i,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(j,{className:"text-lg",children:t.label}),e.jsx(X,{children:t.description})]})]}),o&&e.jsx(_,{variant:o.isActive?"default":"secondary",children:o.isActive?"Ativo":"Inativo"})]})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Tipo de Desconto"}),e.jsxs(H,{value:(s==null?void 0:s.discountType)||"PERCENTAGE",onValueChange:a=>l(t.key,"discountType",a),children:[e.jsx(U,{children:e.jsx(Y,{})}),e.jsxs(J,{children:[e.jsx(I,{value:"PERCENTAGE",children:"Porcentagem (%)"}),e.jsx(I,{value:"FIXED_AMOUNT",children:"Valor Fixo (R$)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{children:["Valor do Desconto ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{type:"number",placeholder:"0",value:(s==null?void 0:s.discountValue)||"",onChange:a=>l(t.key,"discountValue",a.target.value),min:"0",step:"0.01"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300 font-medium",children:(s==null?void 0:s.discountType)==="PERCENTAGE"?"%":"R$"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Valor Mínimo da Compra"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{type:"number",placeholder:"0.00",value:(s==null?void 0:s.minPurchaseAmount)||"0",onChange:a=>l(t.key,"minPurchaseAmount",a.target.value),min:"0",step:"0.01"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300 font-medium",children:"R$"})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Desconto só se aplica acima deste valor"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Desconto Máximo (Opcional)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{type:"number",placeholder:"Sem limite",value:(s==null?void 0:s.maxDiscountAmount)||"",onChange:a=>l(t.key,"maxDiscountAmount",a.target.value),min:"0",step:"0.01"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300 font-medium",children:"R$"})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Limite máximo do desconto em reais"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Descrição (Opcional)"}),e.jsx(v,{placeholder:"Ex: Desconto especial para pagamento à vista",value:(s==null?void 0:s.description)||"",onChange:a=>l(t.key,"description",a.target.value)})]}),(s==null?void 0:s.discountValue)&&e.jsxs(A,{className:"border-blue-200 bg-blue-50",children:[e.jsx(R,{className:"h-4 w-4 text-blue-600"}),e.jsx(F,{className:"text-blue-900",children:"Preview do Desconto"}),e.jsxs(w,{className:"text-blue-800",children:[e.jsxs("p",{className:"mb-2",children:["Para uma compra de R$ 100,00, o desconto será de"," ",e.jsxs("strong",{children:["R$"," ",T(t.key,100).toFixed(2)]})]}),e.jsxs("p",{children:["Total a pagar:"," ",e.jsxs("strong",{children:["R$"," ",(100-T(t.key,100)).toFixed(2)]})]})]})]}),e.jsx(K,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{children:"Status do Desconto"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:s!=null&&s.isActive?"Desconto será aplicado no checkout":"Desconto pausado temporariamente"})]}),e.jsx(z,{checked:(s==null?void 0:s.isActive)??!0,onCheckedChange:a=>l(t.key,"isActive",a)})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[o&&e.jsx(V,{variant:"outline",onClick:()=>q(o.id,t.key),disabled:b,children:"Remover"}),e.jsx(V,{onClick:()=>B(t.key),disabled:b||!(s!=null&&s.discountValue),className:"bg-pink-600 hover:bg-pink-700",children:b?"Salvando...":"Salvar Desconto"})]})]})]},t.key)})]}),e.jsxs(A,{className:"border-pink-200 bg-pink-50",children:[e.jsx(ee,{className:"h-4 w-4 text-pink-600"}),e.jsxs(w,{className:"text-pink-900",children:[e.jsx("strong",{children:"Dica:"})," Descontos para PIX geralmente aumentam a taxa de conversão. Recomendamos oferecer entre 3% a 10% de desconto."]})]})]})};export{ge as default};
