import{r as l,b as I,u as R,j as e,B as P,a6 as F,d,e as m,f as x,h,S as O,I as M,l as V}from"./index-Dp8T7_yL.js";import{T as D,a as H,b as v,c as o,d as U,e as c}from"./table-CSq-PhDo.js";import{c as q}from"./customersApi-CC3w1yv2.js";import{a as G}from"./shopifySync-zo1_gPuT.js";import{S as C}from"./skeleton-BvOxRLJm.js";import{U as j}from"./users-C2Rg9Ov7.js";import{S as $}from"./shopping-bag-BkoqSdBs.js";import{D as J}from"./dollar-sign-Dfm4JkvK.js";import{M as K}from"./mail-BbykfKw8.js";import{P as Q}from"./phone-Ci0f1IZQ.js";import{f as W,p as X}from"./pt-BR-BQ5kKd2v.js";import"./constructFrom-rJN6zrQ_.js";const ce=()=>{const[a,S]=l.useState([]),[b,f]=l.useState([]),[T,u]=l.useState(!0),[p,g]=l.useState(!1),[i,E]=l.useState(""),{toast:n}=I(),t=R(s=>s.user);l.useEffect(()=>{t!=null&&t.id&&w()},[t==null?void 0:t.id]),l.useEffect(()=>{B()},[i,a]);const w=async()=>{if(!(t!=null&&t.id)){u(!1);return}try{u(!0);const s=await q.listFromShopify(t.id);S(s),f(s)}catch(s){console.error("Erro ao carregar clientes:",s),n({title:"Erro ao carregar clientes",description:s.message,variant:"destructive"})}finally{u(!1)}},A=async()=>{if(!(t!=null&&t.id)){n({title:"Erro",description:"Faça login para sincronizar",variant:"destructive"});return}try{g(!0),n({title:"Sincronizando...",description:"Buscando clientes da Shopify"});const s=await G.syncCustomers(t.id);s.success?(n({title:"Sincronização concluída!",description:s.message}),await w()):n({title:"Erro na sincronização",description:s.message,variant:"destructive"})}catch{n({title:"Erro ao sincronizar",description:"Configure a integração Shopify em Integrações",variant:"destructive"})}finally{g(!1)}},B=()=>{if(!i){f(a);return}const s=a.filter(r=>{var N;return r.name.toLowerCase().includes(i.toLowerCase())||r.email.toLowerCase().includes(i.toLowerCase())||((N=r.cpf)==null?void 0:N.toLowerCase().includes(i.toLowerCase()))});f(s)},y=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),k=a.reduce((s,r)=>s+r.totalSpent,0),L=a.reduce((s,r)=>s+r.totalOrders,0),z=a.filter(s=>s.status==="ACTIVE").length;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-purple-50/30 p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Clientes"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Visualize e gerencie todos os clientes da sua loja"})]}),e.jsxs(P,{onClick:A,disabled:p,children:[e.jsx(F,{className:`mr-2 h-4 w-4 ${p?"animate-spin":""}`}),p?"Sincronizando...":"Sincronizar Shopify"]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-4",children:[e.jsxs(d,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Total de Clientes"}),e.jsx(j,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold",children:a.length})})]}),e.jsxs(d,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Clientes Ativos"}),e.jsx(j,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold",children:z})})]}),e.jsxs(d,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Total de Pedidos"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold",children:L})})]}),e.jsxs(d,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Receita Total"}),e.jsx(J,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold",children:y(k)})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(M,{placeholder:"Buscar por nome, email ou CPF...",value:i,onChange:s=>E(s.target.value),className:"pl-9 border-gray-200 bg-white/80 backdrop-blur-sm"})]}),e.jsxs(d,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg",children:[e.jsx(m,{children:e.jsx(x,{children:"Lista de Clientes"})}),e.jsx(h,{children:T?e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"h-12 w-full"}),e.jsx(C,{className:"h-12 w-full"})]}):b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(j,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhum cliente encontrado"})]}):e.jsxs(D,{children:[e.jsx(H,{children:e.jsxs(v,{children:[e.jsx(o,{children:"Cliente"}),e.jsx(o,{children:"Contato"}),e.jsx(o,{children:"Pedidos"}),e.jsx(o,{children:"Total Gasto"}),e.jsx(o,{children:"Última Compra"}),e.jsx(o,{children:"Status"})]})}),e.jsx(U,{children:b.map(s=>e.jsxs(v,{children:[e.jsx(c,{children:e.jsx("div",{className:"font-medium",children:s.name})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(K,{className:"h-3 w-3"}),s.email]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Q,{className:"h-3 w-3"}),s.phone]})]})}),e.jsx(c,{children:s.totalOrders}),e.jsx(c,{children:y(s.totalSpent)}),e.jsx(c,{children:s.lastOrderAt?W(new Date(s.lastOrderAt),"dd/MM/yyyy",{locale:X}):"-"}),e.jsx(c,{children:e.jsx(V,{variant:s.status==="ACTIVE"?"default":"secondary",children:s.status==="ACTIVE"?"Ativo":"Bloqueado"})})]},s.id))})]})})]})]})};export{ce as default};
