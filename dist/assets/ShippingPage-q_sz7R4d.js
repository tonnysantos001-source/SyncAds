import{d as T,r as n,s as o,j as e,i as I,B as c,I as m,C as N,h as F,n as z}from"./index-gnZ44lEE.js";import{L as d}from"./label-COwyjkf7.js";import{S as U,a as R,b as q,c as B,d as j}from"./select-CbC1N1a9.js";import{T as L,a as O,b,c as x,d as H,e as h}from"./table-XLyd6232.js";import{D as X,a as V,b as _,c as $,d as G}from"./dialog-BIAgWYhg.js";import{P as C}from"./plus-B4zOXpok.js";import{S as K}from"./square-pen-CGcXKn1B.js";import{T as W}from"./trash-2-jhcaW3BT.js";import"./index-DZLB06Kh.js";function ie(){const{toast:i}=T(),[g,w]=n.useState([]),[D,P]=n.useState(!0),[E,l]=n.useState(!1),[p,v]=n.useState(null),[r,t]=n.useState({name:"",description:"",type:"FIXED",basePrice:0,pricePerUnit:0,estimatedDays:5,isActive:!0,isDefault:!1});n.useEffect(()=>{u()},[]);const u=async()=>{try{const{data:{user:s}}=await o.auth.getUser();if(!s)return;const{data:a,error:y}=await o.from("ShippingMethod").select("*").eq("userId",s.id).order("createdAt",{ascending:!1});if(y)throw y;w(a||[])}catch(s){console.error("Erro ao carregar métodos:",s),i({title:"Erro",description:"Não foi possível carregar os métodos de frete",variant:"destructive"})}finally{P(!1)}},S=async()=>{try{const{data:{user:s}}=await o.auth.getUser();if(!s)return;if(p){const{error:a}=await o.from("ShippingMethod").update(r).eq("id",p.id);if(a)throw a;i({title:"Método atualizado",description:"O método de frete foi atualizado com sucesso"})}else{const{error:a}=await o.from("ShippingMethod").insert({...r,userId:s.id});if(a)throw a;i({title:"Método criado",description:"O método de frete foi criado com sucesso"})}await u(),l(!1),v(null),f()}catch(s){console.error("Erro ao salvar método:",s),i({title:"Erro",description:"Não foi possível salvar o método de frete",variant:"destructive"})}},k=async s=>{if(confirm("Tem certeza que deseja excluir este método?"))try{const{error:a}=await o.from("ShippingMethod").delete().eq("id",s);if(a)throw a;i({title:"Método excluído",description:"O método de frete foi excluído com sucesso"}),await u()}catch(a){console.error("Erro ao excluir método:",a),i({title:"Erro",description:"Não foi possível excluir o método de frete",variant:"destructive"})}},f=()=>{t({name:"",description:"",type:"FIXED",basePrice:0,pricePerUnit:0,estimatedDays:5,isActive:!0,isDefault:!1}),v(null)},A=s=>{v(s),t({name:s.name,description:s.description||"",type:s.type,basePrice:s.basePrice,pricePerUnit:s.pricePerUnit,estimatedDays:s.estimatedDays,isActive:s.isActive,isDefault:s.isDefault}),l(!0)},M=async s=>{try{const{error:a}=await o.from("ShippingMethod").update({isActive:!s.isActive}).eq("id",s.id);if(a)throw a;await u()}catch(a){console.error("Erro ao alterar status:",a),i({title:"Erro",description:"Não foi possível alterar o status do método",variant:"destructive"})}};return D?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-gray-400"})}):e.jsx("div",{children:e.jsxs("div",{className:"p-6 sm:p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white dark:text-white",children:"Frete e Entrega"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 dark:text-gray-400 mt-1",children:"Configure os métodos de entrega disponíveis no seu checkout"})]}),e.jsxs(X,{open:E,onOpenChange:l,children:[e.jsx(V,{asChild:!0,children:e.jsxs(c,{onClick:()=>{f(),l(!0)},className:"bg-pink-600 hover:bg-pink-700",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Novo método"]})}),e.jsxs(_,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx($,{children:e.jsx(G,{children:p?"Editar Método de Frete":"Novo Método de Frete"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Nome do método *"}),e.jsx(m,{placeholder:"Ex: Correios PAC",value:r.name,onChange:s=>t({...r,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Descrição"}),e.jsx(m,{placeholder:"Ex: Entrega em 5 a 7 dias úteis",value:r.description,onChange:s=>t({...r,description:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Tipo de frete *"}),e.jsxs(U,{value:r.type,onValueChange:s=>t({...r,type:s}),children:[e.jsx(R,{children:e.jsx(q,{})}),e.jsxs(B,{children:[e.jsx(j,{value:"FIXED",children:"Fixo"}),e.jsx(j,{value:"WEIGHT_BASED",children:"Por peso"}),e.jsx(j,{value:"PRICE_BASED",children:"Por valor"}),e.jsx(j,{value:"LOCAL_PICKUP",children:"Retirada local"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Preço base (R$) *"}),e.jsx(m,{type:"number",step:"0.01",value:r.basePrice,onChange:s=>t({...r,basePrice:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Prazo (dias) *"}),e.jsx(m,{type:"number",value:r.estimatedDays,onChange:s=>t({...r,estimatedDays:parseInt(s.target.value)||0})})]})]}),r.type!=="FIXED"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Preço por unidade (R$)"}),e.jsx(m,{type:"number",step:"0.01",value:r.pricePerUnit,onChange:s=>t({...r,pricePerUnit:parseFloat(s.target.value)||0})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(c,{variant:"outline",className:"flex-1",onClick:()=>{l(!1),f()},children:"Cancelar"}),e.jsx(c,{className:"flex-1 bg-pink-600 hover:bg-pink-700",onClick:S,disabled:!r.name,children:p?"Atualizar":"Criar"})]})]})]})]}),g.length===0?e.jsx(N,{children:e.jsxs(F,{className:"py-12 text-center",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 dark:text-gray-400 mb-4",children:"Você ainda não tem métodos de frete configurados."}),e.jsxs(c,{onClick:()=>l(!0),className:"bg-pink-600 hover:bg-pink-700",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Criar primeiro método"]})]})}):e.jsx(N,{children:e.jsxs(L,{children:[e.jsx(O,{children:e.jsxs(b,{children:[e.jsx(x,{children:"Nome"}),e.jsx(x,{children:"Tipo"}),e.jsx(x,{children:"Preço"}),e.jsx(x,{children:"Prazo"}),e.jsx(x,{children:"Status"}),e.jsx(x,{className:"text-right",children:"Ações"})]})}),e.jsx(H,{children:g.map(s=>e.jsxs(b,{children:[e.jsx(h,{className:"font-medium",children:s.name}),e.jsx(h,{children:s.type}),e.jsxs(h,{children:["R$ ",s.basePrice.toFixed(2)]}),e.jsxs(h,{children:[s.estimatedDays," dias"]}),e.jsx(h,{children:e.jsx(z,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativo":"Inativo"})}),e.jsx(h,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>M(s),children:s.isActive?"Desativar":"Ativar"}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>A(s),children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>k(s.id),children:e.jsx(W,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})})}export{ie as default};
