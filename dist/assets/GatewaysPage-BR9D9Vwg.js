import{c as R,s as n,r as h,f as W,u as H,j as e,g as b,h as V,i as X,l as N,t as Y,I as x,C as E,n as F,B as y,a5 as q}from"./index-BFTcrzh6.js";import{D as $,a as Z,b as J,c as Q,e as ee}from"./dialog-ChhAGTga.js";import{L as g}from"./label-CfqzfRef.js";import{S as P}from"./switch-Drva-9eG.js";import{T as te,a as ae,b as j}from"./tabs-RiLe8EWb.js";import{S as se}from"./skeleton-DmvgNpfJ.js";import{W as re}from"./wallet-DoIpjh28.js";import{C as D}from"./circle-check-BNvPw2tu.js";import"./index-DGeQ81w0.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=R("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),oe={async list(s){try{let a=n.from("Gateway").select("*").eq("isActive",!0).order("isPopular",{ascending:!1}).order("name",{ascending:!0});s!=null&&s.type&&(a=a.eq("type",s.type)),(s==null?void 0:s.isPopular)!==void 0&&(a=a.eq("isPopular",s.isPopular)),(s==null?void 0:s.supportsPix)!==void 0&&(a=a.eq("supportsPix",s.supportsPix)),(s==null?void 0:s.supportsCreditCard)!==void 0&&(a=a.eq("supportsCreditCard",s.supportsCreditCard));const{data:i,error:c}=await a;if(c)throw c;return i}catch(a){throw console.error("Error listing gateways:",a),a}},async getById(s){try{const{data:a,error:i}=await n.from("Gateway").select("*").eq("id",s).single();if(i)throw i;return a}catch(a){throw console.error("Error getting gateway:",a),a}},async getBySlug(s){try{const{data:a,error:i}=await n.from("Gateway").select("*").eq("slug",s).single();if(i)throw i;return a}catch(a){throw console.error("Error getting gateway by slug:",a),a}},async listPopular(){try{const{data:s,error:a}=await n.from("Gateway").select("*").eq("isActive",!0).eq("isPopular",!0).order("name",{ascending:!0});if(a)throw a;return s}catch(s){throw console.error("Error listing popular gateways:",s),s}}},k={async list(){try{const{data:s,error:a}=await n.from("GatewayConfig").select("*, Gateway(*)").order("isDefault",{ascending:!1}).order("createdAt",{ascending:!1});if(a)throw a;return s}catch(s){throw console.error("Error listing gateway configs:",s),s}},async getById(s){try{const{data:a,error:i}=await n.from("GatewayConfig").select("*, Gateway(*)").eq("id",s).single();if(i)throw i;return a}catch(a){throw console.error("Error getting gateway config:",a),a}},async getDefault(){try{const{data:s,error:a}=await n.from("GatewayConfig").select("*, Gateway(*)").eq("isDefault",!0).eq("isActive",!0).single();if(a)throw a;return s}catch(s){throw console.error("Error getting default gateway:",s),s}},async create(s){try{s.isDefault&&await n.from("GatewayConfig").update({isDefault:!1}).eq("organizationId",s.organizationId);const{data:a,error:i}=await n.from("GatewayConfig").insert(s).select().single();if(i)throw i;return a}catch(a){throw console.error("Error creating gateway config:",a),a}},async update(s,a){try{if(a.isDefault){const m=await n.from("GatewayConfig").select("organizationId").eq("id",s).single();m.data&&await n.from("GatewayConfig").update({isDefault:!1}).eq("organizationId",m.data.organizationId)}const{data:i,error:c}=await n.from("GatewayConfig").update({...a,updatedAt:new Date().toISOString()}).eq("id",s).select().single();if(c)throw c;return i}catch(i){throw console.error("Error updating gateway config:",i),i}},async toggleActive(s,a){try{const{data:i,error:c}=await n.from("GatewayConfig").update({isActive:a,updatedAt:new Date().toISOString()}).eq("id",s).select().single();if(c)throw c;return i}catch(i){throw console.error("Error toggling gateway:",i),i}},async setAsDefault(s){try{const a=await n.from("GatewayConfig").select("organizationId").eq("id",s).single();if(!a.data)throw new Error("Gateway config not found");await n.from("GatewayConfig").update({isDefault:!1}).eq("organizationId",a.data.organizationId);const{data:i,error:c}=await n.from("GatewayConfig").update({isDefault:!0,updatedAt:new Date().toISOString()}).eq("id",s).select().single();if(c)throw c;return i}catch(a){throw console.error("Error setting default gateway:",a),a}},async delete(s){try{const{error:a}=await n.from("GatewayConfig").delete().eq("id",s);if(a)throw a}catch(a){throw console.error("Error deleting gateway config:",a),a}},async testConnection(s){try{return{success:!0,message:"Conexão testada com sucesso"}}catch(a){throw console.error("Error testing gateway connection:",a),a}}},me=()=>{const[s,a]=h.useState([]),[i,c]=h.useState([]),[m,M]=h.useState(!0),[A,L]=h.useState(""),[d,z]=h.useState(null),[B,w]=h.useState(!1),[v,O]=h.useState("ALL"),{toast:u}=W(),p=H(t=>t.user),[r,l]=h.useState({apiKey:"",secretKey:"",publicKey:"",webhookUrl:"",pixFee:0,creditCardFee:0,boletoFee:0,isTestMode:!0,isActive:!0});h.useEffect(()=>{T()},[]);const T=async()=>{try{const t=await oe.list();if(a(t),p!=null&&p.organizationId){const o=await k.list();c(o)}}catch(t){u({title:"Erro ao carregar gateways",description:t.message,variant:"destructive"})}finally{M(!1)}},K=t=>{z(t);const o=i.find(f=>f.gatewayId===t.id);l(o?{apiKey:o.credentials.apiKey||"",secretKey:o.credentials.secretKey||"",publicKey:o.credentials.publicKey||"",webhookUrl:o.webhookUrl||"",pixFee:o.pixFee||0,creditCardFee:o.creditCardFee||0,boletoFee:o.boletoFee||0,isTestMode:o.isTestMode,isActive:o.isActive}:{apiKey:"",secretKey:"",publicKey:"",webhookUrl:"",pixFee:0,creditCardFee:0,boletoFee:0,isTestMode:!0,isActive:!0}),w(!0)},U=async()=>{try{if(!(p!=null&&p.organizationId)||!d)return;const t=i.find(f=>f.gatewayId===d.id),o={apiKey:r.apiKey,secretKey:r.secretKey,publicKey:r.publicKey};t?(await k.update(t.id,{credentials:o,webhookUrl:r.webhookUrl,pixFee:r.pixFee,creditCardFee:r.creditCardFee,boletoFee:r.boletoFee,isTestMode:r.isTestMode,isActive:r.isActive}),u({title:"Configuração atualizada!"})):(await k.create({organizationId:p.organizationId,gatewayId:d.id,credentials:o,webhookUrl:r.webhookUrl,pixFee:r.pixFee,creditCardFee:r.creditCardFee,boletoFee:r.boletoFee,isTestMode:r.isTestMode,isActive:r.isActive,isDefault:!1}),u({title:"Gateway configurado!",description:"O gateway está pronto para uso."})),w(!1),T()}catch(t){u({title:"Erro ao salvar",description:t.message,variant:"destructive"})}},_=async()=>{try{if(!d)return;u({title:"Testando conexão...",description:`Testando ${d.name}`});const{data:t,error:o}=await n.functions.invoke("test-gateway",{body:{gatewayId:d.id,credentials:{apiKey:r.apiKey,secretKey:r.secretKey,publicKey:r.publicKey},testMode:r.isTestMode}});if(o)throw new Error(o.message);t.success?u({title:"Conexão bem-sucedida!",description:t.message,variant:"default"}):u({title:"Falha na conexão",description:t.message,variant:"destructive"})}catch(t){u({title:"Erro no teste",description:t.message,variant:"destructive"})}},G=t=>i.some(o=>o.gatewayId===t&&o.isActive),C=s.filter(t=>{const o=t.name.toLowerCase().includes(A.toLowerCase()),f=v==="ALL"||t.type===v;return o&&f}),S=C.filter(t=>t.isPopular),I=C.filter(t=>!t.isPopular);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Gateways de Pagamento"}),e.jsxs("p",{className:"text-muted-foreground",children:["Configure e gerencie seus gateways de pagamento (",s.length," disponíveis)"]})]}),e.jsxs(b,{children:[e.jsx(V,{children:e.jsx(X,{className:"text-lg",children:"Gateways Configurados"})}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i.filter(t=>t.isActive).length}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["de ",s.length," gateways disponíveis"]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(x,{placeholder:"Buscar gateway...",value:A,onChange:t=>L(t.target.value),className:"pl-9"})]}),e.jsx(te,{value:v,onValueChange:t=>O(t),children:e.jsxs(ae,{children:[e.jsx(j,{value:"ALL",children:"Todos"}),e.jsx(j,{value:"PAYMENT_PROCESSOR",children:"Processadores"}),e.jsx(j,{value:"WALLET",children:"Wallets"}),e.jsx(j,{value:"BANK",children:"Bancos"})]})})]}),m?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((t,o)=>e.jsx(se,{className:"h-32"},o))}):e.jsxs(e.Fragment,{children:[S.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Gateways Populares"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(t=>e.jsx(b,{className:"hover:shadow-md transition-shadow",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"w-12 h-12 rounded bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0",children:[t.type==="PAYMENT_PROCESSOR"&&e.jsx(E,{className:"h-6 w-6 text-white"}),t.type==="WALLET"&&e.jsx(re,{className:"h-6 w-6 text-white"}),t.type==="BANK"&&e.jsx(ie,{className:"h-6 w-6 text-white"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:t.name}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[t.supportsPix&&e.jsx(F,{variant:"outline",className:"text-xs",children:"PIX"}),t.supportsCreditCard&&e.jsx(F,{variant:"outline",className:"text-xs",children:"Cartão"}),t.supportsBoleto&&e.jsx(F,{variant:"outline",className:"text-xs",children:"Boleto"})]}),G(t.id)&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-green-600",children:[e.jsx(D,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs font-medium",children:"Configurado"})]})]})]}),e.jsx(y,{size:"sm",variant:"outline",onClick:()=>K(t),children:e.jsx(q,{className:"h-4 w-4"})})]})})},t.id))})]}),I.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Outros Gateways"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:I.map(t=>e.jsx(b,{className:"hover:shadow transition-shadow",children:e.jsx(N,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-bold",children:t.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium truncate",children:t.name}),G(t.id)&&e.jsx(D,{className:"h-3 w-3 text-green-600"})]})]}),e.jsx(y,{size:"sm",variant:"ghost",onClick:()=>K(t),children:e.jsx(q,{className:"h-3 w-3"})})]})})},t.id))})]})]}),e.jsx($,{open:B,onOpenChange:w,children:e.jsxs(Z,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsxs(Q,{children:["Configurar ",d==null?void 0:d.name]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{children:"API Key *"}),e.jsx(x,{value:r.apiKey,onChange:t=>l({...r,apiKey:t.target.value}),placeholder:"sk_live_xxx"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Secret Key"}),e.jsx(x,{value:r.secretKey,onChange:t=>l({...r,secretKey:t.target.value}),placeholder:"secret_xxx"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Public Key"}),e.jsx(x,{value:r.publicKey,onChange:t=>l({...r,publicKey:t.target.value}),placeholder:"pk_live_xxx"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Webhook URL"}),e.jsx(x,{value:r.webhookUrl,onChange:t=>l({...r,webhookUrl:t.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Taxa PIX (%)"}),e.jsx(x,{type:"number",step:"0.01",value:r.pixFee,onChange:t=>l({...r,pixFee:parseFloat(t.target.value)})})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Taxa Cartão (%)"}),e.jsx(x,{type:"number",step:"0.01",value:r.creditCardFee,onChange:t=>l({...r,creditCardFee:parseFloat(t.target.value)})})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Taxa Boleto (R$)"}),e.jsx(x,{type:"number",step:"0.01",value:r.boletoFee,onChange:t=>l({...r,boletoFee:parseFloat(t.target.value)})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{checked:r.isTestMode,onCheckedChange:t=>l({...r,isTestMode:t})}),e.jsx(g,{children:"Modo de Teste"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{checked:r.isActive,onCheckedChange:t=>l({...r,isActive:t})}),e.jsx(g,{children:"Ativo"})]})]})]}),e.jsxs(ee,{children:[e.jsx(y,{variant:"outline",onClick:()=>w(!1),children:"Cancelar"}),e.jsx(y,{variant:"outline",onClick:_,children:"Testar Conexão"}),e.jsx(y,{onClick:U,children:"Salvar Configuração"})]})]})}),C.length===0&&!m&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhum gateway encontrado"})]})]})};export{me as default};
