import{s as C,r as y,f as te,u as ae,j as e,B as w,g as k,h as D,i as A,aQ as Y,l as P,k as oe,aa as ne,o as O,I as f,N as ie}from"./index-BOyCtk5k.js";import{L as j}from"./label-CMike-tD.js";import{T as ce,a as le,b as $,c as N,d as de,e as E}from"./table-CDAOLxXk.js";import{D as he,b as ue,c as xe,d as me,e as ge,f as pe}from"./dialog-CtqJTAqX.js";import{S as _,a as G,b as K,c as W,d as v}from"./select-D543OkJ4.js";import{S as M}from"./switch-D359oOiv.js";import{T as je}from"./textarea-D0OvoOK2.js";import{S as H}from"./skeleton-DxzNBJmk.js";import{P as X}from"./plus-DLcEcORE.js";import{E as ve}from"./eye-C0UiF6ni.js";import{M as Ce}from"./mouse-pointer-D64QcrlD.js";import{T as fe}from"./trending-up-DAt9P8SX.js";import{S as ye}from"./square-pen-C1_p0sg9.js";import{C as we}from"./copy-Crg3qT4b.js";import{T as Ne}from"./trash-2-CbOWc6LA.js";import{C as U}from"./circle-alert-DgqTLUiG.js";import"./index-vX3PxqRg.js";import"./index-BhpwvMXG.js";const c={async create(a){try{const{data:s,error:t}=await C.from("DiscountBanner").insert({...a,currentDisplays:0,impressions:0,clicks:0,conversions:0}).select().single();if(t)throw t;return s}catch(s){throw console.error("Error creating discount banner:",s),s}},async update(a,s){try{const{data:t,error:n}=await C.from("DiscountBanner").update({...s,updatedAt:new Date().toISOString()}).eq("id",a).select().single();if(n)throw n;return t}catch(t){throw console.error("Error updating discount banner:",t),t}},async delete(a){try{const{error:s}=await C.from("DiscountBanner").delete().eq("id",a);if(s)throw s}catch(s){throw console.error("Error deleting discount banner:",s),s}},async list(a,s){try{let t=C.from("DiscountBanner").select("*").eq("userId",a).order("priority",{ascending:!1}).order("createdAt",{ascending:!1});s!=null&&s.status&&(t=t.eq("status",s.status)),s!=null&&s.type&&(t=t.eq("type",s.type)),(s==null?void 0:s.active)!==void 0&&(s.active?t=t.eq("status","ACTIVE"):t=t.neq("status","ACTIVE"));const{data:n,error:m}=await t;if(m)throw m;return n}catch(t){throw console.error("Error listing discount banners:",t),t}},async getById(a){try{const{data:s,error:t}=await C.from("DiscountBanner").select("*").eq("id",a).single();if(t)throw t;return s}catch(s){throw console.error("Error getting discount banner:",s),s}},async getActive(a,s){try{const t=new Date().toISOString();let n=C.from("DiscountBanner").select("*").eq("userId",a).eq("status","ACTIVE").or(`validFrom.is.null,validFrom.lte.${t}`).or(`validUntil.is.null,validUntil.gte.${t}`).order("priority",{ascending:!1});s!=null&&s.type&&(n=n.eq("type",s.type)),s!=null&&s.targetAudience&&(n=n.or(`targetAudience.eq.${s.targetAudience},targetAudience.eq.ALL`));const{data:m,error:d}=await n;if(d)throw d;let p=m;return s!=null&&s.page&&(p=p.filter(l=>l.showOnPages&&l.showOnPages.length>0?l.showOnPages.includes(s.page):l.excludePages&&l.excludePages.length>0?!l.excludePages.includes(s.page):!0)),p=p.filter(l=>l.maxDisplays?l.currentDisplays<l.maxDisplays:!0),p}catch(t){throw console.error("Error getting active banners:",t),t}},async toggle(a,s){try{const t=s?"ACTIVE":"INACTIVE";return await c.update(a,{status:t})}catch(t){throw console.error("Error toggling banner:",t),t}},async updatePriority(a,s){try{return await c.update(a,{priority:s})}catch(t){throw console.error("Error updating banner priority:",t),t}},async trackImpression(a){try{const s=await c.getById(a);await c.update(a,{impressions:s.impressions+1,currentDisplays:s.currentDisplays+1})}catch(s){throw console.error("Error tracking banner impression:",s),s}},async trackClick(a){try{const s=await c.getById(a);await c.update(a,{clicks:s.clicks+1})}catch(s){throw console.error("Error tracking banner click:",s),s}},async trackConversion(a){try{const s=await c.getById(a);await c.update(a,{conversions:s.conversions+1})}catch(s){throw console.error("Error tracking banner conversion:",s),s}},async duplicate(a){try{const s=await c.getById(a),{id:t,createdAt:n,updatedAt:m,...d}=s;return await c.create({...d,name:`${s.name} (CÃ³pia)`,status:"INACTIVE",currentDisplays:0,impressions:0,clicks:0,conversions:0})}catch(s){throw console.error("Error duplicating banner:",s),s}},async resetStats(a){try{return await c.update(a,{currentDisplays:0,impressions:0,clicks:0,conversions:0})}catch(s){throw console.error("Error resetting banner stats:",s),s}},async processExpiredBanners(a){try{const s=new Date().toISOString(),{data:t,error:n}=await C.from("DiscountBanner").select("id").eq("userId",a).eq("status","ACTIVE").not("validUntil","is",null).lt("validUntil",s);if(n)throw n;const m=t,d=m.map(p=>c.update(p.id,{status:"EXPIRED"}));return await Promise.all(d),m.length}catch(s){throw console.error("Error processing expired banners:",s),s}},async processScheduledBanners(a){try{const s=new Date().toISOString(),{data:t,error:n}=await C.from("DiscountBanner").select("id").eq("userId",a).eq("status","SCHEDULED").not("validFrom","is",null).lte("validFrom",s);if(n)throw n;const m=t,d=m.map(p=>c.update(p.id,{status:"ACTIVE"}));return await Promise.all(d),m.length}catch(s){throw console.error("Error processing scheduled banners:",s),s}},async getStats(a,s){try{let t=C.from("DiscountBanner").select("*").eq("userId",a);s&&(t=t.gte("createdAt",s.from).lte("createdAt",s.to));const{data:n,error:m}=await t;if(m)throw m;const d=n,p=d.length,l=d.filter(i=>i.status==="ACTIVE").length,R=d.reduce((i,x)=>i+x.impressions,0),F=d.reduce((i,x)=>i+x.clicks,0),T=d.reduce((i,x)=>i+x.conversions,0),I=R>0?F/R*100:0,o=F>0?T/F*100:0,h=["HEADER","FOOTER","POPUP","STICKY","INLINE"],g={};return h.forEach(i=>{const x=d.filter(b=>b.type===i);if(x.length>0){const b=x.reduce((B,S)=>B+S.impressions,0),L=x.reduce((B,S)=>B+S.clicks,0);g[i]={count:x.length,impressions:b,clicks:L,ctr:b>0?L/b*100:0}}}),{totalBanners:p,activeBanners:l,totalImpressions:R,totalClicks:F,totalConversions:T,averageCTR:I,averageConversionRate:o,byType:g}}catch(t){throw console.error("Error getting banner stats:",t),t}},async getBannerPerformance(a){try{const s=await c.getById(a),t=s.impressions>0?s.clicks/s.impressions*100:0,n=s.clicks>0?s.conversions/s.clicks*100:0;return{banner:s,ctr:t,conversionRate:n}}catch(s){throw console.error("Error getting banner performance:",s),s}}},Ue=()=>{const[a,s]=y.useState([]),[t,n]=y.useState(null),[m,d]=y.useState(!0),[p,l]=y.useState(!1),[R,F]=y.useState(!1),[T,I]=y.useState(null),[o,h]=y.useState({name:"",type:"HEADER",status:"ACTIVE",priority:1,title:"",message:"",ctaText:"Saiba Mais",backgroundColor:"#EC4899",textColor:"#FFFFFF",buttonBackgroundColor:"#FFFFFF",buttonTextColor:"#EC4899",trigger:"ALWAYS",closable:!0,showCloseButton:!0}),{toast:g}=te(),i=ae(r=>r.user);y.useEffect(()=>{i!=null&&i.id&&x()},[i==null?void 0:i.id]);const x=async()=>{try{d(!0);const[r,u]=await Promise.all([c.list(i.id),c.getStats(i.id)]);s(r),n(u)}catch(r){console.error("Erro ao carregar dados:",r),g({title:"Erro ao carregar dados",description:r.message,variant:"destructive"})}finally{d(!1)}},b=async()=>{try{if(!(i!=null&&i.id))return;if(!o.name||!o.title||!o.message){g({title:"Campos obrigatÃ³rios",description:"Preencha nome, tÃ­tulo e mensagem",variant:"destructive"});return}const r={...o,userId:i.id};T?(await c.update(T.id,o),g({title:"Banner atualizado com sucesso!"})):(await c.create(r),g({title:"Banner criado com sucesso!"})),l(!1),I(null),z(),x()}catch(r){console.error("Erro ao salvar:",r),g({title:"Erro ao salvar",description:r.message,variant:"destructive"})}},L=r=>{I(r),h(r),l(!0)},B=async r=>{if(confirm("Deseja realmente excluir este banner?"))try{await c.delete(r),g({title:"Banner excluÃ­do com sucesso!"}),x()}catch(u){console.error("Erro ao excluir:",u),g({title:"Erro ao excluir",description:u.message,variant:"destructive"})}},S=async(r,u)=>{try{await c.toggle(r,u),g({title:u?"Banner ativado!":"Banner desativado!"}),x()}catch(q){console.error("Erro ao alternar status:",q),g({title:"Erro ao alternar status",description:q.message,variant:"destructive"})}},Q=async r=>{try{await c.duplicate(r),g({title:"Banner duplicado com sucesso!"}),x()}catch(u){console.error("Erro ao duplicar:",u),g({title:"Erro ao duplicar",description:u.message,variant:"destructive"})}},z=()=>{h({name:"",type:"HEADER",status:"ACTIVE",priority:1,title:"",message:"",ctaText:"Saiba Mais",backgroundColor:"#EC4899",textColor:"#FFFFFF",buttonBackgroundColor:"#FFFFFF",buttonTextColor:"#EC4899",trigger:"ALWAYS",closable:!0,showCloseButton:!0})},V=r=>`${r.toFixed(1)}%`,J=r=>({HEADER:"Topo",FOOTER:"RodapÃ©",POPUP:"Pop-up",STICKY:"Fixo",INLINE:"Inline"})[r],Z=r=>{const u={ACTIVE:{label:"Ativo",variant:"default",icon:ie},INACTIVE:{label:"Inativo",variant:"secondary",icon:U},EXPIRED:{label:"Expirado",variant:"destructive",icon:U},SCHEDULED:{label:"Agendado",variant:"secondary",icon:U}};return u[r]||u.INACTIVE},ee=({data:r})=>e.jsxs("div",{className:"relative p-4 rounded-lg",style:{backgroundColor:r.backgroundColor||"#EC4899",color:r.textColor||"#FFFFFF"},children:[r.showCloseButton&&e.jsx("button",{className:"absolute top-2 right-2 text-white/70 hover:text-white",children:"Ã—"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:r.title||"TÃ­tulo do Banner"}),e.jsx("p",{className:"text-sm mb-3",children:r.message||"Mensagem do banner"}),r.ctaText&&e.jsx("button",{className:"px-4 py-2 rounded font-medium",style:{backgroundColor:r.buttonBackgroundColor||"#FFFFFF",color:r.buttonTextColor||"#EC4899"},children:r.ctaText})]})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Faixas de Desconto"}),e.jsx("p",{className:"text-muted-foreground",children:"Crie banners promocionais para aumentar suas conversÃµes"})]}),e.jsxs(w,{onClick:()=>l(!0),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Novo Banner"]})]}),t&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(k,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Banners Ativos"}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(P,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.activeBanners}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["de ",t.totalBanners," banners"]})]})]}),e.jsxs(k,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Total ImpressÃµes"}),e.jsx(ve,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(P,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.totalImpressions.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"VisualizaÃ§Ãµes"})]})]}),e.jsxs(k,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Total Cliques"}),e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(P,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.totalClicks.toLocaleString()}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["CTR: ",V(t.averageCTR)]})]})]}),e.jsxs(k,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"ConversÃµes"}),e.jsx(fe,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(P,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.totalConversions.toLocaleString()}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Taxa: ",V(t.averageConversionRate)]})]})]})]}),e.jsxs(k,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Banners Cadastrados"}),e.jsxs(oe,{children:[a.length," banner(s) cadastrado(s)"]})]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]}),e.jsx(P,{children:m?e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"h-12 w-full"}),e.jsx(H,{className:"h-12 w-full"}),e.jsx(H,{className:"h-12 w-full"})]}):a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(Y,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhum banner cadastrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Crie seu primeiro banner promocional"}),e.jsxs(w,{onClick:()=>l(!0),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Criar Banner"]})]}):e.jsxs(ce,{children:[e.jsx(le,{children:e.jsxs($,{children:[e.jsx(N,{children:"Nome"}),e.jsx(N,{children:"Tipo"}),e.jsx(N,{children:"Status"}),e.jsx(N,{className:"text-right",children:"ImpressÃµes"}),e.jsx(N,{className:"text-right",children:"Cliques"}),e.jsx(N,{className:"text-right",children:"CTR"}),e.jsx(N,{className:"text-right",children:"ConversÃµes"}),e.jsx(N,{className:"text-right",children:"AÃ§Ãµes"})]})}),e.jsx(de,{children:a.map(r=>{const u=Z(r.status),q=u.icon,se=r.impressions>0?r.clicks/r.impressions*100:0;return e.jsxs($,{children:[e.jsx(E,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:r.title})]})}),e.jsx(E,{children:e.jsx(O,{variant:"outline",children:J(r.type)})}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(O,{variant:u.variant,className:"gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),u.label]}),e.jsx(M,{checked:r.status==="ACTIVE",onCheckedChange:re=>S(r.id,re)})]})}),e.jsx(E,{className:"text-right",children:r.impressions.toLocaleString()}),e.jsx(E,{className:"text-right",children:r.clicks.toLocaleString()}),e.jsx(E,{className:"text-right",children:e.jsx(O,{variant:"outline",children:V(se)})}),e.jsx(E,{className:"text-right",children:e.jsx("span",{className:"font-medium text-green-600",children:r.conversions.toLocaleString()})}),e.jsx(E,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>L(r),children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>Q(r.id),children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>B(r.id),children:e.jsx(Ne,{className:"h-4 w-4 text-red-600"})})]})})]},r.id)})})]})})]}),e.jsx(he,{open:p,onOpenChange:l,children:e.jsxs(ue,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(xe,{children:[e.jsx(me,{children:T?"Editar Banner":"Novo Banner Promocional"}),e.jsx(ge,{children:"Configure o visual e comportamento do banner"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"name",children:"Nome do Banner *"}),e.jsx(f,{id:"name",value:o.name,onChange:r=>h({...o,name:r.target.value}),placeholder:"Ex: Frete GrÃ¡tis Black Friday"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"type",children:"Tipo *"}),e.jsxs(_,{value:o.type,onValueChange:r=>h({...o,type:r}),children:[e.jsx(G,{children:e.jsx(K,{})}),e.jsxs(W,{children:[e.jsx(v,{value:"HEADER",children:"Topo"}),e.jsx(v,{value:"FOOTER",children:"RodapÃ©"}),e.jsx(v,{value:"POPUP",children:"Pop-up"}),e.jsx(v,{value:"STICKY",children:"Fixo"}),e.jsx(v,{value:"INLINE",children:"Inline"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"priority",children:"Prioridade"}),e.jsx(f,{id:"priority",type:"number",value:o.priority,onChange:r=>h({...o,priority:parseInt(r.target.value)})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"title",children:"TÃ­tulo *"}),e.jsx(f,{id:"title",value:o.title,onChange:r=>h({...o,title:r.target.value}),placeholder:"ðŸŽ‰ FRETE GRÃTIS ACIMA DE R$ 99"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"message",children:"Mensagem *"}),e.jsx(je,{id:"message",value:o.message,onChange:r=>h({...o,message:r.target.value}),placeholder:"Aproveite agora e ganhe frete grÃ¡tis!",rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"ctaText",children:"Texto do BotÃ£o"}),e.jsx(f,{id:"ctaText",value:o.ctaText||"",onChange:r=>h({...o,ctaText:r.target.value}),placeholder:"Saiba Mais"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"ctaLink",children:"Link do BotÃ£o"}),e.jsx(f,{id:"ctaLink",value:o.ctaLink||"",onChange:r=>h({...o,ctaLink:r.target.value}),placeholder:"https://..."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"backgroundColor",children:"Cor de Fundo"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{id:"backgroundColor",type:"color",value:o.backgroundColor,onChange:r=>h({...o,backgroundColor:r.target.value}),className:"w-16 h-10 p-1"}),e.jsx(f,{value:o.backgroundColor,onChange:r=>h({...o,backgroundColor:r.target.value}),placeholder:"#EC4899"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"textColor",children:"Cor do Texto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{id:"textColor",type:"color",value:o.textColor,onChange:r=>h({...o,textColor:r.target.value}),className:"w-16 h-10 p-1"}),e.jsx(f,{value:o.textColor,onChange:r=>h({...o,textColor:r.target.value}),placeholder:"#FFFFFF"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"trigger",children:"Quando Exibir"}),e.jsxs(_,{value:o.trigger,onValueChange:r=>h({...o,trigger:r}),children:[e.jsx(G,{children:e.jsx(K,{})}),e.jsxs(W,{children:[e.jsx(v,{value:"ALWAYS",children:"Sempre"}),e.jsx(v,{value:"FIRST_VISIT",children:"Primeira Visita"}),e.jsx(v,{value:"EXIT_INTENT",children:"IntenÃ§Ã£o de SaÃ­da"}),e.jsx(v,{value:"TIME_DELAY",children:"Tempo de Delay"}),e.jsx(v,{value:"SCROLL_PERCENTAGE",children:"Rolagem"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{id:"closable",checked:o.closable,onCheckedChange:r=>h({...o,closable:r})}),e.jsx(j,{htmlFor:"closable",className:"cursor-pointer",children:"Permitir fechar"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{id:"showCloseButton",checked:o.showCloseButton,onCheckedChange:r=>h({...o,showCloseButton:r})}),e.jsx(j,{htmlFor:"showCloseButton",className:"cursor-pointer",children:"Mostrar botÃ£o de fechar"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Preview"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"VisualizaÃ§Ã£o em tempo real"})]}),e.jsx(ee,{data:o})]})]}),e.jsxs(pe,{children:[e.jsx(w,{variant:"outline",onClick:()=>{l(!1),I(null),z()},children:"Cancelar"}),e.jsx(w,{onClick:b,children:"Salvar"})]})]})})]})};export{Ue as default};
