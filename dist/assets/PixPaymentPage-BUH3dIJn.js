import{n as H,e as J,f as U,r as t,j as e,ad as j,g as d,l as i,B as N,T,O as m,d as z,s as R}from"./index-CkeR9g7w.js";import{b as K,Q as q,S as W}from"./browser-B0UAqqQW.js";import{C as Q}from"./circle-alert-TmrAZG4u.js";import{A as F}from"./arrow-left-qqAadhkQ.js";import{C as Y}from"./clock-CdKCH_xW.js";import{C as X}from"./copy-CQHUL3Iq.js";const te=()=>{const{orderId:x,transactionId:l}=H(),g=J(),{toast:k}=U(),[a,w]=t.useState(null),[C,L]=t.useState(""),[v,P]=t.useState(!1),[h,I]=t.useState(0),[$,S]=t.useState(!1),[y,B]=t.useState(!1),[V,E]=t.useState(!0),[f,A]=t.useState(!0);t.useEffect(()=>{(async()=>{var o,s,b,u;try{const p=localStorage.getItem(`pix-${x}`);if(p){const n=JSON.parse(p);w(n),E(!1);return}if(l){const{data:n,error:O}=await R.from("Transaction").select("*").eq("id",l).single();if(!O&&n){const G={qrCode:((s=(o=n.metadata)==null?void 0:o.pixData)==null?void 0:s.qrCode)||"",amount:n.amount,expiresAt:(u=(b=n.metadata)==null?void 0:b.pixData)==null?void 0:u.expiresAt,transactionId:n.id};w(G)}}}catch(p){console.error("Erro ao carregar dados do PIX:",p),k({title:"Erro ao carregar dados",description:"Tente gerar o pagamento novamente",variant:"destructive"})}finally{E(!1)}})()},[x,l]),t.useEffect(()=>{a!=null&&a.qrCode&&K.toDataURL(a.qrCode,{width:400,margin:1,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"H"}).then(r=>{L(r)}).catch(r=>{console.error("Erro ao gerar QR Code:",r)})},[a]),t.useEffect(()=>{if(!(a!=null&&a.expiresAt))return;const r=()=>{const s=new Date().getTime(),u=new Date(a.expiresAt).getTime()-s;if(u<=0){I(0);return}I(Math.floor(u/1e3))};r();const o=setInterval(r,1e3);return()=>clearInterval(o)},[a==null?void 0:a.expiresAt]),t.useEffect(()=>{if(!l||y)return;const r=async()=>{S(!0);try{const{data:s,error:b}=await R.from("Transaction").select("status").eq("id",l).single();!b&&s&&(s.status==="PAID"||s.status==="approved")&&(B(!0),setTimeout(()=>{g(`/checkout/success/${l}`)},2e3))}catch(s){console.error("Erro ao verificar pagamento:",s)}finally{S(!1)}};r();const o=setInterval(r,5e3);return()=>clearInterval(o)},[l,y,g]);const D=r=>{const o=Math.floor(r/60),s=r%60;return`${o.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},M=async()=>{if(a!=null&&a.qrCode)try{await navigator.clipboard.writeText(a.qrCode),P(!0),k({title:"C√≥digo copiado!",description:"Cole no seu app de pagamento"}),setTimeout(()=>P(!1),3e3)}catch(r){console.error("Erro ao copiar c√≥digo:",r)}},c=h<=0&&(a==null?void 0:a.expiresAt);return V?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(j,{className:"h-12 w-12 text-green-600 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Carregando dados do pagamento..."})]})}):a?y?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4",children:e.jsx(d,{className:"max-w-md w-full",children:e.jsxs(i,{className:"p-8 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-green-500 mb-6 animate-bounce",children:e.jsx(T,{className:"h-12 w-12 text-white"})}),e.jsx("h2",{className:"text-3xl font-bold text-green-600 mb-2",children:"Pagamento Confirmado! üéâ"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-2",children:"Seu pagamento via PIX foi aprovado com sucesso."}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Redirecionando..."})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 py-8 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(N,{variant:"ghost",onClick:()=>g(`/checkout/${x}`),className:"mb-4",children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),"Voltar"]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-green-400 to-green-600 shadow-lg mb-4",children:e.jsx(q,{className:"h-10 w-10 text-white"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"Pagamento via PIX"}),e.jsxs("p",{className:"text-xl md:text-2xl font-bold text-green-600",children:["R$ ",a.amount.toFixed(2)]})]})]}),a.expiresAt&&e.jsx(d,{className:m("mb-6 border-2",c?"bg-red-50 border-red-300 dark:bg-red-950/30 dark:border-red-800":h<60?"bg-yellow-50 border-yellow-300 dark:bg-yellow-950/30 dark:border-yellow-800 animate-pulse":"bg-blue-50 border-blue-300 dark:bg-blue-950/30 dark:border-blue-800"),children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(Y,{className:m("h-7 w-7",c?"text-red-600":h<60?"text-yellow-600":"text-blue-600")}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:m("text-3xl font-bold font-mono",c?"text-red-700":h<60?"text-yellow-700":"text-blue-700"),children:c?"Expirado":D(h)}),!c&&e.jsx("p",{className:"text-sm text-gray-600",children:"Tempo restante para pagamento"})]})]})})}),$&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-6 p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx(j,{className:"h-5 w-5 text-blue-600 animate-spin"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300 font-medium",children:"Verificando pagamento..."})]}),e.jsxs("div",{className:"flex gap-2 p-1 bg-white dark:bg-gray-800 rounded-xl mb-6 shadow-sm",children:[e.jsxs("button",{onClick:()=>A(!0),className:m("flex-1 py-4 px-6 rounded-lg font-semibold text-base transition-all",f?"bg-green-500 text-white shadow-md":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300"),children:[e.jsx(q,{className:"h-5 w-5 inline mr-2"}),"QR Code"]}),e.jsxs("button",{onClick:()=>A(!1),className:m("flex-1 py-4 px-6 rounded-lg font-semibold text-base transition-all",f?"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300":"bg-green-500 text-white shadow-md"),children:[e.jsx(X,{className:"h-5 w-5 inline mr-2"}),"Copia e Cola"]})]}),f&&e.jsx(d,{className:"mb-6 shadow-xl",children:e.jsx(i,{className:"p-8 md:p-12",children:e.jsxs("div",{className:"text-center space-y-6",children:[C?e.jsx("div",{className:"inline-block p-6 bg-white rounded-3xl shadow-2xl",children:e.jsx("img",{src:C,alt:"QR Code PIX",className:"w-72 h-72 md:w-96 md:h-96 mx-auto"})}):e.jsx("div",{className:"w-72 h-72 md:w-96 md:h-96 mx-auto bg-gray-100 dark:bg-gray-800 rounded-3xl flex items-center justify-center",children:e.jsx(j,{className:"h-16 w-16 text-gray-400 animate-spin"})}),e.jsx("p",{className:"text-lg font-medium text-gray-700 dark:text-gray-300",children:"Abra o app do seu banco e escaneie o QR Code"})]})})}),!f&&e.jsx(d,{className:"mb-6 shadow-xl",children:e.jsxs(i,{className:"p-8 md:p-12 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-base font-semibold block mb-4 text-gray-700 dark:text-gray-300",children:"C√≥digo PIX Copia e Cola:"}),e.jsx("div",{className:"p-5 bg-gray-50 dark:bg-gray-900 rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-700 overflow-hidden",children:e.jsx("code",{className:"text-sm font-mono break-all block text-gray-800 dark:text-gray-200",children:a.qrCode})})]}),e.jsx(N,{onClick:M,className:m("w-full h-14 text-lg font-bold shadow-lg hover:shadow-xl transition-all",v?"bg-green-600":"bg-green-500"),children:v?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-6 w-6 mr-2"}),"C√≥digo Copiado!"]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-6 w-6 mr-2"}),"Copiar C√≥digo PIX"]})})]})}),e.jsx(d,{className:"mb-6 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20 border-2 border-blue-200 dark:border-blue-800",children:e.jsx(i,{className:"p-6 md:p-8",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(W,{className:"h-8 w-8 text-blue-600 flex-shrink-0 mt-1"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Como pagar:"}),e.jsxs("ol",{className:"space-y-3 text-base text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 flex items-center justify-center w-7 h-7 rounded-full bg-blue-600 text-white text-sm font-bold",children:"1"}),e.jsx("span",{className:"pt-0.5",children:"Abra o app do seu banco ou carteira digital"})]}),e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 flex items-center justify-center w-7 h-7 rounded-full bg-blue-600 text-white text-sm font-bold",children:"2"}),e.jsxs("span",{className:"pt-0.5",children:["Escolha ",e.jsx("strong",{children:"Pix Copia e Cola"})," ou"," ",e.jsx("strong",{children:"Ler QR Code"})]})]}),e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 flex items-center justify-center w-7 h-7 rounded-full bg-blue-600 text-white text-sm font-bold",children:"3"}),e.jsx("span",{className:"pt-0.5",children:"Cole o c√≥digo ou escaneie o QR Code acima"})]}),e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 flex items-center justify-center w-7 h-7 rounded-full bg-blue-600 text-white text-sm font-bold",children:"4"}),e.jsx("span",{className:"pt-0.5",children:"Confirme o pagamento e pronto! ‚úÖ Aprova√ß√£o autom√°tica"})]})]})]})]})})}),e.jsxs("div",{className:"flex items-center gap-3 p-5 bg-green-50 dark:bg-green-950/20 rounded-xl border border-green-200 dark:border-green-800 mb-6",children:[e.jsx(T,{className:"h-6 w-6 text-green-600 flex-shrink-0"}),e.jsx("p",{className:"text-sm md:text-base text-green-700 dark:text-green-300 font-medium",children:"Pagamento 100% seguro e aprova√ß√£o instant√¢nea"})]}),c&&e.jsx(d,{className:"bg-red-50 dark:bg-red-950/20 border-2 border-red-200 dark:border-red-800",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Q,{className:"h-6 w-6 text-red-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-700 dark:text-red-300 font-bold mb-2",children:"C√≥digo PIX Expirado"}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mb-4",children:"Este c√≥digo expirou. Clique no bot√£o abaixo para gerar um novo c√≥digo PIX."}),e.jsxs(N,{onClick:()=>g(`/checkout/${x}`),variant:"outline",className:"border-red-600 text-red-600 hover:bg-red-50",children:[e.jsx(j,{className:"h-5 w-5 mr-2"}),"Gerar Novo C√≥digo"]})]})]})})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4",children:e.jsx(d,{className:"max-w-md w-full",children:e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(Q,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Dados n√£o encontrados"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"N√£o conseguimos encontrar os dados do seu pagamento PIX."}),e.jsxs(N,{onClick:()=>g(`/checkout/${x}`),className:"w-full",children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),"Voltar ao Checkout"]})]})})})};export{te as default};
