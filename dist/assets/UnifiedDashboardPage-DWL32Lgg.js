import{D as H,g as m,J as x,j as e,H as Y,C as l,q as i,l as g,o as u,K as F}from"./index-DzM7EAHs.js";import{D as K}from"./dollar-sign-BjM_qRVX.js";import{S as X}from"./shopping-cart-DQccAdLz.js";import{T as G}from"./trending-up-CEVfWxvs.js";import{C as J}from"./credit-card-BngQH7Gm.js";import{A as W}from"./activity-Akc24yqR.js";import{A as Q}from"./arrow-up-right-D58MlZr2.js";import{A as Z}from"./arrow-down-right-Bi-wmJL3.js";import{R as _,C as ee,X as te,Y as se,T as ae}from"./generateCategoricalChart-B2x2jUPb.js";import{A as re,a as ne}from"./AreaChart-BFpG4_vv.js";import{E as C}from"./eye-C9diYqD4.js";import{C as oe}from"./circle-check-DjId5sPA.js";import{C as ce}from"./circle-x-OYFkTT9Q.js";import{P as le}from"./package-DXXv9JqP.js";import{T as ie}from"./trending-down-sAXD_Xim.js";import{U as de}from"./users-Drd7EuTx.js";const ke=()=>{const c=H(t=>t.user),[A,v]=m.useState(!0),[D,k]=m.useState([]),[p,b]=m.useState([]),[w,R]=m.useState([]),[f,S]=m.useState("week"),[r,d]=m.useState({totalRevenue:0,revenueChange:0,totalOrders:0,ordersChange:0,conversionRate:0,conversionChange:0,averageOrderValue:0,aovChange:0,onlineNow:0,checkoutViews:0,checkoutAbandonment:0,topProducts:[]});m.useEffect(()=>{if(c!=null&&c.id){O();const t=setInterval(()=>{y()},3e4);return()=>clearInterval(t)}},[c==null?void 0:c.id,f]);const O=async()=>{try{v(!0),await Promise.all([T(),M(),P(),E(),I(),U(),y()])}catch(t){console.error("Erro ao carregar dashboard:",t)}finally{v(!1)}},T=async()=>{try{const{data:t}=await x.from("Order").select("total, createdAt").eq("userId",c.id).eq("status","paid").gte("createdAt",j()).order("createdAt",{ascending:!1});if(t&&t.length>0){const s=t.reduce((n,o)=>n+(o.total||0),0),a=V(t);d(n=>({...n,totalRevenue:s,revenueChange:a}))}}catch(t){console.error("Erro ao carregar receita:",t)}},M=async()=>{try{const{data:t}=await x.from("Order").select("id, createdAt, total").eq("userId",c.id).gte("createdAt",j()).order("createdAt",{ascending:!1});if(t){const s=t.length,a=q(t),n=t.reduce((N,$)=>N+($.total||0),0),o=s>0?n/s:0;d(N=>({...N,totalOrders:s,ordersChange:a,averageOrderValue:o,aovChange:5.2}))}}catch(t){console.error("Erro ao carregar pedidos:",t)}},P=async()=>{try{d(a=>({...a,conversionRate:3.2,conversionChange:.8,checkoutViews:1247,checkoutAbandonment:68.5}))}catch(t){console.error("Erro ao carregar conversão:",t)}},E=async()=>{try{const{data:t}=await x.from("Order").select("total, createdAt").eq("userId",c.id).eq("status","paid").gte("createdAt",j()).order("createdAt",{ascending:!0});if(t){const s=L(t);k(s)}}catch(t){console.error("Erro ao carregar gráfico:",t)}},I=async()=>{try{const{data:t}=await x.from("Order").select("id, customerName, total, status, createdAt, paymentMethod").eq("userId",c.id).order("createdAt",{ascending:!1}).limit(5);if(t){const s=t.map(a=>({id:a.id,customer:a.customerName||"Cliente",amount:a.total||0,status:a.status==="paid"?"approved":a.status==="pending"?"pending":"failed",time:z(a.createdAt),paymentMethod:a.paymentMethod||"Cartão"}));R(s)}}catch(t){console.error("Erro ao carregar transações:",t)}},U=async()=>{try{const t=[{name:"Produto A",sales:45,revenue:4500},{name:"Produto B",sales:32,revenue:3200},{name:"Produto C",sales:28,revenue:2800},{name:"Produto D",sales:21,revenue:2100}];d(s=>({...s,topProducts:t}))}catch(t){console.error("Erro ao carregar produtos:",t)}},y=async()=>{try{const t=new Date;t.setMinutes(t.getMinutes()-5);const{count:s,error:a}=await x.from("User").select("*",{count:"exact",head:!0}).gte("lastSeen",t.toISOString());if(a){console.error("Erro ao contar usuários ativos:",a);const{count:n}=await x.from("User").select("*",{count:"exact",head:!0});d(o=>({...o,onlineNow:n||0}))}else d(n=>({...n,onlineNow:s||0}));b([])}catch(t){console.error("Erro ao carregar dados em tempo real:",t),d(s=>({...s,onlineNow:0})),b([])}},j=()=>{const t=new Date;switch(f){case"today":return new Date(t.setHours(0,0,0,0)).toISOString();case"week":return new Date(t.setDate(t.getDate()-7)).toISOString();case"month":return new Date(t.setMonth(t.getMonth()-1)).toISOString();case"year":return new Date(t.setFullYear(t.getFullYear()-1)).toISOString();default:return new Date(t.setDate(t.getDate()-7)).toISOString()}},V=t=>12.5,q=t=>8.3,L=t=>{const s={};return t.forEach(a=>{const n=new Date(a.createdAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"});s[n]=(s[n]||0)+(a.total||0)}),Object.entries(s).map(([a,n])=>({date:a,revenue:n,orders:0}))},z=t=>{const s=new Date(t),n=new Date().getTime()-s.getTime(),o=Math.floor(n/6e4);return o<1?"Agora":o<60?`${o}m atrás`:o<1440?`${Math.floor(o/60)}h atrás`:s.toLocaleDateString("pt-BR")},h=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),B=[{title:"Receita Total",value:h(r.totalRevenue),change:r.revenueChange,trend:r.revenueChange>=0?"up":"down",icon:e.jsx(K,{className:"h-5 w-5"})},{title:"Pedidos",value:r.totalOrders,change:r.ordersChange,trend:r.ordersChange>=0?"up":"down",icon:e.jsx(X,{className:"h-5 w-5"})},{title:"Taxa de Conversão",value:r.conversionRate,change:r.conversionChange,trend:r.conversionChange>=0?"up":"down",icon:e.jsx(G,{className:"h-5 w-5"}),suffix:"%"},{title:"Ticket Médio",value:h(r.averageOrderValue),change:r.aovChange,trend:r.aovChange>=0?"up":"down",icon:e.jsx(J,{className:"h-5 w-5"})}];return A?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(Y,{className:"h-8 w-8 animate-spin text-pink-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Visão geral das suas métricas de vendas"})]}),e.jsx("div",{className:"flex gap-2",children:["today","week","month","year"].map(t=>e.jsxs("button",{onClick:()=>S(t),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${f===t?"bg-pink-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:[t==="today"&&"Hoje",t==="week"&&"7 dias",t==="month"&&"30 dias",t==="year"&&"1 ano"]},t))})]}),e.jsx(l,{className:"bg-gradient-to-br from-pink-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(W,{className:"h-8 w-8 animate-pulse"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm font-medium",children:"Usuários Online Agora"}),e.jsx("p",{className:"text-4xl font-bold mt-1",children:r.onlineNow}),e.jsxs("p",{className:"text-white/80 text-xs mt-1",children:[p.filter(t=>t.page.includes("Checkout")).length," ","no checkout"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium",children:"Ao Vivo"})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:B.map((t,s)=>e.jsx(l,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"h-12 w-12 bg-pink-100 rounded-lg flex items-center justify-center text-pink-600",children:t.icon}),e.jsxs("div",{className:`flex items-center gap-1 text-sm font-medium ${t.trend==="up"?"text-green-600":"text-red-600"}`,children:[t.trend==="up"?e.jsx(Q,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"}),Math.abs(t.change),"%"]})]}),e.jsx("p",{className:"text-gray-600 text-sm font-medium mb-1",children:t.title}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[t.prefix,t.value,t.suffix]})]})},s))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(l,{className:"lg:col-span-2",children:[e.jsx(g,{children:e.jsx(u,{className:"text-lg font-semibold",children:"Receita ao Longo do Tempo"})}),e.jsx(i,{children:e.jsx(_,{width:"100%",height:300,children:e.jsxs(re,{data:D,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ec4899",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#ec4899",stopOpacity:0})]})}),e.jsx(ee,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(te,{dataKey:"date",tick:{fill:"#666",fontSize:12}}),e.jsx(se,{tick:{fill:"#666",fontSize:12}}),e.jsx(ae,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),e.jsx(ne,{type:"monotone",dataKey:"revenue",stroke:"#ec4899",strokeWidth:2,fillOpacity:1,fill:"url(#colorRevenue)"})]})})})]}),e.jsxs(l,{children:[e.jsx(g,{children:e.jsxs(u,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5 text-pink-600"}),"Atividade em Tempo Real"]})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[p.map(t=>e.jsxs("div",{className:"flex items-start gap-3 pb-4 border-b last:border-0 last:pb-0",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full mt-2 animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.page}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[t.timeOnPage,"s na página"]}),e.jsx("span",{className:"text-xs text-gray-400",children:"•"}),e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:t.device})]})]})]},t.id)),p.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Nenhum usuário online no momento"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(g,{children:e.jsx(u,{className:"text-lg font-semibold",children:"Transações Recentes"})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[w.map(t=>e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b last:border-0 last:pb-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ${t.status==="approved"?"bg-green-100":t.status==="pending"?"bg-yellow-100":"bg-red-100"}`,children:[t.status==="approved"&&e.jsx(oe,{className:"h-5 w-5 text-green-600"}),t.status==="pending"&&e.jsx(F,{className:"h-5 w-5 text-yellow-600"}),t.status==="failed"&&e.jsx(ce,{className:"h-5 w-5 text-red-600"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.customer}),e.jsx("p",{className:"text-xs text-gray-500",children:t.time})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold text-gray-900",children:h(t.amount)}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:t.paymentMethod})]})]},t.id)),w.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Nenhuma transação recente"})]})})]}),e.jsxs(l,{children:[e.jsx(g,{children:e.jsxs(u,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-pink-600"}),"Produtos Mais Vendidos"]})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[r.topProducts.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"h-8 w-8 bg-gradient-to-br from-pink-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-sm",children:s+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.sales," vendas"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-sm font-bold text-gray-900",children:h(t.revenue)})})]},s)),r.topProducts.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Nenhum produto vendido ainda"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(l,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(C,{className:"h-5 w-5 text-blue-600"}),e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Visualizações do Checkout"})]}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:r.checkoutViews}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Últimos 7 dias"})]})}),e.jsx(l,{className:"bg-gradient-to-br from-amber-50 to-amber-100 border-amber-200",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ie,{className:"h-5 w-5 text-amber-600"}),e.jsx("p",{className:"text-sm font-medium text-amber-900",children:"Taxa de Abandono"})]}),e.jsxs("p",{className:"text-3xl font-bold text-amber-900",children:[r.checkoutAbandonment,"%"]}),e.jsx("p",{className:"text-xs text-amber-700 mt-1",children:"Oportunidade de melhoria"})]})}),e.jsx(l,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(de,{className:"h-5 w-5 text-green-600"}),e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Novos Clientes"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:Math.floor(r.totalOrders*.65)}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"65% dos pedidos"})]})})]})]})};export{ke as default};
