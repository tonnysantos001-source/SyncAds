import{r as i,f as R,u as P,j as e,B as F,aa as M,g as d,h as m,i as x,U as p,l as h,M as O,I as V,o as k}from"./index-BOyCtk5k.js";import{T as D,a as H,b as v,c,d as U,e as o}from"./table-CDAOLxXk.js";import{c as q}from"./customersApi-PiyiLpcU.js";import{a as G}from"./shopifySync-DhpS1VDJ.js";import{S}from"./skeleton-DxzNBJmk.js";import{S as $}from"./shopping-bag-Dhq_0j7l.js";import{D as J}from"./dollar-sign-CFIpZffW.js";import{M as K}from"./mail--lywG2_t.js";import{P as Q}from"./phone-CSo_JwJ5.js";import{f as W,p as X}from"./pt-BR-BQ5kKd2v.js";import"./constructFrom-rJN6zrQ_.js";const ce=()=>{const[a,b]=i.useState([]),[y,f]=i.useState([]),[T,j]=i.useState(!0),[u,g]=i.useState(!1),[l,E]=i.useState(""),{toast:n}=R(),t=P(s=>s.user);i.useEffect(()=>{t!=null&&t.id&&N()},[t==null?void 0:t.id]),i.useEffect(()=>{B()},[l,a]);const N=async()=>{if(!(t!=null&&t.id)){j(!1);return}try{j(!0);const s=await q.listFromShopify(t.id);b(s),f(s)}catch(s){console.error("Erro ao carregar clientes:",s),n({title:"Erro ao carregar clientes",description:s.message,variant:"destructive"})}finally{j(!1)}},A=async()=>{if(!(t!=null&&t.id)){n({title:"Erro",description:"Faça login para sincronizar",variant:"destructive"});return}try{g(!0),n({title:"Sincronizando...",description:"Buscando clientes da Shopify"});const s=await G.syncCustomers(t.id);s.success?(n({title:"Sincronização concluída!",description:s.message}),await N()):n({title:"Erro na sincronização",description:s.message,variant:"destructive"})}catch{n({title:"Erro ao sincronizar",description:"Configure a integração Shopify em Integrações",variant:"destructive"})}finally{g(!1)}},B=()=>{if(!l){f(a);return}const s=a.filter(r=>{var w;return r.name.toLowerCase().includes(l.toLowerCase())||r.email.toLowerCase().includes(l.toLowerCase())||((w=r.cpf)==null?void 0:w.toLowerCase().includes(l.toLowerCase()))});f(s)},C=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),L=a.reduce((s,r)=>s+r.totalSpent,0),z=a.reduce((s,r)=>s+r.totalOrders,0),I=a.filter(s=>s.status==="ACTIVE").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Clientes"}),e.jsx("p",{className:"text-muted-foreground",children:"Visualize e gerencie todos os clientes da sua loja"})]}),e.jsxs(F,{onClick:A,disabled:u,children:[e.jsx(M,{className:`mr-2 h-4 w-4 ${u?"animate-spin":""}`}),u?"Sincronizando...":"Sincronizar Shopify"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Total de Clientes"}),e.jsx(p,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold",children:a.length})})]}),e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Clientes Ativos"}),e.jsx(p,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold",children:I})})]}),e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Total de Pedidos"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold",children:z})})]}),e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Receita Total"}),e.jsx(J,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold",children:C(L)})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(V,{placeholder:"Buscar por nome, email ou CPF...",value:l,onChange:s=>E(s.target.value),className:"pl-9"})]}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(x,{children:"Lista de Clientes"})}),e.jsx(h,{children:T?e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"h-12 w-full"}),e.jsx(S,{className:"h-12 w-full"})]}):y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(p,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhum cliente encontrado"})]}):e.jsxs(D,{children:[e.jsx(H,{children:e.jsxs(v,{children:[e.jsx(c,{children:"Cliente"}),e.jsx(c,{children:"Contato"}),e.jsx(c,{children:"Pedidos"}),e.jsx(c,{children:"Total Gasto"}),e.jsx(c,{children:"Última Compra"}),e.jsx(c,{children:"Status"})]})}),e.jsx(U,{children:y.map(s=>e.jsxs(v,{children:[e.jsx(o,{children:e.jsx("div",{className:"font-medium",children:s.name})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(K,{className:"h-3 w-3"}),s.email]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Q,{className:"h-3 w-3"}),s.phone]})]})}),e.jsx(o,{children:s.totalOrders}),e.jsx(o,{children:C(s.totalSpent)}),e.jsx(o,{children:s.lastOrderAt?W(new Date(s.lastOrderAt),"dd/MM/yyyy",{locale:X}):"-"}),e.jsx(o,{children:e.jsx(k,{variant:s.status==="ACTIVE"?"default":"secondary",children:s.status==="ACTIVE"?"Ativo":"Bloqueado"})})]},s.id))})]})})]})]})};export{ce as default};
