import{c as oe,n as de,a as me,b as xe,u as ge,r as l,s as x,j as e,k as E,d as f,e as J,f as K,h as v,I as Q,m as A,B as q,o as G}from"./index-CiR4higu.js";import{L as V}from"./label-Bi7RV2fS.js";import{S as y}from"./switch-DVheKBm5.js";import{a as he}from"./gatewaysList-BfxCdpsq.js";import{S as Y,a as Z,b as ee,c as ae,d as F}from"./select-CyJiExqF.js";import{A as ue}from"./arrow-left-CVwM8C3E.js";import{E as pe}from"./external-link-DOzeFUGY.js";import"./index-DeWcy2vT.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=oe("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Se=()=>{const{slug:j}=de(),b=me(),{toast:m}=xe(),c=ge(a=>a.user),[t,se]=l.useState(null),[te,M]=l.useState(!0),[w,P]=l.useState(!1),[g,D]=l.useState(!1),[re,N]=l.useState(!1),[ie,L]=l.useState("production"),[B,T]=l.useState(null),[_,ne]=l.useState(null),[$,H]=l.useState(!1),[d,O]=l.useState({}),[C,z]=l.useState(!1),[k,R]=l.useState(!1),[S,U]=l.useState(!1);l.useEffect(()=>{j&&W()},[j]);const W=async()=>{var a;try{M(!0);const s=he(j);if(!s){m({title:"Gateway não encontrado",description:"O gateway solicitado não existe.",variant:"destructive"}),b("/checkout/gateways");return}if(se(s),c!=null&&c.id){const{data:i}=await x.from("Gateway").select("id").eq("slug",s.slug).single();if(i!=null&&i.id){const{data:o,error:u}=await x.from("GatewayConfig").select("*").eq("userId",c.id).eq("gatewayId",i.id).single();if(!u&&o&&(D(o.isActive||!1),N(o.isVerified??!1),L(o.environment??"production"),T(o.verifiedAt??null),ne(o.id),O(o.credentials||{}),(a=o.credentials)!=null&&a.enabledPaymentMethods)){const r=o.credentials.enabledPaymentMethods;z(r.includes("credit_card")),R(r.includes("pix")),U(r.includes("boleto"))}}}}catch(s){console.error("Error loading gateway:",s)}finally{M(!1)}},le=async()=>{if(!(!t||!(c!=null&&c.id)))try{let a=null;P(!0);const s=t.configFields.filter(r=>r.required&&!d[r.name]).map(r=>r.label);if(s.length>0){m({title:"Campos obrigatórios",description:`Preencha os campos: ${s.join(", ")}`,variant:"destructive"});return}const{data:i,error:o}=await x.from("Gateway").select("id, slug, name").eq("slug",t.slug).single();if(o||!(i!=null&&i.id))throw o||new Error("Gateway não encontrado no banco");const{data:u}=await x.from("GatewayConfig").select("id").eq("userId",c.id).eq("gatewayId",i.id).single();if(u){const r=[];C&&r.push("credit_card"),k&&r.push("pix"),S&&r.push("boleto");const n={...d,enabledPaymentMethods:r},{error:h}=await x.from("GatewayConfig").update({credentials:n,isActive:g,updatedAt:new Date().toISOString()}).eq("id",u.id);h||(a=u.id)}else{const{data:r}=await x.from("GatewayConfig").select("id").eq("userId",c.id).limit(1),n=[];C&&n.push("credit_card"),k&&n.push("pix"),S&&n.push("boleto");const h={...d,enabledPaymentMethods:n},{data:I,error:X}=await x.from("GatewayConfig").insert({userId:c.id,gatewayId:i.id,credentials:h,isActive:g,isDefault:!r||r.length===0}).select("id").single();if(X)throw X;a=(I==null?void 0:I.id)||null}m({title:"Configuração salva!",description:`Gateway ${t.name} foi configurado com sucesso.`});try{const r=a?{configId:a,credentials:d,persistCredentials:!1}:{slug:t.slug,credentials:d,persistCredentials:!1},{data:n,error:h}=await x.functions.invoke("gateway-config-verify",{body:r});if(h)throw h;n!=null&&n.success?m({title:"Credenciais verificadas",description:n.message||"Gateway verificado com sucesso."}):m({title:"Falha na verificação",description:(n==null?void 0:n.message)||"Confira suas credenciais e tente novamente.",variant:"destructive"})}catch(r){m({title:"Erro ao verificar",description:(r==null?void 0:r.message)||"Não foi possível verificar as credenciais.",variant:"destructive"})}await W()}catch(a){console.error("Error saving gateway config:",a),m({title:"Erro ao salvar",description:"Não foi possível salvar a configuração.",variant:"destructive"})}finally{P(!1)}},ce=async()=>{if(!(!t||!(c!=null&&c.id)))try{H(!0);const a={};_?(a.configId=_,a.credentials=d,a.persistCredentials=!1):(a.slug=t.slug,a.credentials=d,a.persistCredentials=!1);const{data:s,error:i}=await x.functions.invoke("gateway-config-verify",{body:a});if(i)throw i;s!=null&&s.success?(N(!0),T(s.verifiedAt||new Date().toISOString()),L("production"),m({title:"Verificação bem-sucedida",description:s.message||"Credenciais verificadas com sucesso."})):(N(!1),m({title:"Falha na verificação",description:(s==null?void 0:s.message)||"Não foi possível verificar as credenciais.",variant:"destructive"}))}catch(a){m({title:"Erro na verificação",description:(a==null?void 0:a.message)||"Erro inesperado ao verificar as credenciais.",variant:"destructive"})}finally{H(!1)}},p=(a,s)=>{O(i=>({...i,[a]:s}))};return te?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(E,{className:"h-8 w-8 animate-spin text-gray-400"})}):t?e.jsxs("div",{className:"space-y-6 max-w-5xl mx-auto",children:[e.jsxs("button",{onClick:()=>b("/checkout/gateways"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white transition-colors",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"ver todos gateways"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800/50 flex items-center justify-center overflow-hidden p-2",children:e.jsx("img",{src:t.logo,alt:`${t.name} logo`,className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:t.name}),e.jsxs("p",{className:"text-gray-600 font-medium mt-1",children:["Integre sua loja ao gateway ",t.name,"."]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(f,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(J,{children:e.jsx(K,{children:"Informações básicas"})}),e.jsx(v,{className:"space-y-4",children:t.configFields.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:a.name,children:[a.label," ",a.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),a.type==="text"&&e.jsx(Q,{id:a.name,type:"text",placeholder:a.placeholder,value:d[a.name]||"",onChange:s=>p(a.name,s.target.value),required:a.required}),a.type==="password"&&e.jsx(Q,{id:a.name,type:"password",placeholder:a.placeholder,value:d[a.name]||"",onChange:s=>p(a.name,s.target.value),required:a.required}),a.type==="select"&&a.options&&e.jsxs(Y,{value:d[a.name]||"",onValueChange:s=>p(a.name,s),children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:a.placeholder||"Selecione"})}),e.jsx(ae,{children:a.options.map(s=>e.jsx(F,{value:s.value,children:s.label},s.value))})]}),a.type==="checkbox"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{id:a.name,checked:d[a.name]||!1,onCheckedChange:s=>p(a.name,s)}),e.jsx(V,{htmlFor:a.name,className:"cursor-pointer",children:a.label})]})]},a.name))})]}),t.paymentMethods.length>0&&e.jsxs(f,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(J,{children:e.jsx(K,{children:"Regras"})}),e.jsx(v,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[t.paymentMethods.includes("credit_card")&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsx("span",{className:"text-sm",children:"Ativar cartão de crédito"}),e.jsx(y,{checked:C,onCheckedChange:a=>{console.log("Toggle cartão:",a),z(a)}})]}),t.paymentMethods.includes("pix")&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsx("span",{className:"text-sm",children:"Ativar pix"}),e.jsx(y,{checked:k,onCheckedChange:a=>{console.log("Toggle PIX:",a),R(a)}})]}),t.paymentMethods.includes("boleto")&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsx("span",{className:"text-sm",children:"Utilizar taxa de juros customizada"}),e.jsx(y,{checked:S,onCheckedChange:a=>{console.log("Toggle boleto:",a),U(a)}})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(f,{className:A("border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300 border-2",g?"border-green-200 dark:border-green-700 bg-green-50 dark:bg-green-950/20":"border-red-200 dark:border-red-700 bg-red-50 dark:bg-red-950/20"),children:e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(V,{htmlFor:"status",className:"text-base font-semibold",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:A("h-3 w-3 rounded-full",g?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:A("text-sm font-medium",g?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"),children:g?"Ativo":"Inativo"})]})]}),e.jsxs(Y,{value:g?"active":"inactive",onValueChange:a=>D(a==="active"),children:[e.jsx(Z,{id:"status",children:e.jsx(ee,{})}),e.jsxs(ae,{children:[e.jsx(F,{value:"active",children:"Ativo"}),e.jsx(F,{value:"inactive",children:"Inativo"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Verificação"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:re&&B?`Verificado em: ${new Date(B).toLocaleString()}`:"Não verificado"}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Ambiente: ",ie]})]}),e.jsx(q,{onClick:async()=>{await ce()},disabled:$,className:"gap-2",children:$?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 animate-spin"})," ","Verificando..."]}):"Verificar credenciais"})]}),e.jsxs("a",{href:t.apiDocs,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-pink-600 hover:text-pink-700 dark:text-pink-400 dark:hover:text-pink-300",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{children:"Está com dúvidas?"}),e.jsxs("span",{className:"underline",children:["Como integrar o gateway ",t.name,"?"]}),e.jsx(pe,{className:"h-3 w-3"})]})]})]})}),e.jsx(f,{children:e.jsxs(v,{className:"p-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Tipo"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[(t.type==="nacional"||t.type==="both")&&e.jsx(G,{variant:"secondary",children:"Nacional"}),(t.type==="global"||t.type==="both")&&e.jsx(G,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:"Global"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Métodos de Pagamento"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:t.paymentMethods.map(a=>e.jsxs(G,{variant:"outline",className:"text-xs",children:[a==="credit_card"&&"Cartão de Crédito",a==="debit_card"&&"Cartão de Débito",a==="pix"&&"Pix",a==="boleto"&&"Boleto",a==="wallet"&&"Carteira Digital"]},a))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Features"}),e.jsx("ul",{className:"mt-1 space-y-1",children:t.features.map((a,s)=>e.jsxs("li",{className:"text-xs text-gray-700 dark:text-gray-300",children:["• ",a]},s))})]})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[e.jsx(q,{variant:"outline",onClick:()=>b("/checkout/gateways"),disabled:w,children:"Cancelar"}),e.jsx(q,{onClick:le,disabled:w,className:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white",children:w?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando..."]}):"Salvar"})]})]}):null};export{Se as default};
