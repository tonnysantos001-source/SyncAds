import{c as ne,r as o,f as ce,u as de,j as e,B as c,ad as H,g as S,h as w,i as k,P as O,l as C,k as $,Q as me,I as p,o as F}from"./index-CkeR9g7w.js";import{T as he,a as ue,b as K,c as j,d as xe,e as g}from"./table-C1F29-R_.js";import{D as pe,b as je,c as ge,d as fe,e as ve,f as ye}from"./dialog-lX_6dRJ2.js";import{L as m}from"./label-Cjl8m8Za.js";import{T as Ne}from"./textarea-DQR5scwU.js";import{S as U,a as Z,b as G,c as Q,d as h}from"./select-JpR3_KMR.js";import{p as A}from"./productsApi-BYkPaDvY.js";import{a as J}from"./shopifySync-B8VsauPO.js";import{S as z}from"./skeleton-2doKeoxp.js";import{A as Se,b as we,a as ke}from"./alert-D7vi6Pms.js";import{P as W}from"./plus-B4Gec9N2.js";import{S as X}from"./shopping-bag-5lC3SRRr.js";import{D as Ce}from"./dollar-sign-D134eXIX.js";import{S as Pe}from"./square-pen-3tkTE0Yk.js";import{T as be}from"./trash-2-CU_VCPMD.js";import"./index-iLHSLSK-.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=ne("Boxes",[["path",{d:"M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z",key:"lc1i9w"}],["path",{d:"m7 16.5-4.74-2.85",key:"1o9zyk"}],["path",{d:"m7 16.5 5-3",key:"va8pkn"}],["path",{d:"M7 16.5v5.17",key:"jnp8gn"}],["path",{d:"M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z",key:"8zsnat"}],["path",{d:"m17 16.5-5-3",key:"8arw3v"}],["path",{d:"m17 16.5 4.74-2.85",key:"8rfmw"}],["path",{d:"M17 16.5v5.17",key:"k6z78m"}],["path",{d:"M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z",key:"1xygjf"}],["path",{d:"M12 8 7.26 5.15",key:"1vbdud"}],["path",{d:"m12 8 4.74-2.85",key:"3rx089"}],["path",{d:"M12 13.5V8",key:"1io7kd"}]]),Ue=()=>{const[d,Y]=o.useState([]),[f,V]=o.useState([]),[_,T]=o.useState(!0),[v,L]=o.useState(!1),[n,ee]=o.useState(""),[u,se]=o.useState("all"),[ae,x]=o.useState(!1),[y,R]=o.useState(null),[I,te]=o.useState({totalProducts:0,totalOrders:0,lastSync:null}),{toast:i}=ce(),a=de(s=>s.user),[t,l]=o.useState({name:"",description:"",price:0,comparePrice:0,sku:"",stock:0,categoryId:"",status:"ACTIVE"}),P={total:d.length,active:d.filter(s=>s.status==="ACTIVE").length,totalValue:d.reduce((s,r)=>s+r.price*r.stock,0)};o.useEffect(()=>{a!=null&&a.id&&(b(),B())},[a==null?void 0:a.id]),o.useEffect(()=>{re()},[n,u,d]);const b=async()=>{if(!(a!=null&&a.id)){T(!1);return}try{T(!0);const s=await A.list();Y(s),V(s)}catch(s){console.error("Erro ao carregar produtos:",s),i({title:"Erro ao carregar produtos",description:s.message,variant:"destructive"})}finally{T(!1)}},B=async()=>{if(a!=null&&a.id)try{const s=await J.getSyncStats(a.id);te(s)}catch(s){console.debug("Sync stats não disponíveis:",s)}},q=async()=>{if(!(a!=null&&a.id)){i({title:"Erro",description:"Faça login para sincronizar",variant:"destructive"});return}try{L(!0),i({title:"Sincronizando...",description:"Buscando produtos da Shopify"});const s=await J.syncProducts(a.id,a.organizationId||a.id);s.success?(i({title:"Sincronização concluída!",description:s.message}),await b(),await B()):i({title:"Shopify não configurada",description:"Configure a integração Shopify em Integrações",variant:"destructive"})}catch{i({title:"Shopify não disponível",description:"Configure a integração em Integrações > Shopify",variant:"destructive"})}finally{L(!1)}},re=()=>{let s=d;n&&(s=s.filter(r=>{var N,M;return r.name.toLowerCase().includes(n.toLowerCase())||((N=r.sku)==null?void 0:N.toLowerCase().includes(n.toLowerCase()))||((M=r.description)==null?void 0:M.toLowerCase().includes(n.toLowerCase()))})),u!=="all"&&(s=s.filter(r=>r.status===u)),V(s)},ie=async s=>{if(s.preventDefault(),!(a!=null&&a.id)){i({title:"Erro",description:"Você precisa estar logado",variant:"destructive"});return}try{y?(await A.update(y.id,t),i({title:"Produto atualizado!",description:"As alterações foram salvas com sucesso."})):(await A.create({...t,userId:a.id,organizationId:a.organizationId||a.id,slug:t.name.toLowerCase().replace(/\s+/g,"-"),lowStockThreshold:5,trackStock:!0,isFeatured:!1,isActive:t.status==="ACTIVE"}),i({title:"Produto criado!",description:"O produto foi adicionado ao catálogo."})),x(!1),D(),b()}catch(r){console.error("Erro ao salvar:",r),i({title:"Erro ao salvar produto",description:r.message||"Tente novamente",variant:"destructive"})}},oe=s=>{R(s),l({name:s.name,description:s.description||"",price:s.price,comparePrice:s.comparePrice||0,sku:s.sku||"",stock:s.stock,categoryId:s.categoryId||"",status:s.status}),x(!0)},le=async s=>{if(confirm("Tem certeza que deseja excluir este produto?"))try{await A.delete(s),i({title:"Produto excluído",description:"O produto foi removido do catálogo."}),b()}catch(r){i({title:"Erro ao excluir produto",description:r.message,variant:"destructive"})}},D=()=>{R(null),l({name:"",description:"",price:0,comparePrice:0,sku:"",stock:0,categoryId:"",status:"ACTIVE"})},E=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s);return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Produtos"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie o catálogo completo de produtos da sua loja"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:q,variant:"outline",disabled:v,children:[e.jsx(H,{className:`mr-2 h-4 w-4 ${v?"animate-spin":""}`}),v?"Sincronizando...":"Sincronizar Shopify"]}),e.jsxs(c,{onClick:()=>{D(),x(!0)},children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Adicionar Produto"]})]})]}),I.lastSync&&e.jsxs(Se,{children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx(we,{children:"Integração Shopify Ativa"}),e.jsxs(ke,{children:["Última sincronização:"," ",new Date(I.lastSync).toLocaleString("pt-BR")," •",I.totalProducts," produtos importados"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(S,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Total de Produtos"}),e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:P.total}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[P.active," ativos"]})]})]}),e.jsxs(S,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Produtos Ativos"}),e.jsx(Ae,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:P.active}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Disponíveis para venda"})]})]}),e.jsxs(S,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Valor Total"}),e.jsx(Ce,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:E(P.totalValue)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Estoque valorizado"})]})]})]}),e.jsxs(S,{children:[e.jsxs(w,{children:[e.jsx(k,{children:"Filtros"}),e.jsx($,{children:"Busque e filtre produtos"})]}),e.jsx(C,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Buscar por nome, SKU ou descrição...",value:n,onChange:s=>ee(s.target.value),className:"pl-10"})]})}),e.jsxs(U,{value:u,onValueChange:se,children:[e.jsx(Z,{className:"w-full md:w-[200px]",children:e.jsx(G,{placeholder:"Status"})}),e.jsxs(Q,{children:[e.jsx(h,{value:"all",children:"Todos os Status"}),e.jsx(h,{value:"ACTIVE",children:"Ativo"}),e.jsx(h,{value:"DRAFT",children:"Rascunho"}),e.jsx(h,{value:"ARCHIVED",children:"Arquivado"})]})]})]})})]}),e.jsxs(S,{children:[e.jsxs(w,{children:[e.jsxs(k,{children:["Catálogo (",f.length,")"]}),e.jsx($,{children:f.length===d.length?"Mostrando todos os produtos":`Mostrando ${f.length} de ${d.length} produtos`})]}),e.jsx(C,{children:_?e.jsxs("div",{className:"space-y-4",children:[e.jsx(z,{className:"h-12 w-full"}),e.jsx(z,{className:"h-12 w-full"}),e.jsx(z,{className:"h-12 w-full"})]}):f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(O,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground text-center mb-4",children:n||u!=="all"?"Nenhum produto encontrado com os filtros aplicados":"Nenhum produto cadastrado"}),!n&&u==="all"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:q,variant:"outline",disabled:v,children:[e.jsx(H,{className:`mr-2 h-4 w-4 ${v?"animate-spin":""}`}),"Sincronizar Shopify"]}),e.jsxs(c,{onClick:()=>{D(),x(!0)},children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Adicionar Primeiro Produto"]})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(he,{children:[e.jsx(ue,{children:e.jsxs(K,{children:[e.jsx(j,{children:"Produto"}),e.jsx(j,{children:"SKU"}),e.jsx(j,{children:"Preço"}),e.jsx(j,{children:"Estoque"}),e.jsx(j,{children:"Status"}),e.jsx(j,{children:"Ações"})]})}),e.jsx(xe,{children:f.map(s=>{var r,N;return e.jsxs(K,{children:[e.jsx(g,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",children:s.description}),((r=s.metadata)==null?void 0:r.shopifyId)&&e.jsxs(F,{variant:"outline",className:"mt-1",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Shopify"]})]})}),e.jsx(g,{children:e.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:s.sku||"N/A"})}),e.jsx(g,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:E(s.price)}),s.comparePrice&&s.comparePrice>s.price&&e.jsx("div",{className:"text-xs text-muted-foreground line-through",children:E(s.comparePrice)})]})}),e.jsx(g,{children:e.jsxs(F,{variant:s.stock>10?"default":s.stock>0?"warning":"destructive",children:[s.stock," un."]})}),e.jsx(g,{children:e.jsx(F,{variant:s.status==="ACTIVE"?"default":s.status==="DRAFT"?"secondary":"outline",children:s.status==="ACTIVE"?"Ativo":s.status==="DRAFT"?"Rascunho":"Arquivado"})}),e.jsx(g,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>oe(s),children:e.jsx(Pe,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>le(s.id),disabled:!!((N=s.metadata)!=null&&N.shopifyId),children:e.jsx(be,{className:"h-4 w-4"})})]})})]},s.id)})})]})})})]}),e.jsx(pe,{open:ae,onOpenChange:x,children:e.jsxs(je,{className:"max-w-2xl",children:[e.jsxs(ge,{children:[e.jsx(fe,{children:y?"Editar Produto":"Novo Produto"}),e.jsx(ve,{children:y?"Atualize as informações do produto":"Adicione um novo produto ao catálogo"})]}),e.jsxs("form",{onSubmit:ie,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"name",children:"Nome do Produto *"}),e.jsx(p,{id:"name",value:t.name,onChange:s=>l({...t,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"description",children:"Descrição"}),e.jsx(Ne,{id:"description",value:t.description,onChange:s=>l({...t,description:s.target.value}),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"price",children:"Preço *"}),e.jsx(p,{id:"price",type:"number",step:"0.01",value:t.price,onChange:s=>l({...t,price:parseFloat(s.target.value)}),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"comparePrice",children:"Preço Comparação"}),e.jsx(p,{id:"comparePrice",type:"number",step:"0.01",value:t.comparePrice,onChange:s=>l({...t,comparePrice:parseFloat(s.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"sku",children:"SKU"}),e.jsx(p,{id:"sku",value:t.sku,onChange:s=>l({...t,sku:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"stock",children:"Estoque *"}),e.jsx(p,{id:"stock",type:"number",value:t.stock,onChange:s=>l({...t,stock:parseInt(s.target.value)}),required:!0})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"status",children:"Status"}),e.jsxs(U,{value:t.status,onValueChange:s=>l({...t,status:s}),children:[e.jsx(Z,{children:e.jsx(G,{})}),e.jsxs(Q,{children:[e.jsx(h,{value:"ACTIVE",children:"Ativo"}),e.jsx(h,{value:"DRAFT",children:"Rascunho"}),e.jsx(h,{value:"ARCHIVED",children:"Arquivado"})]})]})]})]}),e.jsxs(ye,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancelar"}),e.jsxs(c,{type:"submit",children:[y?"Atualizar":"Criar"," Produto"]})]})]})]})})]})})};export{Ue as default};
