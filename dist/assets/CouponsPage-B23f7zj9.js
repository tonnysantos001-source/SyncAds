import{c as F,r,f as X,u as $,j as e,B as h,I as n,g,h as v,i as f,l as C,a5 as Z,n as D}from"./index-DONFIVhV.js";import{T as J,a as K,b as S,e as d,c as Q,d as m}from"./table-BUtEVDS5.js";import{D as W,f as Y,a as ee,b as se,c as te,e as ae}from"./dialog-DZREaTTa.js";import{L as o}from"./label-BZFstuxi.js";import{S as re,a as ie,b as le,c as ne,d as E}from"./select-ByAkXJ6j.js";import{m as N}from"./marketingApi-Ctzi_HxL.js";import{S as P}from"./skeleton-DS4PcywM.js";import{P as L}from"./plus-BefJY2sc.js";import{D as I}from"./dollar-sign-DgA2OTAg.js";import{P as oe}from"./percent-BXU6IEMw.js";import{S as ce}from"./square-pen-C27iR03v.js";import{T as de}from"./trash-2-jZtZmvcf.js";import"./index-25Ejnh_2.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=F("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=F("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),Ee=()=>{const[u,z]=r.useState([]),[b,y]=r.useState([]),[M,R]=r.useState(!0),[c,O]=r.useState(""),[G,j]=r.useState(!1),[p,w]=r.useState(null),{toast:x}=X(),i=$(s=>s.user),[t,a]=r.useState({code:"",name:"",type:"PERCENTAGE",value:0,minPurchaseAmount:0,maxDiscountAmount:0,usageLimit:0,perCustomerLimit:1,startsAt:"",expiresAt:"",isActive:!0});r.useEffect(()=>{A()},[]),r.useEffect(()=>{U()},[c,u]);const A=async()=>{try{if(!(i!=null&&i.organizationId))return;const s=await N.coupons.getAll(i.organizationId);z(s),y(s)}catch(s){x({title:"Erro ao carregar cupons",description:s.message,variant:"destructive"})}finally{R(!1)}},U=()=>{if(!c){y(u);return}const s=u.filter(l=>l.code.toLowerCase().includes(c.toLowerCase())||l.name.toLowerCase().includes(c.toLowerCase()));y(s)},q=async s=>{s.preventDefault();try{if(!(i!=null&&i.organizationId))return;p?(await N.coupons.update(p.id,t),x({title:"Cupom atualizado!",description:"As alterações foram salvas."})):(await N.coupons.create({...t,organizationId:i.organizationId,usageCount:0}),x({title:"Cupom criado!",description:"O cupom está pronto para uso."})),j(!1),T(),A()}catch(l){x({title:"Erro",description:l.message,variant:"destructive"})}},H=async s=>{if(confirm("Tem certeza que deseja deletar este cupom?"))try{await N.coupons.delete(s),x({title:"Cupom deletado"}),A()}catch(l){x({title:"Erro ao deletar",description:l.message,variant:"destructive"})}},V=s=>{w(s),a({code:s.code,name:s.name,type:s.type,value:s.value,minPurchaseAmount:s.minPurchaseAmount||0,maxDiscountAmount:s.maxDiscountAmount||0,usageLimit:s.usageLimit||0,perCustomerLimit:s.perCustomerLimit||1,startsAt:s.startsAt||"",expiresAt:s.expiresAt||"",isActive:s.isActive}),j(!0)},T=()=>{w(null),a({code:"",name:"",type:"PERCENTAGE",value:0,minPurchaseAmount:0,maxDiscountAmount:0,usageLimit:0,perCustomerLimit:1,startsAt:"",expiresAt:"",isActive:!0})},B=u.reduce((s,l)=>s+l.usageCount,0),_=u.filter(s=>s.isActive).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Cupons de Desconto"}),e.jsx("p",{className:"text-muted-foreground",children:"Crie e gerencie cupons para sua loja"})]}),e.jsxs(W,{open:G,onOpenChange:j,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(h,{onClick:T,children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Criar Cupom"]})}),e.jsxs(ee,{className:"max-w-2xl",children:[e.jsx(se,{children:e.jsx(te,{children:p?"Editar Cupom":"Novo Cupom"})}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Código *"}),e.jsx(n,{value:t.code,onChange:s=>a({...t,code:s.target.value.toUpperCase()}),placeholder:"PROMO10",required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Nome *"}),e.jsx(n,{value:t.name,onChange:s=>a({...t,name:s.target.value}),placeholder:"Desconto 10%",required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Tipo *"}),e.jsxs(re,{value:t.type,onValueChange:s=>a({...t,type:s}),children:[e.jsx(ie,{children:e.jsx(le,{})}),e.jsxs(ne,{children:[e.jsx(E,{value:"PERCENTAGE",children:"Porcentagem"}),e.jsx(E,{value:"FIXED_AMOUNT",children:"Valor Fixo"}),e.jsx(E,{value:"FREE_SHIPPING",children:"Frete Grátis"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Valor *"}),e.jsx(n,{type:"number",step:"0.01",value:t.value,onChange:s=>a({...t,value:parseFloat(s.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Compra Mínima"}),e.jsx(n,{type:"number",step:"0.01",value:t.minPurchaseAmount,onChange:s=>a({...t,minPurchaseAmount:parseFloat(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Limite de Usos"}),e.jsx(n,{type:"number",value:t.usageLimit,onChange:s=>a({...t,usageLimit:parseInt(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Data Início"}),e.jsx(n,{type:"datetime-local",value:t.startsAt,onChange:s=>a({...t,startsAt:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Data Expiração"}),e.jsx(n,{type:"datetime-local",value:t.expiresAt,onChange:s=>a({...t,expiresAt:s.target.value})})]})]}),e.jsxs(ae,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),e.jsxs(h,{type:"submit",children:[p?"Atualizar":"Criar"," Cupom"]})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(g,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total de Cupons"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:u.length})})]}),e.jsxs(g,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Cupons Ativos"}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:_})})]}),e.jsxs(g,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total de Usos"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"text-2xl font-bold",children:B})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(n,{placeholder:"Buscar cupons...",value:c,onChange:s=>O(s.target.value),className:"pl-9"})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(f,{children:"Lista de Cupons"})}),e.jsx(C,{children:M?e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"h-12 w-full"}),e.jsx(P,{className:"h-12 w-full"})]}):b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(k,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhum cupom encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:c?"Tente ajustar sua busca":"Comece criando seu primeiro cupom"}),!c&&e.jsxs(h,{onClick:T,children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Criar Primeiro Cupom"]})]}):e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(S,{children:[e.jsx(d,{children:"Código"}),e.jsx(d,{children:"Nome"}),e.jsx(d,{children:"Tipo"}),e.jsx(d,{children:"Valor"}),e.jsx(d,{children:"Usos"}),e.jsx(d,{children:"Status"}),e.jsx(d,{className:"text-right",children:"Ações"})]})}),e.jsx(Q,{children:b.map(s=>e.jsxs(S,{children:[e.jsx(m,{children:e.jsx("code",{className:"font-mono font-bold",children:s.code})}),e.jsx(m,{children:s.name}),e.jsx(m,{children:e.jsxs(D,{variant:"outline",children:[s.type==="PERCENTAGE"&&e.jsx(oe,{className:"h-3 w-3 mr-1"}),s.type==="FIXED_AMOUNT"&&e.jsx(I,{className:"h-3 w-3 mr-1"}),s.type==="PERCENTAGE"?"Porcentagem":s.type==="FIXED_AMOUNT"?"Valor Fixo":"Frete Grátis"]})}),e.jsx(m,{children:s.type==="PERCENTAGE"?`${s.value}%`:s.type==="FIXED_AMOUNT"?`R$ ${s.value.toFixed(2)}`:"-"}),e.jsxs(m,{children:[s.usageCount,s.usageLimit&&` / ${s.usageLimit}`]}),e.jsx(m,{children:e.jsx(D,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativo":"Inativo"})}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>V(s),children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>H(s.id),children:e.jsx(de,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})]})};export{Ee as default};
