import{r,f as F,u as W,s as j,j as e,B as c,I as w,g as N,h as C,i as S,l as y,S as J,n as G,ad as K}from"./index-Cp02ev55.js";import{T as Q,a as X,b as P,c as m,d as Y,e as x}from"./table-B_bkKxhb.js";import{D as Z,a as $,b as ee,c as se,d as ae,f as te}from"./dialog-DHvZyb1R.js";import{L as f}from"./label-C5lmeW6p.js";import{T as re}from"./textarea--ERD1aYa.js";import{S as A}from"./skeleton-BW99Lp7l.js";import{P as I}from"./plus-dNClzfg9.js";import{M as E}from"./message-square-Bhb4sdDR.js";import{T as D}from"./trending-up-DvTmsUlh.js";import{S as ie}from"./square-pen-PlIHJEAY.js";import{T as le}from"./trash-2-BItAVK_G.js";const ge=()=>{const[d,R]=r.useState([]),[T,p]=r.useState([]),[z,O]=r.useState(!0),[l,U]=r.useState(""),[k,h]=r.useState(!1),[u,b]=r.useState(null),{toast:o}=F(),i=W(s=>s.user),[t,n]=r.useState({type:"RECENT_PURCHASE",message:"",displayDuration:5,isActive:!0});r.useEffect(()=>{g()},[]),r.useEffect(()=>{q()},[l,d]);const g=async()=>{try{if(!(i!=null&&i.organizationId))return;const{data:s,error:a}=await j.from("SocialProof").select("*").eq("organizationId",i.organizationId).order("createdAt",{ascending:!1});if(a)throw a;R(s||[]),p(s||[])}catch(s){o({title:"Erro ao carregar",description:s.message,variant:"destructive"})}finally{O(!1)}},q=()=>{if(!l){p(d);return}const s=d.filter(a=>a.message.toLowerCase().includes(l.toLowerCase()));p(s)},H=async s=>{s.preventDefault();try{if(!(i!=null&&i.organizationId))return;if(u){const{error:a}=await j.from("SocialProof").update({...t,updatedAt:new Date().toISOString()}).eq("id",u.id);if(a)throw a;o({title:"Prova social atualizada!"})}else{const{error:a}=await j.from("SocialProof").insert({...t,organizationId:i.organizationId});if(a)throw a;o({title:"Prova social criada!",description:"A notificação está pronta para exibição."})}h(!1),v(),g()}catch(a){o({title:"Erro",description:a.message,variant:"destructive"})}},V=async s=>{if(confirm("Tem certeza que deseja deletar esta prova social?"))try{const{error:a}=await j.from("SocialProof").delete().eq("id",s);if(a)throw a;o({title:"Prova social deletada"}),g()}catch(a){o({title:"Erro ao deletar",description:a.message,variant:"destructive"})}},_=s=>{b(s),n({type:s.type,message:s.message,displayDuration:s.displayDuration,isActive:s.isActive}),h(!0)},v=()=>{b(null),n({type:"RECENT_PURCHASE",message:"",displayDuration:5,isActive:!0})},L=d.filter(s=>s.isActive).length,B=s=>({RECENT_PURCHASE:"Compra Recente",VISITOR_COUNT:"Contador de Visitantes",REVIEW:"Avaliação"})[s]||s,M=s=>{switch(s){case"RECENT_PURCHASE":return e.jsx(D,{className:"h-4 w-4"});case"VISITOR_COUNT":return e.jsx(K,{className:"h-4 w-4"});case"REVIEW":return e.jsx(E,{className:"h-4 w-4"});default:return null}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Prova Social"}),e.jsx("p",{className:"text-muted-foreground",children:"Notificações em tempo real para aumentar confiança"})]}),e.jsxs(Z,{open:k,onOpenChange:h,children:[e.jsx($,{asChild:!0,children:e.jsxs(c,{onClick:v,children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Criar Prova Social"]})}),e.jsxs(ee,{className:"max-w-lg",children:[e.jsx(se,{children:e.jsx(ae,{children:u?"Editar Prova Social":"Nova Prova Social"})}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(f,{children:"Tipo *"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",value:t.type,onChange:s=>n({...t,type:s.target.value}),required:!0,children:[e.jsx("option",{value:"RECENT_PURCHASE",children:"Compra Recente"}),e.jsx("option",{value:"VISITOR_COUNT",children:"Contador de Visitantes"}),e.jsx("option",{value:"REVIEW",children:"Avaliação"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.type==="RECENT_PURCHASE"&&'Ex: "João acabou de comprar há 5 minutos"',t.type==="VISITOR_COUNT"&&'Ex: "23 pessoas estão visualizando este produto"',t.type==="REVIEW"&&'Ex: "★★★★★ Produto excelente! - Maria S."']})]}),e.jsxs("div",{children:[e.jsx(f,{children:"Mensagem *"}),e.jsx(re,{value:t.message,onChange:s=>n({...t,message:s.target.value}),placeholder:"Digite a mensagem que será exibida...",rows:3,required:!0})]}),e.jsxs("div",{children:[e.jsx(f,{children:"Duração de Exibição (segundos)"}),e.jsx(w,{type:"number",min:"1",max:"30",value:t.displayDuration,onChange:s=>n({...t,displayDuration:parseInt(s.target.value)}),required:!0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.isActive,onChange:s=>n({...t,isActive:s.target.checked}),className:"rounded"}),e.jsx(f,{children:"Ativo"})]}),e.jsxs(te,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>h(!1),children:"Cancelar"}),e.jsx(c,{type:"submit",children:u?"Atualizar":"Criar"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(N,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"Total"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold",children:d.length})})]}),e.jsxs(N,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"Ativas"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold",children:L})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(w,{placeholder:"Buscar provas sociais...",value:l,onChange:s=>U(s.target.value),className:"pl-9"})]}),e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(S,{children:"Lista de Provas Sociais"})}),e.jsx(y,{children:z?e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{className:"h-12 w-full"}),e.jsx(A,{className:"h-12 w-full"})]}):T.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(E,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhuma prova social encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:l?"Tente ajustar sua busca":"Comece criando a primeira prova social"}),!l&&e.jsxs(c,{onClick:v,children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Criar Primeira Prova Social"]})]}):e.jsxs(Q,{children:[e.jsx(X,{children:e.jsxs(P,{children:[e.jsx(m,{children:"Tipo"}),e.jsx(m,{children:"Mensagem"}),e.jsx(m,{children:"Duração"}),e.jsx(m,{children:"Status"}),e.jsx(m,{className:"text-right",children:"Ações"})]})}),e.jsx(Y,{children:T.map(s=>e.jsxs(P,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[M(s.type),e.jsx("span",{className:"text-sm",children:B(s.type)})]})}),e.jsx(x,{className:"max-w-md truncate",children:s.message}),e.jsxs(x,{children:[s.displayDuration,"s"]}),e.jsx(x,{children:e.jsx(G,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativa":"Inativa"})}),e.jsx(x,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>_(s),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>V(s.id),children:e.jsx(le,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})]})};export{ge as default};
