import{c as R,r as l,f as W,u as H,j as e,g as v,h as q,i as V,l as y,S as X,I as c,C as S,n as C,B as h,a5 as M,s as Y}from"./index-BFuzBXw_.js";import{D as $,a as Z,b as J,c as Q,e as ee}from"./dialog-D-a4noHY.js";import{L as n}from"./label-B4UQ0dkm.js";import{S as L}from"./switch-DBxmEgsB.js";import{T as se,a as ae,b as u}from"./tabs-DF7DwxKK.js";import{g as te,a as b}from"./gatewaysApi-D86_ePZL.js";import{S as ie}from"./skeleton-Ck4Gc5lo.js";import{W as re}from"./wallet-CX90PAei.js";import{C as I}from"./circle-check-c9YUdcNQ.js";import"./index-COUlQIbY.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=R("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),je=()=>{const[g,P]=l.useState([]),[m,E]=l.useState([]),[w,B]=l.useState(!0),[N,G]=l.useState(""),[r,U]=l.useState(null),[D,p]=l.useState(!1),[j,O]=l.useState("ALL"),{toast:o}=W(),d=H(s=>s.user),[a,i]=l.useState({apiKey:"",secretKey:"",publicKey:"",webhookUrl:"",pixFee:0,creditCardFee:0,boletoFee:0,isTestMode:!0,isActive:!0});l.useEffect(()=>{F()},[]);const F=async()=>{try{const s=await te.list();if(P(s),d!=null&&d.organizationId){const t=await b.list();E(t)}}catch(s){o({title:"Erro ao carregar gateways",description:s.message,variant:"destructive"})}finally{B(!1)}},k=s=>{U(s);const t=m.find(x=>x.gatewayId===s.id);i(t?{apiKey:t.credentials.apiKey||"",secretKey:t.credentials.secretKey||"",publicKey:t.credentials.publicKey||"",webhookUrl:t.webhookUrl||"",pixFee:t.pixFee||0,creditCardFee:t.creditCardFee||0,boletoFee:t.boletoFee||0,isTestMode:t.isTestMode,isActive:t.isActive}:{apiKey:"",secretKey:"",publicKey:"",webhookUrl:"",pixFee:0,creditCardFee:0,boletoFee:0,isTestMode:!0,isActive:!0}),p(!0)},z=async()=>{try{if(!(d!=null&&d.organizationId)||!r)return;const s=m.find(x=>x.gatewayId===r.id),t={apiKey:a.apiKey,secretKey:a.secretKey,publicKey:a.publicKey};s?(await b.update(s.id,{credentials:t,webhookUrl:a.webhookUrl,pixFee:a.pixFee,creditCardFee:a.creditCardFee,boletoFee:a.boletoFee,isTestMode:a.isTestMode,isActive:a.isActive}),o({title:"Configuração atualizada!"})):(await b.create({organizationId:d.organizationId,gatewayId:r.id,credentials:t,webhookUrl:a.webhookUrl,pixFee:a.pixFee,creditCardFee:a.creditCardFee,boletoFee:a.boletoFee,isTestMode:a.isTestMode,isActive:a.isActive,isDefault:!1}),o({title:"Gateway configurado!",description:"O gateway está pronto para uso."})),p(!1),F()}catch(s){o({title:"Erro ao salvar",description:s.message,variant:"destructive"})}},_=async()=>{try{if(!r)return;o({title:"Testando conexão...",description:`Testando ${r.name}`});const{data:s,error:t}=await Y.functions.invoke("test-gateway",{body:{gatewayId:r.id,credentials:{apiKey:a.apiKey,secretKey:a.secretKey,publicKey:a.publicKey},testMode:a.isTestMode}});if(t)throw new Error(t.message);s.success?o({title:"Conexão bem-sucedida!",description:s.message,variant:"default"}):o({title:"Falha na conexão",description:s.message,variant:"destructive"})}catch(s){o({title:"Erro no teste",description:s.message,variant:"destructive"})}},T=s=>m.some(t=>t.gatewayId===s&&t.isActive),f=g.filter(s=>{const t=s.name.toLowerCase().includes(N.toLowerCase()),x=j==="ALL"||s.type===j;return t&&x}),K=f.filter(s=>s.isPopular),A=f.filter(s=>!s.isPopular);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Gateways de Pagamento"}),e.jsxs("p",{className:"text-muted-foreground",children:["Configure e gerencie seus gateways de pagamento (",g.length," disponíveis)"]})]}),e.jsxs(v,{children:[e.jsx(q,{children:e.jsx(V,{className:"text-lg",children:"Gateways Configurados"})}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.filter(s=>s.isActive).length}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["de ",g.length," gateways disponíveis"]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(c,{placeholder:"Buscar gateway...",value:N,onChange:s=>G(s.target.value),className:"pl-9"})]}),e.jsx(se,{value:j,onValueChange:s=>O(s),children:e.jsxs(ae,{children:[e.jsx(u,{value:"ALL",children:"Todos"}),e.jsx(u,{value:"PAYMENT_PROCESSOR",children:"Processadores"}),e.jsx(u,{value:"WALLET",children:"Wallets"}),e.jsx(u,{value:"BANK",children:"Bancos"})]})})]}),w?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((s,t)=>e.jsx(ie,{className:"h-32"},t))}):e.jsxs(e.Fragment,{children:[K.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Gateways Populares"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:K.map(s=>e.jsx(v,{className:"hover:shadow-md transition-shadow",children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"w-12 h-12 rounded bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0",children:[s.type==="PAYMENT_PROCESSOR"&&e.jsx(S,{className:"h-6 w-6 text-white"}),s.type==="WALLET"&&e.jsx(re,{className:"h-6 w-6 text-white"}),s.type==="BANK"&&e.jsx(le,{className:"h-6 w-6 text-white"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:s.name}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[s.supportsPix&&e.jsx(C,{variant:"outline",className:"text-xs",children:"PIX"}),s.supportsCreditCard&&e.jsx(C,{variant:"outline",className:"text-xs",children:"Cartão"}),s.supportsBoleto&&e.jsx(C,{variant:"outline",className:"text-xs",children:"Boleto"})]}),T(s.id)&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-green-600",children:[e.jsx(I,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs font-medium",children:"Configurado"})]})]})]}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>k(s),children:e.jsx(M,{className:"h-4 w-4"})})]})})},s.id))})]}),A.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Outros Gateways"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:A.map(s=>e.jsx(v,{className:"hover:shadow transition-shadow",children:e.jsx(y,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-bold",children:s.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium truncate",children:s.name}),T(s.id)&&e.jsx(I,{className:"h-3 w-3 text-green-600"})]})]}),e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>k(s),children:e.jsx(M,{className:"h-3 w-3"})})]})})},s.id))})]})]}),e.jsx($,{open:D,onOpenChange:p,children:e.jsxs(Z,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsxs(Q,{children:["Configurar ",r==null?void 0:r.name]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"API Key *"}),e.jsx(c,{value:a.apiKey,onChange:s=>i({...a,apiKey:s.target.value}),placeholder:"sk_live_xxx"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Secret Key"}),e.jsx(c,{value:a.secretKey,onChange:s=>i({...a,secretKey:s.target.value}),placeholder:"secret_xxx"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Public Key"}),e.jsx(c,{value:a.publicKey,onChange:s=>i({...a,publicKey:s.target.value}),placeholder:"pk_live_xxx"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Webhook URL"}),e.jsx(c,{value:a.webhookUrl,onChange:s=>i({...a,webhookUrl:s.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Taxa PIX (%)"}),e.jsx(c,{type:"number",step:"0.01",value:a.pixFee,onChange:s=>i({...a,pixFee:parseFloat(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Taxa Cartão (%)"}),e.jsx(c,{type:"number",step:"0.01",value:a.creditCardFee,onChange:s=>i({...a,creditCardFee:parseFloat(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Taxa Boleto (R$)"}),e.jsx(c,{type:"number",step:"0.01",value:a.boletoFee,onChange:s=>i({...a,boletoFee:parseFloat(s.target.value)})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{checked:a.isTestMode,onCheckedChange:s=>i({...a,isTestMode:s})}),e.jsx(n,{children:"Modo de Teste"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{checked:a.isActive,onCheckedChange:s=>i({...a,isActive:s})}),e.jsx(n,{children:"Ativo"})]})]})]}),e.jsxs(ee,{children:[e.jsx(h,{variant:"outline",onClick:()=>p(!1),children:"Cancelar"}),e.jsx(h,{variant:"outline",onClick:_,children:"Testar Conexão"}),e.jsx(h,{onClick:z,children:"Salvar Configuração"})]})]})}),f.length===0&&!w&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhum gateway encontrado"})]})]})};export{je as default};
