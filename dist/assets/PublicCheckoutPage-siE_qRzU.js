import{m as H,e as U,f as J,r as c,j as e,N as R,g as p,l as j,B as b,Y as K,C as $,R as Q,d as W,h as N,i as y,I as d,s as Y}from"./index-ZatFU8eK.js";import{L as i}from"./label-L0ju2r9n.js";import{S as z}from"./separator-BC-rGRJz.js";import{c as G,D as Z,a as ee,g as se,S as ae}from"./defaultCheckoutTheme-BeLT2mL-.js";import{C as te}from"./circle-alert-GZQa4QYY.js";import{L as re}from"./lock-DZPYFlIm.js";import{T as oe}from"./truck-BPiT87I4.js";import{F as le}from"./file-text-CT2MVgCR.js";const je=()=>{const{orderId:C}=H(),P=U(),{toast:x}=J(),[o,w]=c.useState(null),[F,B]=c.useState(null),[L,v]=c.useState(!0),[E,S]=c.useState(!1),[r,I]=c.useState(1),[ne,ie]=c.useState(!1),[m,f]=c.useState({name:"",email:"",phone:"",document:""}),[l,h]=c.useState({street:"",number:"",complement:"",neighborhood:"",city:"",state:"",zipCode:""}),[g,k]=c.useState("PIX"),[T,O]=c.useState(1);c.useEffect(()=>{C&&M()},[C]);const M=async()=>{try{v(!0);const s=localStorage.getItem("syncads_cart");if(!s||s==="[]"){console.error("❌ Carrinho vazio - não há produtos"),w(null),v(!1),x({title:"Carrinho vazio",description:"Adicione produtos ao carrinho antes de finalizar",variant:"destructive"});return}const t=JSON.parse(s);if(!t||t.length===0){console.error("❌ Nenhum produto no carrinho"),w(null),v(!1),x({title:"Carrinho vazio",description:"Adicione produtos ao carrinho antes de finalizar",variant:"destructive"});return}const u=t.reduce((n,A)=>n+A.price*A.quantity,0),D={orderId:C,products:t.map(n=>({id:n.productId||n.variantId||n.id,name:n.name||n.title,price:n.price,quantity:n.quantity,image:n.image||"",sku:n.sku||""})),total:u,subtotal:u,tax:0,shipping:0,discount:0};console.log("✅ Produtos REAIS carregados:",D),console.log("📦 Total de itens:",t.length),console.log("💰 Valor total:",u),w(D);try{const n=await G.loadCustomization("default-org-id");B(n)}catch{console.log("Usando tema padrão profissional"),B({theme:Z})}}catch(s){console.error("Erro ao carregar dados do checkout:",s),x({title:"Erro ao carregar checkout",description:"Não foi possível carregar os dados do pedido",variant:"destructive"})}finally{v(!1)}},V=()=>{if(r===1&&(!m.name||!m.email||!m.phone)){x({title:"Dados incompletos",description:"Preencha todos os campos obrigatórios",variant:"destructive"});return}if(r===2&&(!l.street||!l.number||!l.neighborhood||!l.city||!l.state||!l.zipCode)){x({title:"Endereço incompleto",description:"Preencha todos os campos do endereço",variant:"destructive"});return}I(s=>s+1)},_=()=>{I(s=>s-1)},q=async()=>{if(o){S(!0);try{const s={orderId:o.orderId,gatewayId:"default-gateway",paymentMethod:g,amount:o.total,currency:"BRL",customerData:m,billingAddress:l,installments:T,metadata:{source:"public-checkout",products:o.products}},{data:t,error:u}=await Y.functions.invoke("process-payment",{body:s});if(u)throw new Error(u.message);if(t.success)x({title:"Pagamento processado!",description:"Seu pagamento foi processado com sucesso",variant:"default"}),P(`/checkout/success/${t.data.transactionId}`);else throw new Error(t.message)}catch(s){console.error("Erro no pagamento:",s),x({title:"Erro no pagamento",description:s.message||"Tente novamente",variant:"destructive"})}finally{S(!1)}}};if(L)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"h-16 w-16 animate-spin mx-auto mb-4 text-purple-600"}),e.jsx("div",{className:"absolute inset-0 blur-xl bg-purple-400 opacity-20 animate-pulse"})]}),e.jsx("p",{className:"text-gray-700 font-semibold text-lg",children:"Carregando checkout seguro..."}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Aguarde um momento"})]})});if(!o)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-orange-50 flex items-center justify-center p-4",children:e.jsx(p,{className:"w-full max-w-md shadow-2xl border-0",children:e.jsxs(j,{className:"p-8 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-100 to-red-200 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(te,{className:"h-10 w-10 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Pedido não encontrado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"O pedido solicitado não foi encontrado ou expirou."}),e.jsx(b,{onClick:()=>P("/"),className:"w-full h-12 text-base font-semibold",children:"Voltar ao início"})]})})});const a=ee(F==null?void 0:F.theme),X=se(a);return e.jsxs("div",{className:"min-h-screen transition-colors duration-300",style:{backgroundColor:a.backgroundColor,fontFamily:a.fontFamily,...X},children:[a.noticeBarEnabled&&a.noticeBarMessage&&e.jsx("div",{className:"w-full py-3 px-4 text-center text-sm font-medium",style:{backgroundColor:a.noticeBarBackgroundColor,color:a.noticeBarTextColor,animation:a.noticeBarAnimation?"pulse 2s infinite":"none"},children:a.noticeBarMessage}),e.jsx("div",{className:"bg-white/95 backdrop-blur-lg border-b border-gray-200 shadow-sm sticky top-0 z-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-lg",style:{background:`linear-gradient(135deg, ${a.primaryButtonBackgroundColor} 0%, ${a.checkoutButtonBackgroundColor} 100%)`},children:e.jsx(re,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold tracking-tight",style:{color:a.headingColor},children:"Checkout Seguro"}),a.showTrustBadges&&e.jsx("p",{className:"text-xs hidden sm:block",style:{color:a.footerTextColor},children:"Seus dados estão protegidos 🔒"})]})]}),e.jsx("div",{className:"hidden lg:flex items-center gap-3",children:[{num:1,label:"Dados",icon:K},{num:2,label:"Entrega",icon:oe},{num:3,label:"Pagamento",icon:$}].map((s,t)=>e.jsxs(Q.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`relative w-12 h-12 rounded-xl flex items-center justify-center text-sm font-bold transition-all duration-500 ${r>s.num?"shadow-lg scale-110":r===s.num?"shadow-lg scale-110 animate-bounce":""}`,style:{backgroundColor:r>s.num?a.stepCompletedColor:r===s.num?a.stepActiveColor:a.stepInactiveColor,color:r>=s.num?"#FFFFFF":"#9CA3AF"},children:[r>s.num?e.jsx(W,{className:"h-6 w-6"}):e.jsx(s.icon,{className:"h-6 w-6"}),r===s.num&&e.jsx("div",{className:"absolute inset-0 rounded-xl opacity-50 animate-ping",style:{backgroundColor:a.stepActiveColor}})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium",style:{color:r>=s.num?a.stepActiveColor:a.stepInactiveColor},children:["Etapa ",s.num]}),e.jsx("p",{className:"text-sm font-bold",style:{color:r>=s.num?a.headingColor:a.stepInactiveColor},children:s.label})]})]}),t<2&&a.showProgressBar&&e.jsx("div",{className:"relative w-16 h-1 rounded-full overflow-hidden",style:{backgroundColor:a.stepInactiveColor},children:e.jsx("div",{className:"absolute top-0 left-0 h-full transition-all duration-700",style:{width:r>s.num?"100%":"0%",backgroundColor:a.progressBarColor}})})]},s.num))}),e.jsx("div",{className:"lg:hidden",children:e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold",style:{color:a.primaryButtonBackgroundColor},children:["Etapa ",r," de ",a.navigationSteps]}),e.jsx("p",{className:"text-xs",style:{color:a.footerTextColor},children:r===1?"Dados":r===2?"Entrega":"Pagamento"})]})})]}),a.showProgressBar&&e.jsx("div",{className:"mt-4 lg:hidden",children:e.jsx("div",{className:"w-full h-2 rounded-full overflow-hidden",style:{backgroundColor:a.stepInactiveColor},children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${r/a.navigationSteps*100}%`,backgroundColor:a.progressBarColor}})})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8",children:e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${r>=1?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"}`,children:"1"}),e.jsx("span",{className:"text-sm",children:"Dados"})]}),e.jsx("div",{className:"w-8 h-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${r>=2?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"}`,children:"2"}),e.jsx("span",{className:"text-sm",children:"Endereço"})]}),e.jsx("div",{className:"w-8 h-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${r>=3?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"}`,children:"3"}),e.jsx("span",{className:"text-sm",children:"Pagamento"})]})]})})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[r===1&&e.jsxs(p,{children:[e.jsx(N,{children:e.jsx(y,{children:"Informações Pessoais"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"name",children:"Nome completo *"}),e.jsx(d,{id:"name",value:m.name,onChange:s=>f(t=>({...t,name:s.target.value})),placeholder:"Seu nome completo"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email",children:"E-mail *"}),e.jsx(d,{id:"email",type:"email",value:m.email,onChange:s=>f(t=>({...t,email:s.target.value})),placeholder:"seu@email.com"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"phone",children:"Telefone/WhatsApp *"}),e.jsx(d,{id:"phone",value:m.phone,onChange:s=>f(t=>({...t,phone:s.target.value})),placeholder:"(11) 99999-9999"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"document",children:"CPF"}),e.jsx(d,{id:"document",value:m.document,onChange:s=>f(t=>({...t,document:s.target.value})),placeholder:"000.000.000-00"})]})]})]}),r===2&&e.jsxs(p,{children:[e.jsx(N,{children:e.jsx(y,{children:"Endereço de Entrega"})}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{htmlFor:"street",children:"Rua/Avenida *"}),e.jsx(d,{id:"street",value:l.street,onChange:s=>h(t=>({...t,street:s.target.value})),placeholder:"Nome da rua"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"number",children:"Número *"}),e.jsx(d,{id:"number",value:l.number,onChange:s=>h(t=>({...t,number:s.target.value})),placeholder:"123"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"complement",children:"Complemento"}),e.jsx(d,{id:"complement",value:l.complement,onChange:s=>h(t=>({...t,complement:s.target.value})),placeholder:"Apto 45"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"neighborhood",children:"Bairro *"}),e.jsx(d,{id:"neighborhood",value:l.neighborhood,onChange:s=>h(t=>({...t,neighborhood:s.target.value})),placeholder:"Centro"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"city",children:"Cidade *"}),e.jsx(d,{id:"city",value:l.city,onChange:s=>h(t=>({...t,city:s.target.value})),placeholder:"São Paulo"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"state",children:"Estado *"}),e.jsx(d,{id:"state",value:l.state,onChange:s=>h(t=>({...t,state:s.target.value})),placeholder:"SP",maxLength:2})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"zipCode",children:"CEP *"}),e.jsx(d,{id:"zipCode",value:l.zipCode,onChange:s=>h(t=>({...t,zipCode:s.target.value})),placeholder:"00000-000"})]})]})})]}),r===3&&e.jsxs(p,{children:[e.jsx(N,{children:e.jsx(y,{children:"Forma de Pagamento"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${g==="PIX"?"border-blue-500 bg-blue-50":"border-gray-300"}`,onClick:()=>k("PIX"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"PIX"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pagamento instantâneo"})]})]})}),e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${g==="CREDIT_CARD"?"border-blue-500 bg-blue-50":"border-gray-300"}`,onClick:()=>k("CREDIT_CARD"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Cartão de Crédito"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visa, Mastercard, Elo"})]})]})}),e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${g==="BOLETO"?"border-blue-500 bg-blue-50":"border-gray-300"}`,onClick:()=>k("BOLETO"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Boleto Bancário"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pagamento em até 3 dias úteis"})]})]})})]}),g==="CREDIT_CARD"&&e.jsxs("div",{children:[e.jsx(i,{htmlFor:"installments",children:"Parcelas"}),e.jsx("select",{id:"installments",value:T,onChange:s=>O(Number(s.target.value)),className:"w-full mt-2 px-3 py-2 border border-gray-300 rounded-lg",children:[1,2,3,4,5,6,7,8,9,10,11,12].map(s=>e.jsxs("option",{value:s,children:[s,"x de R$ ",(o.total/s).toFixed(2)]},s))})]})]})]}),e.jsxs("div",{className:"flex justify-between mt-6",children:[r>1&&e.jsx(b,{variant:"outline",onClick:_,children:"Voltar"}),e.jsx("div",{className:"ml-auto",children:r<3?e.jsx(b,{onClick:V,style:{backgroundColor:a.primaryButtonBackgroundColor||"#FF0080",color:a.primaryButtonTextColor||"#FFFFFF"},children:"Continuar"}):e.jsx(b,{onClick:q,disabled:E,style:{backgroundColor:a.checkoutButtonBackgroundColor||"#0FBA00",color:"#FFFFFF"},children:E?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 animate-spin mr-2"}),"Processando..."]}):"Finalizar Compra"})})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(p,{className:"sticky top-4",children:[e.jsx(N,{children:e.jsx(y,{children:"Resumo do Pedido"})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[o.products.map(s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover rounded-lg"}):e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qtd: ",s.quantity]})]}),e.jsxs("div",{className:"text-sm font-medium",children:["R$ ",(s.price*s.quantity).toFixed(2)]})]},s.id)),e.jsx(z,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["R$ ",o.subtotal.toFixed(2)]})]}),o.tax>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Taxa"}),e.jsxs("span",{children:["R$ ",o.tax.toFixed(2)]})]}),o.shipping>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Frete"}),e.jsxs("span",{children:["R$ ",o.shipping.toFixed(2)]})]}),o.discount&&o.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{children:["-R$ ",o.discount.toFixed(2)]})]}),e.jsx(z,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["R$ ",o.total.toFixed(2)]})]})]})]})})]})})]})})]})};export{je as default};
