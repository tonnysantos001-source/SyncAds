import{i as t,s as e}from"./index-BpYC1zIt.js";import{_ as r,b as a}from"./vendor-charts-DhkUgiCU.js";import{r as n,R as o}from"./vendor-react-X41Bjl18.js";const i=t("outline","brand-openai","BrandOpenai",[["path",{d:"M11.217 19.384a3.501 3.501 0 0 0 6.783 -1.217v-5.167l-6 -3.35",key:"svg-0"}],["path",{d:"M5.214 15.014a3.501 3.501 0 0 0 4.446 5.266l4.34 -2.534v-6.946",key:"svg-1"}],["path",{d:"M6 7.63c-1.391 -.236 -2.787 .395 -3.534 1.689a3.474 3.474 0 0 0 1.271 4.745l4.263 2.514l6 -3.348",key:"svg-2"}],["path",{d:"M12.783 4.616a3.501 3.501 0 0 0 -6.783 1.217v5.067l6 3.45",key:"svg-3"}],["path",{d:"M18.786 8.986a3.501 3.501 0 0 0 -4.446 -5.266l-4.34 2.534v6.946",key:"svg-4"}],["path",{d:"M18 16.302c1.391 .236 2.787 -.395 3.534 -1.689a3.474 3.474 0 0 0 -1.271 -4.745l-4.308 -2.514l-5.955 3.42",key:"svg-5"}]]),s=t("outline","menu-2","Menu2",[["path",{d:"M4 6l16 0",key:"svg-0"}],["path",{d:"M4 12l16 0",key:"svg-1"}],["path",{d:"M4 18l16 0",key:"svg-2"}]]),c=t("outline","messages","Messages",[["path",{d:"M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10",key:"svg-0"}],["path",{d:"M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2",key:"svg-1"}]]),d=t("outline","plus","Plus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]),l=t("outline","send","Send",[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]]),u=t("outline","trash","Trash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]),h=t("outline","user-circle","UserCircle",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M12 10m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-1"}],["path",{d:"M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855",key:"svg-2"}]]);var g=n.useLayoutEffect,f=function(t,e){"function"!=typeof t?t.current=e:t(e)},v={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},p=function(t){Object.keys(v).forEach(function(e){t.style.setProperty(e,v[e],"important")})},y=null,w=function(t,e){var r=t.scrollHeight;return"border-box"===e.sizingStyle.boxSizing?r+e.borderSize:r-e.paddingSize};var m=function(){},b=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],C=!!document.documentElement.currentStyle,k=function(t){var e=window.getComputedStyle(t);if(null===e)return null;var r,a=(r=e,b.reduce(function(t,e){return t[e]=r[e],t},{})),n=a.boxSizing;return""===n?null:(C&&"border-box"===n&&(a.width=parseFloat(a.width)+parseFloat(a.borderRightWidth)+parseFloat(a.borderLeftWidth)+parseFloat(a.paddingRight)+parseFloat(a.paddingLeft)+"px"),{sizingStyle:a,paddingSize:parseFloat(a.paddingBottom)+parseFloat(a.paddingTop),borderSize:parseFloat(a.borderBottomWidth)+parseFloat(a.borderTopWidth)})};function M(t,e,r){var a,i,s=(a=r,i=o.useRef(a),g(function(){i.current=a}),i);n.useLayoutEffect(function(){var r=function(t){return s.current(t)};if(t)return t.addEventListener(e,r),function(){return t.removeEventListener(e,r)}},[])}var S=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],x=function(t,e){var i=t.cacheMeasurements,s=t.maxRows,c=t.minRows,d=t.onChange,l=void 0===d?m:d,u=t.onHeightChange,h=void 0===u?m:u,g=r(t,S),v=void 0!==g.value,b=n.useRef(null),C=function(t,e){var r=o.useRef();return o.useCallback(function(a){t.current=a,r.current&&f(r.current,null),r.current=e,e&&f(e,a)},[e])}(b,e),x=n.useRef(0),z=n.useRef(),E=function(){var t=b.current,e=i&&z.current?z.current:k(t);if(e){z.current=e;var r=function(t,e,r,a){void 0===r&&(r=1),void 0===a&&(a=1/0),y||((y=document.createElement("textarea")).setAttribute("tabindex","-1"),y.setAttribute("aria-hidden","true"),p(y)),null===y.parentNode&&document.body.appendChild(y);var n=t.paddingSize,o=t.borderSize,i=t.sizingStyle,s=i.boxSizing;Object.keys(i).forEach(function(t){var e=t;y.style[e]=i[e]}),p(y),y.value=e;var c=w(y,t);y.value=e,c=w(y,t),y.value="x";var d=y.scrollHeight-n,l=d*r;"border-box"===s&&(l=l+n+o),c=Math.max(l,c);var u=d*a;return"border-box"===s&&(u=u+n+o),[c=Math.min(u,c),d]}(e,t.value||t.placeholder||"x",c,s),a=r[0],n=r[1];x.current!==a&&(x.current=a,t.style.setProperty("height",a+"px","important"),h(a,{rowHeight:n}))}};return n.useLayoutEffect(E),function(t,e){M(document.body,"reset",function(r){t.current.form===r.target&&e(r)})}(b,function(){if(!v){var t=b.current.value;requestAnimationFrame(function(){var e=b.current;e&&t!==e.value&&E()})}}),M(window,"resize",E),function(t){M(document.fonts,"loadingdone",t)}(E),n.createElement("textarea",a({},g,{onChange:function(t){v||E(),l(t)},ref:C}))},z=n.forwardRef(x);const E="https://syncads-python-microservice-production.up.railway.app",R=`${E}/api/chat`;const A=new class{abortController=null;async sendMessage(t,r,a={}){try{this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const o=a.signal||this.abortController.signal,{data:{session:i}}=await e.auth.getSession();if(!i)throw new Error("Usuário não autenticado");const{data:{user:s}}=await e.auth.getUser();if(!s)throw new Error("Usuário não encontrado");const c={message:t,conversationId:r,userId:s.id},d=await fetch(R,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`},body:JSON.stringify(c),signal:o});if(!d.ok){const t=await d.json().catch(()=>({}));throw new Error(t.detail||`HTTP ${d.status}: ${d.statusText}`)}const l=d.body?.getReader();if(!l)throw new Error("Stream not available");const u=new TextDecoder;let h="";for(;;){const{done:t,value:e}=await l.read();if(t)break;const r=u.decode(e,{stream:!0}).split("\n");for(const o of r)if(o.startsWith("data: "))try{const t=JSON.parse(o.substring(6));if(t.text&&(h+=t.text,a.onChunk?.(t.text)),t.done)return a.onComplete?.(h),h;if(t.error)throw new Error(t.error)}catch(n){}}return h}catch(o){throw a.onError?.(o),o}finally{this.abortController=null}}cancel(){this.abortController&&(this.abortController.abort(),this.abortController=null)}async getActiveAI(){try{const{data:t}=await e.from("GlobalAiConnection").select("*").eq("isActive",!0).order("createdAt",{ascending:!0}).limit(1).single();return t||null}catch(t){return null}}async saveMessage(t,r,a){try{const{data:{user:n}}=await e.auth.getUser(),{error:o}=await e.from("ChatMessage").insert({conversationId:t,role:r,content:a,userId:n?.id,createdAt:(new Date).toISOString()})}catch(n){}}async getConversationHistory(t,r=50){try{const{data:a,error:n}=await e.from("ChatMessage").select("*").eq("conversationId",t).order("createdAt",{ascending:!0}).limit(r);if(n)throw n;return a||[]}catch(a){return[]}}async createConversation(t){try{const{data:{user:r}}=await e.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:a,error:n}=await e.from("ChatConversation").insert({userId:r.id,title:t||"Nova conversa",createdAt:(new Date).toISOString()}).select().single();if(n)throw n;return a.id}catch(r){throw r}}async listConversations(t=20){try{const{data:{user:r}}=await e.auth.getUser();if(!r)return[];const{data:a,error:n}=await e.from("ChatConversation").select("*").eq("userId",r.id).order("updatedAt",{ascending:!1}).limit(t);if(n)throw n;return a||[]}catch(r){return[]}}async deleteConversation(t){try{await e.from("ChatMessage").delete().eq("conversationId",t);const{error:r}=await e.from("ChatConversation").delete().eq("id",t);if(r)throw r}catch(r){throw r}}async checkHealth(){try{const t=await fetch(`${E}/health`,{signal:AbortSignal.timeout(5e3)});if(!t.ok)return!1;return"healthy"===(await t.json()).status}catch(t){return!1}}async getServiceInfo(){try{const t=await fetch(`${E}/health`);return await t.json()}catch(t){return null}}};export{i as I,c as a,d as b,A as c,u as d,s as e,h as f,l as g,z as i};
