import{r as n,f as q,u as Q,s as U,j as e,g as m,h as u,i as h,l as j,S as J,I as K,B as v,k as W,n as Y,O as Z}from"./index-u-OuqsGW.js";import{T as _,a as $,b as S,c as i,d as ee,e as o}from"./table-DL2KWOTr.js";import{S as se,a as ae,b as te,c as re,d as f}from"./select-DfJZp1zO.js";import{A as le,a as de}from"./alert-CTKgtfMv.js";import{S as y}from"./skeleton-_WNW99hU.js";import{C as X}from"./clock-wYTJ-HGD.js";import{T as ne}from"./trending-up-CvPAJ6bl.js";import{T as ie}from"./trending-down-BuANSWnF.js";import{D as R}from"./dollar-sign-Cfi-OTPj.js";import{C}from"./circle-alert-BImE7XdU.js";import{f as I,p as P}from"./pt-BR-COO1Bk_c.js";import"./index-Yen4fAIC.js";const ye=()=>{const[r,L]=n.useState([]),[p,B]=n.useState([]),[M,b]=n.useState(!0),[l,k]=n.useState(""),[c,z]=n.useState("all"),{toast:w}=q(),d=Q(s=>s.user);n.useEffect(()=>{E()},[d==null?void 0:d.organizationId]),n.useEffect(()=>{G()},[l,c,r]);const E=async()=>{try{if(!(d!=null&&d.organizationId))return;b(!0);const{data:s,error:a}=await U.from("Transaction").select(`
          *,
          Order:orderId (
            id,
            orderNumber,
            customerName,
            customerEmail
          )
        `).eq("paymentMethod","PIX").eq("organizationId",d.organizationId).order("createdAt",{ascending:!1});if(a)throw a;const g=(s||[]).map(t=>{var A,D,T;return{id:t.id,orderId:t.orderId,orderNumber:((A=t.Order)==null?void 0:A.orderNumber)||t.orderId.substring(0,8),customerName:((D=t.Order)==null?void 0:D.customerName)||"N/A",customerEmail:((T=t.Order)==null?void 0:T.customerEmail)||"N/A",amount:t.amount,pixCopyPaste:t.pixCopyPaste,pixQrCode:t.pixQrCode,status:t.status,expiresAt:t.pixExpiresAt,paidAt:t.paidAt,createdAt:t.createdAt}});L(g)}catch(s){console.error("Erro ao carregar transações PIX:",s),w({title:"Erro ao carregar transações",description:s.message,variant:"destructive"})}finally{b(!1)}},G=()=>{let s=r;l&&(s=s.filter(a=>a.orderNumber.toLowerCase().includes(l.toLowerCase())||a.customerName.toLowerCase().includes(l.toLowerCase())||a.customerEmail.toLowerCase().includes(l.toLowerCase()))),c!=="all"&&(s=s.filter(a=>a.status===c)),B(s)},x=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),H=s=>{const a={PENDING:{label:"Aguardando Pagamento",variant:"secondary",icon:X},PAID:{label:"Pago",variant:"default",icon:Z},EXPIRED:{label:"Expirado",variant:"destructive",icon:C},CANCELLED:{label:"Cancelado",variant:"secondary",icon:C}};return a[s]||a.PENDING},N=r.filter(s=>s.status==="PENDING").reduce((s,a)=>s+a.amount,0),F=r.filter(s=>s.status==="PAID").reduce((s,a)=>s+a.amount,0),O=r.filter(s=>s.status==="EXPIRED").reduce((s,a)=>s+a.amount,0),V=r.length>0?(r.filter(s=>s.status==="PAID").length/r.length*100).toFixed(1):"0";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"PIX Recuperados"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie transações PIX e recupere vendas perdidas"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Aguardando Pagamento"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x(N)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.filter(s=>s.status==="PENDING").length," transação(ões)"]})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"PIX Recuperados"}),e.jsx(ne,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x(F)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.filter(s=>s.status==="PAID").length," pagamentos confirmados"]})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Expirados"}),e.jsx(ie,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x(O)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.filter(s=>s.status==="EXPIRED").length," não recuperados"]})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Taxa de Recuperação"}),e.jsx(R,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[V,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Taxa de conversão de PIX"})]})]})]}),N>0&&e.jsxs(le,{children:[e.jsx(C,{className:"h-4 w-4"}),e.jsxs(de,{children:["Você tem ",e.jsx("strong",{children:x(N)})," em PIX aguardando pagamento. Considere enviar lembretes para os clientes."]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(J,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(K,{placeholder:"Buscar por pedido, cliente ou email...",value:l,onChange:s=>k(s.target.value),className:"pl-9"})]}),e.jsxs(se,{value:c,onValueChange:z,children:[e.jsx(ae,{className:"w-[200px]",children:e.jsx(te,{placeholder:"Status"})}),e.jsxs(re,{children:[e.jsx(f,{value:"all",children:"Todos"}),e.jsx(f,{value:"PENDING",children:"Aguardando"}),e.jsx(f,{value:"PAID",children:"Pago"}),e.jsx(f,{value:"EXPIRED",children:"Expirado"}),e.jsx(f,{value:"CANCELLED",children:"Cancelado"})]})]}),e.jsx(v,{onClick:E,variant:"outline",children:"Atualizar"})]}),e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(h,{children:"Transações PIX"}),e.jsxs(W,{children:[p.length," transação(ões) encontrada(s)"]})]}),e.jsx(j,{children:M?e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"h-12 w-full"}),e.jsx(y,{className:"h-12 w-full"}),e.jsx(y,{className:"h-12 w-full"})]}):p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(R,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhum PIX encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l||c!=="all"?"Tente ajustar os filtros":"Aguardando primeira transação PIX"})]}):e.jsxs(_,{children:[e.jsx($,{children:e.jsxs(S,{children:[e.jsx(i,{children:"Pedido"}),e.jsx(i,{children:"Cliente"}),e.jsx(i,{children:"Valor"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Expira em"}),e.jsx(i,{children:"Data"}),e.jsx(i,{className:"text-right",children:"Ações"})]})}),e.jsx(ee,{children:p.map(s=>{const a=H(s.status),g=a.icon;return e.jsxs(S,{children:[e.jsx(o,{children:e.jsxs("div",{className:"font-mono text-sm",children:["#",s.orderNumber]})}),e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customerName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.customerEmail})]})}),e.jsxs(o,{children:[e.jsx("div",{className:"font-medium",children:x(s.amount)}),s.paidAt&&e.jsxs("div",{className:"text-sm text-green-600",children:["Pago em ",I(new Date(s.paidAt),"dd/MM/yyyy HH:mm",{locale:P})]})]}),e.jsx(o,{children:e.jsxs(Y,{variant:a.variant,className:"gap-1",children:[e.jsx(g,{className:"h-3 w-3"}),a.label]})}),e.jsx(o,{children:s.expiresAt?e.jsx("div",{className:"text-sm",children:I(new Date(s.expiresAt),"dd/MM/yyyy HH:mm",{locale:P})}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"-"})}),e.jsx(o,{children:I(new Date(s.createdAt),"dd/MM/yyyy",{locale:P})}),e.jsx(o,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[s.status==="PENDING"&&s.pixCopyPaste&&e.jsx(v,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(s.pixCopyPaste),w({title:"Chave PIX copiada!"})},children:"Copiar PIX"}),e.jsx(v,{variant:"ghost",size:"sm",children:"Ver detalhes"})]})})]},s.id)})})]})})]})]})};export{ye as default};
