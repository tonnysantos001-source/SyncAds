import{j as e}from"./vendor-ui-DkUuACDy.js";import{r as t,R as a,f as r}from"./vendor-react-X41Bjl18.js";import{_ as s,b as o}from"./vendor-charts-DhkUgiCU.js";import{j as n,s as i,f as l,G as c,g as d,i as u,h}from"./index-30frLICg.js";import{S as m}from"./SuperAdminLayout-DqwttlSo.js";import{A as g,m as p}from"./vendor-animation-DQ3cvw6m.js";import{I as x,a as v,b as f}from"./IconSend-CIJDRtKF.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-supabase-BQxDPPjR.js";import"./vendor-query-Bf3pI66S.js";import"./vendor-icons-DTdRnryx.js";const b=n("outline","brand-openai","BrandOpenai",[["path",{d:"M11.217 19.384a3.501 3.501 0 0 0 6.783 -1.217v-5.167l-6 -3.35",key:"svg-0"}],["path",{d:"M5.214 15.014a3.501 3.501 0 0 0 4.446 5.266l4.34 -2.534v-6.946",key:"svg-1"}],["path",{d:"M6 7.63c-1.391 -.236 -2.787 .395 -3.534 1.689a3.474 3.474 0 0 0 1.271 4.745l4.263 2.514l6 -3.348",key:"svg-2"}],["path",{d:"M12.783 4.616a3.501 3.501 0 0 0 -6.783 1.217v5.067l6 3.45",key:"svg-3"}],["path",{d:"M18.786 8.986a3.501 3.501 0 0 0 -4.446 -5.266l-4.34 2.534v6.946",key:"svg-4"}],["path",{d:"M18 16.302c1.391 .236 2.787 -.395 3.534 -1.689a3.474 3.474 0 0 0 -1.271 -4.745l-4.308 -2.514l-5.955 3.42",key:"svg-5"}]]),y=n("outline","messages","Messages",[["path",{d:"M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10",key:"svg-0"}],["path",{d:"M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2",key:"svg-1"}]]),w=n("outline","shield-check","ShieldCheck",[["path",{d:"M11.46 20.846a12 12 0 0 1 -7.96 -14.846a12 12 0 0 0 8.5 -3a12 12 0 0 0 8.5 3a12 12 0 0 1 -.09 7.06",key:"svg-0"}],["path",{d:"M15 19l2 2l4 -4",key:"svg-1"}]]),j=n("outline","trash","Trash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]),N=n("outline","user-circle","UserCircle",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M12 10m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-1"}],["path",{d:"M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855",key:"svg-2"}]]);var C=t.useLayoutEffect,k=function(e,t){"function"!=typeof e?e.current=t:e(t)},S={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},A=function(e){Object.keys(S).forEach(function(t){e.style.setProperty(t,S[t],"important")})},M=null,E=function(e,t){var a=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?a+t.borderSize:a-t.paddingSize};var T=function(){},z=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],I=!!document.documentElement.currentStyle,R=function(e){var t=window.getComputedStyle(e);if(null===t)return null;var a,r=(a=t,z.reduce(function(e,t){return e[t]=a[t],e},{})),s=r.boxSizing;return""===s?null:(I&&"border-box"===s&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px"),{sizingStyle:r,paddingSize:parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),borderSize:parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth)})};function H(e,r,s){var o,n,i=(o=s,n=a.useRef(o),C(function(){n.current=o}),n);t.useLayoutEffect(function(){var t=function(e){return i.current(e)};if(e)return e.addEventListener(r,t),function(){return e.removeEventListener(r,t)}},[])}var F=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],L=function(e,r){var n=e.cacheMeasurements,i=e.maxRows,l=e.minRows,c=e.onChange,d=void 0===c?T:c,u=e.onHeightChange,h=void 0===u?T:u,m=s(e,F),g=void 0!==m.value,p=t.useRef(null),x=function(e,t){var r=a.useRef();return a.useCallback(function(a){e.current=a,r.current&&k(r.current,null),r.current=t,t&&k(t,a)},[t])}(p,r),v=t.useRef(0),f=t.useRef(),b=function(){var e=p.current,t=n&&f.current?f.current:R(e);if(t){f.current=t;var a=function(e,t,a,r){void 0===a&&(a=1),void 0===r&&(r=1/0),M||((M=document.createElement("textarea")).setAttribute("tabindex","-1"),M.setAttribute("aria-hidden","true"),A(M)),null===M.parentNode&&document.body.appendChild(M);var s=e.paddingSize,o=e.borderSize,n=e.sizingStyle,i=n.boxSizing;Object.keys(n).forEach(function(e){var t=e;M.style[t]=n[t]}),A(M),M.value=t;var l=E(M,e);M.value=t,l=E(M,e),M.value="x";var c=M.scrollHeight-s,d=c*a;"border-box"===i&&(d=d+s+o),l=Math.max(d,l);var u=c*r;return"border-box"===i&&(u=u+s+o),[l=Math.min(u,l),c]}(t,e.value||e.placeholder||"x",l,i),r=a[0],s=a[1];v.current!==r&&(v.current=r,e.style.setProperty("height",r+"px","important"),h(r,{rowHeight:s}))}};return t.useLayoutEffect(b),function(e,t){H(document.body,"reset",function(a){e.current.form===a.target&&t(a)})}(p,function(){if(!g){var e=p.current.value;requestAnimationFrame(function(){var t=p.current;t&&e!==t.value&&b()})}}),H(window,"resize",b),function(e){H(document.fonts,"loadingdone",e)}(b),t.createElement("textarea",o({},m,{onChange:function(e){g||b(),d(e)},ref:x}))},U=t.forwardRef(L);const W=new class{abortController=null;async sendMessage(e,t,a={}){try{this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const s=a.signal||this.abortController.signal,{data:{session:o},error:n}=await i.auth.getSession();if(n||!o)throw new Error("Usuário não autenticado");const{data:{user:l},error:c}=await i.auth.getUser();if(c||!l)throw new Error("Usuário não encontrado");const{data:d,error:u}=await i.from("ChatMessage").select("role, content").eq("conversationId",t).order("createdAt",{ascending:!0}).limit(20),h={message:e,conversationId:t,conversationHistory:d?.map(e=>({role:e.role.toLowerCase(),content:e.content}))||[],systemPrompt:void 0},m=await fetch("https://your-project.supabase.co/functions/v1/chat-enhanced",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.access_token}`,apikey:"your-anon-key"},body:JSON.stringify(h),signal:s});if(!m.ok){const e=await m.text();let t=`HTTP ${m.status}: ${m.statusText}`;try{const a=JSON.parse(e);t=a.error||a.message||t}catch(r){e&&(t=e)}throw new Error(t)}const g=await m.json();if(g.error)throw new Error(g.error);if(!g.response||"Sem resposta da IA"===g.response)throw new Error("IA não configurada ou sem resposta. Configure uma IA em Configurações > IA Global.");const p=g.response;if(a.onChunk){const e=p.split(" ");for(let t=0;t<e.length;t+=2){const r=e.slice(t,t+2).join(" ");a.onChunk(r+" "),await new Promise(e=>setTimeout(e,10))}}return a.onComplete&&a.onComplete(p),p}catch(s){if(a.onError&&a.onError(s),"AbortError"===s.name)throw new Error("Request cancelado");throw s}finally{this.abortController=null}}abort(){this.abortController&&(this.abortController.abort(),this.abortController=null)}async saveMessage(e,t,a){try{const{data:{user:r}}=await i.auth.getUser();if(!r)throw new Error("Usuário não autenticado");const s={id:crypto.randomUUID(),conversationId:e,role:t.toUpperCase(),content:a,userId:r.id,createdAt:(new Date).toISOString()},{data:o,error:n}=await i.from("ChatMessage").insert(s).select().single();return n?null:o}catch(r){return null}}async getConversationMessages(e){try{const{data:t,error:a}=await i.from("ChatMessage").select("*").eq("conversationId",e).order("createdAt",{ascending:!0});return a?[]:t||[]}catch(t){return[]}}async isAIConfigured(){try{const{data:e,error:t}=await i.from("GlobalAiConnection").select("id, isActive").eq("isActive",!0).limit(1).maybeSingle();if(t)return!1;return!!e}catch(e){return!1}}},q=2e3;function B(){const[a,s]=t.useState(""),[o,n]=t.useState(!0),[C,k]=t.useState(!0),S=l(e=>e.user),A=l(e=>e.isAuthenticated),M=r(),E=c(e=>e.conversations),T=c(e=>e.activeConversationId),z=c(e=>e.setActiveConversationId),I=c(e=>e.isAssistantTyping),R=c(e=>e.setAssistantTyping),H=c(e=>e.addMessage),F=t.useRef(null),{toast:L}=d(),B=E.find(e=>e.id===T);t.useEffect(()=>{A&&S||M("/login-v2",{replace:!0})},[A,S,M]);t.useEffect(()=>{F.current?.scrollIntoView({behavior:"smooth"})},[B?.messages,I]),t.useEffect(()=>{(async()=>{if(S)try{k(!0),await c.getState().loadConversations(S.id);const{data:e,error:t}=await i.from("ChatConversation").select("id").eq("userId",S.id).limit(1);if(t)throw t;e&&0!==e.length||await c.getState().createNewConversation(S.id,"Chat Admin")}catch(e){L({title:"Erro ao carregar chat",description:"Não foi possível carregar as conversas. Tente recarregar a página.",variant:"destructive"})}finally{k(!1)}})()},[S,L]);const D=t.useCallback(async()=>{if(""===a.trim()||!T||a.length>q)return;const e=a;S&&H(S.id,T,{id:`msg-${Date.now()}`,role:"user",content:e}),s(""),R(!0);try{let t="";if(t=await W.sendMessage(e,T),S){const e=`msg-${Date.now()+1}`;H(S.id,T,{id:e,role:"assistant",content:""});const a=t.split(" ");let r="";for(let t=0;t<a.length;t+=2){r+=(t>0?" ":"")+a.slice(t,t+2).join(" "),H(S.id,T,{id:e,role:"assistant",content:r}),await new Promise(e=>setTimeout(e,20))}H(S.id,T,{id:e,role:"assistant",content:t})}}catch(t){L({title:"Erro ao enviar",description:t.message||"Não foi possível enviar a mensagem.",variant:"destructive"})}finally{R(!1)}},[T,a,S,B?.messages,L,H,R]);return e.jsx(m,{children:e.jsxs("div",{className:"h-[calc(100vh-4rem)] flex bg-[#0A0A0F] overflow-hidden",children:[e.jsx(g,{children:o&&e.jsxs(p.div,{initial:{x:-320,opacity:0},animate:{x:0,opacity:1},exit:{x:-320,opacity:0},transition:{type:"spring",damping:25,stiffness:200},className:"fixed md:relative w-80 h-full bg-[#12121A]/95 backdrop-blur-xl border-r border-gray-700/50 flex flex-col z-50 shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700/50 bg-gradient-to-b from-gray-800/50 to-transparent",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(w,{className:"w-6 h-6 text-blue-400"}),"Admin Chat"]}),e.jsx(p.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:()=>n(!1),className:"p-2 rounded-lg hover:bg-gray-800/50 text-gray-400 hover:text-white transition-all",children:e.jsx(u,{className:"w-5 h-5"})})]}),e.jsxs(p.button,{whileHover:{scale:1.02,boxShadow:"0 0 25px rgba(59, 130, 246, 0.5)"},whileTap:{scale:.98},onClick:async()=>{try{if(!S)return;await c.getState().createNewConversation(S.id,"Nova Conversa Admin"),await c.getState().loadConversations(S.id),L({title:"Nova conversa criada",description:"Uma nova conversa foi iniciada.",variant:"success"})}catch(e){L({title:"Erro",description:"Não foi possível criar nova conversa.",variant:"destructive"})}},className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl px-4 py-3 flex items-center justify-center gap-2 font-medium transition-all shadow-lg shadow-blue-500/30",children:[e.jsx(x,{className:"w-5 h-5"}),"Nova Conversa"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:E.map(t=>e.jsx(p.div,{whileHover:{scale:1.02,x:4},onClick:()=>z(t.id),className:h("p-3 rounded-xl cursor-pointer transition-all group relative",T===t.id?"bg-gradient-to-r from-blue-600/20 to-purple-600/20 border border-blue-500/50 shadow-lg shadow-blue-500/20":"bg-gray-800/30 hover:bg-gray-800/50 border border-transparent"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium text-sm truncate",children:t.title}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.messages&&t.messages.length>0?t.messages[t.messages.length-1].content.substring(0,35)+"...":"Nova conversa"})]}),e.jsx(p.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:e=>{e.stopPropagation(),(async e=>{try{await c.getState().deleteConversation(e),T===e&&S&&await c.getState().loadConversations(S.id),L({title:"Conversa deletada",description:"A conversa foi removida com sucesso.",variant:"success"})}catch(t){}})(t.id)},className:"opacity-0 group-hover:opacity-100 p-2 rounded-lg hover:bg-red-500/20 text-red-400 transition-all",children:e.jsx(j,{className:"w-4 h-4"})})]})},t.id))})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#12121A] to-[#1A1A2E] border-b border-gray-700/50 px-6 py-4 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[!o&&e.jsx(p.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>n(!0),className:"p-2 rounded-lg hover:bg-gray-800/50 text-gray-400 hover:text-white transition-all",children:e.jsx(v,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(w,{className:"w-6 h-6 text-blue-400"}),"Admin AI Assistant"]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Sistema especializado para administradores"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4 bg-[#0A0A0F] custom-scrollbar",children:C?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-16 h-16 border-4 border-blue-500/30 border-t-blue-500 rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg font-medium",children:"Carregando conversas..."}),e.jsx("p",{className:"text-gray-600 text-sm mt-2",children:"Aguarde enquanto configuramos seu chat"})]})}):B&&B.messages?e.jsxs(e.Fragment,{children:[B.messages.map(t=>e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:h("flex","user"===t.role?"justify-end":"justify-start"),children:e.jsxs("div",{className:h("max-w-[80%] rounded-2xl p-4 backdrop-blur-sm","user"===t.role?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg shadow-blue-500/20 border border-blue-400/30":"bg-gray-800/50 text-gray-200 border border-gray-700/30"),children:[e.jsxs("div",{className:"flex items-start gap-3",children:["assistant"===t.role&&e.jsx(p.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},whileHover:{rotate:10,scale:1.1},className:"flex-shrink-0",children:e.jsx(b,{className:"w-6 h-6 text-blue-400"})}),"user"===t.role&&e.jsx(p.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},whileHover:{scale:1.1},className:"flex-shrink-0",children:e.jsx(N,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"flex-1 whitespace-pre-wrap break-words",children:t.content})]}),e.jsx("div",{className:h("text-xs mt-2 ml-9","user"===t.role?"text-white/60":"text-gray-500"),children:t.timestamp?new Date(t.timestamp).toLocaleTimeString("pt-BR"):""})]})},t.id)),I&&e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-start",children:e.jsx("div",{className:"max-w-[80%] bg-gray-800/50 rounded-2xl p-4 border border-gray-700/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"w-6 h-6 text-blue-400 animate-pulse"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(p.div,{animate:{y:[0,-8,0]},transition:{duration:.6,repeat:1/0,delay:0},className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsx(p.div,{animate:{y:[0,-8,0]},transition:{duration:.6,repeat:1/0,delay:.2},className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsx(p.div,{animate:{y:[0,-8,0]},transition:{duration:.6,repeat:1/0,delay:.4},className:"w-2 h-2 bg-blue-400 rounded-full"})]})]})})}),e.jsx("div",{ref:F})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma conversa selecionada"}),e.jsx("p",{className:"text-gray-600 text-sm mt-2",children:"Crie uma nova conversa para começar"})]})})}),e.jsx("div",{className:"border-t border-gray-700/50 bg-[#12121A]/50 backdrop-blur-xl p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx(U,{value:a,onChange:e=>s(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),D())},placeholder:"Digite sua mensagem admin...",maxRows:6,className:"w-full bg-gray-800/50 border-2 border-gray-700/50 focus:border-blue-500/50 rounded-2xl px-6 py-4 pr-14 text-white placeholder-gray-500 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all"}),e.jsx(p.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:D,disabled:""===a.trim()||I||a.length>q,className:"absolute right-3 bottom-3 p-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 rounded-xl text-white disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-blue-500/30",children:e.jsx(f,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 px-2",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[a.length,"/",q," caracteres"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Shift + Enter para nova linha"})]})]})})]})]})})}export{B as default};
