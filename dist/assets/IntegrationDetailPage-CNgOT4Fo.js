import{s as a,m as X,e as D,u as F,Z as B,f as R,r as w,j as s,B as g,W,Y as G,g as v,h as N,i as A,k as C,n as q,l as j,N as k,I as J}from"./index-u-OuqsGW.js";import{L as M}from"./label-BdwxPQB7.js";import{A as T,a as I}from"./alert-CTKgtfMv.js";import{C as O}from"./circle-x-B8dtlsJn.js";import{S as $}from"./shopping-bag-DOfeoedd.js";import{S as K}from"./store-BCvuEF0D.js";import{A as H}from"./arrow-left-CoB6s1CX.js";import{C as b}from"./circle-check-DGNgB8a5.js";import{C as P}from"./circle-alert-BImE7XdU.js";import{C as U}from"./copy-BQDz9Bb2.js";import{E as Y}from"./external-link-DyHlS1Y_.js";import{E as Z}from"./eye-off-jIS4Wy3W.js";import{E as Q}from"./eye-jPw59qvO.js";const ee={async startOAuth(e){var t,r;try{const c=(t=(await a.auth.getUser()).data.user)==null?void 0:t.id;if(!c)throw new Error("User not authenticated");return(await fetch(`https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/shopify-oauth?action=install&shop=${e}&userId=${c}`,{headers:{Authorization:`Bearer ${(r=(await a.auth.getSession()).data.session)==null?void 0:r.access_token}`}})).json()}catch(o){throw console.error("Error starting Shopify OAuth:",o),o}},async connect(e,t,r,o){var c,i;try{const d=await a.auth.getSession(),p=(c=(await a.auth.getUser()).data.user)==null?void 0:c.id;if(!p)return{success:!1,error:"User not authenticated"};e.includes(".myshopify.com")||(e=`${e}.myshopify.com`);const x=e.replace(".myshopify.com","");try{const y=await(await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/shopify-oauth?action=validate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(i=d.data.session)==null?void 0:i.access_token}`},body:JSON.stringify({shopDomain:e,accessToken:t})})).json();if(!y.success)return{success:!1,error:y.error||"Erro ao validar credenciais com Shopify"}}catch(l){return console.error("Error validating Shopify credentials:",l),{success:!1,error:"Erro ao validar credenciais. Verifique se estão corretas."}}const{data:S,error:f}=await a.from("ShopifyIntegration").upsert({userId:p,shopName:x,shopDomain:e,accessToken:t,apiKey:r,apiSecret:o,scope:"read_products,write_products,read_orders,write_orders,read_customers,write_customers",isActive:!0,updatedAt:new Date().toISOString()}).select().single();return f?(console.error("Error saving Shopify integration:",f),{success:!1,error:f.message}):{success:!0,data:S}}catch(d){return console.error("Error connecting to Shopify:",d),{success:!1,error:d.message||"Erro desconhecido"}}},async testConnection(e,t){var r;try{const o=await a.auth.getSession(),c=e.includes(".myshopify.com")?e:`${e}.myshopify.com`,d=await(await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/shopify-oauth?action=validate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(r=o.data.session)==null?void 0:r.access_token}`},body:JSON.stringify({shopDomain:c,accessToken:t})})).json();return d.success?{success:!0,message:d.message||"Conectado com sucesso",data:d.data}:{success:!1,message:d.error||"Erro ao validar credenciais"}}catch(o){return{success:!1,message:`Erro ao conectar com Shopify: ${o.message}`}}},async getActiveIntegration(){return this.getStatus()},async getStatus(){var e;try{const r=(e=(await a.auth.getUser()).data.user)==null?void 0:e.id;if(!r)return null;const{data:o,error:c}=await a.from("ShopifyIntegration").select("*").eq("userId",r).eq("isActive",!0).single();if(c&&c.code!=="PGRST116")throw c;return o}catch(t){return console.error("Error getting Shopify status:",t),null}},async sync(e="sync-all"){var t;try{const r=await this.getStatus();if(!r)throw new Error("No integration found");const o=await a.auth.getSession();return(await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/shopify-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(t=o.data.session)==null?void 0:t.access_token}`},body:JSON.stringify({integrationId:r.id,action:e})})).json()}catch(r){throw console.error("Error syncing Shopify:",r),r}},async disconnect(){var e;try{const r=(e=(await a.auth.getUser()).data.user)==null?void 0:e.id;if(!r)throw new Error("User not authenticated");const{error:o}=await a.from("ShopifyIntegration").update({isActive:!1,updatedAt:new Date().toISOString()}).eq("userId",r).eq("isActive",!0);if(o)throw o;return{success:!0}}catch(t){throw console.error("Error disconnecting Shopify:",t),t}},async getStats(){var e;try{const r=(e=(await a.auth.getUser()).data.user)==null?void 0:e.id;if(!r)return null;const[o,c,i]=await Promise.all([this.getStatus(),a.from("ShopifyProduct").select("id",{count:"exact",head:!0}).eq("userId",r),a.from("ShopifyOrder").select("id",{count:"exact",head:!0}).eq("userId",r)]);return{connected:!!o,shopName:o==null?void 0:o.shopName,lastSync:o==null?void 0:o.lastSyncAt,productsCount:c.count||0,ordersCount:i.count||0}}catch(t){return console.error("Error getting Shopify stats:",t),null}},async syncProducts(){try{const e=await this.getActiveIntegration();if(!e)throw new Error("Nenhuma integração Shopify ativa encontrada");const t=`https://${e.shopName}.myshopify.com`,r=[];let o=null;do{const i=o?`${t}/admin/api/2023-10/products.json?limit=250&page_info=${o}`:`${t}/admin/api/2023-10/products.json?limit=250`,d=await fetch(i,{headers:{"X-Shopify-Access-Token":e.accessToken,"Content-Type":"application/json"}});if(!d.ok)throw new Error(`Erro ao buscar produtos: ${d.statusText}`);const h=await d.json();r.push(...h.products);const p=d.headers.get("Link");if(o=null,p){const x=p.match(/<[^>]*page_info=([^&>]+)/);x&&(o=x[1])}}while(o);const{error:c}=await a.from("ShopifyProduct").upsert(r.map(i=>({id:i.id,organizationId:e.organizationId,title:i.title,handle:i.handle,description:i.body_html,vendor:i.vendor,productType:i.product_type,tags:i.tags?i.tags.split(",").map(d=>d.trim()):[],status:i.status,shopifyData:i,createdAt:i.created_at,updatedAt:i.updated_at})),{onConflict:"id,organizationId"});if(c)throw c;return await a.from("ShopifyIntegration").update({lastSyncAt:new Date().toISOString(),updatedAt:new Date().toISOString()}).eq("id",e.id),{success:!0,message:`${r.length} produtos sincronizados com sucesso`,data:{productCount:r.length,lastSyncAt:new Date().toISOString()}}}catch(e){throw console.error("Error syncing Shopify products:",e),e}},async getProducts(e){try{let t=a.from("ShopifyProduct").select("*").order("updatedAt",{ascending:!1});e!=null&&e.status&&(t=t.eq("status",e.status)),e!=null&&e.vendor&&(t=t.eq("vendor",e.vendor)),e!=null&&e.productType&&(t=t.eq("productType",e.productType)),e!=null&&e.search&&(t=t.or(`title.ilike.%${e.search}%,handle.ilike.%${e.search}%`));const{data:r,error:o}=await t;if(o)throw o;return r}catch(t){throw console.error("Error getting Shopify products:",t),t}},async createOrder(e){var t;try{const r=await this.getActiveIntegration();if(!r)throw new Error("Nenhuma integração Shopify ativa encontrada");const o=`https://${r.shopName}.myshopify.com`,c={order:{line_items:e.lineItems,customer:e.customer,shipping_address:e.shippingAddress,billing_address:e.billingAddress,note:e.note,tags:(t=e.tags)==null?void 0:t.join(", "),financial_status:"pending",send_receipt:!0,send_fulfillment_receipt:!1}},i=await fetch(`${o}/admin/api/2023-10/orders.json`,{method:"POST",headers:{"X-Shopify-Access-Token":r.accessToken,"Content-Type":"application/json"},body:JSON.stringify(c)});if(!i.ok){const h=await i.json();throw new Error(`Erro ao criar pedido: ${h.errors||i.statusText}`)}return{success:!0,message:"Pedido criado com sucesso no Shopify",data:(await i.json()).order}}catch(r){throw console.error("Error creating Shopify order:",r),r}},async getOrders(e){try{const t=await this.getActiveIntegration();if(!t)throw new Error("Nenhuma integração Shopify ativa encontrada");let o=`${`https://${t.shopName}.myshopify.com`}/admin/api/2023-10/orders.json?limit=${(e==null?void 0:e.limit)||50}`;e!=null&&e.status&&(o+=`&status=${e.status}`),e!=null&&e.financialStatus&&(o+=`&financial_status=${e.financialStatus}`),e!=null&&e.startDate&&(o+=`&created_at_min=${e.startDate}`),e!=null&&e.endDate&&(o+=`&created_at_max=${e.endDate}`);const c=await fetch(o,{headers:{"X-Shopify-Access-Token":t.accessToken,"Content-Type":"application/json"}});if(!c.ok)throw new Error(`Erro ao buscar pedidos: ${c.statusText}`);return(await c.json()).orders}catch(t){throw console.error("Error getting Shopify orders:",t),t}},async setupWebhooks(){try{const e=await this.getActiveIntegration();if(!e)throw new Error("Nenhuma integração Shopify ativa encontrada");const t=`https://${e.shopName}.myshopify.com`,r=`${Deno.env.get("SUPABASE_URL")}/functions/v1/shopify-webhook`,o=[{topic:"orders/create",address:r,format:"json"},{topic:"orders/updated",address:r,format:"json"},{topic:"orders/paid",address:r,format:"json"},{topic:"orders/cancelled",address:r,format:"json"}],c=[];for(const i of o)try{const d=await fetch(`${t}/admin/api/2023-10/webhooks.json`,{method:"POST",headers:{"X-Shopify-Access-Token":e.accessToken,"Content-Type":"application/json"},body:JSON.stringify({webhook:i})});if(d.ok){const h=await d.json();c.push({topic:i.topic,success:!0,webhookId:h.webhook.id})}else c.push({topic:i.topic,success:!1,error:d.statusText})}catch(d){c.push({topic:i.topic,success:!1,error:d.message})}return{success:!0,message:"Webhooks configurados",data:c}}catch(e){throw console.error("Error setting up Shopify webhooks:",e),e}}},te={async connect(e,t,r,o="vtexcommercestable"){var c;try{const i=await a.auth.getSession();return await(await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/vtex-connect",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(c=i.data.session)==null?void 0:c.access_token}`},body:JSON.stringify({accountName:e,appKey:t,appToken:r,environment:o})})).json()}catch(i){throw console.error("VTEX connect error:",i),new Error(i.message||"Failed to connect to VTEX")}},async getStatus(){try{const{data:e}=await a.auth.getUser();if(!e.user)throw new Error("Not authenticated");const{data:t,error:r}=await a.from("VtexIntegration").select("*").eq("userId",e.user.id).eq("isActive",!0).single();if(r&&r.code!=="PGRST116")throw r;return t}catch(e){return console.error("Get VTEX status error:",e),null}},async sync(e="sync-all"){var t;try{const r=await this.getStatus();if(!r)throw new Error("No active VTEX integration found");const o=await a.auth.getSession();return await(await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/vtex-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(t=o.data.session)==null?void 0:t.access_token}`},body:JSON.stringify({integrationId:r.id,action:e})})).json()}catch(r){throw console.error("VTEX sync error:",r),new Error(r.message||"Failed to sync VTEX data")}},async disconnect(){try{const{data:e}=await a.auth.getUser();if(!e.user)throw new Error("Not authenticated");const{error:t}=await a.from("VtexIntegration").update({isActive:!1,updatedAt:new Date().toISOString()}).eq("userId",e.user.id).eq("isActive",!0);if(t)throw t;return{success:!0}}catch(e){throw console.error("VTEX disconnect error:",e),new Error(e.message||"Failed to disconnect VTEX")}},async getProducts(e=50){try{const{data:t}=await a.auth.getUser();if(!t.user)throw new Error("Not authenticated");const{data:r,error:o}=await a.from("VtexProduct").select("*").eq("userId",t.user.id).order("updatedAt",{ascending:!1}).limit(e);if(o)throw o;return r||[]}catch(t){throw console.error("Get VTEX products error:",t),new Error(t.message||"Failed to fetch VTEX products")}},async getOrders(e=50){try{const{data:t}=await a.auth.getUser();if(!t.user)throw new Error("Not authenticated");const{data:r,error:o}=await a.from("VtexOrder").select("*").eq("userId",t.user.id).order("createdAt",{ascending:!1}).limit(e);if(o)throw o;return r||[]}catch(t){throw console.error("Get VTEX orders error:",t),new Error(t.message||"Failed to fetch VTEX orders")}},async getStats(){try{const{data:e}=await a.auth.getUser();if(!e.user)throw new Error("Not authenticated");const t=await this.getStatus(),{count:r}=await a.from("VtexProduct").select("id",{count:"exact",head:!0}).eq("userId",e.user.id),{count:o}=await a.from("VtexOrder").select("id",{count:"exact",head:!0}).eq("userId",e.user.id);return{connected:!!t,accountName:t==null?void 0:t.accountName,lastSync:t==null?void 0:t.lastSyncAt,productsCount:r||0,ordersCount:o||0}}catch(e){return console.error("Get VTEX stats error:",e),{connected:!1,productsCount:0,ordersCount:0}}}},se={async connect(e,t,r){var o;try{const c=await a.auth.getSession();return await(await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/nuvemshop-connect",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(o=c.data.session)==null?void 0:o.access_token}`},body:JSON.stringify({storeId:e,storeName:t,accessToken:r})})).json()}catch(c){throw new Error(c.message||"Failed to connect to Nuvemshop")}},async getStatus(){try{const{data:e}=await a.auth.getUser();if(!e.user)return null;const{data:t,error:r}=await a.from("NuvemshopIntegration").select("*").eq("userId",e.user.id).eq("isActive",!0).single();if(r&&r.code!=="PGRST116")throw r;return t}catch{return null}},async sync(e="sync-all"){var t;try{const r=await this.getStatus();if(!r)throw new Error("No active integration");const o=await a.auth.getSession();return await(await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/nuvemshop-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(t=o.data.session)==null?void 0:t.access_token}`},body:JSON.stringify({integrationId:r.id,action:e})})).json()}catch(r){throw new Error(r.message||"Failed to sync")}},async disconnect(){try{const{data:e}=await a.auth.getUser();if(!e.user)throw new Error("Not authenticated");const{error:t}=await a.from("NuvemshopIntegration").update({isActive:!1,updatedAt:new Date().toISOString()}).eq("userId",e.user.id).eq("isActive",!0);if(t)throw t;return{success:!0}}catch(e){throw new Error(e.message||"Failed to disconnect")}},async getProducts(e=50){try{const{data:t}=await a.auth.getUser();if(!t.user)return[];const{data:r,error:o}=await a.from("NuvemshopProduct").select("*").eq("userId",t.user.id).order("updatedAt",{ascending:!1}).limit(e);if(o)throw o;return r||[]}catch{return[]}},async getOrders(e=50){try{const{data:t}=await a.auth.getUser();if(!t.user)return[];const{data:r,error:o}=await a.from("NuvemshopOrder").select("*").eq("userId",t.user.id).order("createdAt",{ascending:!1}).limit(e);if(o)throw o;return r||[]}catch{return[]}}},re={async connect(e,t,r){var o;try{const c=await a.auth.getSession();return await(await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/woocommerce-connect",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(o=c.data.session)==null?void 0:o.access_token}`},body:JSON.stringify({siteUrl:e,consumerKey:t,consumerSecret:r})})).json()}catch(c){throw new Error(c.message||"Failed to connect to WooCommerce")}},async getStatus(){try{const{data:e}=await a.auth.getUser();if(!e.user)return null;const{data:t,error:r}=await a.from("WooCommerceIntegration").select("*").eq("userId",e.user.id).eq("isActive",!0).single();if(r&&r.code!=="PGRST116")throw r;return t}catch{return null}},async sync(e="sync-all"){var t;try{const r=await this.getStatus();if(!r)throw new Error("No active integration");const o=await a.auth.getSession();return await(await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/woocommerce-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(t=o.data.session)==null?void 0:t.access_token}`},body:JSON.stringify({integrationId:r.id,action:e})})).json()}catch(r){throw new Error(r.message||"Failed to sync")}},async disconnect(){try{const{data:e}=await a.auth.getUser();if(!e.user)throw new Error("Not authenticated");const{error:t}=await a.from("WooCommerceIntegration").update({isActive:!1,updatedAt:new Date().toISOString()}).eq("userId",e.user.id).eq("isActive",!0);if(t)throw t;return{success:!0}}catch(e){throw new Error(e.message||"Failed to disconnect")}},async getProducts(e=50){try{const{data:t}=await a.auth.getUser();if(!t.user)return[];const{data:r,error:o}=await a.from("WooCommerceProduct").select("*").eq("userId",t.user.id).order("updatedAt",{ascending:!1}).limit(e);if(o)throw o;return r||[]}catch{return[]}},async getOrders(e=50){try{const{data:t}=await a.auth.getUser();if(!t.user)return[];const{data:r,error:o}=await a.from("WooCommerceOrder").select("*").eq("userId",t.user.id).order("createdAt",{ascending:!1}).limit(e);if(o)throw o;return r||[]}catch{return[]}}},oe={async startOAuth(){var r;const e=await a.auth.getSession();return await(await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/mercadolivre-oauth?action=start",{headers:{Authorization:`Bearer ${(r=e.data.session)==null?void 0:r.access_token}`}})).json()},async getStatus(){const{data:e}=await a.auth.getUser();if(!e.user)return null;const{data:t}=await a.from("MercadoLivreIntegration").select("*").eq("userId",e.user.id).eq("isActive",!0).single();return t},async sync(){var o;const e=await this.getStatus();if(!e)throw new Error("No active integration");const t=await a.auth.getSession();return await(await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/mercadolivre-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(o=t.data.session)==null?void 0:o.access_token}`},body:JSON.stringify({integrationId:e.id})})).json()},async disconnect(){const{data:e}=await a.auth.getUser();if(!e.user)throw new Error("Not authenticated");const{error:t}=await a.from("MercadoLivreIntegration").update({isActive:!1}).eq("userId",e.user.id);if(t)throw t;return{success:!0}}},ae={shopify:{id:"shopify",name:"Shopify",icon:$,description:"Conecte sua loja Shopify para sincronizar produtos, pedidos e clientes automaticamente.",longDescription:"A integração com Shopify permite sincronizar automaticamente todos os seus produtos, pedidos, clientes e dados de estoque entre sua loja e o SyncAds. Com isso, você pode gerenciar tudo em um só lugar.",fields:[],manual:[{step:1,title:"Baixe o Script de Checkout",description:"Clique no botão abaixo para baixar o arquivo shopify-checkout-redirect.js",link:"https://syncads-dun.vercel.app/shopify-checkout-redirect.js",linkText:"📥 Baixar Script"},{step:2,title:"Adicione o Script no seu Tema Shopify",description:"Acesse: Shopify Admin → Online Store → Themes → Actions → Edit code → Na pasta 'Assets', clique em 'Add a new asset' → Upload o arquivo baixado"},{step:3,title:"Insira o Código no theme.liquid",description:"Abra o arquivo 'Layout/theme.liquid' e adicione o código abaixo logo ACIMA da tag </body> no final do arquivo. Use o botão para copiar."},{step:4,title:"Salve e Teste",description:"Salve as alterações e vá até uma página de produto da sua loja. Clique em 'Add to cart' e você será redirecionado para o checkout do SyncAds!"}]},vtex:{id:"vtex",name:"VTEX",icon:K,description:"Integre sua loja VTEX para gerenciar produtos e pedidos em tempo real.",longDescription:"A integração VTEX permite que você sincronize automaticamente produtos, pedidos e estoque da sua loja VTEX com o SyncAds.",fields:[{id:"accountName",label:"Account Name",placeholder:"minhaloja",type:"text",required:!0,helpText:"Nome da sua conta VTEX"},{id:"appKey",label:"App Key",placeholder:"vtexappkey-xxxxx",type:"text",required:!0,helpText:"Chave de aplicação VTEX"},{id:"appToken",label:"App Token",placeholder:"xxxxxxxxxxxxx",type:"password",required:!0,helpText:"Token de acesso da aplicação"}],manual:[{step:1,title:"Acesse o Admin VTEX",description:"Entre no painel administrativo da sua loja VTEX"},{step:2,title:"Gere App Key e App Token",description:'Vá em "Configurações da Conta" > "Chaves de aplicação" > "Gerenciar minhas chaves"'},{step:3,title:"Configure Permissões",description:"Crie uma nova chave com permissões de Catalog, Orders e OMS"}]},nuvemshop:{id:"nuvemshop",name:"Nuvemshop",icon:G,description:"Conecte sua loja Nuvemshop para sincronização automática de dados.",longDescription:"Sincronize produtos, pedidos e clientes da sua Nuvemshop automaticamente.",fields:[{id:"storeId",label:"Store ID",placeholder:"123456",type:"text",required:!0,helpText:"ID da sua loja Nuvemshop"},{id:"storeName",label:"Nome da Loja",placeholder:"Minha Loja",type:"text",required:!1,helpText:"Nome da sua loja (opcional)"},{id:"accessToken",label:"Access Token",placeholder:"xxxxxxxxxxxxx",type:"password",required:!0,helpText:"Token de acesso gerado no admin"}],manual:[{step:1,title:"Acesse Aplicativos",description:"No admin da Nuvemshop, vá em 'Meus aplicativos'"},{step:2,title:"Gere Access Token",description:"Crie um novo aplicativo e copie o Access Token gerado"}]},woocommerce:{id:"woocommerce",name:"WooCommerce",icon:W,description:"Integre sua loja WooCommerce com facilidade.",longDescription:"Conecte sua loja WooCommerce para sincronizar produtos, pedidos e estoque.",fields:[{id:"siteUrl",label:"URL do Site",placeholder:"https://minhaloja.com",type:"url",required:!0,helpText:"URL completa do seu site WooCommerce"},{id:"consumerKey",label:"Consumer Key",placeholder:"ck_xxxxxxxxxxxxx",type:"text",required:!0,helpText:"Chave do consumidor da API REST"},{id:"consumerSecret",label:"Consumer Secret",placeholder:"cs_xxxxxxxxxxxxx",type:"password",required:!0,helpText:"Segredo do consumidor da API REST"}],manual:[{step:1,title:"Acesse WooCommerce",description:"No WordPress admin, vá em WooCommerce > Configurações > Avançado > API REST"},{step:2,title:"Crie Chaves API",description:"Clique em 'Adicionar chave' e gere Consumer Key e Consumer Secret"}]},"mercado-livre":{id:"mercado-livre",name:"Mercado Livre",icon:$,description:"Conecte sua conta do Mercado Livre.",longDescription:"Integração OAuth com Mercado Livre para gerenciar anúncios e vendas.",fields:[],manual:[{step:1,title:"Conectar via OAuth",description:"Clique em 'Conectar' para autorizar via OAuth do Mercado Livre"}]}},we=()=>{const{integrationId:e}=X(),t=D(),r=F(n=>n.user),{isIntegrationConnected:o,loadIntegrations:c}=B(),{toast:i}=R(),[d,h]=w.useState(!1),[p,x]=w.useState(!1),[S,f]=w.useState({}),[l,y]=w.useState({}),u=e?ae[e]:null;if(w.useEffect(()=>{e&&h(o(e))},[e,o]),!u)return s.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-4",children:[s.jsx(O,{className:"h-16 w-16 text-red-500"}),s.jsx("h2",{className:"text-2xl font-bold",children:"Integração não encontrada"}),s.jsx(g,{onClick:()=>t("/integrations"),children:"Voltar para Integrações"})]});const _=(n,m)=>{y(L=>({...L,[n]:m}))},E=async()=>{if(r){if(u.id!=="shopify"){const n=u.fields.filter(m=>m.required&&!l[m.id]).map(m=>m.label);if(n.length>0){i({title:"Campos obrigatórios",description:`Preencha: ${n.join(", ")}`,variant:"destructive"});return}}x(!0);try{let n;if(u.id==="shopify"){h(!0),i({title:"✅ Shopify Configurado!",description:"Ótimo! Agora teste clicando em 'Add to cart' em uma página de produto da sua loja."}),x(!1);return}if(u.id==="vtex"&&(n=await te.connect(l.accountName,l.appKey,l.appToken)),u.id==="nuvemshop"&&(n=await se.connect(l.storeId,l.storeName||"Minha Loja",l.accessToken)),u.id==="woocommerce"&&(n=await re.connect(l.siteUrl,l.consumerKey,l.consumerSecret)),u.id==="mercado-livre"&&(n=await oe.startOAuth(),n.success&&n.authUrl)){window.location.href=n.authUrl;return}if(n&&n.success)h(!0),i({title:"✅ Conectado com Sucesso!",description:`${u.name} foi conectado com sucesso.`}),await c(r.id);else throw new Error((n==null?void 0:n.error)||"Erro ao conectar")}catch(n){i({title:"❌ Erro ao Conectar",description:n.message||"Verifique suas credenciais e tente novamente.",variant:"destructive"})}finally{x(!1)}}},V=async()=>{if(r){x(!0);try{u.id==="shopify"&&await ee.disconnect(),h(!1),y({}),i({title:"Desconectado",description:`${u.name} foi desconectado.`}),await c(r.id)}catch{i({title:"Erro",description:"Não foi possível desconectar.",variant:"destructive"})}finally{x(!1)}}},z=u.icon;return s.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto pb-8",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>t("/integrations"),children:[s.jsx(H,{className:"h-4 w-4 mr-2"}),"Voltar"]})}),s.jsxs(v,{children:[s.jsx(N,{children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"p-3 rounded-lg bg-primary/10",children:s.jsx(z,{className:"h-8 w-8 text-primary"})}),s.jsxs("div",{children:[s.jsx(A,{className:"text-2xl",children:u.name}),s.jsx(C,{className:"mt-1",children:u.description})]})]}),s.jsx("div",{children:d?s.jsxs(q,{className:"bg-green-500 hover:bg-green-600 text-white gap-1",children:[s.jsx(b,{className:"h-3 w-3"}),"Ativo"]}):s.jsxs(q,{variant:"outline",className:"bg-red-500/10 text-red-700 border-red-500/20 gap-1",children:[s.jsx(O,{className:"h-3 w-3"}),"Inativo"]})})]})}),u.longDescription&&s.jsx(j,{children:s.jsx("p",{className:"text-sm text-muted-foreground",children:u.longDescription})})]}),u.id==="shopify"&&!d&&s.jsxs(T,{className:"bg-yellow-50 border-yellow-300",children:[s.jsx(P,{className:"h-5 w-5 text-yellow-600"}),s.jsxs(I,{className:"text-sm",children:[s.jsx("strong",{className:"font-bold text-yellow-900",children:"⚠️ ATENÇÃO - Antes de conectar:"}),s.jsx("br",{}),"No Shopify Partners, você DEVE adicionar a URL de redirecionamento:",s.jsxs("div",{className:"mt-2 p-2 bg-yellow-100 rounded font-mono text-xs break-all flex items-center justify-between gap-2",children:[s.jsxs("span",{className:"flex-1",children:[window.location.origin,"/integrations/callback"]}),s.jsx(g,{type:"button",size:"sm",variant:"ghost",className:"h-7 px-2 hover:bg-yellow-200",onClick:()=>{navigator.clipboard.writeText(`${window.location.origin}/integrations/callback`),i({title:"✅ URL Copiada!",description:"Cole esta URL no campo 'Allowed redirection URL(s)' no Shopify Partners."})},children:s.jsx(U,{className:"h-4 w-4"})})]}),s.jsx("p",{className:"mt-2 text-yellow-800",children:'O erro "OAuth invalid_request" acontece quando esta URL não está configurada corretamente no seu App Shopify.'})]})]}),u.manual.length>0&&!d&&s.jsxs(v,{children:[s.jsxs(N,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(P,{className:"h-5 w-5 text-blue-500"}),s.jsx(A,{className:"text-lg",children:"Como Configurar o Checkout"})]}),s.jsx(C,{children:"Siga os passos abaixo para ativar o checkout SyncAds na sua loja"})]}),s.jsxs(j,{className:"space-y-4",children:[u.manual.map(n=>s.jsx(T,{className:"bg-blue-50 border-blue-200",children:s.jsxs("div",{className:"flex gap-3",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-blue-500 text-white text-sm font-bold flex items-center justify-center",children:n.step}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx("p",{className:"font-semibold text-sm text-gray-900",children:n.title}),s.jsx(I,{className:"text-xs text-gray-700",children:n.description}),n.step===1&&n.link&&s.jsxs(g,{variant:"outline",size:"sm",className:"mt-2 gap-2",onClick:()=>window.open(n.link,"_blank"),children:[n.linkText||"Download",s.jsx(Y,{className:"h-3 w-3"})]}),n.step===3&&u.id==="shopify"&&s.jsxs("div",{className:"mt-3 space-y-2",children:[s.jsx("div",{className:"bg-gray-900 rounded-md p-3 relative",children:s.jsx("code",{className:"text-xs text-green-400 font-mono break-all",children:`<script src="{{ 'shopify-checkout-redirect.js' | asset_url }}" defer><\/script>`})}),s.jsxs(g,{variant:"default",size:"sm",className:"w-full gap-2 bg-blue-600 hover:bg-blue-700",onClick:()=>{navigator.clipboard.writeText(`<script src="{{ 'shopify-checkout-redirect.js' | asset_url }}" defer><\/script>`),i({title:"✅ Código Copiado!",description:"Cole este código no theme.liquid acima da tag </body>"})},children:[s.jsx(U,{className:"h-4 w-4"}),"Copiar Código"]})]})]})]})},n.step)),u.id==="shopify"&&s.jsxs(T,{className:"bg-green-50 border-green-200",children:[s.jsx(b,{className:"h-4 w-4 text-green-600"}),s.jsxs(I,{className:"text-xs text-green-800",children:[s.jsx("strong",{children:"Dica:"}),' Após salvar, teste imediatamente indo em uma página de produto e clicando no botão "Add to cart". Você deve ser redirecionado para o checkout do SyncAds!']})]})]})]}),!d&&u.id==="shopify"&&s.jsx(v,{className:"border-2 border-blue-200 bg-blue-50",children:s.jsx(j,{className:"pt-6",children:s.jsxs("div",{className:"text-center space-y-4",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center",children:s.jsx(b,{className:"h-8 w-8 text-blue-600"})})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Instalou o Script?"}),s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Após seguir os passos acima e instalar o script no seu tema Shopify, clique no botão abaixo para ativar a integração."})]}),s.jsx(g,{onClick:E,disabled:p,size:"lg",className:"w-full max-w-md gap-2 bg-blue-600 hover:bg-blue-700",children:p?s.jsxs(s.Fragment,{children:[s.jsx(k,{className:"h-4 w-4 animate-spin"}),"Verificando..."]}):s.jsxs(s.Fragment,{children:[s.jsx(b,{className:"h-4 w-4"}),"Sim, Instalei o Script"]})})]})})}),!d&&u.id!=="shopify"&&u.fields.length>0&&s.jsxs(v,{children:[s.jsxs(N,{children:[s.jsx(A,{className:"text-lg",children:"Credenciais"}),s.jsx(C,{children:"Preencha todos os campos obrigatórios para conectar"})]}),s.jsx(j,{className:"space-y-4",children:u.fields.map(n=>s.jsxs("div",{className:"space-y-2",children:[s.jsxs(M,{htmlFor:n.id,children:[n.label,n.required&&s.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),s.jsxs("div",{className:"relative",children:[s.jsx(J,{id:n.id,type:n.type==="password"?S[n.id]?"text":"password":n.type,placeholder:n.placeholder,value:l[n.id]||"",onChange:m=>_(n.id,m.target.value),className:"pr-10"}),n.type==="password"&&s.jsx(g,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 px-2",onClick:()=>f(m=>({...m,[n.id]:!m[n.id]})),children:S[n.id]?s.jsx(Z,{className:"h-4 w-4"}):s.jsx(Q,{className:"h-4 w-4"})})]}),n.helpText&&s.jsx("p",{className:"text-xs text-muted-foreground",children:n.helpText})]},n.id))})]}),s.jsx(v,{children:s.jsx(j,{className:"pt-6",children:s.jsx("div",{className:"flex gap-3",children:d?s.jsxs(s.Fragment,{children:[s.jsx(g,{onClick:V,disabled:p,variant:"destructive",className:"flex-1",children:p?s.jsxs(s.Fragment,{children:[s.jsx(k,{className:"h-4 w-4 mr-2 animate-spin"}),"Desconectando..."]}):"Desconectar"}),s.jsx(g,{variant:"outline",onClick:()=>t("/integrations"),children:"Voltar"})]}):s.jsxs(s.Fragment,{children:[s.jsx(g,{onClick:E,disabled:p,className:"flex-1 bg-green-600 hover:bg-green-700",children:p?s.jsxs(s.Fragment,{children:[s.jsx(k,{className:"h-4 w-4 mr-2 animate-spin"}),"Conectando..."]}):"Conectar"}),s.jsx(g,{variant:"outline",onClick:()=>t("/integrations"),children:"Cancelar"})]})})})})]})};export{we as default};
