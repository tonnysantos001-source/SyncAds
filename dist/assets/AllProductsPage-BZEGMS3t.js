import{j as e}from"./vendor-ui-D8qh2McD.js";import{r as a}from"./vendor-react-X41Bjl18.js";import{s as r,g as s,f as t,B as i,C as o,a as l,b as d,c as n,d as c,I as m,e as x}from"./index-BpYC1zIt.js";import{T as u,a as p,b as h,c as g,d as j,e as v}from"./table-Tpw_L4Rf.js";import{D as y,a as f,b,c as k,d as N,f as w}from"./dialog-CDJYGFDi.js";import{L as S}from"./label-BdbDV_-i.js";import{T as C}from"./textarea-DG38tLIM.js";import{S as A,a as P,b as I,c as T,d as z}from"./select-DpHoVnD3.js";import{p as E}from"./productsApi-BGFsC_nG.js";import{a as q}from"./shopifySync-Bu1rHOly.js";import{S as F}from"./skeleton-BSpBdwEt.js";import{A as V,a as D,b as R}from"./alert-y1mPasv3.js";import{u as L}from"./useDebounce-Cz1S1MGD.js";import{u as B}from"./vendor-query-CYpOgAEj.js";import{m as M}from"./vendor-animation-APnkykC6.js";import{R as $,aJ as K,ah as O,J as U,aW as H,D as J,S as G,Q,Y as W,aN as Y,aL as X}from"./vendor-icons-hYCcxcNU.js";import"./vendor-supabase-ChjAI-9u.js";import"./vendor-utils-Dl0_yMKq.js";const Z=()=>{const[Z,_]=a.useState(!1),[ee,ae]=a.useState(""),[re,se]=a.useState("all"),[te,ie]=a.useState(0),[oe,le]=a.useState(!1),[de,ne]=a.useState(null),[ce,me]=a.useState({totalProducts:0,totalOrders:0,lastSync:null}),{toast:xe}=s(),ue=t(e=>e.user),pe=L(ee,500),{data:he,isLoading:ge,totalCount:je,totalPages:ve,refetch:ye}=(({userId:e,page:a=0,pageSize:s=50,search:t="",status:i="all",enabled:o=!0})=>{const{data:l,isLoading:d,error:n,refetch:c}=B({queryKey:["products",e,a,s,t,i],queryFn:async()=>{if(!e)throw new Error("User ID is required");let o=r.from("Product").select("*",{count:"exact"}).eq("userId",e).order("createdAt",{ascending:!1}).range(a*s,(a+1)*s-1);t&&(o=o.or(`name.ilike.%${t}%,sku.ilike.%${t}%,description.ilike.%${t}%`)),"all"!==i&&(o=o.eq("status",i));const{data:l,error:d,count:n}=await o;if(d)throw d;return{products:l||[],count:n||0}},enabled:o&&!!e,staleTime:3e5,gcTime:6e5}),m=l?.count||0,x=Math.ceil(m/s);return{data:l?.products||[],isLoading:d,error:n,totalCount:m,totalPages:x,refetch:c}})({userId:ue?.id||"",page:te,pageSize:50,search:pe,status:re,enabled:!!ue?.id}),fe=he,[be,ke]=a.useState({name:"",description:"",price:0,comparePrice:0,sku:"",stock:0,categoryId:"",status:"ACTIVE"}),Ne={total:je,active:he.filter(e=>"ACTIVE"===e.status).length,totalValue:he.reduce((e,a)=>e+a.price*a.stock,0)};a.useEffect(()=>{ue?.id&&we()},[ue?.id]);const we=async()=>{if(ue?.id)try{const e=await q.getSyncStats(ue.id);me(e)}catch(e){}},Se=async()=>{if(ue?.id)try{_(!0),xe({title:"Sincronizando...",description:"Buscando produtos da Shopify"});const e=await q.syncProducts(ue.id,ue.organizationId||ue.id);e.success?(xe({title:"Sincronização concluída!",description:e.message}),await ye(),await we()):xe({title:"Shopify não configurada",description:"Configure a integração Shopify em Integrações",variant:"destructive"})}catch(e){xe({title:"Shopify não disponível",description:"Configure a integração em Integrações > Shopify",variant:"destructive"})}finally{_(!1)}else xe({title:"Erro",description:"Faça login para sincronizar",variant:"destructive"})},Ce=async e=>{if(confirm("Tem certeza que deseja excluir este produto?"))try{await E.delete(e),xe({title:"Produto excluído",description:"O produto foi removido do catálogo."}),(async()=>{await ye()})()}catch(a){xe({title:"Erro ao excluir produto",description:a.message,variant:"destructive"})}},Ae=()=>{ne(null),ke({name:"",description:"",price:0,comparePrice:0,sku:"",stock:0,categoryId:"",status:"ACTIVE"})},Pe=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-purple-600 via-pink-600 to-cyan-600 bg-clip-text text-transparent",children:"Produtos"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium",children:"Gerencie o catálogo completo de produtos da sua loja"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{onClick:Se,disabled:Z,className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white border-0 hover:from-purple-600 hover:to-pink-600 transition-all duration-300 shadow-lg hover:shadow-xl disabled:opacity-50",children:[e.jsx($,{className:"mr-2 h-4 w-4 "+(Z?"animate-spin":"")}),Z?"Sincronizando...":"Sincronizar Shopify"]}),e.jsxs(i,{onClick:()=>{Ae(),le(!0)},className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white border-0 hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg hover:shadow-xl",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Adicionar Produto"]})]})]}),ce.lastSync&&e.jsx(M.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.1},children:e.jsxs(V,{className:"border-0 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 backdrop-blur-sm",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx(D,{children:"Integração Shopify Ativa"}),e.jsxs(R,{children:["Última sincronização:"," ",new Date(ce.lastSync).toLocaleString("pt-BR")," •",ce.totalProducts," produtos importados"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:e.jsxs(o,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-purple-500 opacity-10 rounded-full blur-3xl"}),e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total de Produtos"}),e.jsx("div",{className:"p-2 rounded-lg bg-purple-500 bg-opacity-10",children:e.jsx(U,{className:"h-4 w-4 text-purple-500"})})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-purple-600 to-pink-500 bg-clip-text text-transparent",children:Ne.total}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[Ne.active," ativos"]})]})]})}),e.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},children:e.jsxs(o,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-pink-500 opacity-10 rounded-full blur-3xl"}),e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Produtos Ativos"}),e.jsx("div",{className:"p-2 rounded-lg bg-pink-500 bg-opacity-10",children:e.jsx(H,{className:"h-4 w-4 text-pink-500"})})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-pink-600 to-rose-500 bg-clip-text text-transparent",children:Ne.active}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Disponíveis para venda"})]})]})}),e.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:e.jsxs(o,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-cyan-500 opacity-10 rounded-full blur-3xl"}),e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Valor Total"}),e.jsx("div",{className:"p-2 rounded-lg bg-cyan-500 bg-opacity-10",children:e.jsx(J,{className:"h-4 w-4 text-cyan-500"})})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-cyan-600 to-blue-500 bg-clip-text text-transparent",children:Pe(Ne.totalValue)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Estoque valorizado"})]})]})})]}),e.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},children:e.jsxs(o,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsxs(l,{children:[e.jsx(d,{className:"text-lg font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Filtros"}),e.jsx(c,{className:"dark:text-gray-400",children:"Busque e filtre produtos"})]}),e.jsx(n,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Buscar por nome, SKU ou descrição...",value:ee,onChange:e=>ae(e.target.value),className:"pl-10 border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm dark:text-white dark:placeholder:text-gray-500"})]})}),e.jsxs(A,{value:re,onValueChange:se,children:[e.jsx(P,{className:"w-full md:w-[200px] border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm dark:text-white",children:e.jsx(I,{placeholder:"Status"})}),e.jsxs(T,{children:[e.jsx(z,{value:"all",children:"Todos os Status"}),e.jsx(z,{value:"ACTIVE",children:"Ativo"}),e.jsx(z,{value:"DRAFT",children:"Rascunho"}),e.jsx(z,{value:"ARCHIVED",children:"Arquivado"})]})]})]})})]})}),e.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:e.jsxs(o,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsxs(l,{children:[e.jsxs(d,{className:"text-xl font-bold bg-gradient-to-r from-purple-600 to-cyan-600 bg-clip-text text-transparent",children:["Catálogo (",fe.length,")"]}),e.jsx(c,{className:"dark:text-gray-400",children:fe.length===he.length?"Mostrando todos os produtos":`Mostrando ${fe.length} de ${he.length} produtos`})]}),e.jsxs(n,{children:[ge?e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{className:"h-12 w-full"}),e.jsx(F,{className:"h-12 w-full"}),e.jsx(F,{className:"h-12 w-full"})]}):0===fe.length?e.jsxs(M.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:"flex flex-col items-center justify-center h-64",children:[e.jsx(U,{className:"h-16 w-16 text-muted-foreground mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground text-center mb-4 dark:text-gray-300",children:ee||"all"!==re?"Nenhum produto encontrado com os filtros aplicados":"Nenhum produto cadastrado"}),!ee&&"all"===re&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{onClick:Se,variant:"outline",disabled:Z,children:[e.jsx($,{className:"mr-2 h-4 w-4 "+(Z?"animate-spin":"")}),"Sincronizar Shopify"]}),e.jsxs(i,{onClick:()=>{Ae(),le(!0)},children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Adicionar Primeiro Produto"]})]})]}):e.jsx("div",{className:"rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:e.jsxs(u,{children:[e.jsx(p,{children:e.jsxs(h,{className:"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-gray-800 dark:to-gray-800 hover:from-purple-100 hover:to-pink-100 dark:hover:from-gray-700 dark:hover:to-gray-700",children:[e.jsx(g,{children:"Imagem"}),e.jsx(g,{className:"font-semibold dark:text-gray-300",children:"Produto"}),e.jsx(g,{className:"font-semibold dark:text-gray-300",children:"SKU"}),e.jsx(g,{className:"font-semibold dark:text-gray-300",children:"Preço"}),e.jsx(g,{className:"font-semibold dark:text-gray-300",children:"Estoque"}),e.jsx(g,{className:"font-semibold dark:text-gray-300",children:"Status"}),e.jsx(g,{className:"text-right font-semibold dark:text-gray-300",children:"Ações"}),e.jsx(g,{children:"Ações"})]})}),e.jsx(j,{children:fe.map((a,r)=>{const s=a.metadata?.images||[],t=s.length>0?s[0]?.src||s[0]:null;return e.jsxs(M.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.05*r},className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gradient-to-r hover:from-purple-50/50 hover:to-pink-50/50 dark:hover:from-gray-800/50 dark:hover:to-gray-800/50 transition-all duration-200",children:[e.jsx(v,{children:t?e.jsx("img",{src:t,alt:a.name,className:"w-12 h-12 object-cover rounded-md border"}):e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-100 to-pink-100 dark:from-purple-900/20 dark:to-pink-900/20 rounded-md flex items-center justify-center",children:e.jsx(U,{className:"h-6 w-6 text-muted-foreground"})})}),e.jsx(v,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium dark:text-white",children:a.name}),a.description&&e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",children:a.description}),a.metadata?.shopifyId&&e.jsxs(x,{variant:"outline",className:"mt-1 bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 text-purple-700 dark:text-purple-300 border-purple-300 dark:border-purple-700",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),"Shopify"]})]})}),e.jsx(v,{children:e.jsx("code",{className:"text-xs bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 px-2 py-1 rounded dark:text-gray-300",children:a.sku||"N/A"})}),e.jsx(v,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:Pe(a.price)}),a.comparePrice&&a.comparePrice>a.price&&e.jsx("div",{className:"text-xs text-muted-foreground line-through",children:Pe(a.comparePrice)})]})}),e.jsx(v,{children:e.jsxs(x,{variant:a.stock>10?"default":a.stock>0?"warning":"destructive",children:[a.stock," un."]})}),e.jsx(v,{children:e.jsx(x,{variant:"ACTIVE"===a.status?"default":"DRAFT"===a.status?"secondary":"outline",children:"ACTIVE"===a.status?"Ativo":"DRAFT"===a.status?"Rascunho":"Arquivado"})}),e.jsx(v,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{ne(e),ke({name:e.name,description:e.description||"",price:e.price,comparePrice:e.comparePrice||0,sku:e.sku||"",stock:e.stock,categoryId:e.categoryId||"",status:e.status}),le(!0)})(a),className:"hover:bg-gradient-to-r hover:from-purple-50 hover:to-pink-50 dark:hover:from-gray-800 dark:hover:to-gray-800",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>Ce(a.id),className:"hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400",children:e.jsx(W,{className:"h-4 w-4"})})]})})]},a.id)})})]})}),!ge&&fe.length>0&&ve>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4 px-2",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Página ",te+1," de ",ve," (",je," ","produtos no total)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>ie(Math.max(0,te-1)),disabled:0===te,children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"Anterior"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>ie(Math.min(ve-1,te+1)),disabled:te>=ve-1,children:["Próxima",e.jsx(X,{className:"h-4 w-4 ml-1"})]})]})]})]})]})}),e.jsx(y,{open:oe,onOpenChange:le,children:e.jsxs(f,{className:"max-w-2xl",children:[e.jsxs(b,{children:[e.jsx(k,{children:de?"Editar Produto":"Novo Produto"}),e.jsx(N,{children:de?"Atualize as informações do produto":"Adicione um novo produto ao catálogo"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),ue?.id)try{de?(await E.update(de.id,be),xe({title:"Produto atualizado!",description:"As alterações foram salvas com sucesso."})):(await E.create({...be,userId:ue.id,organizationId:ue.organizationId||ue.id,slug:be.name.toLowerCase().replace(/\s+/g,"-"),lowStockThreshold:5,trackStock:!0,isFeatured:!1,isActive:"ACTIVE"===be.status}),xe({title:"Produto criado!",description:"O produto foi adicionado ao catálogo."})),le(!1),Ae(),await ye()}catch(a){xe({title:"Erro ao salvar produto",description:a.message||"Tente novamente",variant:"destructive"})}else xe({title:"Erro",description:"Você precisa estar logado",variant:"destructive"})},children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"name",children:"Nome do Produto *"}),e.jsx(m,{id:"name",value:be.name,onChange:e=>ke({...be,name:e.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"description",children:"Descrição"}),e.jsx(C,{id:"description",value:be.description,onChange:e=>ke({...be,description:e.target.value}),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"price",children:"Preço *"}),e.jsx(m,{id:"price",type:"number",step:"0.01",value:be.price,onChange:e=>ke({...be,price:parseFloat(e.target.value)}),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"comparePrice",children:"Preço Comparação"}),e.jsx(m,{id:"comparePrice",type:"number",step:"0.01",value:be.comparePrice,onChange:e=>ke({...be,comparePrice:parseFloat(e.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"sku",children:"SKU"}),e.jsx(m,{id:"sku",value:be.sku,onChange:e=>ke({...be,sku:e.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"stock",children:"Estoque *"}),e.jsx(m,{id:"stock",type:"number",value:be.stock,onChange:e=>ke({...be,stock:parseInt(e.target.value)}),required:!0})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"status",children:"Status"}),e.jsxs(A,{value:be.status,onValueChange:e=>ke({...be,status:e}),children:[e.jsx(P,{children:e.jsx(I,{})}),e.jsxs(T,{children:[e.jsx(z,{value:"ACTIVE",children:"Ativo"}),e.jsx(z,{value:"DRAFT",children:"Rascunho"}),e.jsx(z,{value:"ARCHIVED",children:"Arquivado"})]})]})]})]}),e.jsxs(w,{children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>le(!1),children:"Cancelar"}),e.jsxs(i,{type:"submit",children:[de?"Atualizar":"Criar"," Produto"]})]})]})]})})]})};export{Z as default};
