import{f as R,e as L,r as m,s as r,j as e,aH as b,t as z,B as n,g as x,h,i as u,l as p,I as P,aI as $}from"./index-B3Kc0SDt.js";import{L as j}from"./label-NdD6wxGm.js";import{S as Z,a as B,b as Q,c as X,d as g}from"./select-BsmE_Htu.js";import{A as G,b as _}from"./alert-DuYsJtTC.js";import{A as H}from"./arrow-left-Cn7coa4W.js";import{C}from"./copy-CoBgfkug.js";import{C as N}from"./circle-alert-X8fmatWA.js";import{C as D}from"./circle-check-C9c8Yr5-.js";import{E as Y}from"./external-link-9vN2bZ5M.js";import"./index-q8DXVjtI.js";function ce(){const{toast:o}=R(),E=L(),[k,V]=m.useState([]),[O,U]=m.useState(!0),[T,v]=m.useState(!1),[I,S]=m.useState(!1),[c,w]=m.useState({subdomain:"checkout",domain:""});m.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:{user:a}}=await r.auth.getUser();if(!a)return;const{data:s}=await r.from("User").select("organizationId").eq("id",a.id).single();if(!(s!=null&&s.organizationId))return;const{data:i}=await r.from("Organization").select("domain, domainVerified").eq("id",s.organizationId).single();i!=null&&i.domain&&V([{id:"1",domain:i.domain,subdomain:"checkout",cnameRecord:A(i.domain),verified:i.domainVerified||!1,sslConfigured:!1,createdAt:new Date().toISOString()}])}catch(a){console.error("Erro ao carregar domínios:",a)}finally{U(!1)}},A=a=>{const s=a.split("").reduce((i,d)=>(i<<5)-i+d.charCodeAt(0)|0,0);return`checkout-${Math.abs(s).toString(36)}.syncads.com.br`},M=async()=>{if(!c.domain){o({title:"Erro",description:"Por favor, preencha o domínio",variant:"destructive"});return}try{const{data:{user:a}}=await r.auth.getUser();if(!a)return;const{data:s}=await r.from("User").select("organizationId").eq("id",a.id).single();if(!(s!=null&&s.organizationId))return;const i=A(c.domain),d=`${c.subdomain}.${c.domain}`,{error:l}=await r.from("Organization").update({domain:d,domainVerified:!1,domainVerificationToken:crypto.randomUUID(),domainVerificationMethod:"DNS"}).eq("id",s.organizationId);if(l)throw l;o({title:"Domínio cadastrado",description:"Agora você precisa configurar o DNS no seu provedor"}),await f(),v(!1),w({subdomain:"checkout",domain:""})}catch(a){console.error("Erro ao adicionar domínio:",a),o({title:"Erro",description:"Não foi possível cadastrar o domínio",variant:"destructive"})}},q=async()=>{S(!0);try{const{data:{user:a}}=await r.auth.getUser();if(!a)return;const{data:s}=await r.from("User").select("organizationId").eq("id",a.id).single();if(!(s!=null&&s.organizationId))return;const{data:i}=await r.auth.getSession(),d=await fetch(`${$.functionsUrl}/verify-domain`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i==null?void 0:i.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92c2tlcHFnZ214bGZja3hxZ2JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4MjQ4NTUsImV4cCI6MjA3NjQwMDg1NX0.UdNgqpTN38An6FuoJPZlj_zLkmAqfJQXb6i1DdTQO_E"},body:JSON.stringify({subdomain:t.subdomain,domain:t.domain})}),l=await d.json();if(!d.ok||!l.verified)throw new Error(l.details||l.reason||"Verificação falhou");o({title:"Domínio verificado com sucesso!",description:"Seu domínio está pronto para uso"}),await f()}catch(a){console.error("Erro ao verificar domínio:",a),o({title:"Erro",description:a.message||"Não foi possível verificar o domínio. Verifique se o DNS está configurado corretamente.",variant:"destructive"})}finally{S(!1)}},y=(a,s)=>{navigator.clipboard.writeText(a),o({title:"Copiado!",description:`${s} copiado para a área de transferência`})},F=async()=>{try{const{data:{user:a}}=await r.auth.getUser();if(!a)return;const{data:s}=await r.from("User").select("organizationId").eq("id",a.id).single();if(!(s!=null&&s.organizationId))return;const{error:i}=await r.from("Organization").update({domain:null,domainVerified:!1,domainVerificationToken:null}).eq("id",s.organizationId);if(i)throw i;o({title:"Domínio excluído",description:"O domínio foi removido com sucesso"}),await f()}catch(a){console.error("Erro ao excluir domínio:",a),o({title:"Erro",description:"Não foi possível excluir o domínio",variant:"destructive"})}};if(O)return e.jsx(b,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(z,{className:"h-8 w-8 animate-spin text-gray-400"})})});if(k.length===0)return e.jsx(b,{children:e.jsxs("div",{className:"p-6 sm:p-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Você ainda não tem nenhum domínio cadastrado."}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400 mb-8",children:"Cadastrando seu domínio você aumenta a credibilidade e conversão da sua loja."}),e.jsx(n,{size:"lg",onClick:()=>v(!0),className:"bg-pink-600 hover:bg-pink-700 text-white",children:"CADASTRAR DOMÍNIO"})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(x,{className:"w-full max-w-md",children:[e.jsx(h,{children:e.jsx(u,{className:"uppercase text-lg",children:"Adicionar novo domínio"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Domínio"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Z,{value:c.subdomain,onValueChange:a=>w({...c,subdomain:a}),children:[e.jsx(B,{className:"w-[140px]",children:e.jsx(Q,{})}),e.jsxs(X,{children:[e.jsx(g,{value:"checkout",children:"checkout."}),e.jsx(g,{value:"seguro",children:"seguro."}),e.jsx(g,{value:"secure",children:"secure."}),e.jsx(g,{value:"pay",children:"pay."})]})]}),e.jsx(P,{placeholder:"ex.: sualoja.com.br",value:c.domain,onChange:a=>w({...c,domain:a.target.value})})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("p",{children:"• Vincule um domínio que já pertença a você."}),e.jsx("p",{children:"• Não use http, https, www e url da sua loja myshopify."})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(n,{variant:"outline",className:"flex-1",onClick:()=>v(!1),children:"Cancelar"}),e.jsx(n,{className:"flex-1 bg-pink-600 hover:bg-pink-700",onClick:M,children:"Salvar"})]})]})]})})]})});const t=k[0],J=`${t.subdomain}.${t.domain}`;return e.jsx(b,{children:e.jsx("div",{className:"p-6 sm:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>E("/onboarding"),className:"text-pink-600 hover:text-pink-700 mb-4 flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"ver todos os domínios"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"CONFIGURAÇÃO DO DOMÍNIO"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:J})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(u,{children:"Cadastrando o apontamento"})}),e.jsxs(p,{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Em seu provedor, na seção de configuração registros DNS, adicione as informações abaixo. Preencha cada campo com as respectivas informações listadas abaixo:"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"text-xs uppercase tracking-wide",children:"Tipo"}),e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>y("CNAME","Tipo"),children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"CNAME"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"text-xs uppercase tracking-wide",children:"Nome"}),e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>y(t.subdomain,"Nome"),children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),t.subdomain]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"text-xs uppercase tracking-wide",children:"Valor"}),e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>y(t.cnameRecord,"Valor"),children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),t.cnameRecord]})]})]}),e.jsxs(G,{children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(_,{children:"Após realizar corretamente os apontamentos acima em seu provedor de domínio, você deve aguardar um tempo para que as informações sejam propagadas. Esse processo costuma levar até 4h."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(n,{variant:"outline",className:"flex-1",onClick:F,children:"Excluir domínio"}),e.jsx(n,{className:"flex-1 bg-pink-600 hover:bg-pink-700 text-white",onClick:q,disabled:I||t.verified,children:I?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Verificando..."]}):"VERIFICAR DOMÍNIO"})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(u,{className:"text-sm",children:"Status"})}),e.jsx(p,{children:e.jsx("div",{className:"flex items-center gap-2",children:t.verified?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-green-500 font-medium",children:"Concluído"})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-yellow-500 font-medium",children:"Pendente"})]})})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(u,{className:"text-sm",children:"SSL"})}),e.jsx(p,{children:e.jsx("div",{className:"flex items-center gap-2",children:t.sslConfigured?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-green-500 font-medium",children:"Concluído"})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-yellow-500 font-medium",children:"Pendente"})]})})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(u,{className:"text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-pink-100 flex items-center justify-center",children:e.jsx(N,{className:"h-5 w-5 text-pink-600"})}),"Está com dúvidas?"]})}),e.jsxs(p,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Aprenda como verificar o domínio da sua loja."}),e.jsxs(n,{variant:"link",className:"p-0",children:["Ver tutorial ",e.jsx(Y,{className:"h-4 w-4 ml-1"})]})]})]})]})]})]})})})}export{ce as default};
