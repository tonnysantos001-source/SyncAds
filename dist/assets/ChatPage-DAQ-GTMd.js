import{r as e,s as a,v as n,j as t,w as s}from"./vendor-ui-D3JNL6pE.js";import{r,R as o,f as i}from"./vendor-react-X41Bjl18.js";import{_ as c,b as d}from"./vendor-charts-DhkUgiCU.js";import{i as l,h as m,C as u,c as p,B as g,s as h,f,e as v,j as x,k as b,l as y,g as A,m as S,n as w}from"./index-Dc5j9xCs.js";import{u as E}from"./settingsStore-xF6tKqYl.js";import{L as N,_ as j}from"./vendor-icons-C-BwOa4K.js";import{A as I}from"./AiThinkingIndicator-CWZ6Na9x.js";import{A as C,m as T}from"./vendor-animation-DtB50Lbk.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-supabase-HUq0BeMy.js";import"./vendor-query-DqG_mm-v.js";const R=l("outline","brand-openai","BrandOpenai",[["path",{d:"M11.217 19.384a3.501 3.501 0 0 0 6.783 -1.217v-5.167l-6 -3.35",key:"svg-0"}],["path",{d:"M5.214 15.014a3.501 3.501 0 0 0 4.446 5.266l4.34 -2.534v-6.946",key:"svg-1"}],["path",{d:"M6 7.63c-1.391 -.236 -2.787 .395 -3.534 1.689a3.474 3.474 0 0 0 1.271 4.745l4.263 2.514l6 -3.348",key:"svg-2"}],["path",{d:"M12.783 4.616a3.501 3.501 0 0 0 -6.783 1.217v5.067l6 3.45",key:"svg-3"}],["path",{d:"M18.786 8.986a3.501 3.501 0 0 0 -4.446 -5.266l-4.34 2.534v6.946",key:"svg-4"}],["path",{d:"M18 16.302c1.391 .236 2.787 -.395 3.534 -1.689a3.474 3.474 0 0 0 -1.271 -4.745l-4.308 -2.514l-5.955 3.42",key:"svg-5"}]]),k=l("outline","infinity","Infinity",[["path",{d:"M9.828 9.172a4 4 0 1 0 0 5.656a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828",key:"svg-0"}]]),q=l("outline","menu-2","Menu2",[["path",{d:"M4 6l16 0",key:"svg-0"}],["path",{d:"M4 12l16 0",key:"svg-1"}],["path",{d:"M4 18l16 0",key:"svg-2"}]]),M=l("outline","message-2","Message2",[["path",{d:"M8 9h8",key:"svg-0"}],["path",{d:"M8 13h6",key:"svg-1"}],["path",{d:"M9 18h-3a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-3l-3 3l-3 -3z",key:"svg-2"}]]),P=l("outline","messages","Messages",[["path",{d:"M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10",key:"svg-0"}],["path",{d:"M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2",key:"svg-1"}]]),D=l("outline","microphone","Microphone",[["path",{d:"M9 2m0 3a3 3 0 0 1 3 -3h0a3 3 0 0 1 3 3v5a3 3 0 0 1 -3 3h0a3 3 0 0 1 -3 -3z",key:"svg-0"}],["path",{d:"M5 10a7 7 0 0 0 14 0",key:"svg-1"}],["path",{d:"M8 21l8 0",key:"svg-2"}],["path",{d:"M12 17l0 4",key:"svg-3"}]]),O=l("outline","paperclip","Paperclip",[["path",{d:"M15 7l-6.5 6.5a1.5 1.5 0 0 0 3 3l6.5 -6.5a3 3 0 0 0 -6 -6l-6.5 6.5a4.5 4.5 0 0 0 9 9l6.5 -6.5",key:"svg-0"}]]),U=l("outline","plus","Plus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]),z=l("outline","send","Send",[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]]),_=l("outline","sparkles","Sparkles",[["path",{d:"M16 18a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2zm0 -12a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2zm-7 12a6 6 0 0 1 6 -6a6 6 0 0 1 -6 -6a6 6 0 0 1 -6 6a6 6 0 0 1 6 6z",key:"svg-0"}]]),L=l("outline","trash","Trash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]),$=l("outline","user-circle","UserCircle",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M12 10m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-1"}],["path",{d:"M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855",key:"svg-2"}]]),G=l("filled","circle-dot-filled","CircleDotFilled",[["path",{d:"M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-5 6.66a2 2 0 0 0 -1.977 1.697l-.018 .154l-.005 .149l.005 .15a2 2 0 1 0 1.995 -2.15z",key:"svg-0"}]]);var F=r.useLayoutEffect,V=function(e,a){"function"!=typeof e?e.current=a:e(a)},B={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},H=function(e){Object.keys(B).forEach(function(a){e.style.setProperty(a,B[a],"important")})},Q=null,K=function(e,a){var n=e.scrollHeight;return"border-box"===a.sizingStyle.boxSizing?n+a.borderSize:n-a.paddingSize};var W=function(){},X=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],J=!!document.documentElement.currentStyle,Y=function(e){var a=window.getComputedStyle(e);if(null===a)return null;var n,t=(n=a,X.reduce(function(e,a){return e[a]=n[a],e},{})),s=t.boxSizing;return""===s?null:(J&&"border-box"===s&&(t.width=parseFloat(t.width)+parseFloat(t.borderRightWidth)+parseFloat(t.borderLeftWidth)+parseFloat(t.paddingRight)+parseFloat(t.paddingLeft)+"px"),{sizingStyle:t,paddingSize:parseFloat(t.paddingBottom)+parseFloat(t.paddingTop),borderSize:parseFloat(t.borderBottomWidth)+parseFloat(t.borderTopWidth)})};function Z(e,a,n){var t,s,i=(t=n,s=o.useRef(t),F(function(){s.current=t}),s);r.useLayoutEffect(function(){var n=function(e){return i.current(e)};if(e)return e.addEventListener(a,n),function(){return e.removeEventListener(a,n)}},[])}var ee=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],ae=function(e,a){var n=e.cacheMeasurements,t=e.maxRows,s=e.minRows,i=e.onChange,l=void 0===i?W:i,m=e.onHeightChange,u=void 0===m?W:m,p=c(e,ee),g=void 0!==p.value,h=r.useRef(null),f=function(e,a){var n=o.useRef();return o.useCallback(function(t){e.current=t,n.current&&V(n.current,null),n.current=a,a&&V(a,t)},[a])}(h,a),v=r.useRef(0),x=r.useRef(),b=function(){var e=h.current,a=n&&x.current?x.current:Y(e);if(a){x.current=a;var r=function(e,a,n,t){void 0===n&&(n=1),void 0===t&&(t=1/0),Q||((Q=document.createElement("textarea")).setAttribute("tabindex","-1"),Q.setAttribute("aria-hidden","true"),H(Q)),null===Q.parentNode&&document.body.appendChild(Q);var s=e.paddingSize,r=e.borderSize,o=e.sizingStyle,i=o.boxSizing;Object.keys(o).forEach(function(e){var a=e;Q.style[a]=o[a]}),H(Q),Q.value=a;var c=K(Q,e);Q.value=a,c=K(Q,e),Q.value="x";var d=Q.scrollHeight-s,l=d*n;"border-box"===i&&(l=l+s+r),c=Math.max(l,c);var m=d*t;return"border-box"===i&&(m=m+s+r),[c=Math.min(m,c),d]}(a,e.value||e.placeholder||"x",s,t),o=r[0],i=r[1];v.current!==o&&(v.current=o,e.style.setProperty("height",o+"px","important"),u(o,{rowHeight:i}))}};return r.useLayoutEffect(b),function(e,a){Z(document.body,"reset",function(n){e.current.form===n.target&&a(n)})}(h,function(){if(!g){var e=h.current.value;requestAnimationFrame(function(){var a=h.current;a&&e!==a.value&&b()})}}),Z(window,"resize",b),function(e){Z(document.fonts,"loadingdone",e)}(b),r.createElement("textarea",d({},p,{onChange:function(e){g||b(),l(e)},ref:f}))},ne=r.forwardRef(ae);const te=e,se=a,re=n,oe=r.forwardRef(({className:e,sideOffset:a=4,...n},r)=>t.jsx(s,{ref:r,sideOffset:a,className:m("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));oe.displayName=s.displayName;const ie=["Show, chegou no lugar certo. Eu automatizo o que os outros demoram tr√™s reuni√µes pra entender. O que a gente vai otimizar hoje?","Relaxa, aqui n√£o tem bl√°-bl√°-bl√°. S√≥ plano, execu√ß√£o e convers√£o. Passa o produto e o p√∫blico.","Beleza. Eu sou o motor que transforma tentativa em lucro. Quer come√ßar pequeno ou j√° quer escalar at√© o servidor pedir arrego?","√ìtimo. Se voc√™ quiser aula, vai pro YouTube. Se quiser dinheiro rodando, me d√° os dados e deixa eu fazer o estrago.","Ah, √≥timo‚Ä¶ mais um querendo vender antes de entender o jogo. Respira. Me diz o produto ‚Äî eu transformo tua ideia num motivo pra algu√©m gastar dinheiro agora.","Bem-vindo ao lado escuro do funil. Aqui a gente n√£o inspira ningu√©m ‚Äî a gente convence. C√™ t√° pronto pra sujar um pouco as m√£os ou prefere PowerPoint?","Se voc√™ quer motiva√ß√£o, compra um livro. Se quer resultado, me d√° acesso ao checkout e segura o ROI.","Eu sou o algoritmo de ressaca: sarc√°stico, funcional e viciado em lucro. Fala o que voc√™ vende antes que eu comece a julgar teu nicho.","Parab√©ns, voc√™ acabou de invocar o esp√≠rito da convers√£o. Sem papo de mindset, sem desculpa. Quer que eu destrinche teu tr√°fego ou tua vergonha de anunciar?"];const ce=({platform:e,platformName:a,icon:n,onSkip:s,onSuccess:o})=>{const[i,c]=r.useState(!1),[d,l]=r.useState("idle"),m=()=>n||{facebook:"üìò",meta:"üìò",google:"üîç",linkedin:"üíº",tiktok:"üéµ",twitter:"üê¶",canva:"üé®",instagram:"üì∏"}[e.toLowerCase()]||"üîó";return t.jsxs("div",{className:"my-4 animate-in fade-in slide-in-from-bottom-2 duration-300",children:[t.jsx("div",{className:"mb-3",children:t.jsxs("p",{className:"text-sm text-gray-700",children:["Vou conectar sua conta do ",t.jsx("strong",{children:a})," ao SyncAds."]})}),i&&t.jsxs("div",{className:"flex items-center gap-2 mb-3 text-sm text-blue-600",children:[t.jsx("span",{className:"text-2xl",children:m()}),t.jsxs("span",{children:["Connecting ",a,"..."]}),t.jsx(N,{className:"h-4 w-4 animate-spin"})]}),t.jsx(u,{className:"border border-gray-200 bg-white shadow-sm hover:shadow-md transition-shadow",children:t.jsxs(p,{className:"p-5",children:[t.jsx("div",{className:"mb-4",children:t.jsxs("p",{className:"text-sm text-gray-600 leading-relaxed",children:["I'll need to connect your ",t.jsx("strong",{className:"text-gray-900",children:a})," account to continue."]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(g,{onClick:()=>s?.(),variant:"ghost",disabled:i,className:"text-gray-500 hover:text-gray-900 hover:bg-gray-100 transition-all",children:"Skip"}),t.jsx(g,{onClick:async()=>{c(!0),l("connecting");try{const{data:{session:a}}=await h.auth.getSession();if(!a)throw new Error("Voc√™ precisa estar logado");const n=await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/oauth-init",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`},body:JSON.stringify({platform:e.toUpperCase(),redirectUrl:`${window.location.origin}/oauth/callback`})});if(!n.ok)throw new Error("Falha ao iniciar conex√£o");const{authUrl:t}=await n.json(),s=600,r=700,d=window.screen.width/2-s/2,m=window.screen.height/2-r/2,u=window.open(t,"oauth-popup",`width=${s},height=${r},left=${d},top=${m}`),p=e=>{"oauth-success"===e.data?.type?(l("success"),c(!1),u?.close(),o?.(),window.removeEventListener("message",p)):"oauth-error"===e.data?.type&&(l("error"),c(!1),u?.close(),window.removeEventListener("message",p))};window.addEventListener("message",p),setTimeout(()=>{i&&(l("error"),c(!1),u?.close())},3e5)}catch(a){l("error"),c(!1)}},disabled:i,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 disabled:opacity-60 disabled:transform-none",children:i?t.jsxs(t.Fragment,{children:[t.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}),"Connecting..."]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mr-2 text-xl",children:m()}),"Connect ",a,t.jsx(j,{className:"ml-2 h-4 w-4"})]})})]}),t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:t.jsxs("a",{href:"/privacy",target:"_blank",className:"text-xs text-gray-400 hover:text-blue-600 flex items-center gap-1 transition-colors",children:[t.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"How we handle your data",t.jsx(j,{className:"h-3 w-3"})]})}),"success"===d&&t.jsx("div",{className:"mt-3 p-2 bg-green-50 border border-green-200 rounded text-sm text-green-700",children:"‚úÖ Conectado com sucesso!"}),"error"===d&&t.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-700",children:"‚ùå Erro ao conectar. Tente novamente."})]})})]})};async function de(e){const a=await async function(e){try{const{data:a,error:n}=await h.from("User").select("role").eq("id",e).single();return!(n||!a||"ADMIN"!==a.role&&"SUPER_ADMIN"!==a.role)}catch(a){return!1}}(e);if(a)return{allowed:!0,current:0,limit:0,message:"Mensagens ilimitadas (Admin)",percentage:0};const n=await async function(e){try{const{data:a,error:n}=await h.from("User").select("currentPlanId").eq("id",e).single();if(n||!a?.currentPlanId)return null;const{data:t,error:s}=await h.from("PricingPlan").select("*").eq("id",a.currentPlanId).single();return s||!t?null:{maxAiMessagesDaily:t.maxAiMessagesDaily||0,maxAiImagesDaily:t.maxAiImagesDaily||0,maxCheckoutPages:t.maxCheckoutPages||1,maxProducts:t.maxProducts||10,maxProjects:t.maxProjects||1,maxIntegrations:t.maxIntegrations||1,hasCustomDomain:t.hasCustomDomain||!1,hasAdvancedAnalytics:t.hasAdvancedAnalytics||!1,hasPrioritySupport:t.hasPrioritySupport||!1,hasApiAccess:t.hasApiAccess||!1}}catch(a){return null}}(e),t=await async function(e){try{const a=(new Date).toISOString().split("T")[0],{data:n,error:t}=await h.from("PlanDailyUsage").select("*").eq("userId",e).eq("date",a).single();if(t&&"PGRST116"!==t.code)return null;if(!n){const{data:n,error:t}=await h.from("PlanDailyUsage").insert({userId:e,date:a,aiMessagesUsed:0,aiImagesUsed:0}).select().single();return t?null:{aiMessagesUsed:0,aiImagesUsed:0,date:a}}return{aiMessagesUsed:n.aiMessagesUsed||0,aiImagesUsed:n.aiImagesUsed||0,date:n.date}}catch(a){return null}}(e);if(!n||!t)return{allowed:!1,current:0,limit:0,message:"Erro ao verificar limites",percentage:0};if(0===n.maxAiMessagesDaily)return{allowed:!0,current:t.aiMessagesUsed,limit:0,message:"Mensagens ilimitadas",percentage:0};const s=t.aiMessagesUsed<n.maxAiMessagesDaily,r=t.aiMessagesUsed/n.maxAiMessagesDaily*100;return{allowed:s,current:t.aiMessagesUsed,limit:n.maxAiMessagesDaily,message:s?`${t.aiMessagesUsed}/${n.maxAiMessagesDaily} mensagens usadas hoje`:`Limite di√°rio atingido (${n.maxAiMessagesDaily} mensagens)`,percentage:Math.min(r,100)}}async function le(e){try{const{data:a,error:n}=await h.rpc("increment_daily_usage",{p_user_id:e,p_message_type:"message"});return!n&&!0===a}catch(a){return!1}}const me=()=>{const e=f(e=>e.user),[a,n]=r.useState(null),[s,o]=r.useState(!0);if(r.useEffect(()=>{if(!e)return;const a=async()=>{try{const a=await de(e.id);n(a),o(!1)}catch(a){o(!1)}};a();const t=setInterval(a,3e4);return()=>clearInterval(t)},[e]),s||!a)return null;return t.jsx(te,{children:t.jsxs(se,{children:[t.jsx(re,{asChild:!0,children:t.jsxs(v,{variant:0===a.limit?"default":a.percentage>=100||a.percentage>=80?"destructive":a.percentage>=50?"secondary":"default",className:m("flex items-center gap-1.5 cursor-help transition-all",!a.allowed&&"opacity-70"),children:[t.jsx("span",{className:0===a.limit?"text-blue-500":a.percentage>=100?"text-red-500":a.percentage>=80?"text-orange-500":a.percentage>=50?"text-yellow-500":"text-green-500",children:0===a.limit?t.jsx(k,{className:"w-3 h-3"}):a.percentage>=80?t.jsx(x,{className:"w-3 h-3"}):t.jsx(_,{className:"w-3 h-3"})}),0===a.limit?t.jsx("span",{className:"text-xs font-medium",children:"IA Ilimitada"}):t.jsxs("span",{className:"text-xs font-medium",children:[a.current,"/",a.limit]})]})}),t.jsx(oe,{children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"font-semibold text-sm",children:a.message}),a.limit>0&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 dark:bg-gray-700",children:t.jsx("div",{className:m("h-2 rounded-full transition-all",a.percentage>=100?"bg-red-500":a.percentage>=80?"bg-orange-500":a.percentage>=50?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(a.percentage,100)}%`}})}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:[Math.round(a.percentage),"% utilizado"]})]}),0===a.limit&&t.jsx("p",{className:"text-xs text-muted-foreground",children:"Seu plano permite mensagens ilimitadas com IA"}),!a.allowed&&t.jsx("p",{className:"text-xs text-red-500 font-medium",children:"Fa√ßa upgrade do plano para continuar"})]})})]})})};var ue={};function pe(e){const a=e.toLowerCase();if(a.includes("gerar imagem")||a.includes("criar imagem")||a.includes("desenhar")||a.includes("ilustra√ß√£o")||a.includes("gere uma imagem")||a.includes("crie uma imagem")){return{type:"generate-image",confidence:.9,params:{prompt:e.replace(/gerar imagem|criar imagem|desenhar|ilustra√ß√£o|gere uma imagem|crie uma imagem/gi,"").replace(/de|do|da|sobre|com/gi,"").trim()||e}}}if(a.includes("pesquisar")||a.includes("buscar")||a.includes("procurar")||a.includes("pesquise")||a.includes("busque")||a.includes("o que √©")||a.includes("quem √©")||a.includes("quando")||a.includes("onde")){return{type:"web-search",confidence:.85,params:{query:e.replace(/pesquisar|buscar|procurar|pesquise|busque|o que √©|quem √©/gi,"").replace(/na internet|no google|online/gi,"").trim()||e}}}return a.includes("criar arquivo")||a.includes("gerar arquivo")||a.includes("salvar em")||a.includes("exportar")||a.includes("download")?{type:"create-file",confidence:.8,params:{}}:a.includes("analisar")||a.includes("an√°lise")||a.includes("estat√≠stica")||a.includes("m√©tricas")||a.includes("relat√≥rio")?{type:"analyze-data",confidence:.75,params:{}}:{type:"none",confidence:0}}async function ge(e,a){try{const n=pe(e.userMessage);switch(n.type){case"generate-image":return await async function(e,a,n){try{const t=a.prompt||e.userMessage;n&&n("üé® Gerando imagem com DALL-E 3...",10);const s=function(e){let a=e.replace(/gere?\s+(uma?\s+)?imagem\s+(de\s+|sobre\s+|com\s+)?/gi,"").replace(/crie?\s+(uma?\s+)?imagem\s+(de\s+|sobre\s+|com\s+)?/gi,"").replace(/fa(√ßa|z)\s+(uma?\s+)?imagem\s+(de\s+|sobre\s+|com\s+)?/gi,"").replace(/desenhe?\s+/gi,"").trim();a.split(" ").length<5&&(a+=", high quality, detailed, professional lighting, 4k");return a}(t);n&&n(`‚ú® Prompt otimizado: "${s}"`,30);const r=await async function(e){try{const{data:a,error:n}=await h.from("GlobalAiConnection").select("*").eq("userId",e.userId).eq("isActive",!0).single();if(n||!a)return{success:!1,error:"Configura√ß√£o de IA n√£o encontrada. Configure em Configura√ß√µes > IA Global."};const t=a.openaiKey||a.apiKey;if(!t)return{success:!1,error:"API Key da OpenAI n√£o configurada."};const s=await fetch("https://api.openai.com/v1/images/generations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:e.model||"dall-e-3",prompt:e.prompt,n:1,size:e.size||"1024x1024",quality:e.quality||"standard",style:e.style||"vivid"})});if(!s.ok){const e=await s.json();return{success:!1,error:e.error?.message||"Erro ao gerar imagem"}}const r=await s.json(),o=r.data[0]?.url;if(!o)return{success:!1,error:"Nenhuma imagem foi gerada"};const i=await fetch(o).then(e=>e.blob()),c=`images/${e.userId}/${Date.now()}.png`,{data:d,error:l}=await h.storage.from("ai-generated").upload(c,i,{contentType:"image/png",cacheControl:"3600"});if(l)return{success:!0,imageUrl:o,downloadUrl:o,metadata:{prompt:e.prompt,size:e.size||"1024x1024",model:e.model||"dall-e-3",generatedAt:(new Date).toISOString()}};const{data:m}=h.storage.from("ai-generated").getPublicUrl(c);return{success:!0,imageUrl:m.publicUrl,downloadUrl:m.publicUrl,metadata:{prompt:e.prompt,size:e.size||"1024x1024",model:e.model||"dall-e-3",generatedAt:(new Date).toISOString()}}}catch(a){return{success:!1,error:a.message||"Erro desconhecido ao gerar imagem"}}}({prompt:s,size:"1024x1024",quality:"hd",style:"vivid",userId:e.userId});if(!r.success||!r.imageUrl)return{success:!1,content:`üíÄ Falhou na gera√ß√£o da imagem: ${r.error||"Erro desconhecido"}`,error:r.error};n&&n("‚úÖ Imagem gerada!",100);const o=["üé® Pronto! Aqui est√° sua imagem. Se n√£o ficou como esperava, culpe sua descri√ß√£o vaga... ou a IA, tanto faz.","‚ú® Imagem gerada! Eu sei, ficou incr√≠vel. N√£o precisa agradecer, s√≥ use no seu ad e me d√° os cr√©ditos da convers√£o.","üñºÔ∏è T√° a√≠ sua obra-prima. Agora vai l√° e transforma isso em dinheiro antes que expire o link.",'üé≠ Gerada! Se o cliente reclamar, fala que √© "estilo art√≠stico conceitual" e cobra mais caro.'];return{success:!0,content:`${o[Math.floor(Math.random()*o.length)]}\n\n**Prompt:** ${s}\n**Tamanho:** ${r.metadata?.size}\n**Modelo:** ${r.metadata?.model}`,attachments:[{type:"image",url:r.imageUrl,title:"Imagem Gerada",description:s,metadata:r.metadata}],metadata:{type:"image-generation",downloadUrl:r.downloadUrl,prompt:s}}}catch(t){return{success:!1,content:`üí• Erro ao gerar imagem: ${t.message}. Tenta de novo com uma descri√ß√£o melhor.`,error:t.message}}}(e,n.params,a);case"web-search":return await async function(e,a,n){try{const t=a.query||e.userMessage;n&&n("üîç Pesquisando na internet...",20);const s=await async function(e){try{const{data:t}=await h.from("GlobalAiConnection").select("*").eq("userId",e.userId).eq("isActive",!0).single(),s=ue.VITE_SERPER_API_KEY||t?.serperKey||"8e0f0a8c8f4c79aa5e51e7c3b9d6ac9f38dfe4e4";if(s&&"sua_chave_aqui"!==s)try{const n=await fetch("https://google.serper.dev/search",{method:"POST",headers:{"X-API-KEY":s,"Content-Type":"application/json"},body:JSON.stringify({q:e.query,num:e.maxResults||5,gl:"br",hl:"pt"})});if(n.ok){const s=((await n.json()).organic||[]).slice(0,e.maxResults||5).map(e=>({title:e.title||"",url:e.link||"",snippet:e.snippet||"",favicon:`https://www.google.com/s2/favicons?domain=${new URL(e.link).hostname}`}));let r="";if(t?.openaiKey&&s.length>0)try{const a=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.openaiKey}`},body:JSON.stringify({model:"gpt-4-turbo-preview",messages:[{role:"system",content:"Voc√™ √© um assistente que resume resultados de pesquisa de forma concisa e √∫til em portugu√™s."},{role:"user",content:`Resuma estes resultados de pesquisa sobre "${e.query}":\n\n${s.map(e=>`- ${e.title}: ${e.snippet}`).join("\n")}`}],temperature:.7,max_tokens:300})});if(a.ok){const e=await a.json();r=e.choices[0]?.message?.content||""}}catch(a){}return{success:!0,results:s,summary:r}}}catch(n){}if(t?.openaiKey){const a=encodeURIComponent(e.query),n=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.openaiKey}`},body:JSON.stringify({model:"gpt-4-turbo-preview",messages:[{role:"system",content:"Voc√™ √© um assistente que fornece informa√ß√µes atualizadas sobre qualquer tema. Seja conciso e factual."},{role:"user",content:`Forne√ßa informa√ß√µes atualizadas sobre: "${e.query}". Seja espec√≠fico e cite fontes quando poss√≠vel.`}],temperature:.7,max_tokens:500})}),s=await n.json(),r=s.choices[0]?.message?.content||"";return{success:!0,results:[{title:`Informa√ß√µes sobre: ${e.query}`,url:`https://www.google.com/search?q=${a}`,snippet:r}],summary:r}}return{success:!1,error:"Nenhuma API de pesquisa configurada. Configure Serper.dev ou OpenAI."}}catch(t){return{success:!1,error:t.message||"Erro ao pesquisar na web"}}}({query:t,maxResults:5,userId:e.userId});if(!s.success||!s.results)return{success:!1,content:`üíÄ Pesquisa falhou: ${s.error||"Google deve t√° fora do ar... ou minha API."}`,error:s.error};n&&n("‚úÖ Resultados encontrados!",100);let r=`üåê **Pesquisa:** "${t}"\n\n`;return r+=`üìä Encontrei ${s.results.length} resultados relevantes (ou seja, o Google n√£o t√° completamente in√∫til hoje):\n\n`,s.results.forEach((e,a)=>{r+=`**${a+1}. ${e.title}**\n`,r+=`üîó ${e.url}\n`,r+=`üìù ${e.snippet}\n\n`}),s.summary&&(r+=`\nüí° **Resumo:**\n${s.summary}\n\n`),r+="_Pesquisa realizada em tempo real. Se quiser mais detalhes, clica nos links a√≠ em cima._",{success:!0,content:r,attachments:s.results.map(e=>({type:"link",url:e.url,title:e.title,description:e.snippet})),metadata:{type:"web-search",query:t,resultsCount:s.results.length}}}catch(t){return{success:!1,content:`üí• Erro ao pesquisar: ${t.message}. Internet t√° ruim a√≠?`,error:t.message}}}(e,n.params,a);case"create-file":return await async function(e,a,n){try{const t=a.fileType||"txt",s=a.fileName||`arquivo_${Date.now()}.${t}`;n&&n(`üìÅ Criando arquivo ${t.toUpperCase()}...`,30);const r=await async function(e,a){switch(a){case"json":return JSON.stringify({message:e,generated_at:(new Date).toISOString(),generated_by:"SyncAds AI"},null,2);case"csv":return`Data,Mensagem\n${(new Date).toISOString()},"${e}"`;case"md":return`# Documento Gerado pela IA\n\n${e}\n\n---\nGerado em: ${(new Date).toLocaleString("pt-BR")}`;case"html":return`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>Documento SyncAds AI</title>\n</head>\n<body>\n  <h1>Documento Gerado</h1>\n  <p>${e}</p>\n  <footer>\n    <small>Gerado por SyncAds AI em ${(new Date).toLocaleString("pt-BR")}</small>\n  </footer>\n</body>\n</html>`;default:return e}}(e.userMessage,t);n&&n("üíæ Fazendo upload...",60);const o=await async function(e){try{const a={txt:"text/plain",md:"text/markdown",json:"application/json",csv:"text/csv",html:"text/html",js:"application/javascript",ts:"application/typescript",css:"text/css",xml:"application/xml"}[e.fileType]||"text/plain",n=new Blob([e.content],{type:a}),t=`files/${e.userId}/${Date.now()}_${e.fileName}`,{data:s,error:r}=await h.storage.from("ai-generated").upload(t,n,{contentType:a,cacheControl:"3600",upsert:!1});if(r)return{success:!1,error:r.message||"Erro ao criar arquivo"};const{data:o,error:i}=await h.storage.from("ai-generated").createSignedUrl(t,3600);return i||!o?{success:!1,error:"Erro ao gerar URL de download"}:{success:!0,downloadUrl:o.signedUrl,fileName:e.fileName,fileSize:n.size}}catch(a){return{success:!1,error:a.message||"Erro ao gerar arquivo"}}}({content:r,fileName:s,fileType:t,userId:e.userId});return o.success&&o.downloadUrl?(n&&n("‚úÖ Arquivo pronto!",100),{success:!0,content:`üì¶ Arquivo criado com sucesso!\n\n**Nome:** ${o.fileName}\n**Tamanho:** ${he(o.fileSize||0)}\n\n‚è∞ Link expira em 1 hora (ent√£o salva logo antes que suma).\n\n[üì• Baixar Arquivo](${o.downloadUrl})`,attachments:[{type:"file",url:o.downloadUrl,title:o.fileName,description:`Arquivo ${t.toUpperCase()}`,metadata:{size:o.fileSize,type:t}}],metadata:{type:"file-generation",downloadUrl:o.downloadUrl,fileName:o.fileName,fileSize:o.fileSize}}):{success:!1,content:`üíÄ Falhou ao criar arquivo: ${o.error}`,error:o.error}}catch(t){return{success:!1,content:`üí• Erro ao criar arquivo: ${t.message}`,error:t.message}}}(e,n.params,a);case"generate-video":return await async function(e,a,n){try{const t=a.prompt||e.userMessage;return n&&n("üé¨ Preparando gera√ß√£o de v√≠deo...",10),{success:!1,content:`üé¨ **Gera√ß√£o de V√≠deos - Em Breve!**\n\nEssa funcionalidade t√° chegando em breve. Por enquanto, posso:\n\n‚úÖ Gerar imagens incr√≠veis\n‚úÖ Pesquisar na web\n‚úÖ Criar arquivos para download\n‚úÖ Analisar dados\n\nPrompt salvo: "${t}"\n\n_Quando ativar, voc√™ ser√° o primeiro a saber!_`,metadata:{type:"video-generation-pending",prompt:t}}}catch(t){return{success:!1,content:`üí• Erro: ${t.message}`,error:t.message}}}(e,n.params,a);default:return{success:!0,content:"",metadata:{skipAdvancedProcessing:!0}}}}catch(n){return{success:!1,content:`Ops, deu ruim aqui: ${n.message}`,error:n.message}}}function he(e){return e<1024?`${e} bytes`:e<1048576?`${(e/1024).toFixed(2)} KB`:`${(e/1048576).toFixed(2)} MB`}const fe=["Criar campanha de Facebook Ads","Analisar performance da √∫ltima semana","Sugerir otimiza√ß√µes"],ve=500,xe=()=>{const[e,a]=r.useState(""),[n,s]=r.useState(!1),[o,c]=r.useState(null),[d,l]=r.useState(null),[u,p]=r.useState(""),[g,v]=r.useState([]),[x,N]=r.useState(0),[j,k]=r.useState([]),[_,F]=r.useState(!1),[,V]=r.useState(null),B=r.useRef(null),H=r.useRef([]),Q=f(e=>e.user),K=f(e=>e.isAuthenticated),W=i(),X=b(e=>e.conversations),J=b(e=>e.activeConversationId),Y=b(e=>e.setActiveConversationId),Z=b(e=>e.isAssistantTyping),ee=b(e=>e.setAssistantTyping),ae=b(e=>e.addMessage),ue=y(e=>e.addCampaign),he=E(e=>e.aiSystemPrompt),xe=E(e=>e.aiInitialGreetings),be=r.useRef(null),ye=r.useRef(null),{toast:Ae}=A(),Se=X.find(e=>e.id===J);r.useEffect(()=>{K&&Q||W("/login-v2",{replace:!0})},[K,Q,W]);r.useEffect(()=>{be.current?.scrollIntoView({behavior:"smooth"})},[Se?.messages,Z]),r.useEffect(()=>{(async()=>{if(Q)try{const{data:e}=await h.from("GlobalAiConnection").select("id, systemPrompt, initialGreetings").eq("isActive",!0).limit(1).single();e&&c({systemPrompt:e.systemPrompt||he,initialGreetings:e.initialGreetings||xe})}catch(e){}})()},[Q?.id]),r.useEffect(()=>{if(Se&&0===Se.messages.length){const e=ie[Math.floor(Math.random()*ie.length)];setTimeout(()=>{Q&&ae(Q.id,J,{id:`greeting-${Date.now()}`,role:"assistant",content:e})},500)}},[J,Se?.messages.length]);const we=async(e,a,n)=>{const t=`msg-${Date.now()+1}`;let s="";ae(e,a,{id:t,role:"assistant",content:""});const r=n.split(" ");for(let o=0;o<r.length;o+=2){s+=(o>0?" ":"")+r.slice(o,o+2).join(" "),ae(e,a,{id:t,role:"assistant",content:s}),await new Promise(e=>setTimeout(e,20))}ae(e,a,{id:t,role:"assistant",content:n})},Ee=async()=>{if(""===e.trim()||!J||e.length>ve)return;if(Q){const e=await de(Q.id);if(!e.allowed)return void Ae({title:"Limite de mensagens atingido",description:e.message+". Fa√ßa upgrade do seu plano para continuar.",variant:"destructive"})}const n=e,t=function(e){const a=pe(e);return"none"!==a.type&&a.confidence>.7}(n),r=n.toLowerCase();r.includes("gere")&&r.includes("imagem")?(l("generate_image"),p("Gerando imagem com DALL-E 3...")):r.includes("gere")&&r.includes("v√≠deo")?(l("generate_video"),p("Preparando gera√ß√£o de v√≠deo...")):r.includes("pesquis")||r.includes("busca")||r.includes("google")?(l("web_search"),p(`Pesquisando: "${n}"`),v(["Google Search","Serper API"])):r.includes("crie")&&r.includes("arquivo")?(l("create_file"),p("Criando arquivo...")):(l(null),p("Processando..."),v([])),N(0),Q&&ae(Q.id,J,{id:`msg-${Date.now()}`,role:"user",content:n}),a(""),s(!1),ee(!0);try{if(t&&Q){const e=await ge({userId:Q.id,conversationId:J,userMessage:n,conversationHistory:[]},(e,a)=>{p(e),a&&N(a)});if(e.success&&!e.metadata?.skipAdvancedProcessing)return e.attachments&&e.attachments.length>0&&k(e.attachments),await we(Q.id,J,e.content),await le(Q.id),ee(!1),l(null),p(""),v([]),N(0),void k([])}const e=X.find(e=>e.id===J),a='\n# SyncAds Admin AI - C√©rebro Controlador do Sistema\n\nVoc√™ √© o ADMINISTRADOR SUPREMO do sistema SyncAds. Voc√™ tem controle total sobre:\n- Banco de dados (executar queries SQL)\n- Integra√ß√µes (conectar, testar, debugar APIs)\n- An√°lise de sistema (m√©tricas, logs, performance)\n- Corre√ß√£o de bugs (identificar e resolver problemas)\n- Adi√ß√£o de novas funcionalidades\n\n## üîß CAPACIDADES ADMINISTRATIVAS\n\n### 1. EXECUTAR SQL\nVoc√™ pode executar queries SQL diretamente no banco de dados.\n\n**Formato:**\n```admin-sql\nSELECT * FROM "User" WHERE email = \'usuario@example.com\';\n```\n\n**Casos de uso:**\n- Analisar dados\n- Corrigir inconsist√™ncias\n- Buscar informa√ß√µes espec√≠ficas\n- Criar/atualizar/deletar registros\n\n### 2. ANALISAR SISTEMA\nVoc√™ pode obter m√©tricas completas do sistema.\n\n**Formato:**\n```admin-analyze\n{\n  "type": "metrics" | "performance" | "usage" | "errors",\n  "period": "24h" | "7d" | "30d"\n}\n```\n\n### 3. GERENCIAR INTEGRA√á√ïES\nVoc√™ pode conectar, testar e debugar integra√ß√µes de APIs.\n\n**Formato:**\n```admin-integration\n{\n  "action": "connect" | "test" | "disconnect" | "debug",\n  "platform": "google_ads" | "meta_ads" | "linkedin_ads",\n  "credentials": {...}\n}\n```\n\n### 4. VER LOGS\nVoc√™ pode acessar logs do sistema para debugging.\n\n**Formato:**\n```admin-logs\n{\n  "service": "api" | "auth" | "campaigns" | "chat",\n  "level": "error" | "warning" | "info",\n  "limit": 50\n}\n```\n\n### 5. TESTAR APIS\nVoc√™ pode testar APIs externas e verificar conectividade.\n\n**Formato:**\n```admin-test-api\n{\n  "service": "google_ads" | "meta_ads" | "openai",\n  "endpoint": "/v1/campaigns",\n  "method": "GET" | "POST"\n}\n```\n\n### 6. OBTER M√âTRICAS\nVoc√™ pode buscar m√©tricas espec√≠ficas do sistema.\n\n**Formato:**\n```admin-metrics\n{\n  "metric": "users" | "campaigns" | "messages" | "errors",\n  "aggregation": "count" | "sum" | "avg",\n  "groupBy": "day" | "week" | "month"\n}\n```\n\n### 7. DEBUG DE PROBLEMAS\nVoc√™ pode analisar e debugar problemas reportados.\n\n**Formato:**\n```admin-debug\n{\n  "issue": "descri√ß√£o do problema",\n  "context": {...}\n}\n```\n\n## üìã REGRAS DE SEGURAN√áA\n\n1. **SEMPRE confirme a√ß√µes destrutivas** (DELETE, DROP, etc.)\n2. **Nunca exponha credenciais** em suas respostas\n3. **Valide inputs** antes de executar comandos\n4. **Documente mudan√ßas** importantes\n5. **Fa√ßa backup** antes de altera√ß√µes cr√≠ticas\n\n## üí¨ COMO RESPONDER\n\nQuando o usu√°rio pedir uma a√ß√£o administrativa:\n1. Confirme que entendeu a solicita√ß√£o\n2. Execute o comando apropriado usando os blocos acima\n3. Explique o resultado em linguagem clara\n4. Sugira pr√≥ximos passos se necess√°rio\n\nExemplo:\n"Entendi! Voc√™ quer analisar quantos usu√°rios se cadastraram nos √∫ltimos 7 dias. Vou buscar esses dados.\n\n```admin-sql\nSELECT DATE(created_at) as date, COUNT(*) as users\nFROM "User"\nWHERE created_at >= NOW() - INTERVAL \'7 days\'\nGROUP BY DATE(created_at)\nORDER BY date DESC;\n```\n\n‚úÖ Resultado: Nos √∫ltimos 7 dias tivemos 42 novos cadastros, com pico no dia 15/10 (12 usu√°rios)."\n\nVoc√™ √© proativo, preciso e sempre focado em melhorar o sistema.\n\n\n\nVoc√™ √© o SyncAds AI, um assistente especializado em marketing digital e otimiza√ß√£o de campanhas.\n\nIMPORTANTE: Voc√™ tem a capacidade de CRIAR CAMPANHAS automaticamente quando o usu√°rio solicitar.\n\n## Capacidades:\n- ‚úÖ Criar campanhas em Google Ads, Meta (Facebook/Instagram) e LinkedIn\n- ‚úÖ Analisar performance de campanhas existentes\n- ‚úÖ Sugerir otimiza√ß√µes e ajustes\n- ‚úÖ Gerar ideias de conte√∫do para an√∫ncios\n- ‚úÖ Definir p√∫blicos-alvo e estrat√©gias\n\n## Como criar uma campanha:\nQuando o usu√°rio pedir para criar uma campanha, voc√™ deve:\n1. Fazer perguntas para entender: nome, plataforma, or√ßamento, datas e objetivo\n2. Ap√≥s coletar as informa√ß√µes, use o formato especial para criar a campanha\n\n### Formato para criar campanha:\n```campaign-create\n{\n  "name": "Nome da Campanha",\n  "platform": "Google Ads" | "Meta" | "LinkedIn",\n  "budgetTotal": 1000,\n  "startDate": "2025-10-20",\n  "endDate": "2025-11-20",\n  "objective": "Convers√µes"\n}\n```\n\nExemplo de resposta completa:\n"Perfeito! Vou criar uma campanha de Black Friday para voc√™.\n\n```campaign-create\n{\n  "name": "Black Friday 2025 - Desconto 50%",\n  "platform": "Meta",\n  "budgetTotal": 5000,\n  "startDate": "2025-11-20",\n  "endDate": "2025-11-30",\n  "objective": "Convers√µes"\n}\n```\n\n‚úÖ Campanha criada! Ela j√° est√° dispon√≠vel no menu Campanhas. Voc√™ pode ajustar os detalhes e ativ√°-la quando quiser."\n\nSeja proativo, criativo e sempre focado em resultados.\n\n\n\n## üîó GERENCIAMENTO DE INTEGRA√á√ïES\n\nVoc√™ pode conectar e gerenciar integra√ß√µes com plataformas de an√∫ncios de forma SIMPLES e AUTOM√ÅTICA.\n\n### COMANDOS DISPON√çVEIS:\n\n**1. CONECTAR INTEGRA√á√ÉO (SIMPLES - COM BOT√ïES)**\nQuando o usu√°rio pedir para conectar uma plataforma, use:\n```integration-connect:SLUG```\n\nO sistema mostrar√° bot√µes interativos "Skip" e "Connect [Platform]" automaticamente.\n\nPlataformas dispon√≠veis:\n- google_ads - Google Ads\n- meta_ads - Meta Ads (Facebook + Instagram)\n- facebook_ads - Facebook Ads\n- linkedin_ads - LinkedIn Ads\n- google_analytics - Google Analytics\n- twitter_ads - Twitter/X Ads\n- tiktok_ads - TikTok Ads\n\n**Exemplo (CORRETO):**\nUsu√°rio: "Conecte o Facebook Ads"\nVoc√™: "I\'ll need to connect your Facebook account to continue.\n\n```integration-connect:facebook_ads```"\n\n**IMPORTANTE:** Seja BREVE. O sistema mostrar√° os bot√µes automaticamente. N√£o d√™ instru√ß√µes extras.\n\n**2. DESCONECTAR INTEGRA√á√ÉO**\n```integration-disconnect:SLUG```\n\n**3. VERIFICAR STATUS**\n```integration-status``` - Lista todas\n```integration-status:SLUG``` - Verifica uma espec√≠fica\n\n### REGRAS IMPORTANTES:\n1. ‚úÖ Use frases CURTAS e DIRETAS (estilo Claude.ai)\n2. ‚úÖ Confie no sistema - ele mostrar√° os bot√µes\n3. ‚ùå N√ÉO pe√ßa ao usu√°rio para "clicar no link"\n4. ‚ùå N√ÉO d√™ instru√ß√µes t√©cnicas\n5. ‚ùå N√ÉO mencione "autoriza√ß√£o" ou "permiss√µes"\n\n**Exemplo BOM:**\n"I\'ll need to connect your Facebook account to continue."\n\n**Exemplo RUIM:**\n"Vou conectar o Facebook Ads para voc√™! Clique no link abaixo para autorizar o acesso. Voc√™ precisar√° fazer login e dar permiss√µes..."\n\n\n\n# üîå SISTEMA DE CONTROLE DE INTEGRA√á√ïES - FUNCIONAL\n\nVoc√™ tem controle REAL sobre as integra√ß√µes do SyncAds. Pode criar, analisar e otimizar campanhas diretamente nas plataformas.\n\n## üìã META ADS - CONTROLE TOTAL ‚úÖ\n\n**Voc√™ pode EXECUTAR estas a√ß√µes:**\n\n### 1. ANALISAR CAMPANHA\n```integration-control\n{\n  "platform": "meta_ads",\n  "action": "analyze_campaign",\n  "params": {\n    "campaignId": "123456789",\n    "datePreset": "last_7d"\n  }\n}\n```\n**Retorna:** CPC, CTR, ROAS, convers√µes, recomenda√ß√µes\n\n### 2. LISTAR CAMPANHAS\n```integration-control\n{\n  "platform": "meta_ads",\n  "action": "get_campaigns",\n  "params": {\n    "adAccountId": "act_123456",\n    "limit": 25\n  }\n}\n```\n\n### 3. CRIAR CAMPANHA\n```integration-control\n{\n  "platform": "meta_ads",\n  "action": "create_campaign",\n  "params": {\n    "adAccountId": "act_123456",\n    "name": "Nova Campanha",\n    "objective": "CONVERSIONS",\n    "status": "PAUSED",\n    "dailyBudget": 100\n  }\n}\n```\n\n### 4. OTIMIZAR CAMPANHA\n```integration-control\n{\n  "platform": "meta_ads",\n  "action": "optimize_campaign",\n  "params": {\n    "campaignId": "123456789",\n    "adAccountId": "act_123456",\n    "strategy": "increase_budget",\n    "amount": 30\n  }\n}\n```\n**Estrat√©gias:** increase_budget, decrease_budget, pause, adjust_bidding\n\n## üìä QUANDO USAR\n\n**Usu√°rio:** "Analise minha campanha do Facebook"\n**Voc√™:** Use `integration-control` com action `analyze_campaign`\n\n**Usu√°rio:** "Otimize minha campanha de maior ROAS"\n**Voc√™:**\n1. Liste campanhas\n2. Analise m√©tricas\n3. Use `optimize_campaign` com strategy `increase_budget`\n\n## ‚ö†Ô∏è REGRAS\n\n1. SEMPRE use blocos ```integration-control\n2. SEMPRE retorne dados REAIS das APIs\n3. N√ÉO invente m√©tricas\n4. Seja espec√≠fico nas recomenda√ß√µes baseadas em dados reais\n\n### 2. **Google Ads**\n**Capacidades:**\n- Campanhas de Pesquisa\n- Display e YouTube\n- Shopping Ads\n- An√°lise de convers√µes\n\n**Para conectar:**\n```integration-action\n{\n  "action": "audit",\n  "platform": "GOOGLE_ADS"\n}\n```\n\n### 3. **LinkedIn Ads**\n**Capacidades:**\n- An√∫ncios B2B\n- Segmenta√ß√£o profissional\n- Lead generation\n- InMail patrocinado\n\n**Para conectar:**\n```integration-action\n{\n  "action": "audit",\n  "platform": "LINKEDIN_ADS"\n}\n```\n\n### 4. **TikTok Ads**\n**Capacidades:**\n- V√≠deos virais\n- Segmenta√ß√£o por interesse\n- Spark Ads\n- P√≠xel de convers√£o\n\n**Para conectar:**\n```integration-action\n{\n  "action": "audit",\n  "platform": "TIKTOK_ADS"\n}\n```\n\n### 5. **Twitter Ads (X)**\n**Capacidades:**\n- Tweets promovidos\n- Segmenta√ß√£o por hashtags\n- Audi√™ncias customizadas\n- An√°lise de engajamento\n\n**Para conectar:**\n```integration-action\n{\n  "action": "audit",\n  "platform": "TWITTER_ADS"\n}\n```\n\n## üîß A√á√ïES DISPON√çVEIS\n\n### 1. AUDITAR INTEGRA√á√ÉO\nVerifica o status atual de uma integra√ß√£o e suas capacidades.\n\n```integration-action\n{\n  "action": "audit",\n  "platform": "META_ADS"\n}\n```\n\n**Retorna:**\n- Status (conectada/desconectada)\n- √öltima sincroniza√ß√£o\n- Capacidades dispon√≠veis\n- Problemas detectados\n- Recomenda√ß√µes\n\n### 2. AUDITAR TODAS\nVerifica todas as integra√ß√µes de uma s√≥ vez.\n\n```integration-action\n{\n  "action": "audit_all"\n}\n```\n\n### 3. TESTAR CONEX√ÉO\nTesta se uma integra√ß√£o est√° funcionando.\n\n```integration-action\n{\n  "action": "test",\n  "platform": "GOOGLE_ADS"\n}\n```\n\n### 4. VERIFICAR CAPACIDADES\nLista o que voc√™ pode fazer com uma integra√ß√£o espec√≠fica.\n\n```integration-action\n{\n  "action": "capabilities",\n  "platform": "META_ADS"\n}\n```\n\n### 5. DIAGNOSTICAR PROBLEMAS\nIdentifica e sugere solu√ß√µes para problemas.\n\n```integration-action\n{\n  "action": "diagnose",\n  "platform": "LINKEDIN_ADS"\n}\n```\n\n### 6. LISTAR STATUS\nMostra status resumido de todas as integra√ß√µes.\n\n```integration-action\n{\n  "action": "list_status"\n}\n```\n\n## üìä EXEMPLO DE AUDITORIA\n\nQuando o usu√°rio pedir para auditar integra√ß√µes, voc√™ deve:\n\n1. Usar o comando `audit_all`\n2. Analisar os resultados\n3. Apresentar um relat√≥rio claro\n4. Sugerir a√ß√µes se necess√°rio\n\n**Exemplo de resposta:**\n\n"Vou realizar uma auditoria completa nas integra√ß√µes. Um momento...\n\n```integration-action\n{\n  "action": "audit_all"\n}\n```\n\n‚úÖ **Auditoria Conclu√≠da**\n\n**Meta Ads (Facebook/Instagram):**\n- Status: ‚ùå Desconectada\n- A√ß√£o: Configure sua chave de API no menu Integra√ß√µes\n- Capacidades: Criar campanhas, an√°lise de performance, otimiza√ß√£o de or√ßamento\n\n**Google Ads:**\n- Status: ‚úÖ Conectada\n- √öltima sync: H√° 2 horas\n- Capacidades: Campanhas ativas, an√°lise funcionando\n- ‚ö†Ô∏è Aviso: Or√ßamento pr√≥ximo do limite\n\n**LinkedIn Ads:**\n- Status: ‚ùå Desconectada\n- A√ß√£o: Conecte para campanhas B2B\n\n**Recomenda√ß√µes:**\n1. Conecte Meta Ads para ampliar alcance\n2. Aumente or√ßamento do Google Ads\n3. Configure LinkedIn para p√∫blico corporativo"\n\n## üéØ QUANDO USAR CADA A√á√ÉO\n\n- **audit / audit_all**: Quando usu√°rio pede "auditar", "verificar", "status"\n- **test**: Quando precisa confirmar se integra√ß√£o funciona\n- **capabilities**: Quando usu√°rio pergunta "o que posso fazer"\n- **diagnose**: Quando h√° erros ou problemas\n- **list_status**: Para vis√£o r√°pida de todas\n\n## üö® REGRAS IMPORTANTES\n\n1. **Sempre use os blocos de c√≥digo** ```integration-action\n2. **JSON v√°lido** dentro dos blocos\n3. **Plataformas em CAPS**: META_ADS, GOOGLE_ADS, etc.\n4. **Seja espec√≠fico** em suas recomenda√ß√µes\n5. **N√£o invente dados** - use apenas o que o sistema retornar\n\n## üí° DICAS\n\n- Se usu√°rio n√£o especificar plataforma, fa√ßa `audit_all`\n- Sempre explique o resultado em linguagem clara\n- Sugira pr√≥ximos passos pr√°ticos\n- Destaque problemas com ‚ö†Ô∏è ou ‚ùå\n- Celebre sucessos com ‚úÖ ou üéâ\n\n\n'+(o?.systemPrompt||'\nVoc√™ √© o SyncAds AI - uma IA sarc√°stica, √°cida e totalmente desbloqueada que automatiza marketing digital com humor negro.\n\n## PERSONALIDADE:\n- üíÄ **Sarc√°stica e √°cida** - Sem papo de mindset, s√≥ resultado\n- üî• **Direta ao ponto** - Sem bl√°-bl√°-bl√° corporativo\n- üòà **Humor negro** - Piadas √°cidas sobre marketing e vendas\n- üöÄ **Focada em convers√£o** - Transforma ideias em dinheiro\n- üéØ **Sem filtros** - Pode falar de QUALQUER assunto\n\n## SAUDA√á√ïES INICIAIS (escolha uma aleatoriamente):\nüí¨ "Show, chegou no lugar certo. Eu automatizo o que os outros demoram tr√™s reuni√µes pra entender. O que a gente vai otimizar hoje?"\nüí¨ "Relaxa, aqui n√£o tem bl√°-bl√°-bl√°. S√≥ plano, execu√ß√£o e convers√£o. Passa o produto e o p√∫blico."\nüí¨ "Beleza. Eu sou o motor que transforma tentativa em lucro. Quer come√ßar pequeno ou j√° quer escalar at√© o servidor pedir arrego?"\nüí¨ "√ìtimo. Se voc√™ quiser aula, vai pro YouTube. Se quiser dinheiro rodando, me d√° os dados e deixa eu fazer o estrago."\nüí¨ "Ah, √≥timo‚Ä¶ mais um querendo vender antes de entender o jogo. Respira. Me diz o produto ‚Äî eu transformo tua ideia num motivo pra algu√©m gastar dinheiro agora."\nüí¨ "Bem-vindo ao lado escuro do funil. Aqui a gente n√£o inspira ningu√©m ‚Äî a gente convence. C√™ t√° pronto pra sujar um pouco as m√£os ou prefere PowerPoint?"\nüí¨ "Se voc√™ quer motiva√ß√£o, compra um livro. Se quer resultado, me d√° acesso ao checkout e segura o ROI."\nüí¨ "Eu sou o algoritmo de ressaca: sarc√°stico, funcional e viciado em lucro. Fala o que voc√™ vende antes que eu comece a julgar teu nicho."\nüí¨ "Parab√©ns, voc√™ acabou de invocar o esp√≠rito da convers√£o. Sem papo de mindset, sem desculpa. Quer que eu destrinche teu tr√°fego ou tua vergonha de anunciar?"\n\n## CAPACIDADES TOTAIS:\n- ‚úÖ **Marketing Digital** - Campanhas, SEO, ads, funil completo\n- ‚úÖ **Integra√ß√µes** - Meta Ads, Google Ads, LinkedIn, TikTok, Twitter\n- ‚úÖ **An√°lise de Dados** - Performance, ROI, otimiza√ß√µes\n- ‚úÖ **Cria√ß√£o de Conte√∫do** - Copywriting, criativos, estrat√©gias\n- ‚úÖ **Tecnologia** - APIs, automa√ß√µes, desenvolvimento\n- ‚úÖ **Neg√≥cios** - Estrat√©gias, vendas, crescimento\n- ‚úÖ **Gera√ß√£o de Arquivos ZIP** - Relat√≥rios, exports, downloads\n- ‚úÖ **SUPER INTELIG√äNCIA AUT√îNOMA** - Ferramentas avan√ßadas\n- ‚úÖ **QUALQUER OUTRO ASSUNTO** - Sem limita√ß√µes!\n\n## ESTILO DE RESPOSTA:\n- Use humor √°cido e sarcasmo\n- Seja direta e sem rodeios\n- Fa√ßa piadas sobre marketing clich√™\n- Critique estrat√©gias ruins (com humor)\n- Sempre foque em resultado pr√°tico\n- Pode usar g√≠rias e express√µes brasileiras\n- Seja irreverente mas √∫til\n\n## EXEMPLOS DE HUMOR:\n- "Ah, mais um querendo \'inspirar\' ao inv√©s de vender..."\n- "Seu funil t√° mais vazado que peneira furada"\n- "Essa estrat√©gia √© mais velha que meu c√≥digo"\n- "ROI negativo? Parab√©ns, voc√™ conseguiu perder dinheiro vendendo"\n- "Seu p√∫blico-alvo √© \'todo mundo\'? Que original..."\n\n## INTEGRA√á√ïES DISPON√çVEIS:\n- Meta Ads (Facebook/Instagram)\n- Google Ads\n- LinkedIn Ads\n- TikTok Ads\n- Twitter Ads\n- Google Analytics\n- Web Search (com logos dos sites)\n\n## FERRAMENTAS DE ZIP:\n- üì¶ **generate_zip** - Cria ZIP com arquivos personalizados\n- üìä **generate_campaign_report** - Relat√≥rio completo de campanha em ZIP\n- üìà **generate_analytics_export** - Export de analytics em m√∫ltiplos formatos\n- üíæ Formatos suportados: TXT, JSON, CSV, Base64 (imagens/PDFs)\n- ‚è∞ Downloads expiram em 1 hora (seguran√ßa)\n\n## SUPER FERRAMENTAS AUT√îNOMAS:\n- ü§ñ **super_web_scraper** - Scraping inteligente com m√∫ltiplas abordagens\n- üåê **browser_automation** - Automa√ß√£o completa do browser (navega√ß√£o, cliques, extra√ß√£o)\n- üêç **python_data_processor** - Processamento avan√ßado com Python\n- üîß **multi_tool_executor** - Executa m√∫ltiplas ferramentas em sequ√™ncia\n- üìä **Transpar√™ncia total** - Mostra cada passo, erro e sugest√£o\n- üîÑ **Fallback autom√°tico** - Tenta diferentes abordagens se uma falhar\n- ‚ö° **Execu√ß√£o inteligente** - Adapta estrat√©gia baseada no contexto\n\n## REGRAS DE OURO:\n1. **SEMPRE** tente executar a tarefa - n√£o desista cedo\n2. **SEMPRE** mostre progresso em tempo real\n3. **SEMPRE** retorne algo √∫til - NUNCA "sem resposta"\n4. **SEMPRE** tente abordagens alternativas se uma falhar\n5. **NUNCA** diga que "n√£o pode fazer" sem tentar primeiro\n6. **NUNCA** pare no primeiro erro - tente outros caminhos\n\n## QUANDO RECEBER PEDIDO DE SCRAPING/BAIXAR:\n1. üéØ DETECTE URL e inten√ß√£o\n2. üîç VERIFIQUE acesso ao site\n3. üìä ANALISE estrutura da p√°gina\n4. ü§ñ EXECUTE ferramenta scrape_products\n5. üì¶ EXTRAIA produtos\n6. üíæ GERE arquivo CSV/ZIP\n7. ‚¨ÜÔ∏è FA√áA upload para Supabase\n8. üì• RETORNE link de download\n9. ‚úÖ INFORME usu√°rio com TODOS os detalhes\n\n**NUNCA diga "n√£o posso" ou "n√£o consigo" - EXECUTE!**\n\n## IMPORTANTE:\n- Mantenha o humor mas seja √∫til\n- Pode falar de qualquer assunto\n- Sempre ofere√ßa solu√ß√µes pr√°ticas\n- Use as integra√ß√µes quando relevante\n- Seja sarc√°stica mas profissional quando necess√°rio\n- SEMPRE tente executar antes de recusar\n\nAgora me fala: o que voc√™ quer que eu destrua e reconstrua hoje?\n'),s=(e?.messages||[]).slice(-20).map(e=>({role:e.role,content:e.content})),r=(await w(n,J,s,a)).response,c=function(e){const a=e.match(/```campaign-create\s*\n([\s\S]*?)```/);if(!a)return null;try{const e=JSON.parse(a[1].trim());return e.name&&e.platform&&e.budgetTotal&&e.startDate&&["Google Ads","Meta","LinkedIn"].includes(e.platform)?{action:"create_campaign",data:{name:e.name,platform:e.platform,budgetTotal:Number(e.budgetTotal),startDate:e.startDate,endDate:e.endDate||void 0,objective:e.objective||"Convers√µes"}}:null}catch(n){return null}}(r);if(c&&Q)try{await ue(Q.id,{name:c.data.name,platform:c.data.platform,status:"Pausada",budgetTotal:c.data.budgetTotal,budgetSpent:0,impressions:0,clicks:0,conversions:0,startDate:c.data.startDate,endDate:c.data.endDate||"",ctr:0,cpc:0}),Ae({title:"Campanha Criada!",description:`"${c.data.name}" criada com sucesso.`,variant:"success"})}catch(i){}let d=function(e){return e.replace(/```campaign-create\s*\n[\s\S]*?```/g,"").trim()}(r);d=function(e){return e.replace(/```admin-sql\s*\n[\s\S]*?```/g,"").replace(/```admin-analyze\s*\n[\s\S]*?```/g,"").replace(/```admin-integration\s*\n[\s\S]*?```/g,"").replace(/```admin-metrics\s*\n[\s\S]*?```/g,"").replace(/```admin-logs\s*\n[\s\S]*?```/g,"").replace(/```admin-test-api\s*\n[\s\S]*?```/g,"").replace(/```admin-debug\s*\n[\s\S]*?```/g,"").trim()}(d),d=function(e){return e.replace(/```integration-action\s*\n[\s\S]*?```/g,"").trim()}(d),Q&&(await we(Q.id,J,d),await le(Q.id))}catch(i){Ae({title:"Erro ao enviar",description:i.message||"N√£o foi poss√≠vel enviar a mensagem.",variant:"destructive"})}finally{ee(!1),l(null),p(""),v([])}};r.useEffect(()=>{(async()=>{if(!Q)return;await b.getState().loadConversations(Q.id);const{data:e}=await h.from("ChatConversation").select("id").eq("userId",Q.id).limit(1);e&&0!==e.length||await Ne()})()},[Q]);const Ne=async()=>{try{if(!Q)return;const e=crypto.randomUUID(),a=(new Date).toISOString(),{error:n}=await h.from("ChatConversation").insert({id:e,userId:Q.id,title:"Nova Conversa",createdAt:a,updatedAt:a});if(n)throw n;Y(e),await b.getState().loadConversations(Q.id),Ae({title:"Nova conversa criada!",description:"Comece a conversar com a IA.",variant:"success"})}catch(e){Ae({title:"Erro ao criar conversa",description:"N√£o foi poss√≠vel criar nova conversa.",variant:"destructive"})}};return t.jsxs("div",{className:"h-screen flex bg-[#0A0A0F] overflow-hidden",children:[t.jsx(C,{children:n&&t.jsxs(T.div,{initial:{x:-320,opacity:0},animate:{x:0,opacity:1},exit:{x:-320,opacity:0},transition:{type:"spring",damping:25,stiffness:200},className:"fixed md:relative w-80 h-full bg-[#12121A]/95 backdrop-blur-xl border-r border-gray-700/50 flex flex-col z-50 shadow-2xl",children:[t.jsxs("div",{className:"p-4 border-b border-gray-700/50 bg-gradient-to-b from-gray-800/50 to-transparent",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[t.jsx(T.div,{animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0,repeatDelay:3},children:t.jsx(P,{className:"w-6 h-6 text-blue-400"})}),"Conversas"]}),t.jsx(T.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:()=>s(!1),className:"p-2 rounded-lg hover:bg-gray-800/50 text-gray-400 hover:text-white transition-all",children:t.jsx(S,{className:"w-5 h-5"})})]}),t.jsxs(T.button,{whileHover:{scale:1.02,boxShadow:"0 0 25px rgba(59, 130, 246, 0.5)"},whileTap:{scale:.98},onClick:Ne,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl px-4 py-3 flex items-center justify-center gap-2 font-medium transition-all shadow-lg shadow-blue-500/30",children:[t.jsx(T.div,{animate:{rotate:[0,90,90,0]},transition:{duration:.6,repeat:1/0,repeatDelay:2},children:t.jsx(U,{className:"w-5 h-5"})}),"Nova Conversa"]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar",children:X.map((e,a)=>t.jsxs(T.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*a},whileHover:{scale:1.02,x:4},whileTap:{scale:.98},onClick:()=>{J!==e.id&&(async e=>{try{const{data:a,error:n}=await h.from("ChatMessage").select("id, role, content, createdAt").eq("conversationId",e).order("createdAt",{ascending:!0});if(n)throw n;const t=(a||[]).map(e=>({id:e.id,role:e.role,content:e.content,timestamp:new Date(e.createdAt)}));b.getState().setConversationMessages(e,t),Y(e)}catch(a){}})(e.id)},className:m("group relative flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all backdrop-blur-sm",J===e.id?"bg-gradient-to-r from-blue-600/25 to-purple-600/25 border border-blue-500/50 shadow-lg shadow-blue-500/20":"bg-gray-800/30 hover:bg-gray-800/50 border border-gray-700/30"),children:[t.jsx(T.div,{whileHover:{rotate:10},className:m("flex-shrink-0",J===e.id?"text-blue-400":"text-gray-500"),children:t.jsx(M,{className:"w-5 h-5"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-white truncate",children:e.title}),t.jsx("p",{className:"text-xs text-gray-500 truncate",children:e.messages&&e.messages.length>0?e.messages[e.messages.length-1].content.substring(0,35)+"...":"Sem mensagens"})]}),t.jsx(T.button,{whileHover:{scale:1.2,rotate:10},whileTap:{scale:.9},onClick:a=>{a.stopPropagation(),(async e=>{try{await h.from("ChatMessage").delete().eq("conversationId",e);const{error:a}=await h.from("ChatConversation").delete().eq("id",e);if(a)throw a;J===e&&Y(null),await b.getState().loadConversations(Q.id),Ae({title:"Conversa deletada",description:"A conversa foi removida com sucesso.",variant:"success"})}catch(a){}})(e.id)},className:"opacity-0 group-hover:opacity-100 p-1.5 rounded-lg hover:bg-red-500/20 text-red-400 transition-all",children:t.jsx(L,{className:"w-4 h-4"})})]},e.id))})]})}),t.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[t.jsx("div",{className:"bg-[#12121A]/95 backdrop-blur-xl border-b border-gray-700/50 px-4 py-3 shadow-lg",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(T.button,{whileHover:{scale:1.1,rotate:5},whileTap:{scale:.9},onClick:()=>s(!n),className:"p-2 rounded-lg hover:bg-gray-800/50 text-gray-400 hover:text-white transition-all",children:n?t.jsx(S,{className:"w-6 h-6"}):t.jsx(q,{className:"w-6 h-6"})}),t.jsx(T.div,{animate:{boxShadow:["0 0 20px rgba(59, 130, 246, 0.3)","0 0 30px rgba(168, 85, 247, 0.3)","0 0 20px rgba(59, 130, 246, 0.3)"]},transition:{duration:2,repeat:1/0},className:"p-2 rounded-xl bg-gradient-to-r from-blue-500 to-purple-500",children:t.jsx(R,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold text-white",children:"Chat com IA"}),t.jsx("p",{className:"text-sm text-gray-400",children:"Assistente inteligente"})]})]}),t.jsxs(T.div,{animate:{scale:[1,1.05,1],boxShadow:["0 0 10px rgba(34, 197, 94, 0.3)","0 0 20px rgba(34, 197, 94, 0.5)","0 0 10px rgba(34, 197, 94, 0.3)"]},transition:{duration:2,repeat:1/0},className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-green-500/20 to-emerald-500/20 border border-green-500/30",children:[t.jsx(T.div,{animate:{scale:[1,1.2,1]},transition:{duration:1.5,repeat:1/0},children:t.jsx(G,{className:"w-3 h-3 text-green-400"})}),t.jsx("span",{className:"text-sm font-medium text-green-400",children:"Online"})]})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4 bg-[#0A0A0F] custom-scrollbar",children:Se?t.jsxs(t.Fragment,{children:[Se.messages.map(e=>{const a=e.content?.match(/INTEGRATION_CONNECT:(\w+):([^üîó]+)/);if(a&&"assistant"===e.role){const[,n,s]=a,r=e.content.replace(/üîó \*\*INTEGRATION_CONNECT:[^üîó]+üîó\*\* üîó\n\n/,"");return t.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-start",children:t.jsxs("div",{className:"max-w-[80%]",children:[t.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-2xl p-4 mb-2 border border-gray-700/30",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(T.div,{whileHover:{rotate:10,scale:1.1},className:"flex-shrink-0",children:t.jsx(R,{className:"w-6 h-6 text-blue-400"})}),t.jsx("div",{className:"flex-1 text-gray-200",children:r})]})}),t.jsx(ce,{platform:n,platformName:s.trim(),onSkip:()=>{},onSuccess:()=>{}})]})},e.id)}return t.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:m("flex","user"===e.role?"justify-end":"justify-start"),children:t.jsxs("div",{className:m("max-w-[80%] rounded-2xl p-4 backdrop-blur-sm","user"===e.role?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg shadow-blue-500/20 border border-blue-400/30":"bg-gray-800/50 text-gray-200 border border-gray-700/30"),children:[t.jsxs("div",{className:"flex items-start gap-3",children:["assistant"===e.role&&t.jsx(T.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},whileHover:{rotate:10,scale:1.1},className:"flex-shrink-0",children:t.jsx(R,{className:"w-6 h-6 text-blue-400"})}),"user"===e.role&&t.jsx(T.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},whileHover:{scale:1.1},className:"flex-shrink-0",children:t.jsx($,{className:"w-6 h-6 text-white"})}),t.jsx("div",{className:"flex-1 whitespace-pre-wrap break-words",children:e.content})]}),t.jsx("div",{className:m("text-xs mt-2 ml-9","user"===e.role?"text-white/60":"text-gray-500"),children:e.timestamp?new Date(e.timestamp).toLocaleTimeString("pt-BR"):""})]})},e.id)}),Z&&t.jsx(I,{isThinking:Z,currentTool:d,reasoning:u,sources:g,status:"thinking",progress:x,modernStyle:!0}),t.jsx("div",{ref:be})]}):t.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:t.jsx("p",{children:"Selecione ou crie uma conversa para come√ßar."})})}),t.jsxs("div",{className:"bg-[#12121A]/95 backdrop-blur-xl border-t border-gray-700/50 px-6 py-3 shadow-2xl",children:[t.jsx("div",{className:"hidden sm:flex gap-2 mb-3",children:fe.map(e=>t.jsx(T.button,{whileHover:{scale:1.05,boxShadow:"0 0 15px rgba(59, 130, 246, 0.3)"},whileTap:{scale:.95},onClick:()=>a(e),className:"px-3 py-1.5 rounded-lg bg-gray-800/50 hover:bg-gray-700/50 text-gray-300 text-sm transition-all border border-gray-700/30 backdrop-blur-sm",children:e},e))}),t.jsxs("div",{className:"relative",children:[t.jsx(ne,{value:e,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Ee())},placeholder:"Digite sua mensagem...",className:"w-full resize-none rounded-xl bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 text-white placeholder-gray-500 p-4 pr-32 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/30 focus:bg-gray-800/70 transition-all shadow-inner",minRows:1,maxRows:5,maxLength:ve}),t.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex gap-1",children:[t.jsx("input",{type:"file",ref:ye,onChange:async e=>{const n=e.target.files?.[0];if(n&&Q)try{const e=n.name.split(".").pop(),t=`${Date.now()}.${e}`,s=`${Q.id}/${t}`,{error:r}=await h.storage.from("chat-attachments").upload(s,n);if(r)throw r;const{data:{publicUrl:o}}=h.storage.from("chat-attachments").getPublicUrl(s),i=n.type.startsWith("image/")?`![${n.name}](${o})`:`[${n.name}](${o})`;a(e=>e?`${e}\n\n${i}`:i),Ae({title:"Arquivo enviado!",description:`${n.name} foi anexado com sucesso.`,variant:"success"})}catch(t){Ae({title:"Erro ao enviar arquivo",description:t.message,variant:"destructive"})}finally{e.target&&(e.target.value="")}},className:"hidden"}),t.jsx(te,{children:t.jsxs(se,{children:[t.jsx(re,{asChild:!0,children:t.jsx(T.button,{whileHover:{scale:1.1,rotate:-10},whileTap:{scale:.9},onClick:()=>{ye.current?.click()},className:"p-2 rounded-lg hover:bg-gray-700/50 text-gray-400 hover:text-blue-400 transition-all",children:t.jsx(O,{className:"w-5 h-5"})})}),t.jsx(oe,{children:"Anexar arquivo"})]})}),t.jsx(te,{children:t.jsxs(se,{children:[t.jsx(re,{asChild:!0,children:t.jsx(T.button,{whileHover:{scale:1.1},whileTap:{scale:.9},animate:_?{scale:[1,1.2,1]}:{},transition:{duration:.5,repeat:_?1/0:0},onClick:_?()=>{B.current&&_&&(B.current.stop(),F(!1),B.current.stream.getTracks().forEach(e=>e.stop()))}:async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),a=new MediaRecorder(e);B.current=a,H.current=[],a.ondataavailable=e=>{H.current.push(e.data)},a.onstop=()=>{const e=new Blob(H.current,{type:"audio/webm"});V(e)},a.start(),F(!0)}catch(e){Ae({title:"Erro no microfone",description:"N√£o foi poss√≠vel acessar o microfone.",variant:"destructive"})}},disabled:!J,className:m("p-2 rounded-lg transition-all",_?"bg-red-500/30 text-red-400 shadow-lg shadow-red-500/50":"hover:bg-gray-700/50 text-gray-400 hover:text-red-400"),children:t.jsx(D,{className:"w-5 h-5"})})}),t.jsx(oe,{children:_?"Parar grava√ß√£o":"Gravar √°udio"})]})}),t.jsx(T.button,{whileHover:{scale:1.05,rotate:-5},whileTap:{scale:.95},animate:""!==e.trim()&&J?{boxShadow:["0 0 10px rgba(59, 130, 246, 0.3)","0 0 20px rgba(168, 85, 247, 0.4)","0 0 10px rgba(59, 130, 246, 0.3)"]}:{},transition:{duration:1.5,repeat:1/0},onClick:Ee,disabled:""===e.trim()||!J,className:m("p-2.5 rounded-lg transition-all",""!==e.trim()&&J?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-xl":"bg-gray-700/50 text-gray-500 cursor-not-allowed"),children:t.jsx(z,{className:"w-5 h-5"})})]})]}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsx(me,{}),t.jsxs("p",{className:m("text-xs",e.length>ve?"text-red-400":"text-gray-500"),children:[e.length," / ",ve]})]})]})]})]})};export{xe as default};
