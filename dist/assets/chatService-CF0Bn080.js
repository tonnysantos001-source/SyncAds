import{i as e,s as t}from"./index-BxunKSmL.js";import{_ as r,b as o}from"./vendor-charts-DgCBwi6-.js";import{r as n,R as a}from"./vendor-react-BDwqAlkB.js";const i=e("outline","brand-openai","BrandOpenai",[["path",{d:"M11.217 19.384a3.501 3.501 0 0 0 6.783 -1.217v-5.167l-6 -3.35",key:"svg-0"}],["path",{d:"M5.214 15.014a3.501 3.501 0 0 0 4.446 5.266l4.34 -2.534v-6.946",key:"svg-1"}],["path",{d:"M6 7.63c-1.391 -.236 -2.787 .395 -3.534 1.689a3.474 3.474 0 0 0 1.271 4.745l4.263 2.514l6 -3.348",key:"svg-2"}],["path",{d:"M12.783 4.616a3.501 3.501 0 0 0 -6.783 1.217v5.067l6 3.45",key:"svg-3"}],["path",{d:"M18.786 8.986a3.501 3.501 0 0 0 -4.446 -5.266l-4.34 2.534v6.946",key:"svg-4"}],["path",{d:"M18 16.302c1.391 .236 2.787 -.395 3.534 -1.689a3.474 3.474 0 0 0 -1.271 -4.745l-4.308 -2.514l-5.955 3.42",key:"svg-5"}]]),s=e("outline","plus","Plus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]),l=e("outline","send","Send",[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]]),d=e("outline","trash","Trash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]);var c=n.useLayoutEffect,u=function(e,t){"function"!=typeof e?e.current=t:e(t)},h={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},g=function(e){Object.keys(h).forEach(function(t){e.style.setProperty(t,h[t],"important")})},p=null,f=function(e,t){var r=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?r+t.borderSize:r-t.paddingSize};var v=function(){},m=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],b=!!document.documentElement.currentStyle,y=function(e){var t=window.getComputedStyle(e);if(null===t)return null;var r,o=(r=t,m.reduce(function(e,t){return e[t]=r[t],e},{})),n=o.boxSizing;return""===n?null:(b&&"border-box"===n&&(o.width=parseFloat(o.width)+parseFloat(o.borderRightWidth)+parseFloat(o.borderLeftWidth)+parseFloat(o.paddingRight)+parseFloat(o.paddingLeft)+"px"),{sizingStyle:o,paddingSize:parseFloat(o.paddingBottom)+parseFloat(o.paddingTop),borderSize:parseFloat(o.borderBottomWidth)+parseFloat(o.borderTopWidth)})};function w(e,t,r){var o,i,s=(o=r,i=a.useRef(o),c(function(){i.current=o}),i);n.useLayoutEffect(function(){var r=function(e){return s.current(e)};if(e)return e.addEventListener(t,r),function(){return e.removeEventListener(t,r)}},[])}var C=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],S=function(e,t){var i=e.cacheMeasurements,s=e.maxRows,l=e.minRows,d=e.onChange,c=void 0===d?v:d,h=e.onHeightChange,m=void 0===h?v:h,b=r(e,C),S=void 0!==b.value,x=n.useRef(null),k=function(e,t){var r=a.useRef();return a.useCallback(function(o){e.current=o,r.current&&u(r.current,null),r.current=t,t&&u(t,o)},[t])}(x,t),M=n.useRef(0),E=n.useRef(),z=function(){var e=x.current,t=i&&E.current?E.current:y(e);if(t){E.current=t;var r=function(e,t,r,o){void 0===r&&(r=1),void 0===o&&(o=1/0),p||((p=document.createElement("textarea")).setAttribute("tabindex","-1"),p.setAttribute("aria-hidden","true"),g(p)),null===p.parentNode&&document.body.appendChild(p);var n=e.paddingSize,a=e.borderSize,i=e.sizingStyle,s=i.boxSizing;Object.keys(i).forEach(function(e){var t=e;p.style[t]=i[t]}),g(p),p.value=t;var l=f(p,e);p.value=t,l=f(p,e),p.value="x";var d=p.scrollHeight-n,c=d*r;"border-box"===s&&(c=c+n+a),l=Math.max(c,l);var u=d*o;return"border-box"===s&&(u=u+n+a),[l=Math.min(u,l),d]}(t,e.value||e.placeholder||"x",l,s),o=r[0],n=r[1];M.current!==o&&(M.current=o,e.style.setProperty("height",o+"px","important"),m(o,{rowHeight:n}))}};return n.useLayoutEffect(z),function(e,t){w(document.body,"reset",function(r){e.current.form===r.target&&t(r)})}(x,function(){if(!S){var e=x.current.value;requestAnimationFrame(function(){var t=x.current;t&&e!==t.value&&z()})}}),w(window,"resize",z),function(e){w(document.fonts,"loadingdone",e)}(z),n.createElement("textarea",o({},b,{onChange:function(e){S||z(),c(e)},ref:k}))},x=n.forwardRef(S);const k=new class{abortController=null;async sendMessage(e,r,o={}){try{this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const a=o.signal||this.abortController.signal,{data:{session:i},error:s}=await t.auth.getSession();if(s||!i)throw new Error("Usuário não autenticado");const{data:{user:l},error:d}=await t.auth.getUser();if(d||!l)throw new Error("Usuário não encontrado");const{data:c,error:u}=await t.from("ChatMessage").select("role, content").eq("conversationId",r).order("createdAt",{ascending:!0}).limit(20),h={message:e,conversationId:r,conversationHistory:c?.map(e=>({role:e.role.toLowerCase(),content:e.content}))||[],systemPrompt:void 0},g=await fetch("https://your-project.supabase.co/functions/v1/chat-enhanced",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`,apikey:"your-anon-key"},body:JSON.stringify(h),signal:a});if(!g.ok){const e=await g.text();let t=`HTTP ${g.status}: ${g.statusText}`;try{const r=JSON.parse(e);t=r.error||r.message||t}catch(n){e&&(t=e)}throw new Error(t)}const p=await g.json();if(p.error)throw new Error(p.error);if(!p.response||"Sem resposta da IA"===p.response)throw new Error("IA não configurada ou sem resposta. Configure uma IA em Configurações > IA Global.");const f=p.response;if(o.onChunk){const e=f.split(" ");for(let t=0;t<e.length;t+=2){const r=e.slice(t,t+2).join(" ");o.onChunk(r+" "),await new Promise(e=>setTimeout(e,10))}}return o.onComplete&&o.onComplete(f),f}catch(a){if(o.onError&&o.onError(a),"AbortError"===a.name)throw new Error("Request cancelado");throw a}finally{this.abortController=null}}abort(){this.abortController&&(this.abortController.abort(),this.abortController=null)}async saveMessage(e,r,o){try{const{data:{user:n}}=await t.auth.getUser();if(!n)throw new Error("Usuário não autenticado");const a={id:crypto.randomUUID(),conversationId:e,role:r.toUpperCase(),content:o,userId:n.id,createdAt:(new Date).toISOString()},{data:i,error:s}=await t.from("ChatMessage").insert(a).select().single();return s?null:i}catch(n){return null}}async getConversationMessages(e){try{const{data:r,error:o}=await t.from("ChatMessage").select("*").eq("conversationId",e).order("createdAt",{ascending:!0});return o?[]:r||[]}catch(r){return[]}}async isAIConfigured(){try{const{data:e,error:r}=await t.from("GlobalAiConnection").select("id, isActive").eq("isActive",!0).limit(1).maybeSingle();if(r)return!1;return!!e}catch(e){return!1}}};export{i as I,s as a,l as b,d as c,k as d,x as i};
