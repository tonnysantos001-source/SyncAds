import{j as e}from"./vendor-ui-D3JNL6pE.js";import{r as s}from"./vendor-react-X41Bjl18.js";import{s as a,g as t,f as r,B as i,I as o,C as d,a as l,b as c,c as n,e as u}from"./index-BKeegzPq.js";import{T as h,a as m,b as x,c as p,d as g,e as f}from"./table-C5Vn1sXo.js";import{D as j,e as y,a as v,b,c as N,f as C}from"./dialog-CcUTiayE.js";import{L as w}from"./label-D0zMtGEm.js";import{T as k}from"./textarea-D0zZ5SOs.js";import{p as S}from"./productsApi-CtkH-Whg.js";import{S as A}from"./skeleton-BfY8mepo.js";import{aN as I,aY as q,J as z,S as D,Q as P,Y as L}from"./vendor-icons-BvRy6l6m.js";import{m as E}from"./vendor-animation-DtB50Lbk.js";import"./vendor-supabase-HUq0BeMy.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-DqG_mm-v.js";const O={async listFromShopify(e,s){try{let t=a.from("ShopifyCollection").select("*").eq("userId",e).order("updatedAt",{ascending:!1});void 0!==s?.published&&(t=t.eq("published",s.published)),s?.search&&(t=t.or(`title.ilike.%${s.search}%,handle.ilike.%${s.search}%`));const{data:r,error:i}=await t;if(i)throw i;return(r||[]).map(e=>({id:String(e.id),userId:e.userId,name:e.title,slug:e.handle,description:e.description||e.bodyHtml,imageUrl:e.image?.src||null,productsCount:e.productsCount||0,published:e.published,metadata:{shopifyId:e.id,shopifyData:e.shopifyData,sortOrder:e.sortOrder,publishedScope:e.publishedScope,image:e.image},createdAt:e.createdAt,updatedAt:e.updatedAt}))}catch(t){throw t}},async getById(e,s){try{const{data:t,error:r}=await a.from("ShopifyCollection").select("*").eq("userId",e).eq("id",s).single();return r?null:t?{id:String(t.id),userId:t.userId,name:t.title,slug:t.handle,description:t.description||t.bodyHtml,imageUrl:t.image?.src||null,productsCount:t.productsCount||0,published:t.published,metadata:{shopifyId:t.id,shopifyData:t.shopifyData,sortOrder:t.sortOrder,publishedScope:t.publishedScope,image:t.image},createdAt:t.createdAt,updatedAt:t.updatedAt}:null}catch(t){return null}},async getCollectionProducts(e,s){try{const{data:t,error:r}=await a.from("ShopifyCollection").select("shopifyData").eq("userId",e).eq("id",s).single();if(r||!t)return[];const i=t.shopifyData?.products?.map(e=>e.id)||[];if(0===i.length)return[];const{data:o,error:d}=await a.from("ShopifyProduct").select("*").eq("userId",e).in("id",i);if(d)throw d;return o||[]}catch(t){return[]}},async count(e){try{const{count:s,error:t}=await a.from("ShopifyCollection").select("*",{count:"exact",head:!0}).eq("userId",e);if(t)throw t;return s||0}catch(s){return 0}},async getStats(e){try{const{data:s,error:t}=await a.from("ShopifyCollection").select("published, productsCount").eq("userId",e);if(t)throw t;const r=s?.length||0,i=s?.filter(e=>e.published).length||0,o=s?.reduce((e,s)=>e+(s.productsCount||0),0)||0;return{total:r,published:i,draft:r-i,totalProducts:o,averageProducts:r>0?Math.round(o/r):0}}catch(s){return{total:0,published:0,draft:0,totalProducts:0,averageProducts:0}}}},T=()=>{const[a,T]=s.useState([]),[B,F]=s.useState([]),[U,$]=s.useState(!0),[H,Y]=s.useState(!1),[J,M]=s.useState(""),[Q,R]=s.useState(!1),[G,K]=s.useState(null),{toast:V}=t(),W=r(e=>e.user),[X,Z]=s.useState({name:"",slug:"",description:"",isActive:!0});s.useEffect(()=>{W?.id&&_()},[W?.id]),s.useEffect(()=>{ee()},[J,a]);const _=async()=>{if(W?.id)try{$(!0);const e=await O.listFromShopify(W.id);T(e),F(e)}catch(e){V({title:"Erro ao carregar coleções",description:e.message,variant:"destructive"})}finally{$(!1)}else $(!1)},ee=()=>{if(!J)return void F(a);const e=a.filter(e=>e.name.toLowerCase().includes(J.toLowerCase())||e.slug.toLowerCase().includes(J.toLowerCase()));F(e)},se=e=>e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),ae=()=>{K(null),Z({name:"",slug:"",description:"",isActive:!0})},te=a.filter(e=>e.isActive).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Coleções de Produtos"}),e.jsx("p",{className:"text-muted-foreground",children:"Organize seus produtos em coleções"})]}),e.jsxs(j,{open:Q,onOpenChange:R,children:[e.jsx(y,{asChild:!0,children:e.jsxs(i,{onClick:ae,children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Criar Coleção"]})}),e.jsxs(v,{children:[e.jsx(b,{children:e.jsx(N,{children:G?"Editar Coleção":"Nova Coleção"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{if(!W?.organizationId)return;G?(await S.collections.update(G.id,X),V({title:"Coleção atualizada!"})):(await S.collections.create({...X,organizationId:W.organizationId}),V({title:"Coleção criada!",description:"A coleção está pronta para receber produtos."})),R(!1),ae(),_()}catch(s){V({title:"Erro",description:s.message,variant:"destructive"})}},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(w,{children:"Nome da Coleção"}),e.jsx(o,{value:X.name,onChange:e=>{return s=e.target.value,void Z({...X,name:s,slug:G?X.slug:se(s)});var s},required:!0})]}),e.jsxs("div",{children:[e.jsx(w,{children:"Slug (URL)"}),e.jsx(o,{value:X.slug,onChange:e=>Z({...X,slug:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(w,{children:"Descrição"}),e.jsx(k,{value:X.description,onChange:e=>Z({...X,description:e.target.value})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:X.isActive,onChange:e=>Z({...X,isActive:e.target.checked})}),e.jsx(w,{children:"Ativa"})]})]}),e.jsxs(C,{className:"mt-4",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>R(!1),children:"Cancelar"}),e.jsx(i,{type:"submit",children:G?"Atualizar":"Criar"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(d,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total de Coleções"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold",children:a.length})})]}),e.jsxs(d,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Coleções Ativas"}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold",children:te})})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(o,{placeholder:"Buscar coleções...",value:J,onChange:e=>M(e.target.value),className:"pl-9 border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm dark:text-white dark:placeholder:text-gray-500"})]}),e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},children:e.jsxs(d,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsx(l,{children:e.jsx(c,{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-fuchsia-600 bg-clip-text text-transparent",children:"Lista de Coleções"})}),e.jsx(n,{children:U?e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{className:"h-12 w-full"}),e.jsx(A,{className:"h-12 w-full"})]}):0===B.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"h-12 w-12 text-muted-foreground mb-4 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhuma coleção encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Comece criando a primeira coleção"}),e.jsxs(i,{onClick:()=>R(!0),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Criar Primeira Coleção"]})]}):e.jsx("div",{className:"rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:e.jsxs(h,{children:[e.jsx(m,{children:e.jsxs(x,{className:"bg-gradient-to-r from-indigo-50 to-fuchsia-50 dark:from-gray-800 dark:to-gray-800 hover:from-indigo-100 hover:to-fuchsia-100 dark:hover:from-gray-700 dark:hover:to-gray-700",children:[e.jsx(p,{className:"font-semibold dark:text-gray-300",children:"Nome"}),e.jsx(p,{className:"font-semibold dark:text-gray-300",children:"Slug"}),e.jsx(p,{className:"font-semibold dark:text-gray-300",children:"Produtos"}),e.jsx(p,{className:"font-semibold dark:text-gray-300",children:"Status"}),e.jsx(p,{className:"text-right font-semibold dark:text-gray-300",children:"Ações"})]})}),e.jsx(g,{children:B.map((s,a)=>e.jsxs(E.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.05*a},className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gradient-to-r hover:from-indigo-50/50 hover:to-fuchsia-50/50 dark:hover:from-gray-800/50 dark:hover:to-gray-800/50 transition-all duration-200",children:[e.jsx(f,{className:"font-medium",children:s.name}),e.jsx(f,{className:"text-sm text-muted-foreground",children:s.slug}),e.jsxs(f,{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:s.productCount||0}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"produtos"})]}),e.jsx(f,{children:e.jsx(u,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativa":"Inativa"})}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{K(e),Z({name:e.name,slug:e.slug,description:e.description||"",isActive:e.isActive}),R(!0)})(s),className:"hover:bg-gradient-to-r hover:from-indigo-50 hover:to-violet-50 dark:hover:from-gray-800 dark:hover:to-gray-800",children:e.jsx(P,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Tem certeza que deseja deletar esta coleção?"))try{await S.collections.delete(e),V({title:"Coleção deletada"}),_()}catch(s){V({title:"Erro ao deletar",description:s.message,variant:"destructive"})}})(s.id),disabled:!!s.metadata?.shopifyId,className:"hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400 disabled:opacity-50",children:e.jsx(L,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]})})]})};export{T as default};
