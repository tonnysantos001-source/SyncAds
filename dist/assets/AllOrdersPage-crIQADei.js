import{c as k,s as d,r as m,f as q,u as M,j as e,g as j,h as p,i as g,a6 as E,l as N,a7 as G,a5 as H,I as V,k as z,n as C,B as U}from"./index-DONFIVhV.js";import{T as X,a as _,b as P,e as u,c as J,d as x}from"./table-BUtEVDS5.js";import{S as K,a as Q,b as W,c as Y,d as h}from"./select-ByAkXJ6j.js";import{S as v}from"./skeleton-DS4PcywM.js";import{D as Z}from"./dollar-sign-DgA2OTAg.js";import{E as $}from"./eye-BfUaaDfr.js";import{f as ee,p as te}from"./pt-BR-COO1Bk_c.js";import"./index-25Ejnh_2.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=k("PackageX",[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["path",{d:"m17 13 5 5m-5 0 5-5",key:"im3w4b"}]]),D={async getAll(s){const{data:r,error:a}=await d.from("Order").select(`
        *,
        items:OrderItem(*),
        history:OrderHistory(*)
      `).eq("organizationId",s).order("createdAt",{ascending:!1});if(a)throw a;return r},async getById(s){const{data:r,error:a}=await d.from("Order").select(`
        *,
        items:OrderItem(*),
        history:OrderHistory(*)
      `).eq("id",s).single();if(a)throw a;return r},async getByCustomer(s){const{data:r,error:a}=await d.from("Order").select(`
        *,
        items:OrderItem(*)
      `).eq("customerId",s).order("createdAt",{ascending:!1});if(a)throw a;return r},async create(s){const{data:r,error:a}=await d.from("Order").insert(s).select().single();if(a)throw a;return r},async update(s,r){const{data:a,error:l}=await d.from("Order").update({...r,updatedAt:new Date().toISOString()}).eq("id",s).select().single();if(l)throw l;return a},async updatePaymentStatus(s,r,a){const l={paymentStatus:r};a&&(l.paidAt=a);const{data:i,error:c}=await d.from("Order").update(l).eq("id",s).select().single();if(c)throw c;return i},async updateFulfillmentStatus(s,r,a){const l={fulfillmentStatus:r,...a},{data:i,error:c}=await d.from("Order").update(l).eq("id",s).select().single();if(c)throw c;return i},async cancel(s,r){const a={paymentStatus:"CANCELLED",fulfillmentStatus:"CANCELLED",cancelledAt:new Date().toISOString()},{data:l,error:i}=await d.from("Order").update(a).eq("id",s).select().single();if(i)throw i;return l&&await D.addHistory(s,"ORDER_CANCELLED",r||"Order cancelled"),l},async delete(s){const{error:r}=await d.from("Order").delete().eq("id",s);if(r)throw r}},me=()=>{const[s,r]=m.useState([]),[a,l]=m.useState([]),[i,c]=m.useState(!0),[o,I]=m.useState(""),[f,O]=m.useState("all"),{toast:A}=q(),y=M(t=>t.user);m.useEffect(()=>{L()},[]),m.useEffect(()=>{R()},[o,f,s]);const L=async()=>{try{if(!(y!=null&&y.organizationId))return;const t=await D.getAll(y.organizationId);r(t),l(t)}catch(t){A({title:"Erro ao carregar pedidos",description:t.message,variant:"destructive"})}finally{c(!1)}},R=()=>{let t=s;o&&(t=t.filter(n=>n.orderNumber.toLowerCase().includes(o.toLowerCase())||n.customerName.toLowerCase().includes(o.toLowerCase())||n.customerEmail.toLowerCase().includes(o.toLowerCase()))),f!=="all"&&(t=t.filter(n=>n.paymentStatus===f)),l(t)},w=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),S=t=>({PENDING:{label:"Pendente",variant:"secondary"},PROCESSING:{label:"Processando",variant:"default"},PAID:{label:"Pago",variant:"default"},FAILED:{label:"Falhou",variant:"destructive"},REFUNDED:{label:"Reembolsado",variant:"secondary"},CANCELLED:{label:"Cancelado",variant:"secondary"}})[t],b=t=>({PENDING:{label:"Pendente",variant:"secondary"},PROCESSING:{label:"Preparando",variant:"default"},SHIPPED:{label:"Enviado",variant:"default"},DELIVERED:{label:"Entregue",variant:"default"},CANCELLED:{label:"Cancelado",variant:"destructive"}})[t],T=s.filter(t=>t.paymentStatus==="PAID").reduce((t,n)=>t+n.total,0),B=s.filter(t=>t.paymentStatus==="PENDING").length,F=s.filter(t=>t.paymentStatus==="PAID").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Pedidos"}),e.jsx("p",{className:"text-muted-foreground",children:"Visualize e gerencie todos os pedidos da sua loja"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(j,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Total de Pedidos"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:s.length})})]}),e.jsxs(j,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Pedidos Pagos"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:F})})]}),e.jsxs(j,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Pedidos Pendentes"}),e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:B})})]}),e.jsxs(j,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Receita Total"}),e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:w(T)})})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(H,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(V,{placeholder:"Buscar por número, cliente ou email...",value:o,onChange:t=>I(t.target.value),className:"pl-9"})]}),e.jsxs(K,{value:f,onValueChange:O,children:[e.jsx(Q,{className:"w-[200px]",children:e.jsx(W,{placeholder:"Status"})}),e.jsxs(Y,{children:[e.jsx(h,{value:"all",children:"Todos os Status"}),e.jsx(h,{value:"PENDING",children:"Pendente"}),e.jsx(h,{value:"PROCESSING",children:"Processando"}),e.jsx(h,{value:"PAID",children:"Pago"}),e.jsx(h,{value:"FAILED",children:"Falhou"}),e.jsx(h,{value:"REFUNDED",children:"Reembolsado"}),e.jsx(h,{value:"CANCELLED",children:"Cancelado"})]})]})]}),e.jsxs(j,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Lista de Pedidos"}),e.jsxs(z,{children:[a.length," pedido(s) encontrado(s)"]})]}),e.jsx(N,{children:i?e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{className:"h-12 w-full"}),e.jsx(v,{className:"h-12 w-full"}),e.jsx(v,{className:"h-12 w-full"})]}):a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(E,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o||f!=="all"?"Tente ajustar os filtros":"Aguardando o primeiro pedido"})]}):e.jsxs(X,{children:[e.jsx(_,{children:e.jsxs(P,{children:[e.jsx(u,{children:"Pedido"}),e.jsx(u,{children:"Cliente"}),e.jsx(u,{children:"Valor"}),e.jsx(u,{children:"Pagamento"}),e.jsx(u,{children:"Entrega"}),e.jsx(u,{children:"Data"}),e.jsx(u,{className:"text-right",children:"Ações"})]})}),e.jsx(J,{children:a.map(t=>e.jsxs(P,{children:[e.jsx(x,{children:e.jsxs("div",{className:"font-mono text-sm",children:["#",t.orderNumber]})}),e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.customerName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.customerEmail})]})}),e.jsxs(x,{children:[e.jsx("div",{className:"font-medium",children:w(t.total)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.paymentMethod})]}),e.jsx(x,{children:e.jsx(C,{variant:S(t.paymentStatus).variant,children:S(t.paymentStatus).label})}),e.jsx(x,{children:e.jsx(C,{variant:b(t.fulfillmentStatus).variant,children:b(t.fulfillmentStatus).label})}),e.jsx(x,{children:ee(new Date(t.createdAt),"dd/MM/yyyy",{locale:te})}),e.jsx(x,{className:"text-right",children:e.jsx(U,{variant:"ghost",size:"icon",children:e.jsx($,{className:"h-4 w-4"})})})]},t.id))})]})})]})]})};export{me as default};
