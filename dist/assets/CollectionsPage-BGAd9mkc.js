import{j as e}from"./vendor-ui-DkUuACDy.js";import{r as s}from"./vendor-react-X41Bjl18.js";import{s as t,g as a,f as r,B as i,I as o,C as d,a as l,b as c,c as n,e as h}from"./index-tKVwugE8.js";import{T as u,a as m,b as x,c as p,d as g,e as f}from"./table-DlEdvEx4.js";import{D as j,e as y,a as v,b,c as N,f as C}from"./dialog-CiCOYraq.js";import{L as w}from"./label-BhNmEvIm.js";import{T as k}from"./textarea-CQXd4KGD.js";import{p as S}from"./productsApi-DJPhzu04.js";import{S as A}from"./skeleton-CNl74KWd.js";import{aJ as I,aX as q,J as z,S as D,Q as P,Y as L}from"./vendor-icons-DTdRnryx.js";import{m as E}from"./vendor-animation-DQ3cvw6m.js";import"./vendor-supabase-BQxDPPjR.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-Bf3pI66S.js";const O={async listFromShopify(e,s){try{let a=t.from("ShopifyCollection").select("*").eq("userId",e).order("updatedAt",{ascending:!1});void 0!==s?.published&&(a=a.eq("published",s.published)),s?.search&&(a=a.or(`title.ilike.%${s.search}%,handle.ilike.%${s.search}%`));const{data:r,error:i}=await a;if(i)throw i;return(r||[]).map(e=>({id:String(e.id),userId:e.userId,name:e.title,slug:e.handle,description:e.description||e.bodyHtml,imageUrl:e.image?.src||null,productsCount:e.productsCount||0,published:e.published,metadata:{shopifyId:e.id,shopifyData:e.shopifyData,sortOrder:e.sortOrder,publishedScope:e.publishedScope,image:e.image},createdAt:e.createdAt,updatedAt:e.updatedAt}))}catch(a){throw a}},async getById(e,s){try{const{data:a,error:r}=await t.from("ShopifyCollection").select("*").eq("userId",e).eq("id",s).single();return r?null:a?{id:String(a.id),userId:a.userId,name:a.title,slug:a.handle,description:a.description||a.bodyHtml,imageUrl:a.image?.src||null,productsCount:a.productsCount||0,published:a.published,metadata:{shopifyId:a.id,shopifyData:a.shopifyData,sortOrder:a.sortOrder,publishedScope:a.publishedScope,image:a.image},createdAt:a.createdAt,updatedAt:a.updatedAt}:null}catch(a){return null}},async getCollectionProducts(e,s){try{const{data:a,error:r}=await t.from("ShopifyCollection").select("shopifyData").eq("userId",e).eq("id",s).single();if(r||!a)return[];const i=a.shopifyData?.products?.map(e=>e.id)||[];if(0===i.length)return[];const{data:o,error:d}=await t.from("ShopifyProduct").select("*").eq("userId",e).in("id",i);if(d)throw d;return o||[]}catch(a){return[]}},async count(e){try{const{count:s,error:a}=await t.from("ShopifyCollection").select("*",{count:"exact",head:!0}).eq("userId",e);if(a)throw a;return s||0}catch(s){return 0}},async getStats(e){try{const{data:s,error:a}=await t.from("ShopifyCollection").select("published, productsCount").eq("userId",e);if(a)throw a;const r=s?.length||0,i=s?.filter(e=>e.published).length||0,o=s?.reduce((e,s)=>e+(s.productsCount||0),0)||0;return{total:r,published:i,draft:r-i,totalProducts:o,averageProducts:r>0?Math.round(o/r):0}}catch(s){return{total:0,published:0,draft:0,totalProducts:0,averageProducts:0}}}},T=()=>{const[t,T]=s.useState([]),[B,F]=s.useState([]),[U,$]=s.useState(!0),[H,J]=s.useState(!1),[M,Q]=s.useState(""),[R,X]=s.useState(!1),[Y,G]=s.useState(null),{toast:K}=a(),V=r(e=>e.user),[W,Z]=s.useState({name:"",slug:"",description:"",isActive:!0});s.useEffect(()=>{V?.id&&_()},[V?.id]),s.useEffect(()=>{ee()},[M,t]);const _=async()=>{if(V?.id)try{$(!0);const e=await O.listFromShopify(V.id);T(e),F(e)}catch(e){K({title:"Erro ao carregar coleções",description:e.message,variant:"destructive"})}finally{$(!1)}else $(!1)},ee=()=>{if(!M)return void F(t);const e=t.filter(e=>e.name.toLowerCase().includes(M.toLowerCase())||e.slug.toLowerCase().includes(M.toLowerCase()));F(e)},se=e=>e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),te=()=>{G(null),Z({name:"",slug:"",description:"",isActive:!0})},ae=t.filter(e=>e.isActive).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Coleções de Produtos"}),e.jsx("p",{className:"text-muted-foreground",children:"Organize seus produtos em coleções"})]}),e.jsxs(j,{open:R,onOpenChange:X,children:[e.jsx(y,{asChild:!0,children:e.jsxs(i,{onClick:te,children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Criar Coleção"]})}),e.jsxs(v,{children:[e.jsx(b,{children:e.jsx(N,{children:Y?"Editar Coleção":"Nova Coleção"})}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{if(!V?.organizationId)return;Y?(await S.collections.update(Y.id,W),K({title:"Coleção atualizada!"})):(await S.collections.create({...W,organizationId:V.organizationId}),K({title:"Coleção criada!",description:"A coleção está pronta para receber produtos."})),X(!1),te(),_()}catch(s){K({title:"Erro",description:s.message,variant:"destructive"})}},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(w,{children:"Nome da Coleção"}),e.jsx(o,{value:W.name,onChange:e=>{return s=e.target.value,void Z({...W,name:s,slug:Y?W.slug:se(s)});var s},required:!0})]}),e.jsxs("div",{children:[e.jsx(w,{children:"Slug (URL)"}),e.jsx(o,{value:W.slug,onChange:e=>Z({...W,slug:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(w,{children:"Descrição"}),e.jsx(k,{value:W.description,onChange:e=>Z({...W,description:e.target.value})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:W.isActive,onChange:e=>Z({...W,isActive:e.target.checked})}),e.jsx(w,{children:"Ativa"})]})]}),e.jsxs(C,{className:"mt-4",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>X(!1),children:"Cancelar"}),e.jsx(i,{type:"submit",children:Y?"Atualizar":"Criar"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(d,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total de Coleções"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold",children:t.length})})]}),e.jsxs(d,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Coleções Ativas"}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold",children:ae})})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(o,{placeholder:"Buscar coleções...",value:M,onChange:e=>Q(e.target.value),className:"pl-9 border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm dark:text-white dark:placeholder:text-gray-500"})]}),e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},children:e.jsxs(d,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsx(l,{children:e.jsx(c,{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-fuchsia-600 bg-clip-text text-transparent",children:"Lista de Coleções"})}),e.jsx(n,{children:U?e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{className:"h-12 w-full"}),e.jsx(A,{className:"h-12 w-full"})]}):0===B.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"h-12 w-12 text-muted-foreground mb-4 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhuma coleção encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Comece criando a primeira coleção"}),e.jsxs(i,{onClick:()=>X(!0),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Criar Primeira Coleção"]})]}):e.jsx("div",{className:"rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:e.jsxs(u,{children:[e.jsx(m,{children:e.jsxs(x,{className:"bg-gradient-to-r from-indigo-50 to-fuchsia-50 dark:from-gray-800 dark:to-gray-800 hover:from-indigo-100 hover:to-fuchsia-100 dark:hover:from-gray-700 dark:hover:to-gray-700",children:[e.jsx(p,{className:"font-semibold dark:text-gray-300",children:"Nome"}),e.jsx(p,{className:"font-semibold dark:text-gray-300",children:"Slug"}),e.jsx(p,{className:"font-semibold dark:text-gray-300",children:"Produtos"}),e.jsx(p,{className:"font-semibold dark:text-gray-300",children:"Status"}),e.jsx(p,{className:"text-right font-semibold dark:text-gray-300",children:"Ações"})]})}),e.jsx(g,{children:B.map((s,t)=>e.jsxs(E.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.05*t},className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gradient-to-r hover:from-indigo-50/50 hover:to-fuchsia-50/50 dark:hover:from-gray-800/50 dark:hover:to-gray-800/50 transition-all duration-200",children:[e.jsx(f,{className:"font-medium",children:s.name}),e.jsx(f,{className:"text-sm text-muted-foreground",children:s.slug}),e.jsxs(f,{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:s.productCount||0}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"produtos"})]}),e.jsx(f,{children:e.jsx(h,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativa":"Inativa"})}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{G(e),Z({name:e.name,slug:e.slug,description:e.description||"",isActive:e.isActive}),X(!0)})(s),className:"hover:bg-gradient-to-r hover:from-indigo-50 hover:to-violet-50 dark:hover:from-gray-800 dark:hover:to-gray-800",children:e.jsx(P,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Tem certeza que deseja deletar esta coleção?"))try{await S.collections.delete(e),K({title:"Coleção deletada"}),_()}catch(s){K({title:"Erro ao deletar",description:s.message,variant:"destructive"})}})(s.id),disabled:!!s.metadata?.shopifyId,className:"hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400 disabled:opacity-50",children:e.jsx(L,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]})})]})};export{T as default};
