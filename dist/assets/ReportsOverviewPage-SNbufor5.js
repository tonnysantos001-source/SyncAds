import{e as M,u as D,r as y,s as m,j as e,B as h,Y as L,g as t,l,W as v,h as f,i as u}from"./index-hGGesvR-.js";import{S as p}from"./skeleton-DNs0LOA0.js";import{C as B}from"./calendar-DAoMNAo1.js";import{C as G}from"./circle-alert-C4M15LLu.js";import{A as U}from"./arrow-right-Ci0iaKTH.js";const K=()=>{const P=M(),a=D(s=>s.user),[i,N]=y.useState({totalRevenue:0,totalOrders:0,approvedRevenue:0,refundedRevenue:0,netProfit:0,totalShipping:0,avgTicket:0,conversionRate:0,loading:!0}),[n,w]=y.useState({billing:!1,domain:!1,gateway:!1,shipping:!1,loading:!0});y.useEffect(()=>{a!=null&&a.id&&(I(),q())},[a==null?void 0:a.id]);const d=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),I=async()=>{try{N(r=>({...r,loading:!0}));const s=a==null?void 0:a.id;if(!s){N(r=>({...r,loading:!1}));return}const[{data:c},{data:x}]=await Promise.all([m.from("Order").select("total, status, shippingCost").eq("userId",s),m.from("Transaction").select("amount, status, paymentMethod").eq("userId",s)]);console.log("📊 [Reports] Dados carregados:",{orders:c,transactions:x});const j=(c==null?void 0:c.filter(r=>r.status==="PAID").reduce((r,o)=>r+(o.total||0),0))||0,g=(c==null?void 0:c.length)||0,b=(c==null?void 0:c.filter(r=>r.status==="PAID").length)||0,C=(x==null?void 0:x.filter(r=>r.status==="PAID").reduce((r,o)=>r+(o.amount||0),0))||0,R=(x==null?void 0:x.filter(r=>r.status==="REFUNDED").reduce((r,o)=>r+(o.amount||0),0))||0,z=(c==null?void 0:c.filter(r=>r.status==="PAID").reduce((r,o)=>r+(o.shippingCost||0),0))||0,k=b>0?j/b:0,S=g>0?b/g*100:0,A=C-R;N({totalRevenue:j,totalOrders:g,approvedRevenue:C,refundedRevenue:R,netProfit:A,totalShipping:z,avgTicket:k,conversionRate:S,loading:!1}),console.log("✅ [Reports] Métricas calculadas:",{totalRevenue:d(j),totalOrders:g,netProfit:d(A),avgTicket:d(k),conversionRate:S.toFixed(2)+"%"})}catch(s){console.error("❌ [Reports] Erro ao carregar dados:",s),N(c=>({...c,loading:!1}))}},q=async()=>{if(a!=null&&a.id)try{const[s,c,x,j]=await Promise.all([T(),E(),F(),O()]);w({billing:s,domain:c,gateway:x,shipping:j,loading:!1})}catch(s){console.error("❌ [Reports] Erro ao verificar setup:",s),w(c=>({...c,loading:!1}))}},T=async()=>{if(!(a!=null&&a.id))return!1;try{const{data:s}=await m.from("User").select("currentPlanId").eq("id",a.id).single();if(s!=null&&s.currentPlanId)return!0;const{data:c}=await m.from("Subscription").select("id, status").eq("userId",a.id).eq("status","active").single();return!!c}catch{return!1}},E=async()=>{if(!(a!=null&&a.id))return!1;try{const{data:s}=await m.from("User").select("domain, domainVerified").eq("id",a.id).single();return!!(s!=null&&s.domain&&(s!=null&&s.domainVerified))}catch{return!1}},F=async()=>{if(!(a!=null&&a.id))return!1;try{const{data:s}=await m.from("GatewayConfig").select("id, isActive").eq("userId",a.id).eq("isActive",!0).limit(1);return((s==null?void 0:s.length)||0)>0}catch{return!1}},O=async()=>{if(!(a!=null&&a.id))return!1;try{const{data:s}=await m.from("ShippingMethod").select("id").eq("userId",a.id).limit(1);return((s==null?void 0:s.length)||0)>0}catch{return!1}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"VISÃO GERAL"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Acompanhe o desempenho geral do seu e-commerce"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Atualizar"]}),e.jsx(h,{className:"bg-pink-600 hover:bg-pink-700 text-white",size:"sm",children:"Filtrar"}),e.jsx(h,{variant:"outline",size:"sm",children:"Colection"}),e.jsx(h,{variant:"outline",size:"sm",children:"Semana"}),e.jsx(h,{variant:"outline",size:"sm",children:"Mês"}),e.jsx(h,{variant:"outline",size:"sm",children:e.jsx(B,{className:"w-4 h-4"})})]})]}),!n.loading&&(!n.billing||!n.domain||!n.gateway||!n.shipping)&&e.jsx(t,{className:"border-pink-200 bg-pink-50",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-2 flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-pink-600"}),"Configure seu Checkout"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Complete o onboarding para ativar seu checkout e começar a vender"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[!n.billing&&e.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border border-pink-200",children:"❌ Faturamento"}),!n.domain&&e.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border border-pink-200",children:"❌ Domínio"}),!n.gateway&&e.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border border-pink-200",children:"❌ Gateway"}),!n.shipping&&e.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border border-pink-200",children:"❌ Frete"})]})]}),e.jsxs(h,{onClick:()=>P("/onboarding"),className:"bg-pink-600 hover:bg-pink-700 text-white",size:"sm",children:["Configurar ",e.jsx(U,{className:"h-4 w-4 ml-2"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(t,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Receita líquida"}),i.loading?e.jsx(p,{className:"h-9 w-32"}):e.jsxs("p",{className:"text-3xl font-bold",children:[d(i.totalRevenue)," (",i.totalOrders,")"]}),e.jsx("div",{className:"flex items-center gap-2 text-sm",children:i.loading?e.jsx(p,{className:"h-4 w-12"}):e.jsxs("span",{className:"text-gray-500",children:["Aprovados: ",i.totalOrders," pedidos"]})})]})})}),e.jsx(t,{className:"bg-gray-900 text-white",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Lucro Líquido"}),i.loading?e.jsx(p,{className:"h-9 w-24"}):e.jsx("p",{className:"text-3xl font-bold",children:d(i.netProfit)}),e.jsx("div",{className:"flex items-center gap-2 text-sm",children:i.loading?e.jsx(p,{className:"h-4 w-12"}):e.jsxs("span",{className:"text-gray-400",children:["Aprovado: ",d(i.approvedRevenue)]})})]})})}),e.jsx(t,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ticket Médio"}),e.jsx(v,{className:"w-4 h-4 text-gray-400"})]}),i.loading?e.jsx(p,{className:"h-9 w-24"}):e.jsx("p",{className:"text-3xl font-bold",children:d(i.avgTicket)}),e.jsx("div",{className:"flex items-center gap-2 text-sm",children:i.loading?e.jsx(p,{className:"h-4 w-12"}):e.jsxs("span",{className:"text-gray-500",children:["Conversão: ",i.conversionRate.toFixed(1),"%"]})})]})})})]}),e.jsxs(t,{children:[e.jsx(f,{children:e.jsx(u,{className:"text-lg",children:"Resumo Financeiro"})}),e.jsx(l,{children:e.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded",children:e.jsx("p",{className:"text-gray-400",children:"Gráfico de linha - Receita por período"})})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Receita Aprovada"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00 (0)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"% 0%"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Receita Estornada"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00 (0)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"% 0%"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Compra / Dia"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00"}),e.jsx("p",{className:"text-xs text-gray-500",children:"— 0%"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Pedidos"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00 (0)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"% 0%"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Frete"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00"}),e.jsx("p",{className:"text-xs text-gray-500",children:"— 0%"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Custo p/o"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00"}),e.jsx("p",{className:"text-xs text-gray-500",children:"— 0%"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Margem Líquida"}),e.jsx("p",{className:"text-xl font-bold",children:"0%"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Lucro Real"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00"}),e.jsx("p",{className:"text-xs text-gray-500",children:"— 0%"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Ticket médio"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00"}),e.jsx("p",{className:"text-xs text-gray-500",children:"— 0%"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Lucratividade"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00"}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(v,{className:"w-3 h-3"})," Mais de meta"]})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Meta de ROAS"}),e.jsx("p",{className:"text-xl font-bold",children:"0%"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Novo de ROAS"}),e.jsx("p",{className:"text-xl font-bold flex items-center gap-1",children:e.jsx(v,{className:"w-3 h-3"})})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Tax. de Conversão"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00"}),e.jsx("p",{className:"text-xs text-gray-500",children:"— 0%"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Roas"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00"}),e.jsx("p",{className:"text-xs text-gray-500",children:"— 0%"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Roi"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00"})]})}),e.jsx(t,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"CPA"}),e.jsx("p",{className:"text-xl font-bold",children:"0,00"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(f,{children:e.jsx(u,{className:"text-lg",children:"Funnel de Conversão"})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm mb-2",children:"UTM's Utilizadas"}),e.jsx("p",{className:"text-2xl font-bold",children:"0% (0)"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm mb-2",children:"Entrega"}),e.jsx("p",{className:"text-2xl font-bold",children:"0% (0)"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm mb-2",children:"Pagamento"}),e.jsx("p",{className:"text-2xl font-bold",children:"0% (0)"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm mb-2",children:"Comprou"}),e.jsx("p",{className:"text-2xl font-bold",children:"0% (0)"})]})]})})]}),e.jsxs(t,{children:[e.jsx(f,{children:e.jsx(u,{className:"text-lg",children:"Taxas"})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Pix"}),e.jsx("span",{className:"font-medium",children:"0%"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Boleto"}),e.jsx("span",{className:"font-medium",children:"0%"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Cartão crédito"}),e.jsx("span",{className:"font-medium",children:"0%"})]})]})})]})]}),e.jsxs(t,{children:[e.jsx(f,{children:e.jsx(u,{className:"text-lg",children:"Parcelamento"})}),e.jsx(l,{children:e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Não existem informações para os critérios selecionados"})})]})]})};export{K as default};
