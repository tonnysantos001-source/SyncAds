import{r,b as H,u as $,j as e,B as c,I as m,d as w,e as D,f as E,h as A,S as M,o as X}from"./index-CurQCjv1.js";import{T as _,a as J,b as I,c as u,d as K,e as h}from"./table-NgKfF-Ho.js";import{D as Q,a as W,b as Y,c as Z,d as ee,f as se}from"./dialog-Bh_5VG6P.js";import{L as i}from"./label-BvN8-3bF.js";import{S as f,a as N,b as C,c as T,d as j}from"./select-BGGe4r2k.js";import{T as ae}from"./textarea-B01ftEOM.js";import{m as p}from"./marketingApi-BwHVkpan.js";import{p as te}from"./productsApi-DSLLy4PR.js";import{S as U}from"./skeleton-KytUVP5t.js";import{P as k}from"./plus-sm2wkxUO.js";import{T as V}from"./trending-up-eFtzmenH.js";import{S as le}from"./square-pen-DwL0yt9D.js";import{T as re}from"./trash-2-B17ahRq-.js";import"./x-j8W6nHBD.js";import"./index-DoOV3b-C.js";const Ce=()=>{const[b,z]=r.useState([]),[y,R]=r.useState([]),[q,L]=r.useState(!0),[P,B]=r.useState(""),[F,d]=r.useState(!1),[x,g]=r.useState(null),{toast:n}=H(),l=$(s=>s.user),[a,t]=r.useState({name:"",triggerProductId:"",upsellProductId:"",title:"",description:"",discountType:"PERCENTAGE",discountValue:0,isActive:!0});r.useEffect(()=>{v()},[]);const v=async()=>{try{if(!(l!=null&&l.organizationId))return;const[s,o]=await Promise.all([p.upsells.getAll(l.organizationId),te.list()]);z(s),R(o)}catch(s){n({title:"Erro",description:s.message,variant:"destructive"})}finally{L(!1)}},G=async s=>{s.preventDefault();try{if(!(l!=null&&l.organizationId))return;x?(await p.upsells.update(x.id,a),n({title:"Upsell atualizado!"})):(await p.upsells.create({...a,organizationId:l.organizationId}),n({title:"Upsell criado!"})),d(!1),g(null),v()}catch(o){n({title:"Erro",description:o.message,variant:"destructive"})}},O=async s=>{if(confirm("Deletar upsell?"))try{await p.upsells.delete(s),n({title:"Upsell deletado"}),v()}catch(o){n({title:"Erro",description:o.message,variant:"destructive"})}},S=b.filter(s=>s.name.toLowerCase().includes(P.toLowerCase()));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Upsells"}),e.jsx("p",{className:"text-muted-foreground",children:"Aumente o ticket médio com ofertas de upsell"})]}),e.jsxs(Q,{open:F,onOpenChange:d,children:[e.jsx(W,{asChild:!0,children:e.jsxs(c,{onClick:()=>{g(null),t({name:"",triggerProductId:"",upsellProductId:"",title:"",description:"",discountType:"PERCENTAGE",discountValue:0,isActive:!0})},children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Criar Upsell"]})}),e.jsxs(Y,{className:"max-w-2xl",children:[e.jsx(Z,{children:e.jsx(ee,{children:x?"Editar Upsell":"Novo Upsell"})}),e.jsxs("form",{onSubmit:G,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Nome Interno"}),e.jsx(m,{value:a.name,onChange:s=>t({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Produto Gatilho"}),e.jsxs(f,{value:a.triggerProductId,onValueChange:s=>t({...a,triggerProductId:s}),required:!0,children:[e.jsx(N,{children:e.jsx(C,{placeholder:"Produto que ativa o upsell"})}),e.jsx(T,{children:y.map(s=>e.jsx(j,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Produto Upsell"}),e.jsxs(f,{value:a.upsellProductId,onValueChange:s=>t({...a,upsellProductId:s}),required:!0,children:[e.jsx(N,{children:e.jsx(C,{placeholder:"Produto oferecido"})}),e.jsx(T,{children:y.map(s=>e.jsx(j,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Título da Oferta"}),e.jsx(m,{value:a.title,onChange:s=>t({...a,title:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Descrição"}),e.jsx(ae,{value:a.description,onChange:s=>t({...a,description:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Tipo Desconto"}),e.jsxs(f,{value:a.discountType,onValueChange:s=>t({...a,discountType:s}),children:[e.jsx(N,{children:e.jsx(C,{})}),e.jsxs(T,{children:[e.jsx(j,{value:"PERCENTAGE",children:"Percentual"}),e.jsx(j,{value:"FIXED_AMOUNT",children:"Valor Fixo"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Valor"}),e.jsx(m,{type:"number",step:"0.01",value:a.discountValue,onChange:s=>t({...a,discountValue:parseFloat(s.target.value)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.isActive,onChange:s=>t({...a,isActive:s.target.checked})}),e.jsx(i,{children:"Ativo"})]})]}),e.jsxs(se,{className:"mt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancelar"}),e.jsx(c,{type:"submit",children:x?"Atualizar":"Criar"})]})]})]})]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-3",children:e.jsxs(w,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Total de Upsells"}),e.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(A,{children:e.jsx("div",{className:"text-2xl font-bold",children:b.length})})]})}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(m,{placeholder:"Buscar upsells...",value:P,onChange:s=>B(s.target.value),className:"pl-9"})]}),e.jsxs(w,{children:[e.jsx(D,{children:e.jsx(E,{children:"Lista de Upsells"})}),e.jsx(A,{children:q?e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{className:"h-12 w-full"}),e.jsx(U,{className:"h-12 w-full"})]}):S.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"h-12 w-12 text-muted-foreground mb-4 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhum upsell encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Comece criando o primeiro upsell"}),e.jsxs(c,{onClick:()=>d(!0),children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Criar Primeiro Upsell"]})]}):e.jsxs(_,{children:[e.jsx(J,{children:e.jsxs(I,{children:[e.jsx(u,{children:"Nome"}),e.jsx(u,{children:"Título"}),e.jsx(u,{children:"Desconto"}),e.jsx(u,{children:"Status"}),e.jsx(u,{className:"text-right",children:"Ações"})]})}),e.jsx(K,{children:S.map(s=>e.jsxs(I,{children:[e.jsx(h,{className:"font-medium",children:s.name}),e.jsx(h,{children:s.title}),e.jsx(h,{children:s.discountType==="PERCENTAGE"?`${s.discountValue}%`:`R$ ${s.discountValue}`}),e.jsx(h,{children:e.jsx(X,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativo":"Inativo"})}),e.jsx(h,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>{g(s),t(s),d(!0)},children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>O(s.id),children:e.jsx(re,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})]})};export{Ce as default};
