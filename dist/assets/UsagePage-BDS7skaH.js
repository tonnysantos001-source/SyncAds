import{f as B,r as u,s as b,j as e,g as c,h as x,i as m,l as g,k as U,S as F,I as O,n as H}from"./index-DWWt1LWg.js";import{T as $,a as Z,b as N,c as o,d as q,e as n}from"./table-D7siHGXS.js";import{S as T}from"./SuperAdminLayout-DvhgvWMk.js";import{M as k}from"./message-square-Yy78l39M.js";import{Z as G}from"./zap-BN7gYHrl.js";import{D as K}from"./dollar-sign-DfxqAQIS.js";import{T as J}from"./trending-up-lku-fS7z.js";import"./Logo-D9UDRpNh.js";function ae(){const{toast:w}=B(),[l,A]=u.useState([]),[j,M]=u.useState(""),[S,I]=u.useState(!0);u.useEffect(()=>{E()},[]);const E=async()=>{try{const{data:s,error:a}=await b.from("Organization").select(`
          id,
          name,
          slug,
          plan,
          createdAt,
          OrganizationAiConnection (
            globalAi:GlobalAiConnection (
              provider
            )
          )
        `).order("createdAt",{ascending:!1});if(a)throw a;const C=(s||[]).map(t=>t.id),{data:P}=await b.from("ChatConversation").select("organizationId, ChatMessage(count)").in("organizationId",C),{data:z}=await b.from("AiUsage").select("organizationId, totalTokens, estimatedCost, createdAt").in("organizationId",C).order("createdAt",{ascending:!1}),p=new Map;(P||[]).forEach(t=>{var i,d;const r=p.get(t.organizationId)||0;p.set(t.organizationId,r+(((d=(i=t.ChatMessage)==null?void 0:i[0])==null?void 0:d.count)||0))});const f=new Map;(z||[]).forEach(t=>{f.has(t.organizationId)||f.set(t.organizationId,t)});const L=(s||[]).map(t=>{var d,v;const r=f.get(t.id),i=(d=t.OrganizationAiConnection)==null?void 0:d[0];return{clientId:t.id,clientName:t.name,clientSlug:t.slug,plan:t.plan,totalMessages:p.get(t.id)||0,totalTokens:(r==null?void 0:r.totalTokens)||0,estimatedCost:(r==null?void 0:r.estimatedCost)||0,aiProvider:((v=i==null?void 0:i.globalAi)==null?void 0:v.provider)||"N/A",lastUsed:(r==null?void 0:r.createdAt)||null}});A(L)}catch(s){w({title:"Erro ao carregar uso de IA",description:s.message,variant:"destructive"})}finally{I(!1)}},y=l.filter(s=>s.clientName.toLowerCase().includes(j.toLowerCase())||s.clientSlug.toLowerCase().includes(j.toLowerCase())),h={totalMessages:l.reduce((s,a)=>s+a.totalMessages,0),totalTokens:l.reduce((s,a)=>s+a.totalTokens,0),totalCost:l.reduce((s,a)=>s+a.estimatedCost,0),avgMessagesPerClient:l.length>0?l.reduce((s,a)=>s+a.totalMessages,0)/l.length:0},R=s=>{const a={FREE:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100",STARTER:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",PRO:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",ENTERPRISE:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200"};return e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${a[s]||a.FREE}`,children:s})},D=s=>{const a={openai:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",anthropic:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",google:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200","N/A":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100"};return e.jsx(H,{variant:"outline",className:a[s]||a["N/A"],children:s.toUpperCase()})};return S?e.jsx(T,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsx(T,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Uso de IA"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Acompanhe o uso de inteligência artificial por cliente"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total de Mensagens"}),e.jsx(k,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:h.totalMessages.toLocaleString("pt-BR")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Todas conversas com IA"})]})]}),e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total de Tokens"}),e.jsx(G,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(h.totalTokens/1e3).toFixed(1),"K"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tokens processados"})]})]}),e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Custo Estimado"}),e.jsx(K,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["R$ ",h.totalCost.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Custo com APIs"})]})]}),e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Média por Cliente"}),e.jsx(J,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Math.round(h.avgMessagesPerClient)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mensagens / cliente"})]})]})]}),e.jsxs(c,{children:[e.jsx(x,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(m,{children:"Uso de IA por Cliente"}),e.jsx(U,{children:"Detalhes de mensagens, tokens e custos"})]})})}),e.jsxs(g,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(O,{placeholder:"Buscar cliente...",value:j,onChange:s=>M(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs($,{children:[e.jsx(Z,{children:e.jsxs(N,{children:[e.jsx(o,{children:"Cliente"}),e.jsx(o,{children:"Plano"}),e.jsx(o,{children:"Provider"}),e.jsx(o,{children:"Mensagens"}),e.jsx(o,{children:"Tokens"}),e.jsx(o,{children:"Custo"}),e.jsx(o,{children:"Último Uso"})]})}),e.jsx(q,{children:y.length===0?e.jsx(N,{children:e.jsx(n,{colSpan:7,className:"text-center py-8 text-gray-500",children:"Nenhum dado de uso encontrado"})}):y.map(s=>e.jsxs(N,{children:[e.jsx(n,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.clientName}),e.jsx("div",{className:"text-sm text-gray-500",children:s.clientSlug})]})}),e.jsx(n,{children:R(s.plan)}),e.jsx(n,{children:D(s.aiProvider)}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:s.totalMessages})]})}),e.jsx(n,{children:e.jsx("span",{className:"text-sm",children:s.totalTokens.toLocaleString("pt-BR")})}),e.jsx(n,{children:e.jsxs("span",{className:"font-semibold text-green-600",children:["R$ ",s.estimatedCost.toLocaleString("pt-BR",{minimumFractionDigits:2})]})}),e.jsx(n,{children:s.lastUsed?e.jsx("span",{className:"text-sm text-gray-600",children:new Date(s.lastUsed).toLocaleDateString("pt-BR")}):e.jsx("span",{className:"text-sm text-gray-400",children:"Nunca"})})]},s.clientId))})]})})]})]})]})})}export{ae as default};
