import{f as T,r as d,t,j as e,aH as b,s as F,B as c,I as p,g as C,l as U,n as q}from"./index-RWkbfn3L.js";import{L as x}from"./label-aYI7Ziwo.js";import{S as L,a as R,b as B,c as H,d as g}from"./select-Clc0vpBw.js";import{T as O,a as X,b as w,c as h,d as V,e as m}from"./table-CrjLMpO0.js";import{D as _,f as $,a as G,b as K,c as W}from"./dialog-8PybGCCj.js";import{P}from"./plus-KVHE3ReI.js";import{S as J}from"./square-pen-Cm_v8vQ9.js";import{T as Q}from"./trash-2-BkbH-M-A.js";import"./index-C1VieR44.js";function ne(){const{toast:o}=T(),[y,D]=d.useState([]),[E,S]=d.useState(!0),[I,l]=d.useState(!1),[u,f]=d.useState(null),[r,i]=d.useState({name:"",description:"",type:"FIXED",basePrice:0,pricePerUnit:0,estimatedDays:5,isActive:!0,isDefault:!1});d.useEffect(()=>{j()},[]);const j=async()=>{try{const{data:{user:s}}=await t.auth.getUser();if(!s)return;const{data:a}=await t.from("User").select("organizationId").eq("id",s.id).single();if(!(a!=null&&a.organizationId))return;const{data:n,error:N}=await t.from("ShippingMethod").select("*").eq("organizationId",a.organizationId).order("createdAt",{ascending:!1});if(N)throw N;D(n||[])}catch(s){console.error("Erro ao carregar métodos:",s),o({title:"Erro",description:"Não foi possível carregar os métodos de frete",variant:"destructive"})}finally{S(!1)}},A=async()=>{try{const{data:{user:s}}=await t.auth.getUser();if(!s)return;const{data:a}=await t.from("User").select("organizationId").eq("id",s.id).single();if(!(a!=null&&a.organizationId))return;if(u){const{error:n}=await t.from("ShippingMethod").update(r).eq("id",u.id);if(n)throw n;o({title:"Método atualizado",description:"O método de frete foi atualizado com sucesso"})}else{const{error:n}=await t.from("ShippingMethod").insert({...r,organizationId:a.organizationId});if(n)throw n;o({title:"Método criado",description:"O método de frete foi criado com sucesso"})}await j(),l(!1),f(null),v()}catch(s){console.error("Erro ao salvar método:",s),o({title:"Erro",description:"Não foi possível salvar o método de frete",variant:"destructive"})}},k=async s=>{if(confirm("Tem certeza que deseja excluir este método?"))try{const{error:a}=await t.from("ShippingMethod").delete().eq("id",s);if(a)throw a;o({title:"Método excluído",description:"O método de frete foi excluído com sucesso"}),await j()}catch(a){console.error("Erro ao excluir método:",a),o({title:"Erro",description:"Não foi possível excluir o método de frete",variant:"destructive"})}},v=()=>{i({name:"",description:"",type:"FIXED",basePrice:0,pricePerUnit:0,estimatedDays:5,isActive:!0,isDefault:!1}),f(null)},z=s=>{f(s),i({name:s.name,description:s.description||"",type:s.type,basePrice:s.basePrice,pricePerUnit:s.pricePerUnit,estimatedDays:s.estimatedDays,isActive:s.isActive,isDefault:s.isDefault}),l(!0)},M=async s=>{try{const{error:a}=await t.from("ShippingMethod").update({isActive:!s.isActive}).eq("id",s.id);if(a)throw a;await j()}catch(a){console.error("Erro ao alterar status:",a),o({title:"Erro",description:"Não foi possível alterar o status do método",variant:"destructive"})}};return E?e.jsx(b,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-gray-400"})})}):e.jsx(b,{children:e.jsxs("div",{className:"p-6 sm:p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Frete e Entrega"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Configure os métodos de entrega disponíveis no seu checkout"})]}),e.jsxs(_,{open:I,onOpenChange:l,children:[e.jsx($,{asChild:!0,children:e.jsxs(c,{onClick:()=>{v(),l(!0)},className:"bg-pink-600 hover:bg-pink-700",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Novo método"]})}),e.jsxs(G,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(K,{children:e.jsx(W,{children:u?"Editar Método de Frete":"Novo Método de Frete"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Nome do método *"}),e.jsx(p,{placeholder:"Ex: Correios PAC",value:r.name,onChange:s=>i({...r,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Descrição"}),e.jsx(p,{placeholder:"Ex: Entrega em 5 a 7 dias úteis",value:r.description,onChange:s=>i({...r,description:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Tipo de frete *"}),e.jsxs(L,{value:r.type,onValueChange:s=>i({...r,type:s}),children:[e.jsx(R,{children:e.jsx(B,{})}),e.jsxs(H,{children:[e.jsx(g,{value:"FIXED",children:"Fixo"}),e.jsx(g,{value:"WEIGHT_BASED",children:"Por peso"}),e.jsx(g,{value:"PRICE_BASED",children:"Por valor"}),e.jsx(g,{value:"LOCAL_PICKUP",children:"Retirada local"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Preço base (R$) *"}),e.jsx(p,{type:"number",step:"0.01",value:r.basePrice,onChange:s=>i({...r,basePrice:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Prazo (dias) *"}),e.jsx(p,{type:"number",value:r.estimatedDays,onChange:s=>i({...r,estimatedDays:parseInt(s.target.value)||0})})]})]}),r.type!=="FIXED"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Preço por unidade (R$)"}),e.jsx(p,{type:"number",step:"0.01",value:r.pricePerUnit,onChange:s=>i({...r,pricePerUnit:parseFloat(s.target.value)||0})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(c,{variant:"outline",className:"flex-1",onClick:()=>{l(!1),v()},children:"Cancelar"}),e.jsx(c,{className:"flex-1 bg-pink-600 hover:bg-pink-700",onClick:A,disabled:!r.name,children:u?"Atualizar":"Criar"})]})]})]})]}),y.length===0?e.jsx(C,{children:e.jsxs(U,{className:"py-12 text-center",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Você ainda não tem métodos de frete configurados."}),e.jsxs(c,{onClick:()=>l(!0),className:"bg-pink-600 hover:bg-pink-700",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Criar primeiro método"]})]})}):e.jsx(C,{children:e.jsxs(O,{children:[e.jsx(X,{children:e.jsxs(w,{children:[e.jsx(h,{children:"Nome"}),e.jsx(h,{children:"Tipo"}),e.jsx(h,{children:"Preço"}),e.jsx(h,{children:"Prazo"}),e.jsx(h,{children:"Status"}),e.jsx(h,{className:"text-right",children:"Ações"})]})}),e.jsx(V,{children:y.map(s=>e.jsxs(w,{children:[e.jsx(m,{className:"font-medium",children:s.name}),e.jsx(m,{children:s.type}),e.jsxs(m,{children:["R$ ",s.basePrice.toFixed(2)]}),e.jsxs(m,{children:[s.estimatedDays," dias"]}),e.jsx(m,{children:e.jsx(q,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativo":"Inativo"})}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>M(s),children:s.isActive?"Desativar":"Ativar"}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>z(s),children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>k(s.id),children:e.jsx(Q,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})})}export{ne as default};
