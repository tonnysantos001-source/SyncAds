import{c as le,R as ne,u as oe,f as ce,r as d,s as w,j as e,g as v,h as I,i as k,l as j,ar as V,o as F,B as f,I as X}from"./index-CQReMJg2.js";import{L as y}from"./label--QE-Krp5.js";import{S as W}from"./switch-BRzwQNuD.js";import{D as H,b as Z,c as B,d as J,e as Q,f as Y}from"./dialog-DEh8RoSm.js";import{A as M,b as de,a as R}from"./alert-BsdCDpoy.js";import{S as xe}from"./separator-ByqASFa_.js";import"./settingsStore-C0it6maN.js";import{A as ee}from"./activity-BI8j4G7v.js";import{C as se}from"./circle-check-XmK7iXIc.js";import{C as me}from"./circle-x-BOmVC0rM.js";import{E as ue}from"./external-link-d0qkkTCR.js";import{P as he}from"./plus-Dd-Mm_Zm.js";import{S as fe}from"./square-pen-CwBvTD1-.js";import{T as pe}from"./trash-2-CqfB0G-8.js";import"./index-CnPV0EMo.js";import"./index-CTcTxgHL.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=le("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);function ve(a,i){if(Object.is(a,i))return!0;if(typeof a!="object"||a===null||typeof i!="object"||i===null)return!1;if(a instanceof Map&&i instanceof Map){if(a.size!==i.size)return!1;for(const[n,x]of a)if(!Object.is(x,i.get(n)))return!1;return!0}if(a instanceof Set&&i instanceof Set){if(a.size!==i.size)return!1;for(const n of a)if(!i.has(n))return!1;return!0}const m=Object.keys(a);if(m.length!==Object.keys(i).length)return!1;for(const n of m)if(!Object.prototype.hasOwnProperty.call(i,n)||!Object.is(a[n],i[n]))return!1;return!0}const{useRef:je}=ne;function Ce(a){const i=je();return m=>{const n=a(m);return ve(i.current,n)?i.current:i.current=n}}const Ne=()=>oe(Ce(a=>({isAuthenticated:a.isAuthenticated,isInitialized:a.isInitialized,user:a.user}))),we=()=>{const{user:a}=Ne(),{toast:i}=ce(),[m,n]=d.useState([]),[x,P]=d.useState([]),[G,b]=d.useState(!0),[L,E]=d.useState(!1),[z,S]=d.useState(!1),[A,_]=d.useState(!1),C=async()=>{try{const{data:t,error:r}=await w.from("Pixel").select("*").eq("isActive",!0).order("platform");if(r)throw r;n(t||[])}catch(t){console.error("Error fetching pixels:",t),i({title:"Erro ao carregar pixels",description:t.message,variant:"destructive"})}},o=async()=>{if(a!=null&&a.id)try{b(!0);const{data:t,error:r}=await w.from("PixelConfig").select("*").eq("userId",a.id).order("createdAt",{ascending:!1});if(r)throw r;P(t||[])}catch(t){console.error("Error fetching pixel configs:",t),i({title:"Erro ao carregar configura√ß√µes",description:t.message,variant:"destructive"})}finally{b(!1)}},D=async t=>{if(!(a!=null&&a.id))return i({title:"Erro",description:"Usu√°rio n√£o autenticado",variant:"destructive"}),null;try{E(!0);const{data:r,error:c}=await w.from("PixelConfig").insert({userId:a.id,platform:t.platform,pixelId:t.pixelId,name:t.name,accessToken:t.accessToken,isActive:t.isActive??!0,events:t.events||["page_view","add_to_cart","purchase","initiate_checkout"],config:t.config||{}}).select().single();if(c)throw c;return i({title:"Pixel cadastrado!",description:`O pixel ${t.name||t.platform} foi cadastrado com sucesso.`}),await o(),r}catch(r){return console.error("Error creating pixel config:",r),i({title:"Erro ao cadastrar pixel",description:r.message,variant:"destructive"}),null}finally{E(!1)}},O=async(t,r)=>{try{S(!0);const{data:c,error:g}=await w.from("PixelConfig").update({...r,updatedAt:new Date().toISOString()}).eq("id",t).select().single();if(g)throw g;return i({title:"Pixel atualizado!",description:"As configura√ß√µes do pixel foram atualizadas com sucesso."}),await o(),c}catch(c){return console.error("Error updating pixel config:",c),i({title:"Erro ao atualizar pixel",description:c.message,variant:"destructive"}),null}finally{S(!1)}},T=async t=>{try{_(!0);const{error:r}=await w.from("PixelConfig").delete().eq("id",t);if(r)throw r;return i({title:"Pixel removido!",description:"A configura√ß√£o do pixel foi removida com sucesso."}),await o(),!0}catch(r){return console.error("Error deleting pixel config:",r),i({title:"Erro ao remover pixel",description:r.message,variant:"destructive"}),!1}finally{_(!1)}},p=async(t,r)=>{try{const{error:c}=await w.from("PixelConfig").update({isActive:r,updatedAt:new Date().toISOString()}).eq("id",t);if(c)throw c;return i({title:r?"Pixel ativado!":"Pixel desativado!",description:r?"O pixel est√° agora rastreando eventos.":"O pixel foi pausado temporariamente."}),await o(),!0}catch(c){return console.error("Error toggling pixel config:",c),i({title:"Erro ao alterar status",description:c.message,variant:"destructive"}),!1}},q=t=>x.some(r=>r.platform===t),l=t=>x.find(r=>r.platform===t),u=()=>x.filter(t=>t.isActive),N={total:x.length,active:x.filter(t=>t.isActive).length,inactive:x.filter(t=>!t.isActive).length,byPlatform:{facebook:x.filter(t=>t.platform==="FACEBOOK").length,tiktok:x.filter(t=>t.platform==="TIKTOK").length,google:x.filter(t=>t.platform==="GOOGLE_ADS").length}};return d.useEffect(()=>{C()},[]),d.useEffect(()=>{a!=null&&a.id&&o()},[a==null?void 0:a.id]),{pixels:m,pixelConfigs:x,loading:G,creating:L,updating:z,deleting:A,stats:N,createPixelConfig:D,updatePixelConfig:O,deletePixelConfig:T,togglePixelConfig:p,fetchPixelConfigs:o,fetchPixels:C,hasPixelForPlatform:q,getPixelConfigByPlatform:l,getActivePixelConfigs:u}},K={FACEBOOK:{platform:"FACEBOOK",name:"Meta Ads (Facebook/Instagram)",description:"Pixel do Meta para rastreamento de convers√µes no Facebook e Instagram",icon:"üìò",color:"#1877F2",documentation:"https://developers.facebook.com/docs/meta-pixel",requiredFields:["pixelId"],availableEvents:["page_view","add_to_cart","purchase","initiate_checkout","view_content","search","add_payment_info","complete_registration"]},TIKTOK:{platform:"TIKTOK",name:"TikTok Ads",description:"Pixel do TikTok para rastreamento de convers√µes e cria√ß√£o de p√∫blicos",icon:"üéµ",color:"#000000",documentation:"https://ads.tiktok.com/help/article?aid=10000357",requiredFields:["pixelId"],availableEvents:["page_view","add_to_cart","purchase","initiate_checkout","view_content","search","add_payment_info","complete_registration"]},GOOGLE_ADS:{platform:"GOOGLE_ADS",name:"Google Ads",description:"Tag de convers√£o do Google Ads para remarketing e medi√ß√£o",icon:"üîç",color:"#4285F4",documentation:"https://support.google.com/google-ads/answer/6331314",requiredFields:["pixelId"],availableEvents:["page_view","add_to_cart","purchase","begin_checkout","view_item","search","add_payment_info","sign_up"]}},te=(a,i)=>{switch(a){case"FACEBOOK":return/^\d{15,16}$/.test(i);case"TIKTOK":return/^[A-Z0-9]{15,20}$/.test(i);case"GOOGLE_ADS":return/^AW-\d{9,11}$/.test(i)||/^G-[A-Z0-9]{10}$/.test(i);default:return!1}},Le=()=>{const{pixelConfigs:a,loading:i,creating:m,updating:n,deleting:x,stats:P,createPixelConfig:G,updatePixelConfig:b,deletePixelConfig:L,togglePixelConfig:E,hasPixelForPlatform:z}=we(),[S,A]=d.useState(!1),[_,C]=d.useState(!1),[o,D]=d.useState(null),[O,T]=d.useState(null),[p,q]=d.useState(""),[l,u]=d.useState({platform:"FACEBOOK",pixelId:"",name:"",isActive:!0,events:["page_view","add_to_cart","purchase","initiate_checkout"]}),[N,t]=d.useState(null),r=s=>{D(s),u({platform:s,pixelId:"",name:"",isActive:!0,events:K[s].availableEvents.slice(0,4)}),t(null),A(!0)},c=s=>{T(s),u({platform:s.platform,pixelId:s.pixelId,name:s.name||"",isActive:s.isActive,events:s.events}),t(null),C(!0)},g=()=>{A(!1),C(!1),D(null),T(null),t(null)},ae=async()=>{if(!te(l.platform,l.pixelId)){t("ID de pixel inv√°lido para esta plataforma. Verifique o formato correto.");return}await G(l)&&g()},ie=async()=>{if(!O)return;if(l.pixelId&&l.pixelId!==O.pixelId&&!te(l.platform,l.pixelId)){t("ID de pixel inv√°lido para esta plataforma. Verifique o formato correto.");return}await b(O.id,{pixelId:l.pixelId,name:l.name,isActive:l.isActive,events:l.events})&&g()},re=async s=>{window.confirm("Tem certeza que deseja remover este pixel? Esta a√ß√£o n√£o pode ser desfeita.")&&await L(s)},$=a.filter(s=>{var h;return s.pixelId.toLowerCase().includes(p.toLowerCase())||((h=s.name)==null?void 0:h.toLowerCase().includes(p.toLowerCase()))||s.platform.toLowerCase().includes(p.toLowerCase())});return i?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Carregando pixels..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Pixels de Rastreamento"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gerencie seus pixels do Meta, TikTok e Google Ads integrados com sua Shopify"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(v,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Total de Pixels"}),e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold",children:P.total})})]}),e.jsxs(v,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Pixels Ativos"}),e.jsx(se,{className:"h-4 w-4 text-green-600"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold",children:P.active})})]}),e.jsxs(v,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Pixels Inativos"}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold",children:P.inactive})})]}),e.jsxs(v,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Plataformas"}),e.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"3"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Meta, TikTok, Google"})]})]})]}),e.jsxs(M,{children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx(de,{children:"Integra√ß√£o com Shopify"}),e.jsx(R,{children:"Os pixels cadastrados aqui ser√£o automaticamente integrados ao seu checkout da Shopify para rastreamento de convers√µes."})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Plataformas Dispon√≠veis"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:Object.values(K).map(s=>{const h=z(s.platform);return e.jsxs(v,{className:"hover:shadow-md transition-shadow",children:[e.jsx(I,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-2xl",style:{backgroundColor:s.color+"20"},children:s.icon}),e.jsxs("div",{children:[e.jsx(k,{className:"text-lg",children:s.name}),h&&e.jsxs(F,{variant:"secondary",className:"mt-1",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Configurado"]})]})]})})}),e.jsxs(j,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("a",{href:s.documentation,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"}),"Documenta√ß√£o"]}),e.jsxs(f,{size:"sm",onClick:()=>r(s.platform),disabled:m,variant:h?"outline":"default",children:[e.jsx(he,{className:"w-4 h-4 mr-1"}),h?"Adicionar Outro":"Cadastrar Pixel"]})]})]})]},s.platform)})})]}),e.jsx(xe,{}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Pixels Cadastrados"}),e.jsx(X,{type:"text",placeholder:"Buscar pixels...",value:p,onChange:s=>q(s.target.value),className:"max-w-xs"})]}),$.length===0?e.jsx(v,{children:e.jsxs(j,{className:"py-12 text-center",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Nenhum pixel cadastrado"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:p?"Nenhum pixel encontrado com esse filtro.":"Cadastre seu primeiro pixel para come√ßar a rastrear convers√µes."})]})}):e.jsx("div",{className:"space-y-4",children:$.map(s=>{const h=K[s.platform];return e.jsx(v,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-xl flex-shrink-0",style:{backgroundColor:h.color+"20"},children:h.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name||h.name}),e.jsx(F,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativo":"Inativo"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Pixel ID: ",s.pixelId]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.events.slice(0,4).map(U=>e.jsx(F,{variant:"outline",className:"text-xs",children:U},U)),s.events.length>4&&e.jsxs(F,{variant:"outline",className:"text-xs",children:["+",s.events.length-4]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>E(s.id,!s.isActive),disabled:n,children:e.jsx(ge,{className:`w-4 h-4 ${s.isActive?"text-green-600":"text-gray-400"}`})}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>c(s),disabled:n,children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>re(s.id),disabled:x,children:e.jsx(pe,{className:"w-4 h-4 text-red-600"})})]})]})})},s.id)})})]}),e.jsx(H,{open:S,onOpenChange:A,children:e.jsxs(Z,{children:[e.jsxs(B,{children:[e.jsxs(J,{children:["Cadastrar Pixel"," ",o&&K[o].name]}),e.jsx(Q,{children:"Configure um novo pixel para rastrear convers√µes na sua loja Shopify."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{htmlFor:"pixelId",children:["Pixel ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(X,{id:"pixelId",placeholder:o==="FACEBOOK"?"1234567890123456":o==="TIKTOK"?"CXXXXXXXXXXXXXXXXX":"AW-1234567890 ou G-XXXXXXXXXX",value:l.pixelId,onChange:s=>u({...l,pixelId:s.target.value})}),o&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Formato esperado:"," ",o==="FACEBOOK"&&"15-16 d√≠gitos",o==="TIKTOK"&&"C√≥digo alfanum√©rico de 15-20 caracteres",o==="GOOGLE_ADS"&&"AW-XXXXXXXXXX ou G-XXXXXXXXXX"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"name",children:"Nome (Opcional)"}),e.jsx(X,{id:"name",placeholder:"Ex: Pixel Principal, Pixel de Remarketing...",value:l.name,onChange:s=>u({...l,name:s.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{id:"isActive",checked:l.isActive,onCheckedChange:s=>u({...l,isActive:s})}),e.jsx(y,{htmlFor:"isActive",children:"Ativar pixel imediatamente"})]}),N&&e.jsx(M,{variant:"destructive",children:e.jsx(R,{children:N})})]}),e.jsxs(Y,{children:[e.jsx(f,{variant:"outline",onClick:g,children:"Cancelar"}),e.jsx(f,{onClick:ae,disabled:m||!l.pixelId,children:m?"Cadastrando...":"Cadastrar Pixel"})]})]})}),e.jsx(H,{open:_,onOpenChange:C,children:e.jsxs(Z,{children:[e.jsxs(B,{children:[e.jsx(J,{children:"Editar Pixel"}),e.jsx(Q,{children:"Atualize as configura√ß√µes do seu pixel."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"edit-pixelId",children:"Pixel ID"}),e.jsx(X,{id:"edit-pixelId",value:l.pixelId,onChange:s=>u({...l,pixelId:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"edit-name",children:"Nome"}),e.jsx(X,{id:"edit-name",placeholder:"Nome do pixel",value:l.name,onChange:s=>u({...l,name:s.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{id:"edit-isActive",checked:l.isActive,onCheckedChange:s=>u({...l,isActive:s})}),e.jsx(y,{htmlFor:"edit-isActive",children:"Pixel ativo"})]}),N&&e.jsx(M,{variant:"destructive",children:e.jsx(R,{children:N})})]}),e.jsxs(Y,{children:[e.jsx(f,{variant:"outline",onClick:g,children:"Cancelar"}),e.jsx(f,{onClick:ie,disabled:n,children:n?"Salvando...":"Salvar Altera√ß√µes"})]})]})})]})};export{Le as default};
