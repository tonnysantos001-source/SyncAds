var L=Object.defineProperty;var F=(a,s,t)=>s in a?L(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var p=(a,s,t)=>F(a,typeof s!="symbol"?s+"":s,t);import{s as b,aw as H,ax as z,ay as B,d as V,a as W,r as g,j as e,N as j,B as f,az as T,I as M,C as v,e as w,f as C,ab as U,h as N,aA as P,aB as D,g as $,n as X,ak as Y}from"./index-uxpDdXL2.js";import{L as E}from"./label-H8dDvCrO.js";import{D as J,a as Z,b as Q,c as ee,d as se,e as ae,f as te}from"./dialog-C2sewE8V.js";import{S as re,a as ie,b as ne,c as ce,d as oe}from"./select-CRAfHGMf.js";import{S as K}from"./SuperAdminLayout-BkTzwh_w.js";import"./index-BcJpzdIa.js";const le={async list(a){try{let s=b.from("Gateway").select("*").eq("isActive",!0).order("isPopular",{ascending:!1}).order("name",{ascending:!0});a!=null&&a.type&&(s=s.eq("type",a.type)),(a==null?void 0:a.isPopular)!==void 0&&(s=s.eq("isPopular",a.isPopular)),(a==null?void 0:a.supportsPix)!==void 0&&(s=s.eq("supportsPix",a.supportsPix)),(a==null?void 0:a.supportsCreditCard)!==void 0&&(s=s.eq("supportsCreditCard",a.supportsCreditCard));const{data:t,error:n}=await s;if(n)throw n;return t}catch(s){throw console.error("Error listing gateways:",s),s}},async getById(a){try{const{data:s,error:t}=await b.from("Gateway").select("*").eq("id",a).single();if(t)throw t;return s}catch(s){throw console.error("Error getting gateway:",s),s}},async getBySlug(a){try{const{data:s,error:t}=await b.from("Gateway").select("*").eq("slug",a).single();if(t)throw t;return s}catch(s){throw console.error("Error getting gateway by slug:",s),s}},async listPopular(){try{const{data:a,error:s}=await b.from("Gateway").select("*").eq("isActive",!0).eq("isPopular",!0).order("name",{ascending:!0});if(s)throw s;return a}catch(a){throw console.error("Error listing popular gateways:",a),a}}};class de extends Error{constructor(t){super(t.message);p(this,"type");p(this,"userMessage");p(this,"details");p(this,"code");p(this,"statusCode");p(this,"retryable");this.name="CustomError",this.type=t.type,this.userMessage=t.userMessage,this.details=t.details,this.code=t.code,this.statusCode=t.statusCode||500,this.retryable=t.retryable||!1}}function O(a){var s,t,n;return a!=null&&a.code?ue(a):a!=null&&a.response?me(a):(s=a==null?void 0:a.message)!=null&&s.includes("fetch")||(t=a==null?void 0:a.message)!=null&&t.includes("network")?{type:"NETWORK_ERROR",message:a.message,userMessage:"Erro de conexÃ£o. Verifique sua internet.",retryable:!0}:(n=a==null?void 0:a.message)!=null&&n.includes("timeout")?{type:"TIMEOUT",message:a.message,userMessage:"A operaÃ§Ã£o demorou muito. Tente novamente.",retryable:!0}:a instanceof de?{type:a.type,message:a.message,userMessage:a.userMessage,details:a.details,code:a.code,statusCode:a.statusCode,retryable:a.retryable}:{type:"UNKNOWN_ERROR",message:(a==null?void 0:a.message)||"Erro desconhecido",userMessage:"Algo deu errado. Tente novamente.",details:a,retryable:!1}}function ue(a){const s=a.code,t=a.message||"";return s==="PGRST301"||t.includes("JWT")?{type:"SESSION_EXPIRED",message:t,userMessage:"Sua sessÃ£o expirou. FaÃ§a login novamente.",code:s,statusCode:401,retryable:!1}:s==="PGRST116"||t.includes("not found")?{type:"NOT_FOUND",message:t,userMessage:"Registro nÃ£o encontrado.",code:s,statusCode:404,retryable:!1}:s==="23505"||t.includes("duplicate")||t.includes("already exists")?{type:"DUPLICATE_ENTRY",message:t,userMessage:"Este registro jÃ¡ existe.",code:s,statusCode:409,retryable:!1}:t.includes("permission denied")||t.includes("RLS")?{type:"FORBIDDEN",message:t,userMessage:"VocÃª nÃ£o tem permissÃ£o para esta aÃ§Ã£o.",code:s,statusCode:403,retryable:!1}:{type:"DATABASE_ERROR",message:t,userMessage:"Erro ao acessar o banco de dados.",code:s,statusCode:500,retryable:!0}}function me(a){var m,l;const s=(m=a.response)==null?void 0:m.status,t=(l=a.response)==null?void 0:l.data,n=(t==null?void 0:t.message)||(t==null?void 0:t.error)||a.message;switch(s){case 400:return{type:"VALIDATION_ERROR",message:n,userMessage:"Dados invÃ¡lidos. Verifique os campos.",statusCode:400,details:t,retryable:!1};case 401:return{type:"UNAUTHORIZED",message:n,userMessage:"VocÃª precisa fazer login.",statusCode:401,retryable:!1};case 403:return{type:"FORBIDDEN",message:n,userMessage:"VocÃª nÃ£o tem permissÃ£o para esta aÃ§Ã£o.",statusCode:403,retryable:!1};case 404:return{type:"NOT_FOUND",message:n,userMessage:"Recurso nÃ£o encontrado.",statusCode:404,retryable:!1};case 409:return{type:"DUPLICATE_ENTRY",message:n,userMessage:"Este registro jÃ¡ existe.",statusCode:409,retryable:!1};case 429:return{type:"RATE_LIMIT_EXCEEDED",message:n,userMessage:"Muitas requisiÃ§Ãµes. Aguarde um momento.",statusCode:429,retryable:!0};case 500:case 502:case 503:case 504:return{type:"API_ERROR",message:n,userMessage:"Erro no servidor. Tente novamente em alguns instantes.",statusCode:s,retryable:!0};default:return{type:"API_ERROR",message:n,userMessage:"Erro na comunicaÃ§Ã£o com o servidor.",statusCode:s,details:t,retryable:!0}}}class ge{constructor(){p(this,"logs",[]);p(this,"maxLogs",100)}log(s,t){const n={timestamp:new Date().toISOString(),type:s.type,message:s.message,userMessage:s.userMessage,details:s.details,code:s.code,statusCode:s.statusCode,userId:t==null?void 0:t.userId,organizationId:t==null?void 0:t.organizationId,url:window.location.href,userAgent:navigator.userAgent};this.logs.unshift(n),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(0,this.maxLogs)),this.sendToSentry(n)}getLogs(s=20){return this.logs.slice(0,s)}clear(){this.logs=[]}sendToSentry(s){H("error_details",{type:s.type,code:s.code,statusCode:s.statusCode,url:s.url}),z(s.userMessage,"error",{type:s.type,code:s.code,statusCode:s.statusCode});const t=new Error(s.message);t.name=s.type,B(t,{type:s.type,code:s.code,statusCode:s.statusCode,userMessage:s.userMessage,details:s.details,userId:s.userId,organizationId:s.organizationId,url:s.url})}}const ye=new ge;function pe(a,s){const t=O(a);return ye.log(t,s),t}async function xe(a,s={}){const{maxRetries:t=3,delayMs:n=1e3,backoff:m=!0}=s;let l;for(let y=0;y<=t;y++)try{return await a()}catch(x){if(l=x,!O(x).retryable)throw x;if(y===t)break;const c=m?n*Math.pow(2,y):n;await new Promise(u=>setTimeout(u,c)),console.log(`ðŸ”„ Retry attempt ${y+1}/${t}`)}throw l}function he(){const{toast:a}=V(),{user:s,organization:t}=W(),n=g.useCallback((i,c)=>{const u=pe(i,{userId:s==null?void 0:s.id,organizationId:t==null?void 0:t.id});return a({title:"Erro",description:c||u.userMessage,variant:"destructive"}),u},[a,s,t]),m=g.useCallback(i=>{a({title:"Sucesso",description:i})},[a]),l=g.useCallback(i=>{a({title:"AtenÃ§Ã£o",description:i,variant:"default"})},[a]),y=g.useCallback(i=>{a({title:"InformaÃ§Ã£o",description:i})},[a]),x=g.useCallback(async(i,c)=>{try{const A=await(c!=null&&c.retry?()=>xe(i,c.retry):i)();return c!=null&&c.successMessage&&m(c.successMessage),A}catch(u){return n(u,c==null?void 0:c.errorMessage),null}},[n,m]);return{showError:n,showSuccess:m,showWarning:l,showInfo:y,executeWithErrorHandling:x}}const k=[{value:"stripe",label:"Stripe",icon:"ðŸ’³"},{value:"mercadopago",label:"Mercado Pago",icon:"ðŸ‡§ðŸ‡·"},{value:"pagseguro",label:"PagSeguro",icon:"ðŸ”’"},{value:"paypal",label:"PayPal",icon:"ðŸ…¿ï¸"},{value:"asaas",label:"Asaas",icon:"ðŸ’°"}];function Ae(){const{showError:a,executeWithErrorHandling:s}=he(),[t,n]=g.useState([]),[m,l]=g.useState(!1),[y,x]=g.useState(!0),[i,c]=g.useState({name:"",provider:"",publicKey:"",secretKey:""});g.useEffect(()=>{u()},[]);const u=async()=>{x(!0);const r=await s(async()=>{const d=await le.list();return await Promise.all(d.map(async o=>{var I,R;try{const{count:q}=await b.from("Transaction").select("*",{count:"exact",head:!0}).eq("gatewayId",o.id);return{id:o.id,name:o.name,provider:o.type,publicKey:((I=o.apiKey)==null?void 0:I.slice(0,20))+"***"||"N/A",isActive:o.isActive,createdAt:o.createdAt,transactionsCount:q||0}}catch{return{id:o.id,name:o.name,provider:o.type,publicKey:((R=o.apiKey)==null?void 0:R.slice(0,20))+"***"||"N/A",isActive:o.isActive,createdAt:o.createdAt,transactionsCount:0}}}))},{errorMessage:"NÃ£o foi possÃ­vel carregar os gateways"});r&&n(r),x(!1)},A=async()=>{if(!i.name||!i.provider||!i.publicKey||!i.secretKey){a(new Error("Campos obrigatÃ³rios"),"Preencha todos os campos");return}await s(async()=>{const{data:d,error:h}=await b.from("Gateway").insert({name:i.name,type:i.provider,apiKey:i.publicKey,secretKey:i.secretKey,isActive:!0,createdAt:new Date().toISOString()}).select().single();if(h)throw h;return d},{successMessage:`${i.name} foi configurado com sucesso.`,errorMessage:"NÃ£o foi possÃ­vel adicionar o gateway"})&&(l(!1),c({name:"",provider:"",publicKey:"",secretKey:""}),u())},G=async(r,d)=>{await s(async()=>{const{error:o}=await b.from("Gateway").update({isActive:d,updatedAt:new Date().toISOString()}).eq("id",r);if(o)throw o;return!0},{successMessage:d?"Gateway ativado":"Gateway desativado",errorMessage:"NÃ£o foi possÃ­vel atualizar o status"})&&u()},_=r=>k.find(d=>d.value===r)||{label:r,icon:"ðŸ’³"},S={total:t.length,active:t.filter(r=>r.isActive).length,totalTransactions:t.reduce((r,d)=>r+(d.transactionsCount||0),0)};return y?e.jsx(K,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsx(K,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(j.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"Gateways de Pagamento"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Gerencie os meios de recebimento dos clientes"})]}),e.jsxs(J,{open:m,onOpenChange:l,children:[e.jsx(Z,{asChild:!0,children:e.jsxs(f,{className:"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Adicionar Gateway"]})}),e.jsxs(Q,{className:"sm:max-w-[500px] bg-gray-900 border-gray-700",children:[e.jsxs(ee,{children:[e.jsx(se,{className:"text-white",children:"Adicionar Gateway de Pagamento"}),e.jsx(ae,{className:"text-gray-400",children:"Configure um novo meio de recebimento"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"name",className:"text-gray-300",children:"Nome"}),e.jsx(M,{id:"name",placeholder:"Ex: Stripe Principal",value:i.name,onChange:r=>c({...i,name:r.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"provider",className:"text-gray-300",children:"Provider"}),e.jsxs(re,{value:i.provider,onValueChange:r=>c({...i,provider:r}),children:[e.jsx(ie,{className:"bg-gray-800 border-gray-700 text-white",children:e.jsx(ne,{placeholder:"Selecione um provider"})}),e.jsx(ce,{className:"bg-gray-800 border-gray-700",children:k.map(r=>e.jsx(oe,{value:r.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:r.icon}),e.jsx("span",{children:r.label})]})},r.value))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"publicKey",className:"text-gray-300",children:"Public Key"}),e.jsx(M,{id:"publicKey",placeholder:"pk_test_...",value:i.publicKey,onChange:r=>c({...i,publicKey:r.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"secretKey",className:"text-gray-300",children:"Secret Key"}),e.jsx(M,{id:"secretKey",type:"password",placeholder:"sk_test_...",value:i.secretKey,onChange:r=>c({...i,secretKey:r.target.value}),className:"bg-gray-800 border-gray-700 text-white"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Esta chave serÃ¡ armazenada de forma segura e criptografada"})]})]}),e.jsxs(te,{children:[e.jsx(f,{variant:"outline",onClick:()=>l(!1),className:"border-gray-700 text-gray-300 hover:bg-gray-800",children:"Cancelar"}),e.jsx(f,{className:"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white border-0",onClick:A,children:"Adicionar Gateway"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(v,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-gray-300",children:"Gateways Configurados"}),e.jsx(U,{className:"h-4 w-4 text-blue-400"})]}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:S.total}),e.jsx("p",{className:"text-xs text-gray-400",children:"Total de meios de pagamento"})]})]})}),e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(v,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-gray-300",children:"Gateways Ativos"}),e.jsx(P,{className:"h-4 w-4 text-green-400"})]}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:S.active}),e.jsx("p",{className:"text-xs text-gray-400",children:"Recebendo pagamentos"})]})]})}),e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(v,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-gray-300",children:"TransaÃ§Ãµes"}),e.jsx(D,{className:"h-4 w-4 text-purple-400"})]}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:S.totalTransactions}),e.jsx("p",{className:"text-xs text-gray-400",children:"Total processadas"})]})]})})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t.length===0?e.jsx(v,{className:"col-span-full",children:e.jsxs(N,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(CreditCard,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Nenhum gateway configurado"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Adicione seu primeiro gateway de pagamento"}),e.jsxs(f,{className:"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white border-0",onClick:()=>l(!0),children:[e.jsx(T,{className:"h-5 w-5 mr-2"}),"Adicionar Gateway"]})]})}):t.map((r,d)=>{const h=_(r.provider);return e.jsx(j.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:d*.1},children:e.jsxs(v,{className:"relative overflow-hidden border-gray-700/50 bg-gray-800/50 backdrop-blur-xl",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 transform translate-x-16 -translate-y-16 rounded-full ${r.isActive?"bg-green-500/10":"bg-gray-500/10"}`}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:h.icon}),e.jsxs("div",{children:[e.jsx(C,{className:"text-lg text-white",children:r.name}),e.jsx($,{className:"text-gray-400",children:h.label})]})]}),e.jsx(X,{variant:r.isActive?"default":"outline",children:r.isActive?"Ativo":"Inativo"})]})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Public Key"}),e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded block overflow-hidden text-ellipsis",children:r.publicKey})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"TransaÃ§Ãµes"}),e.jsx("span",{className:"font-medium text-white",children:r.transactionsCount||0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"outline",className:"flex-1 border-gray-700 hover:bg-gray-700",size:"sm",onClick:()=>{},children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Configurar"]}),e.jsx(f,{variant:r.isActive?"destructive":"default",size:"sm",onClick:()=>G(r.id,!r.isActive),children:r.isActive?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(P,{className:"h-4 w-4"})})]})]})]})},r.id)})})]})})}export{Ae as default};
