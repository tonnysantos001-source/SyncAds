import{d as X,r as h,s as y,j as e,N as w,b8 as S,C as $,e as F,f as M,g as _,n as z,h as O,I as j,B as R}from"./index-gnZ44lEE.js";import{L as m}from"./label-COwyjkf7.js";import{S as H}from"./switch-7Ud_WHh8.js";import{S as Z,a as U,b as Y,c as J,d as V}from"./select-CbC1N1a9.js";import{A as k,b as I,a as A}from"./alert-BSv7Vfig.js";import{S as K}from"./separator-mZq-XnsV.js";import{u as Q}from"./useOptimizedSelectors-CWXAv2a_.js";import{C as D}from"./credit-card-olyBjyWL.js";import{D as W}from"./dollar-sign-DnRwyCFa.js";import{P as ee}from"./percent-BAWapDoD.js";import{Z as se}from"./zap-vMplLvpX.js";import{T as te}from"./target-CYQOBivq.js";import{C as ae}from"./circle-alert-D-MLyNw5.js";import"./index-DZLB06Kh.js";import"./settingsStore-bH5UKA99.js";const C=({title:c,value:r,icon:f,color:l,delay:x=0,subtitle:p})=>e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:x},children:e.jsxs($,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${l} opacity-10 rounded-full blur-3xl`}),e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(M,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:c}),e.jsx("div",{className:`p-2 rounded-lg ${l} bg-opacity-10`,children:e.jsx(f,{className:`h-5 w-5 ${l.replace("bg-","text-")}`})})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:r}),p&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:p})]})]})}),v=[{key:"CREDIT_CARD",label:"Cartão de Crédito",icon:D,color:"bg-blue-500",description:"Desconto para pagamentos com cartão de crédito"},{key:"PIX",label:"PIX",icon:W,color:"bg-green-500",description:"Desconto para pagamentos via PIX (mais comum)"},{key:"BOLETO",label:"Boleto Bancário",icon:D,color:"bg-orange-500",description:"Desconto para pagamentos com boleto bancário"},{key:"DEBIT_CARD",label:"Cartão de Débito",icon:D,color:"bg-purple-500",description:"Desconto para pagamentos com cartão de débito"}],ve=()=>{const{toast:c}=X(),{user:r}=Q(),[f,l]=h.useState(!0),[x,p]=h.useState(!1),[g,B]=h.useState([]),[b,E]=h.useState({});h.useEffect(()=>{r!=null&&r.id&&N()},[r==null?void 0:r.id]);const N=async()=>{if(r!=null&&r.id)try{l(!0);const{data:t,error:o}=await y.from("PaymentMethodDiscount").select("*").eq("userId",r.id).order("createdAt",{ascending:!1});if(o)throw o;B(t||[]);const n={};v.forEach(a=>{var i,T;const s=(t||[]).find(L=>L.paymentMethod===a.key);s?n[a.key]={discountType:s.discountType,discountValue:s.discountValue.toString(),minPurchaseAmount:((i=s.minPurchaseAmount)==null?void 0:i.toString())||"0",maxDiscountAmount:((T=s.maxDiscountAmount)==null?void 0:T.toString())||"",description:s.description||"",isActive:s.isActive}:n[a.key]={discountType:"PERCENTAGE",discountValue:"",minPurchaseAmount:"0",maxDiscountAmount:"",description:"",isActive:!0}}),E(n)}catch(t){console.error("Erro ao carregar descontos:",t),c({title:"Erro ao carregar descontos",description:t.message,variant:"destructive"})}finally{l(!1)}},q=async t=>{var n;if(!(r!=null&&r.id))return;const o=b[t];if(!o||!o.discountValue){c({title:"Valor obrigatório",description:"Informe o valor do desconto",variant:"destructive"});return}p(!0);try{const a=g.find(i=>i.paymentMethod===t),s={userId:r.id,paymentMethod:t,discountType:o.discountType,discountValue:parseFloat(o.discountValue),minPurchaseAmount:parseFloat(o.minPurchaseAmount||"0"),maxDiscountAmount:o.maxDiscountAmount?parseFloat(o.maxDiscountAmount):null,description:o.description||null,isActive:o.isActive,updatedAt:new Date().toISOString()};if(a){const{error:i}=await y.from("PaymentMethodDiscount").update(s).eq("id",a.id);if(i)throw i}else{const{error:i}=await y.from("PaymentMethodDiscount").insert(s);if(i)throw i}c({title:"Desconto salvo!",description:`Desconto para ${(n=v.find(i=>i.key===t))==null?void 0:n.label} configurado com sucesso`}),await N()}catch(a){console.error("Erro ao salvar desconto:",a),c({title:"Erro ao salvar",description:a.message,variant:"destructive"})}finally{p(!1)}},G=async(t,o)=>{var n;if(window.confirm(`Tem certeza que deseja remover o desconto de ${(n=v.find(a=>a.key===o))==null?void 0:n.label}?`))try{const{error:a}=await y.from("PaymentMethodDiscount").delete().eq("id",t);if(a)throw a;c({title:"Desconto removido!",description:"O desconto foi removido com sucesso"}),await N()}catch(a){console.error("Erro ao remover desconto:",a),c({title:"Erro ao remover",description:a.message,variant:"destructive"})}},d=(t,o,n)=>{E(a=>({...a,[t]:{...a[t]||{discountType:"PERCENTAGE",discountValue:"",minPurchaseAmount:"0",maxDiscountAmount:"",description:"",isActive:!0},[o]:n}}))},P=(t,o=100)=>{const n=b[t];if(!n||!n.discountValue)return 0;const a=parseFloat(n.discountValue);let s=0;if(n.discountType==="PERCENTAGE"?s=o*a/100:s=a,n.maxDiscountAmount){const i=parseFloat(n.maxDiscountAmount);s=Math.min(s,i)}return s},u={total:g.length,active:g.filter(t=>t.isActive).length,inactive:g.filter(t=>!t.isActive).length};return f?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando descontos..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Descontos por Forma de Pagamento"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mt-2",children:"Configure descontos automáticos baseados na forma de pagamento escolhida pelo cliente no checkout"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsx(C,{title:"Total de Descontos",value:u.total,icon:ee,color:"bg-blue-500",delay:.1,subtitle:u.total===0?"Nenhum configurado":`${u.total} ${u.total===1?"método":"métodos"}`}),e.jsx(C,{title:"Descontos Ativos",value:u.active,icon:se,color:"bg-green-500",delay:.2,subtitle:"Aplicados no checkout"}),e.jsx(C,{title:"Descontos Inativos",value:u.inactive,icon:te,color:"bg-gray-500",delay:.3,subtitle:"Pausados temporariamente"})]}),e.jsxs(k,{children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx(I,{children:"Como funciona"}),e.jsx(A,{children:"Os descontos configurados aqui serão aplicados automaticamente no checkout público quando o cliente selecionar a forma de pagamento. O desconto será exibido de forma clara antes da finalização da compra."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Configurar Descontos"}),v.map((t,o)=>{const n=t.icon,a=g.find(i=>i.paymentMethod===t.key),s=b[t.key];return e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5+o*.1},children:e.jsxs($,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${t.color} flex items-center justify-center`,children:e.jsx(n,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(M,{className:"text-lg",children:t.label}),e.jsx(_,{children:t.description})]})]}),a&&e.jsx(z,{variant:a.isActive?"default":"secondary",children:a.isActive?"Ativo":"Inativo"})]})}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Tipo de Desconto"}),e.jsxs(Z,{value:(s==null?void 0:s.discountType)||"PERCENTAGE",onValueChange:i=>d(t.key,"discountType",i),children:[e.jsx(U,{children:e.jsx(Y,{})}),e.jsxs(J,{children:[e.jsx(V,{value:"PERCENTAGE",children:"Porcentagem (%)"}),e.jsx(V,{value:"FIXED_AMOUNT",children:"Valor Fixo (R$)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{children:["Valor do Desconto"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{type:"number",placeholder:"0",value:(s==null?void 0:s.discountValue)||"",onChange:i=>d(t.key,"discountValue",i.target.value),min:"0",step:"0.01"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300 font-medium",children:(s==null?void 0:s.discountType)==="PERCENTAGE"?"%":"R$"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Valor Mínimo da Compra"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{type:"number",placeholder:"0.00",value:(s==null?void 0:s.minPurchaseAmount)||"0",onChange:i=>d(t.key,"minPurchaseAmount",i.target.value),min:"0",step:"0.01"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300 font-medium",children:"R$"})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Desconto só se aplica acima deste valor"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Desconto Máximo (Opcional)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{type:"number",placeholder:"Sem limite",value:(s==null?void 0:s.maxDiscountAmount)||"",onChange:i=>d(t.key,"maxDiscountAmount",i.target.value),min:"0",step:"0.01"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300 font-medium",children:"R$"})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Limite máximo do desconto em reais"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Descrição (Opcional)"}),e.jsx(j,{placeholder:"Ex: Desconto especial para pagamento à vista",value:(s==null?void 0:s.description)||"",onChange:i=>d(t.key,"description",i.target.value)})]}),(s==null?void 0:s.discountValue)&&e.jsxs(k,{className:"border-blue-200 bg-blue-50",children:[e.jsx(S,{className:"h-4 w-4 text-blue-600"}),e.jsx(I,{className:"text-blue-900",children:"Preview do Desconto"}),e.jsxs(A,{className:"text-blue-800",children:[e.jsxs("p",{className:"mb-2",children:["Para uma compra de R$ 100,00, o desconto será de"," ",e.jsxs("strong",{children:["R$"," ",P(t.key,100).toFixed(2)]})]}),e.jsxs("p",{children:["Total a pagar:"," ",e.jsxs("strong",{children:["R$"," ",(100-P(t.key,100)).toFixed(2)]})]})]})]}),e.jsx(K,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(m,{children:"Status do Desconto"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:s!=null&&s.isActive?"Desconto será aplicado no checkout":"Desconto pausado temporariamente"})]}),e.jsx(H,{checked:(s==null?void 0:s.isActive)??!0,onCheckedChange:i=>d(t.key,"isActive",i)})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[a&&e.jsx(R,{variant:"outline",onClick:()=>G(a.id,t.key),disabled:x,children:"Remover"}),e.jsx(R,{onClick:()=>q(t.key),disabled:x||!(s!=null&&s.discountValue),className:"bg-pink-600 hover:bg-pink-700",children:x?"Salvando...":"Salvar Desconto"})]})]})]})},t.key)})]}),e.jsxs(k,{className:"border-pink-200 bg-pink-50",children:[e.jsx(ae,{className:"h-4 w-4 text-pink-600"}),e.jsxs(A,{className:"text-pink-900",children:[e.jsx("strong",{children:"Dica:"})," Descontos para PIX geralmente aumentam a taxa de conversão. Recomendamos oferecer entre 3% a 10% de desconto."]})]})]})};export{ve as default};
