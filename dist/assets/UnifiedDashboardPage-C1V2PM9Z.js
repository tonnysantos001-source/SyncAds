import{u as $,r as d,s as h,j as e,S as F,C as X,m as H,g as l,l as i,h as g,i as u,P as G,U as K}from"./index-Bkmeh8s3.js";import{D as W}from"./dollar-sign-CNWnC4Kw.js";import{T as Z}from"./trending-up-BD3sL38y.js";import{A as J,a as Q,b as _,R as ee,c as se,C as te,X as ae,Y as re,T as ne,d as oe}from"./AreaChart-CfauldK7.js";import{E as w}from"./eye-bjdHlNpQ.js";import{C as ce}from"./circle-check-DP14FePI.js";import{C as le}from"./clock-B0QWHfGZ.js";import{C as ie}from"./circle-x-DFxbNYw1.js";import{T as de}from"./trending-down-DnJwwALs.js";const ve=()=>{const o=$(s=>s.user),[C,v]=d.useState(!0),[k,D]=d.useState([]),[p,R]=d.useState([]),[b,A]=d.useState([]),[f,O]=d.useState("week"),[r,m]=d.useState({totalRevenue:0,revenueChange:0,totalOrders:0,ordersChange:0,conversionRate:0,conversionChange:0,averageOrderValue:0,aovChange:0,onlineNow:0,checkoutViews:0,checkoutAbandonment:0,topProducts:[]});d.useEffect(()=>{if(o!=null&&o.id){S();const s=setInterval(()=>{y()},3e4);return()=>clearInterval(s)}},[o==null?void 0:o.id,f]);const S=async()=>{try{v(!0),await Promise.all([P(),T(),M(),E(),I(),V(),y()])}catch(s){console.error("Erro ao carregar dashboard:",s)}finally{v(!1)}},P=async()=>{try{const{data:s}=await h.from("Order").select("total, createdAt").eq("userId",o.id).eq("status","paid").gte("createdAt",j()).order("createdAt",{ascending:!1});if(s&&s.length>0){const t=s.reduce((n,c)=>n+(c.total||0),0),a=U(s);m(n=>({...n,totalRevenue:t,revenueChange:a}))}}catch(s){console.error("Erro ao carregar receita:",s)}},T=async()=>{try{const{data:s}=await h.from("Order").select("id, createdAt, total").eq("userId",o.id).gte("createdAt",j()).order("createdAt",{ascending:!1});if(s){const t=s.length,a=L(s),n=s.reduce((N,Y)=>N+(Y.total||0),0),c=t>0?n/t:0;m(N=>({...N,totalOrders:t,ordersChange:a,averageOrderValue:c,aovChange:5.2}))}}catch(s){console.error("Erro ao carregar pedidos:",s)}},M=async()=>{try{m(a=>({...a,conversionRate:3.2,conversionChange:.8,checkoutViews:1247,checkoutAbandonment:68.5}))}catch(s){console.error("Erro ao carregar conversão:",s)}},E=async()=>{try{const{data:s}=await h.from("Order").select("total, createdAt").eq("userId",o.id).eq("status","paid").gte("createdAt",j()).order("createdAt",{ascending:!0});if(s){const t=q(s);D(t)}}catch(s){console.error("Erro ao carregar gráfico:",s)}},I=async()=>{try{const{data:s}=await h.from("Order").select("id, customerName, total, status, createdAt, paymentMethod").eq("userId",o.id).order("createdAt",{ascending:!1}).limit(5);if(s){const t=s.map(a=>({id:a.id,customer:a.customerName||"Cliente",amount:a.total||0,status:a.status==="paid"?"approved":a.status==="pending"?"pending":"failed",time:z(a.createdAt),paymentMethod:a.paymentMethod||"Cartão"}));A(t)}}catch(s){console.error("Erro ao carregar transações:",s)}},V=async()=>{try{const s=[{name:"Produto A",sales:45,revenue:4500},{name:"Produto B",sales:32,revenue:3200},{name:"Produto C",sales:28,revenue:2800},{name:"Produto D",sales:21,revenue:2100}];m(t=>({...t,topProducts:s}))}catch(s){console.error("Erro ao carregar produtos:",s)}},y=async()=>{try{const s=[{id:"1",page:"Checkout - Pagamento",timeOnPage:45,device:"mobile"},{id:"2",page:"Checkout - Dados Pessoais",timeOnPage:120,device:"desktop"},{id:"3",page:"Produto - Fones XYZ",timeOnPage:30,device:"mobile"}];R(s),m(t=>({...t,onlineNow:s.length}))}catch(s){console.error("Erro ao carregar dados em tempo real:",s)}},j=()=>{const s=new Date;switch(f){case"today":return new Date(s.setHours(0,0,0,0)).toISOString();case"week":return new Date(s.setDate(s.getDate()-7)).toISOString();case"month":return new Date(s.setMonth(s.getMonth()-1)).toISOString();case"year":return new Date(s.setFullYear(s.getFullYear()-1)).toISOString();default:return new Date(s.setDate(s.getDate()-7)).toISOString()}},U=s=>12.5,L=s=>8.3,q=s=>{const t={};return s.forEach(a=>{const n=new Date(a.createdAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"});t[n]=(t[n]||0)+(a.total||0)}),Object.entries(t).map(([a,n])=>({date:a,revenue:n,orders:Math.floor(Math.random()*20)+5}))},z=s=>{const t=new Date(s),n=new Date().getTime()-t.getTime(),c=Math.floor(n/6e4);return c<1?"Agora":c<60?`${c}m atrás`:c<1440?`${Math.floor(c/60)}h atrás`:t.toLocaleDateString("pt-BR")},x=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),B=[{title:"Receita Total",value:x(r.totalRevenue),change:r.revenueChange,trend:r.revenueChange>=0?"up":"down",icon:e.jsx(W,{className:"h-5 w-5"})},{title:"Pedidos",value:r.totalOrders,change:r.ordersChange,trend:r.ordersChange>=0?"up":"down",icon:e.jsx(F,{className:"h-5 w-5"})},{title:"Taxa de Conversão",value:r.conversionRate,change:r.conversionChange,trend:r.conversionChange>=0?"up":"down",icon:e.jsx(Z,{className:"h-5 w-5"}),suffix:"%"},{title:"Ticket Médio",value:x(r.averageOrderValue),change:r.aovChange,trend:r.aovChange>=0?"up":"down",icon:e.jsx(X,{className:"h-5 w-5"})}];return C?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(H,{className:"h-8 w-8 animate-spin text-pink-600"})}):e.jsxs("div",{className:"space-y-6 p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Visão geral das suas métricas de vendas"})]}),e.jsx("div",{className:"flex gap-2",children:["today","week","month","year"].map(s=>e.jsxs("button",{onClick:()=>O(s),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${f===s?"bg-pink-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:[s==="today"&&"Hoje",s==="week"&&"7 dias",s==="month"&&"30 dias",s==="year"&&"1 ano"]},s))})]}),e.jsx(l,{className:"bg-gradient-to-br from-pink-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(J,{className:"h-8 w-8 animate-pulse"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/80 text-sm font-medium",children:"Usuários Online Agora"}),e.jsx("p",{className:"text-4xl font-bold mt-1",children:r.onlineNow}),e.jsxs("p",{className:"text-white/80 text-xs mt-1",children:[p.filter(s=>s.page.includes("Checkout")).length," ","no checkout"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium",children:"Ao Vivo"})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:B.map((s,t)=>e.jsx(l,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"h-12 w-12 bg-pink-100 rounded-lg flex items-center justify-center text-pink-600",children:s.icon}),e.jsxs("div",{className:`flex items-center gap-1 text-sm font-medium ${s.trend==="up"?"text-green-600":"text-red-600"}`,children:[s.trend==="up"?e.jsx(Q,{className:"h-4 w-4"}):e.jsx(_,{className:"h-4 w-4"}),Math.abs(s.change),"%"]})]}),e.jsx("p",{className:"text-gray-600 text-sm font-medium mb-1",children:s.title}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[s.prefix,s.value,s.suffix]})]})},t))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(l,{className:"lg:col-span-2",children:[e.jsx(g,{children:e.jsx(u,{className:"text-lg font-semibold",children:"Receita ao Longo do Tempo"})}),e.jsx(i,{children:e.jsx(ee,{width:"100%",height:300,children:e.jsxs(se,{data:k,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ec4899",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#ec4899",stopOpacity:0})]})}),e.jsx(te,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(ae,{dataKey:"date",tick:{fill:"#666",fontSize:12}}),e.jsx(re,{tick:{fill:"#666",fontSize:12}}),e.jsx(ne,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),e.jsx(oe,{type:"monotone",dataKey:"revenue",stroke:"#ec4899",strokeWidth:2,fillOpacity:1,fill:"url(#colorRevenue)"})]})})})]}),e.jsxs(l,{children:[e.jsx(g,{children:e.jsxs(u,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-pink-600"}),"Atividade em Tempo Real"]})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[p.map(s=>e.jsxs("div",{className:"flex items-start gap-3 pb-4 border-b last:border-0 last:pb-0",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full mt-2 animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.page}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[s.timeOnPage,"s na página"]}),e.jsx("span",{className:"text-xs text-gray-400",children:"•"}),e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:s.device})]})]})]},s.id)),p.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Nenhum usuário online no momento"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsx(g,{children:e.jsx(u,{className:"text-lg font-semibold",children:"Transações Recentes"})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[b.map(s=>e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b last:border-0 last:pb-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ${s.status==="approved"?"bg-green-100":s.status==="pending"?"bg-yellow-100":"bg-red-100"}`,children:[s.status==="approved"&&e.jsx(ce,{className:"h-5 w-5 text-green-600"}),s.status==="pending"&&e.jsx(le,{className:"h-5 w-5 text-yellow-600"}),s.status==="failed"&&e.jsx(ie,{className:"h-5 w-5 text-red-600"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.customer}),e.jsx("p",{className:"text-xs text-gray-500",children:s.time})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold text-gray-900",children:x(s.amount)}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:s.paymentMethod})]})]},s.id)),b.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Nenhuma transação recente"})]})})]}),e.jsxs(l,{children:[e.jsx(g,{children:e.jsxs(u,{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-pink-600"}),"Produtos Mais Vendidos"]})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[r.topProducts.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"h-8 w-8 bg-gradient-to-br from-pink-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-sm",children:t+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.sales," vendas"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-sm font-bold text-gray-900",children:x(s.revenue)})})]},t)),r.topProducts.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Nenhum produto vendido ainda"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(l,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(w,{className:"h-5 w-5 text-blue-600"}),e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Visualizações do Checkout"})]}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:r.checkoutViews}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Últimos 7 dias"})]})}),e.jsx(l,{className:"bg-gradient-to-br from-amber-50 to-amber-100 border-amber-200",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(de,{className:"h-5 w-5 text-amber-600"}),e.jsx("p",{className:"text-sm font-medium text-amber-900",children:"Taxa de Abandono"})]}),e.jsxs("p",{className:"text-3xl font-bold text-amber-900",children:[r.checkoutAbandonment,"%"]}),e.jsx("p",{className:"text-xs text-amber-700 mt-1",children:"Oportunidade de melhoria"})]})}),e.jsx(l,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(K,{className:"h-5 w-5 text-green-600"}),e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Novos Clientes"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:Math.floor(r.totalOrders*.65)}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"65% dos pedidos"})]})})]})]})};export{ve as default};
