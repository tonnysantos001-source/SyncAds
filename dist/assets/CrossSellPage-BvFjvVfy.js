import{r as o,b as _,u as J,j as e,B as d,I as j,d as f,e as v,f as N,h as b,S as K,l as W}from"./index-Dp8T7_yL.js";import{T as Y,a as Z,b as E,c as u,d as ee,e as m}from"./table-CSq-PhDo.js";import{D as se,a as ae,b as te,c as re,d as ie,f as oe}from"./dialog-urgc1yCn.js";import{L as n}from"./label-u6bLtzmi.js";import{S as A,a as I,b as D,c as k,d as C}from"./select-CoY7G1n6.js";import{T as le}from"./textarea-D1iWbjZL.js";import{m as h}from"./marketingApi-D-37nNEV.js";import{p as de}from"./productsApi-CFpGeW-k.js";import{S as V}from"./skeleton-BvOxRLJm.js";import{P as z}from"./plus-Cx-HgXAG.js";import{S as R}from"./shopping-cart-donWatbC.js";import{P as ne}from"./percent-B2wkpzsA.js";import{S as ce}from"./square-pen-wM8AsNNA.js";import{T as ue}from"./trash-2-CwzJIqvX.js";import"./x-DFGXYiBU.js";import"./index-CmL9QpFf.js";import"./chevron-up-BV1zSlM2.js";const Ae=()=>{const[g,F]=o.useState([]),[y,G]=o.useState([]),[B,L]=o.useState(!0),[T,q]=o.useState(""),[H,c]=o.useState(!1),[x,w]=o.useState(null),{toast:l}=_(),r=J(s=>s.user),[t,i]=o.useState({name:"",triggerProductId:"",suggestedProductIds:[],discountType:"PERCENTAGE",discountValue:0,isActive:!0});o.useEffect(()=>{p()},[]);const p=async()=>{try{if(!(r!=null&&r.organizationId))return;const[s,a]=await Promise.all([h.crossSells.getAll(r.organizationId),de.list()]);F(s),G(a)}catch(s){l({title:"Erro ao carregar",description:s.message,variant:"destructive"})}finally{L(!1)}},O=async s=>{s.preventDefault();try{if(!(r!=null&&r.organizationId))return;x?(await h.crossSells.update(x.id,t),l({title:"Cross-sell atualizado!"})):(await h.crossSells.create({...t,organizationId:r.organizationId}),l({title:"Cross-sell criado!",description:"Configure produtos sugeridos para aumentar as vendas."})),c(!1),P(),p()}catch(a){l({title:"Erro",description:a.message,variant:"destructive"})}},$=async s=>{if(confirm("Tem certeza que deseja deletar este cross-sell?"))try{await h.crossSells.delete(s),l({title:"Cross-sell deletado"}),p()}catch(a){l({title:"Erro ao deletar",description:a.message,variant:"destructive"})}},M=s=>{w(s),i({name:s.name||"",triggerProductId:s.triggerProductId||"",suggestedProductIds:s.suggestedProductIds||[],discountType:s.discountType||"PERCENTAGE",discountValue:s.discountValue||0,isActive:s.isActive??!0}),c(!0)},P=()=>{w(null),i({name:"",triggerProductId:"",suggestedProductIds:[],discountType:"PERCENTAGE",discountValue:0,isActive:!0})},Q=s=>{const a=y.find(X=>X.id===s);return(a==null?void 0:a.name)||"Produto não encontrado"},S=g.filter(s=>{var a;return(a=s.name)==null?void 0:a.toLowerCase().includes(T.toLowerCase())}),U=g.filter(s=>s.isActive).length;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-purple-50/30 p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Cross-Sell"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Sugira produtos complementares e aumente o ticket médio"})]}),e.jsxs(se,{open:H,onOpenChange:c,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(d,{onClick:P,children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Criar Cross-Sell"]})}),e.jsxs(te,{className:"max-w-2xl",children:[e.jsx(re,{children:e.jsx(ie,{children:x?"Editar Cross-Sell":"Novo Cross-Sell"})}),e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Nome da Campanha"}),e.jsx(j,{value:t.name,onChange:s=>i({...t,name:s.target.value}),placeholder:"Ex: Combo Produto + Acessório",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Produto Gatilho"}),e.jsxs(A,{value:t.triggerProductId,onValueChange:s=>i({...t,triggerProductId:s}),children:[e.jsx(I,{children:e.jsx(D,{placeholder:"Selecione o produto que ativa a sugestão"})}),e.jsx(k,{children:y.map(s=>e.jsx(C,{value:s.id,children:s.name},s.id))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Quando este produto for adicionado ao carrinho, os produtos sugeridos aparecerão"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Produtos Sugeridos (IDs separados por vírgula)"}),e.jsx(le,{value:t.suggestedProductIds.join(", "),onChange:s=>i({...t,suggestedProductIds:s.target.value.split(",").map(a=>a.trim()).filter(Boolean)}),placeholder:"Ex: prod-123, prod-456",rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Digite os IDs dos produtos que serão sugeridos como complementares"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Tipo de Desconto"}),e.jsxs(A,{value:t.discountType,onValueChange:s=>i({...t,discountType:s}),children:[e.jsx(I,{children:e.jsx(D,{})}),e.jsxs(k,{children:[e.jsx(C,{value:"PERCENTAGE",children:"Percentual (%)"}),e.jsx(C,{value:"FIXED_AMOUNT",children:"Valor Fixo (R$)"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Valor do Desconto"}),e.jsx(j,{type:"number",step:"0.01",min:"0",value:t.discountValue,onChange:s=>i({...t,discountValue:parseFloat(s.target.value)||0}),placeholder:t.discountType==="PERCENTAGE"?"10":"50.00"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:t.isActive,onChange:s=>i({...t,isActive:s.target.checked}),className:"h-4 w-4"}),e.jsx(n,{htmlFor:"isActive",className:"cursor-pointer",children:"Ativo"})]})]}),e.jsxs(oe,{className:"mt-6",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",children:x?"Atualizar":"Criar"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(f,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total de Cross-Sells"}),e.jsx(R,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:g.length})})]}),e.jsxs(f,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Ativos"}),e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold",children:U})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(j,{placeholder:"Buscar cross-sells...",value:T,onChange:s=>q(s.target.value),className:"pl-9 border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm dark:text-white dark:placeholder:text-gray-500"})]}),e.jsxs(f,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg",children:[e.jsx(v,{children:e.jsx(N,{children:"Lista de Cross-Sells"})}),e.jsx(b,{children:B?e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"h-12 w-full"}),e.jsx(V,{className:"h-12 w-full"})]}):S.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"h-12 w-12 text-muted-foreground mb-4 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Nenhum cross-sell encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Comece criando o primeiro cross-sell para aumentar suas vendas"}),e.jsxs(d,{onClick:()=>c(!0),children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Criar Primeiro Cross-Sell"]})]}):e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(E,{children:[e.jsx(u,{children:"Nome"}),e.jsx(u,{children:"Produto Gatilho"}),e.jsx(u,{children:"Desconto"}),e.jsx(u,{children:"Status"}),e.jsx(u,{className:"text-right",children:"Ações"})]})}),e.jsx(ee,{children:S.map(s=>{var a;return e.jsxs(E,{children:[e.jsx(m,{className:"font-medium",children:s.name}),e.jsx(m,{className:"text-sm",children:Q(s.triggerProductId)}),e.jsx(m,{children:s.discountType==="PERCENTAGE"?`${s.discountValue}%`:`R$ ${(a=s.discountValue)==null?void 0:a.toFixed(2)}`}),e.jsx(m,{children:e.jsx(W,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativo":"Inativo"})}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>M(s),children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>$(s.id),children:e.jsx(ue,{className:"h-4 w-4"})})]})})]},s.id)})})]})})]})]})};export{Ae as default};
