import{c as ae,n as se,e as te,f as re,u as ie,r as l,s as m,j as e,m as S,g as y,h as $,i as H,l as j,I as z,O as I,B as A,o as E}from"./index-9opmT7pX.js";import{L as q}from"./label-BSYo--v5.js";import{S as w}from"./switch-Dc3F4iDv.js";import{a as ne}from"./gatewaysList-BfxCdpsq.js";import{S as R,a as U,b as J,c as K,d as G}from"./select-c8znCYDt.js";import{A as ce}from"./arrow-left-DdE4aQ-I.js";import{E as le}from"./external-link-BnJGJo2I.js";import"./index-DJOPIVgp.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=ae("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ve=()=>{const{slug:N}=se(),h=te(),{toast:o}=re(),n=ie(a=>a.user),[t,Q]=l.useState(null),[W,V]=l.useState(!0),[b,F]=l.useState(!1),[x,D]=l.useState(!1),[g,C]=l.useState(!1),[p,L]=l.useState("production"),[M,B]=l.useState(null),[P,X]=l.useState(null),[O,T]=l.useState(!1),[d,_]=l.useState({});l.useEffect(()=>{N&&Y()},[N]);const Y=async()=>{try{V(!0);const a=ne(N);if(!a){o({title:"Gateway não encontrado",description:"O gateway solicitado não existe.",variant:"destructive"}),h("/checkout/gateways");return}if(Q(a),n!=null&&n.id){const{data:s}=await m.from("Gateway").select("id").eq("slug",a.slug).single();if(s!=null&&s.id){const{data:r,error:v}=await m.from("GatewayConfig").select("*").eq("userId",n.id).eq("gatewayId",s.id).single();!v&&r&&(D(r.isActive||!1),C(r.isVerified??!1),L(r.environment??"production"),B(r.verifiedAt??null),X(r.id),_(r.credentials||{}))}}}catch(a){console.error("Error loading gateway:",a)}finally{V(!1)}},Z=async()=>{if(!(!t||!(n!=null&&n.id)))try{let a=null;F(!0);const s=t.configFields.filter(i=>i.required&&!d[i.name]).map(i=>i.label);if(s.length>0){o({title:"Campos obrigatórios",description:`Preencha os campos: ${s.join(", ")}`,variant:"destructive"});return}const{data:r,error:v}=await m.from("Gateway").select("id, slug, name").eq("slug",t.slug).single();if(v||!(r!=null&&r.id))throw v||new Error("Gateway não encontrado no banco");const{data:k}=await m.from("GatewayConfig").select("id").eq("userId",n.id).eq("gatewayId",r.id).single();if(k){const{error:i}=await m.from("GatewayConfig").update({credentials:d,isActive:x,updatedAt:new Date().toISOString()}).eq("id",k.id);i||(a=k.id)}else{const{data:i}=await m.from("GatewayConfig").select("id").eq("userId",n.id).limit(1),{data:c,error:u}=await m.from("GatewayConfig").insert({userId:n.id,gatewayId:r.id,credentials:d,isActive:x,isDefault:!i||i.length===0}).select("id").single();if(u)throw u;a=(c==null?void 0:c.id)||null}o({title:"Configuração salva!",description:`Gateway ${t.name} foi configurado com sucesso.`});try{const i=a?{configId:a}:{slug:t.slug,credentials:d,persistCredentials:!1},{data:c,error:u}=await m.functions.invoke("gateway-config-verify",{body:i});if(u)throw u;c!=null&&c.success?o({title:"Credenciais verificadas",description:c.message||"Gateway verificado com sucesso."}):o({title:"Falha na verificação",description:(c==null?void 0:c.message)||"Confira suas credenciais e tente novamente.",variant:"destructive"})}catch(i){o({title:"Erro ao verificar",description:(i==null?void 0:i.message)||"Não foi possível verificar as credenciais.",variant:"destructive"})}h("/checkout/gateways")}catch(a){console.error("Error saving gateway config:",a),o({title:"Erro ao salvar",description:"Não foi possível salvar a configuração.",variant:"destructive"})}finally{F(!1)}},ee=async()=>{if(!(!t||!(n!=null&&n.id)))try{T(!0);const a={};P?a.configId=P:(a.slug=t.slug,a.credentials=d,a.persistCredentials=!1);const{data:s,error:r}=await m.functions.invoke("gateway-config-verify",{body:a});if(r)throw r;s!=null&&s.success?(C(!0),B(s.verifiedAt||new Date().toISOString()),L("production"),o({title:"Verificação bem-sucedida",description:s.message||"Credenciais verificadas com sucesso."})):(C(!1),o({title:"Falha na verificação",description:(s==null?void 0:s.message)||"Não foi possível verificar as credenciais.",variant:"destructive"}))}catch(a){o({title:"Erro na verificação",description:(a==null?void 0:a.message)||"Erro inesperado ao verificar as credenciais.",variant:"destructive"})}finally{T(!1)}},f=(a,s)=>{_(r=>({...r,[a]:s}))};return W?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(S,{className:"h-8 w-8 animate-spin text-gray-400"})}):t?e.jsxs("div",{className:"p-6 sm:p-8 max-w-5xl mx-auto space-y-6",children:[e.jsxs("button",{onClick:()=>h("/checkout/gateways"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"ver todos gateways"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex items-center justify-center overflow-hidden p-2",children:e.jsx("img",{src:t.logo,alt:`${t.name} logo`,className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:t.name}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:["Integre sua loja ao gateway ",t.name,"."]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(y,{children:[e.jsx($,{children:e.jsx(H,{children:"Informações básicas"})}),e.jsx(j,{className:"space-y-4",children:t.configFields.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(q,{htmlFor:a.name,children:[a.label," ",a.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),a.type==="text"&&e.jsx(z,{id:a.name,type:"text",placeholder:a.placeholder,value:d[a.name]||"",onChange:s=>f(a.name,s.target.value),required:a.required}),a.type==="password"&&e.jsx(z,{id:a.name,type:"password",placeholder:a.placeholder,value:d[a.name]||"",onChange:s=>f(a.name,s.target.value),required:a.required}),a.type==="select"&&a.options&&e.jsxs(R,{value:d[a.name]||"",onValueChange:s=>f(a.name,s),children:[e.jsx(U,{children:e.jsx(J,{placeholder:a.placeholder||"Selecione"})}),e.jsx(K,{children:a.options.map(s=>e.jsx(G,{value:s.value,children:s.label},s.value))})]}),a.type==="checkbox"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:a.name,checked:d[a.name]||!1,onCheckedChange:s=>f(a.name,s)}),e.jsx(q,{htmlFor:a.name,className:"cursor-pointer",children:a.label})]})]},a.name))})]}),t.paymentMethods.length>0&&e.jsxs(y,{children:[e.jsx($,{children:e.jsx(H,{children:"Regras"})}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[t.paymentMethods.includes("credit_card")&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsx("span",{className:"text-sm",children:"Ativar cartão de crédito"}),e.jsx(w,{defaultChecked:!1,disabled:!g||p!=="production"}),(!g||p!=="production")&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"Disponível após verificação em produção"})]}),t.paymentMethods.includes("pix")&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsx("span",{className:"text-sm",children:"Ativar pix"}),e.jsx(w,{defaultChecked:!1,disabled:!g||p!=="production"}),(!g||p!=="production")&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"Disponível após verificação em produção"})]}),t.paymentMethods.includes("boleto")&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsx("span",{className:"text-sm",children:"Utilizar taxa de juros customizada"}),e.jsx(w,{defaultChecked:!1,disabled:!g||p!=="production"}),(!g||p!=="production")&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"Disponível após verificação em produção"})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(y,{className:I("border-2",x?"border-green-200 bg-green-50 dark:bg-green-950/20":"border-red-200 bg-red-50 dark:bg-red-950/20"),children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(q,{htmlFor:"status",className:"text-base font-semibold",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:I("h-3 w-3 rounded-full",x?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:I("text-sm font-medium",x?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"),children:x?"Ativo":"Inativo"})]})]}),e.jsxs(R,{value:x?"active":"inactive",onValueChange:a=>D(a==="active"),children:[e.jsx(U,{id:"status",children:e.jsx(J,{})}),e.jsxs(K,{children:[e.jsx(G,{value:"active",children:"Ativo"}),e.jsx(G,{value:"inactive",children:"Inativo"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Verificação"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:g&&M?`Verificado em: ${new Date(M).toLocaleString()}`:"Não verificado"}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Ambiente: ",p]})]}),e.jsx(A,{onClick:async()=>{await ee()},disabled:O,className:"gap-2",children:O?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 animate-spin"})," ","Verificando..."]}):"Verificar credenciais"})]}),e.jsxs("a",{href:t.apiDocs,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-pink-600 hover:text-pink-700 dark:text-pink-400 dark:hover:text-pink-300",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:"Está com dúvidas?"}),e.jsxs("span",{className:"underline",children:["Como integrar o gateway ",t.name,"?"]}),e.jsx(le,{className:"h-3 w-3"})]})]})]})}),e.jsx(y,{children:e.jsxs(j,{className:"p-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Tipo"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[(t.type==="nacional"||t.type==="both")&&e.jsx(E,{variant:"secondary",children:"Nacional"}),(t.type==="global"||t.type==="both")&&e.jsx(E,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:"Global"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Métodos de Pagamento"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:t.paymentMethods.map(a=>e.jsxs(E,{variant:"outline",className:"text-xs",children:[a==="credit_card"&&"Cartão de Crédito",a==="debit_card"&&"Cartão de Débito",a==="pix"&&"Pix",a==="boleto"&&"Boleto",a==="wallet"&&"Carteira Digital"]},a))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Features"}),e.jsx("ul",{className:"mt-1 space-y-1",children:t.features.map((a,s)=>e.jsxs("li",{className:"text-xs text-gray-700 dark:text-gray-300",children:["• ",a]},s))})]})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[e.jsx(A,{variant:"outline",onClick:()=>h("/checkout/gateways"),disabled:b,children:"Cancelar"}),e.jsx(A,{onClick:Z,disabled:b,className:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white",children:b?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando..."]}):"Salvar"})]})]}):null};export{ve as default};
