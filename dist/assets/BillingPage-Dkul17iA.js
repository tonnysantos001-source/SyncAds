import{c as ee,u as ae,f as se,r as n,s as c,j as e,t as re,g as k,h as w,i as C,k as A,l as S,n as f,B as o,ai as te,C as q,I as x}from"./index-qfmMwoGc.js";import{L as h}from"./label-DXSc73Fd.js";import{A as ie,a as le}from"./alert-XgeMoe0b.js";import{D as B,a as V,b as z,c as Y,d as R,e as ne}from"./dialog-DGgbieAn.js";import{C as P}from"./circle-check-DHUM-uZ6.js";import{C as de}from"./calendar-Djeqcy1p.js";import{D as ce}from"./download-pAp8HXut.js";import{f as oe,p as me}from"./pt-BR-COO1Bk_c.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=ee("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),ye=()=>{const r=ae(a=>a.user),{toast:b}=se(),[G,N]=n.useState(!0),[i,O]=n.useState(null),[D,H]=n.useState([]),[I,T]=n.useState([]),[$,g]=n.useState(!1),[U,y]=n.useState(!1),[M,W]=n.useState([]),[l,m]=n.useState({cardNumber:"",cardName:"",expiryMonth:"",expiryYear:"",cvv:""});n.useEffect(()=>{r!=null&&r.id&&_()},[r==null?void 0:r.id]);const _=async()=>{try{N(!0);const{data:a}=await c.from("User").select("currentPlanId").eq("id",r.id).single();a!=null&&a.currentPlanId||await J(),await E()}catch(a){console.error("Error initializing:",a),await E()}},J=async()=>{try{const{data:a,error:d}=await c.from("Plan").select("*").eq("slug","free").single();if(d||!a){console.error("Free plan not found");return}const t=new Date,p=new Date(t);p.setFullYear(t.getFullYear()+100);const{data:u,error:j}=await c.from("Subscription").insert({userId:r.id,planId:a.id,status:"active",currentPeriodStart:t.toISOString(),currentPeriodEnd:p.toISOString(),usedAiMessages:0,aiMessagesResetAt:t.toISOString()}).select().single();if(j){console.error("Error creating subscription:",j);return}await c.from("User").update({currentPlanId:a.id,currentSubscriptionId:u.id}).eq("id",r.id),b({title:"Plano Gratuito Ativado!",description:"Seu plano gratuito foi ativado com sucesso."})}catch(a){console.error("Error initializing free plan:",a)}},E=async()=>{try{N(!0);const{data:a,error:d}=await c.from("Subscription").select(`
          *,
          plan:planId (*)
        `).eq("userId",r.id).eq("status","active").single();!d&&a&&O(a);const{data:t,error:p}=await c.from("PaymentMethod").select("*").eq("userId",r.id).order("isDefault",{ascending:!1});!p&&t&&H(t);const{data:u,error:j}=await c.from("Invoice").select("*").eq("userId",r.id).order("createdAt",{ascending:!1}).limit(10);!j&&u&&T(u);const{data:L,error:Z}=await c.from("Plan").select("*").eq("active",!0).order("sortOrder");!Z&&L&&W(L)}catch(a){console.error("Error loading billing data:",a)}finally{N(!1)}},K=async()=>{b({title:"Em breve",description:"A integração com o gateway de pagamento será implementada em breve."}),g(!1)},Q=async a=>{b({title:"Em breve",description:"A troca de planos será implementada em breve."}),y(!1)},v=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),F=a=>a?oe(new Date(a),"dd/MM/yyyy",{locale:me}):"-",X=a=>{const t={active:{label:"Ativa",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"},trialing:{label:"Trial",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},past_due:{label:"Atrasada",className:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200"},canceled:{label:"Cancelada",className:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"},paid:{label:"Paga",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"},open:{label:"Aberta",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},void:{label:"Cancelada",className:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}}[a]||{label:a,className:"bg-gray-100 text-gray-800"};return e.jsx(f,{className:t.className,children:t.label})};if(G)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(re,{className:"h-8 w-8 animate-spin text-gray-400"})});const s=(i==null?void 0:i.plan)||M.find(a=>a.slug==="free");return e.jsxs("div",{className:"p-6 sm:p-8 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Faturamento"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Gerencie seu plano, métodos de pagamento e faturas"})]}),e.jsxs(k,{children:[e.jsxs(w,{children:[e.jsx(C,{children:"Meu Plano"}),e.jsx(A,{children:(i==null?void 0:i.status)==="active"?`Você está atualmente no plano ${s==null?void 0:s.name}.`:"Selecione um plano para começar."})]}),e.jsxs(S,{className:"space-y-4",children:[s&&e.jsxs("div",{className:"p-6 rounded-lg border bg-gradient-to-br from-pink-50 to-purple-50 dark:from-pink-950/20 dark:to-purple-950/20",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.name}),(i==null?void 0:i.status)==="active"&&e.jsxs(f,{className:"bg-green-500 text-white",children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),"Ativo"]})]}),e.jsxs("p",{className:"text-3xl font-bold text-pink-600 dark:text-pink-400 mt-2",children:[s.price===0?"Gratuito":v(s.price),s.price>0&&e.jsx("span",{className:"text-lg font-normal text-gray-600 dark:text-gray-400",children:" /mês"})]})]}),s.slug==="free"&&e.jsx(o,{onClick:()=>y(!0),className:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white",children:"Ver Planos"})]}),e.jsx("div",{className:"space-y-2",children:s.features.map((a,d)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(P,{className:"h-4 w-4 text-green-600 dark:text-green-400 flex-shrink-0"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:a})]},d))}),i&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{children:["Renovação: ",F(i.currentPeriodEnd)]})]})})]}),e.jsxs(ie,{className:"border-blue-200 bg-blue-50 dark:bg-blue-950/20",children:[e.jsx(te,{className:"h-4 w-4 text-blue-600"}),e.jsxs(le,{className:"text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("strong",{children:"Checkout de Pagamento 100% Gratuito!"})," Você pode processar pagamentos ilimitados sem nenhum custo. No futuro, cobraremos apenas pelos pacotes de mensagens de IA."]})]})]})]}),e.jsxs(k,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Método de Pagamento"}),e.jsx(A,{children:"Gerencie seus cartões de crédito salvos"})]}),e.jsxs(o,{onClick:()=>g(!0),size:"sm",className:"bg-pink-600 hover:bg-pink-700 text-white",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Adicionar Cartão"]})]})}),e.jsx(S,{children:D.length>0?e.jsx("div",{className:"space-y-3",children:D.map(a=>e.jsxs("div",{className:"p-4 rounded-lg border bg-white dark:bg-gray-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-16 rounded bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center",children:e.jsx(q,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[a.brand||"Cartão"," •••• ",a.last4]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Validade: ",String(a.expiryMonth).padStart(2,"0"),"/",a.expiryYear]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.isDefault&&e.jsx(f,{className:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200",children:"Padrão"}),e.jsx(o,{variant:"ghost",size:"sm",children:"Remover"})]})]},a.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(xe,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"font-medium",children:"Nenhum cartão cadastrado"}),e.jsx("p",{className:"text-sm mt-1",children:"Adicione um cartão para pagamentos futuros"})]})})]}),e.jsxs(k,{children:[e.jsxs(w,{children:[e.jsx(C,{children:"Histórico de Faturas"}),e.jsx(A,{children:"Veja e baixe suas faturas anteriores"})]}),e.jsx(S,{children:I.length>0?e.jsx("div",{className:"space-y-2",children:I.map(a=>e.jsxs("div",{className:"p-4 rounded-lg border bg-white dark:bg-gray-800 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a.invoiceNumber}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:F(a.paidAt||a.createdAt)})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-gray-900 dark:text-white",children:v(a.amount)}),X(a.status)]}),a.invoicePdf&&e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(ce,{className:"h-4 w-4"})})]})]},a.id))}):e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx("svg",{className:"h-12 w-12 mx-auto mb-3 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"font-medium",children:"Nenhuma fatura emitida"}),e.jsx("p",{className:"text-sm mt-1",children:"Suas faturas aparecerão aqui quando forem geradas"})]})})]}),e.jsx(B,{open:$,onOpenChange:g,children:e.jsxs(V,{className:"sm:max-w-md",children:[e.jsxs(z,{children:[e.jsx(Y,{children:"Adicionar Cartão de Crédito"}),e.jsx(R,{children:"Adicione um cartão para pagamentos futuros"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cardNumber",children:"Número do Cartão"}),e.jsx(x,{id:"cardNumber",placeholder:"0000 0000 0000 0000",value:l.cardNumber,onChange:a=>m({...l,cardNumber:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cardName",children:"Nome no Cartão"}),e.jsx(x,{id:"cardName",placeholder:"Nome impresso no cartão",value:l.cardName,onChange:a=>m({...l,cardName:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"expiryMonth",children:"Mês"}),e.jsx(x,{id:"expiryMonth",placeholder:"MM",maxLength:2,value:l.expiryMonth,onChange:a=>m({...l,expiryMonth:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"expiryYear",children:"Ano"}),e.jsx(x,{id:"expiryYear",placeholder:"AAAA",maxLength:4,value:l.expiryYear,onChange:a=>m({...l,expiryYear:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cvv",children:"CVV"}),e.jsx(x,{id:"cvv",placeholder:"123",maxLength:4,value:l.cvv,onChange:a=>m({...l,cvv:a.target.value})})]})]})]}),e.jsxs(ne,{children:[e.jsx(o,{variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(o,{onClick:K,className:"bg-pink-600 hover:bg-pink-700 text-white",children:"Adicionar Cartão"})]})]})}),e.jsx(B,{open:U,onOpenChange:y,children:e.jsxs(V,{className:"sm:max-w-4xl",children:[e.jsxs(z,{children:[e.jsx(Y,{children:"Escolha seu Plano"}),e.jsx(R,{children:"Selecione o plano que melhor atende suas necessidades"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 py-4",children:M.map(a=>e.jsxs("div",{className:`relative p-6 rounded-lg border-2 ${a.isPopular?"border-pink-500 bg-pink-50 dark:bg-pink-950/20":"border-gray-200 dark:border-gray-700"}`,children:[a.isPopular&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:e.jsx(f,{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white",children:"Mais Popular"})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:a.name}),e.jsxs("p",{className:"text-3xl font-bold text-pink-600 dark:text-pink-400 mt-2",children:[a.price===0?"Gratuito":v(a.price),a.price>0&&e.jsx("span",{className:"text-sm font-normal text-gray-600",children:" /mês"})]})]}),e.jsx("ul",{className:"space-y-2 mb-6",children:a.features.map((d,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(P,{className:"h-4 w-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:d})]},t))}),e.jsx(o,{onClick:()=>Q(a.id),className:`w-full ${a.slug===(s==null?void 0:s.slug)?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white"}`,disabled:a.slug===(s==null?void 0:s.slug),children:a.slug===(s==null?void 0:s.slug)?"Plano Atual":"Selecionar"})]},a.id))})]})})]})};export{ye as default};
