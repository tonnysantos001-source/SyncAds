import{j as e}from"./vendor-ui-D3JNL6pE.js";import{f as s,r as a}from"./vendor-react-X41Bjl18.js";import{g as i,s as r,B as t,C as n,a as o,b as c,c as d,I as l,aP as m}from"./index-D-ADUcR6.js";import{L as x}from"./label-5B6OAN88.js";import{S as h,a as j,b as u,c as p,d as f}from"./select-Pu6nddvY.js";import{A as v,a as N}from"./alert-Cfp-9Efq.js";import{L as g,v as w,au as y,av as b,o as k,_ as C}from"./vendor-icons-BvRy6l6m.js";import"./vendor-supabase-HUq0BeMy.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-animation-DtB50Lbk.js";import"./vendor-query-DqG_mm-v.js";function I(){const{toast:I}=i(),S=s(),[A,V]=a.useState([]),[D,O]=a.useState(!0),[E,U]=a.useState(!1),[z,F]=a.useState(!1),[J,M]=a.useState({subdomain:"checkout",domain:""});a.useEffect(()=>{T()},[]);const T=async()=>{try{const{data:{user:e}}=await r.auth.getUser();if(!e)return;const{data:s}=await r.from("User").select("domain, domainVerified").eq("id",e.id).single();s?.domain&&V([{id:"1",domain:s.domain,subdomain:"checkout",cnameRecord:q(s.domain),verified:s.domainVerified||!1,sslConfigured:!1,createdAt:(new Date).toISOString()}])}catch(e){}finally{O(!1)}},q=e=>{const s=e.split("").reduce((e,s)=>(e<<5)-e+s.charCodeAt(0)|0,0);return`checkout-${Math.abs(s).toString(36)}.syncads.com.br`},R=async()=>{if(J.domain)try{const{data:{user:e}}=await r.auth.getUser();if(!e)return;q(J.domain);const s=`${J.subdomain}.${J.domain}`,{error:a}=await r.from("User").update({domain:s,domainVerified:!1,domainVerificationToken:crypto.randomUUID(),domainVerificationMethod:"DNS"}).eq("id",e.id);if(a)throw a;I({title:"Domínio cadastrado",description:"Agora você precisa configurar o DNS no seu provedor"}),await T(),U(!1),M({subdomain:"checkout",domain:""})}catch(e){I({title:"Erro",description:"Não foi possível cadastrar o domínio",variant:"destructive"})}else I({title:"Erro",description:"Por favor, preencha o domínio",variant:"destructive"})},$=(e,s)=>{navigator.clipboard.writeText(e),I({title:"Copiado!",description:`${s} copiado para a área de transferência`})};if(D)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(g,{className:"h-8 w-8 animate-spin text-gray-400"})});if(0===A.length)return e.jsx("div",{children:e.jsxs("div",{className:"p-6 sm:p-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Você ainda não tem nenhum domínio cadastrado."}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400 mb-8",children:"Cadastrando seu domínio você aumenta a credibilidade e conversão da sua loja."}),e.jsx(t,{size:"lg",onClick:()=>U(!0),className:"bg-pink-600 hover:bg-pink-700 text-white",children:"CADASTRAR DOMÍNIO"})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(n,{className:"w-full max-w-md",children:[e.jsx(o,{children:e.jsx(c,{className:"uppercase text-lg",children:"Adicionar novo domínio"})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Domínio"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{value:J.subdomain,onValueChange:e=>M({...J,subdomain:e}),children:[e.jsx(j,{className:"w-[140px]",children:e.jsx(u,{})}),e.jsxs(p,{children:[e.jsx(f,{value:"checkout",children:"checkout."}),e.jsx(f,{value:"seguro",children:"seguro."}),e.jsx(f,{value:"secure",children:"secure."}),e.jsx(f,{value:"pay",children:"pay."})]})]}),e.jsx(l,{placeholder:"ex.: sualoja.com.br",value:J.domain,onChange:e=>M({...J,domain:e.target.value})})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("p",{children:"• Vincule um domínio que já pertença a você."}),e.jsx("p",{children:"• Não use http, https, www e url da sua loja myshopify."})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(t,{variant:"outline",className:"flex-1",onClick:()=>U(!1),children:"Cancelar"}),e.jsx(t,{className:"flex-1 bg-pink-600 hover:bg-pink-700",onClick:R,children:"Salvar"})]})]})]})})]})});const P=A[0],Z=`${P.subdomain}.${P.domain}`;return e.jsx("div",{children:e.jsx("div",{className:"p-6 sm:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>S("/onboarding"),className:"text-pink-600 hover:text-pink-700 mb-4 flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"ver todos os domínios"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"CONFIGURAÇÃO DO DOMÍNIO"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:Z})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(n,{children:[e.jsx(o,{children:e.jsx(c,{children:"Cadastrando o apontamento"})}),e.jsxs(d,{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Em seu provedor, na seção de configuração registros DNS, adicione as informações abaixo. Preencha cada campo com as respectivas informações listadas abaixo:"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"text-xs uppercase tracking-wide",children:"Tipo"}),e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>$("CNAME","Tipo"),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"CNAME"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"text-xs uppercase tracking-wide",children:"Nome"}),e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>$(P.subdomain,"Nome"),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),P.subdomain]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"text-xs uppercase tracking-wide",children:"Valor"}),e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>$(P.cnameRecord,"Valor"),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),P.cnameRecord]})]})]}),e.jsxs(v,{children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(N,{children:"Após realizar corretamente os apontamentos acima em seu provedor de domínio, você deve aguardar um tempo para que as informações sejam propagadas. Esse processo costuma levar até 4h."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(t,{variant:"outline",className:"flex-1",onClick:async()=>{try{const{data:{user:e}}=await r.auth.getUser();if(!e)return;const{error:s}=await r.from("User").update({domain:null,domainVerified:!1,domainVerificationToken:null}).eq("id",e.id);if(s)throw s;I({title:"Domínio excluído",description:"O domínio foi removido com sucesso"}),await T()}catch(e){I({title:"Erro",description:"Não foi possível excluir o domínio",variant:"destructive"})}},children:"Excluir domínio"}),e.jsx(t,{className:"flex-1 bg-pink-600 hover:bg-pink-700 text-white",onClick:async()=>{F(!0);try{const{data:{user:e}}=await r.auth.getUser();if(!e)return;const{data:s}=await r.auth.getSession(),a=await fetch(`${m.functionsUrl}/verify-domain`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s?.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92c2tlcHFnZ214bGZja3hxZ2JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4MjQ4NTUsImV4cCI6MjA3NjQwMDg1NX0.UdNgqpTN38An6FuoJPZlj_zLkmAqfJQXb6i1DdTQO_E"},body:JSON.stringify({subdomain:P.subdomain,domain:P.domain})}),i=await a.json();if(!a.ok||!i.verified)throw new Error(i.details||i.reason||"Verificação falhou");I({title:"Domínio verificado com sucesso!",description:"Seu domínio está pronto para uso"}),await T()}catch(e){I({title:"Erro",description:e.message||"Não foi possível verificar o domínio. Verifique se o DNS está configurado corretamente.",variant:"destructive"})}finally{F(!1)}},disabled:z||P.verified,children:z?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 mr-2 animate-spin"}),"Verificando..."]}):"VERIFICAR DOMÍNIO"})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n,{children:[e.jsx(o,{children:e.jsx(c,{className:"text-sm",children:"Status"})}),e.jsx(d,{children:e.jsx("div",{className:"flex items-center gap-2",children:P.verified?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-green-500 font-medium",children:"Concluído"})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-yellow-500 font-medium",children:"Pendente"})]})})})]}),e.jsxs(n,{children:[e.jsx(o,{children:e.jsx(c,{className:"text-sm",children:"SSL"})}),e.jsx(d,{children:e.jsx("div",{className:"flex items-center gap-2",children:P.sslConfigured?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-green-500 font-medium",children:"Concluído"})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-yellow-500 font-medium",children:"Pendente"})]})})})]}),e.jsxs(n,{children:[e.jsx(o,{children:e.jsxs(c,{className:"text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-pink-100 flex items-center justify-center",children:e.jsx(b,{className:"h-5 w-5 text-pink-600"})}),"Está com dúvidas?"]})}),e.jsxs(d,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Aprenda como verificar o domínio da sua loja."}),e.jsxs(t,{variant:"link",className:"p-0",children:["Ver tutorial ",e.jsx(C,{className:"h-4 w-4 ml-1"})]})]})]})]})]})]})})})}export{I as default};
