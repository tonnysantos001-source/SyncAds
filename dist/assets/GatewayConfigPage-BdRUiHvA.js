import{j as e}from"./vendor-ui-D3JNL6pE.js";import{k as a,f as s,r}from"./vendor-react-X41Bjl18.js";import{g as t,f as i,s as l,e as n,C as d,a as o,b as c,c as m,I as x,h as g,B as h}from"./index-BKeegzPq.js";import{L as p}from"./label-D0zMtGEm.js";import{S as u}from"./switch-CtiOT17c.js";import{a as y,G as b}from"./GatewayLogo-BzRHe6h8.js";import{S as j,a as v,b as f,c as N,d as w}from"./select-BMRuRgso.js";import{S as k}from"./skeleton-BfY8mepo.js";import{m as C}from"./vendor-animation-DtB50Lbk.js";import{v as S,_ as G,p as q,l as I,au as P,aw as A,E as F,g as M,Z as V,aJ as D,c as _,o as E,bc as B,L}from"./vendor-icons-BvRy6l6m.js";import"./vendor-supabase-HUq0BeMy.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-DqG_mm-v.js";const O=()=>{const{slug:O}=a(),T=s(),{toast:$}=t(),z=i(e=>e.user),[J,R]=r.useState(null),[X,Z]=r.useState(!0),[H,K]=r.useState(!1),[Q,U]=r.useState(!1),[W,Y]=r.useState(!1),[ee,ae]=r.useState("production"),[se,re]=r.useState(null),[te,ie]=r.useState(null),[le,ne]=r.useState(!1),[de,oe]=r.useState({}),[ce,me]=r.useState(!1),[xe,ge]=r.useState(!1),[he,pe]=r.useState(!1),[ue,ye]=r.useState({}),[be,je]=r.useState(null);r.useEffect(()=>{O&&ve()},[O]);const ve=async()=>{try{Z(!0);const e=y(O);if(!e)return $({title:"Gateway n√£o encontrado",description:"O gateway solicitado n√£o existe.",variant:"destructive"}),void T("/checkout/gateways");if(R(e),z?.id){const{data:a}=await l.from("Gateway").select("id").eq("slug",e.slug).single();if(a?.id){const{data:e,error:s}=await l.from("GatewayConfig").select("*").eq("userId",z.id).eq("gatewayId",a.id).single();if(!s&&e&&(U(e.isActive||!1),Y(e.isVerified??!1),ae(e.environment??"production"),re(e.verifiedAt??null),ie(e.id),oe(e.credentials||{}),e.credentials?.enabledPaymentMethods)){const a=e.credentials.enabledPaymentMethods;me(a.includes("credit_card")),ge(a.includes("pix")),pe(a.includes("boleto"))}}}}catch(e){}finally{Z(!1)}},fe=(e,a)=>{oe(s=>({...s,[e]:a}))},Ne=(e,a)=>{navigator.clipboard.writeText(e),je(a),setTimeout(()=>je(null),2e3),$({title:"üìã Copiado!",description:"Valor copiado para a √°rea de transfer√™ncia."})};return X?e.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto p-6",children:[e.jsx(k,{className:"h-10 w-48"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{className:"w-20 h-20 rounded-lg"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{className:"h-10 w-64"}),e.jsx(k,{className:"h-4 w-96"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(k,{className:"h-64 w-full"}),e.jsx(k,{className:"h-48 w-full"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(k,{className:"h-48 w-full"}),e.jsx(k,{className:"h-64 w-full"})]})]})]}):J?e.jsxs("div",{className:"p-6 sm:p-8 max-w-5xl mx-auto space-y-6",children:[e.jsx(C.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3},children:e.jsxs("button",{onClick:()=>T("/checkout/gateways"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white transition-colors group",children:[e.jsx(S,{className:"h-4 w-4 group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:"Voltar para Gateways"})]})}),e.jsxs(C.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"flex items-start gap-6",children:[e.jsx(b,{name:J.name,logo:J.logo,slug:J.slug,size:"xl"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent",children:J.name}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mt-2",children:J.description}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[("nacional"===J.type||"both"===J.type)&&e.jsx(n,{className:"bg-green-500/10 text-green-700 dark:text-green-400 border-0",children:"Nacional"}),("global"===J.type||"both"===J.type)&&e.jsx(n,{className:"bg-blue-500/10 text-blue-700 dark:text-blue-400 border-0",children:"Global"})]})]}),e.jsxs("a",{href:J.apiDocs,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 transition-colors text-sm font-medium",children:[e.jsx(G,{className:"h-4 w-4"}),"Documenta√ß√£o"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:e.jsxs(d,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 bg-opacity-10",children:e.jsx(q,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsx(c,{className:"text-xl",children:"Credenciais de API"})]})}),e.jsx(m,{className:"space-y-4",children:J.configFields.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:a.name,children:[a.label," ",a.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),"text"===a.type&&e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:a.name,type:"text",placeholder:a.placeholder,value:de[a.name]||"",onChange:e=>fe(a.name,e.target.value),className:"pr-10 dark:bg-gray-800 dark:border-gray-700",required:a.required}),de[a.name]&&e.jsx("button",{type:"button",onClick:()=>Ne(de[a.name],a.name),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:be===a.name?e.jsx(I,{className:"h-4 w-4 text-green-600"}):e.jsx(P,{className:"h-4 w-4 text-gray-400"})})]}),"password"===a.type&&e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:a.name,type:ue[a.name]?"text":"password",placeholder:a.placeholder,value:de[a.name]||"",onChange:e=>fe(a.name,e.target.value),className:"pr-20 dark:bg-gray-800 dark:border-gray-700",required:a.required}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex gap-1",children:[de[a.name]&&e.jsx("button",{type:"button",onClick:()=>Ne(de[a.name],a.name),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:be===a.name?e.jsx(I,{className:"h-4 w-4 text-green-600"}):e.jsx(P,{className:"h-4 w-4 text-gray-400"})}),e.jsx("button",{type:"button",onClick:()=>{return e=a.name,void ye(a=>({...a,[e]:!a[e]}));var e},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:ue[a.name]?e.jsx(A,{className:"h-4 w-4 text-gray-400"}):e.jsx(F,{className:"h-4 w-4 text-gray-400"})})]})]}),"select"===a.type&&a.options&&e.jsxs(j,{value:de[a.name]||"",onValueChange:e=>fe(a.name,e),children:[e.jsx(v,{className:"dark:bg-gray-800 dark:border-gray-700",children:e.jsx(f,{placeholder:a.placeholder||"Selecione"})}),e.jsx(N,{children:a.options.map(a=>e.jsx(w,{value:a.value,children:a.label},a.value))})]}),"checkbox"===a.type&&e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50",children:[e.jsx(u,{id:a.name,checked:de[a.name]||!1,onCheckedChange:e=>fe(a.name,e)}),e.jsx(p,{htmlFor:a.name,className:"cursor-pointer",children:a.label})]})]},a.name))})]})}),J.paymentMethods.length>0&&e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},children:e.jsxs(d,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-purple-500 to-pink-600 bg-opacity-10",children:e.jsx(M,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),e.jsx(c,{className:"text-xl",children:"M√©todos de Pagamento"})]})}),e.jsxs(m,{className:"space-y-3",children:[J.paymentMethods.includes("credit_card")&&e.jsxs(C.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"flex items-center justify-between p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(M,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Cart√£o de Cr√©dito"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Aceitar pagamentos com cart√£o"})]})]}),e.jsx(u,{checked:ce,onCheckedChange:me})]}),J.paymentMethods.includes("pix")&&e.jsxs(C.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.15},className:"flex items-center justify-between p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 hover:border-green-500 dark:hover:border-green-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-500/10",children:e.jsx(V,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"PIX"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Pagamento instant√¢neo"})]})]}),e.jsx(u,{checked:xe,onCheckedChange:ge})]}),J.paymentMethods.includes("boleto")&&e.jsxs(C.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"flex items-center justify-between p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 hover:border-orange-500 dark:hover:border-orange-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-500/10",children:e.jsx(D,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Boleto"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Boleto banc√°rio"})]})]}),e.jsx(u,{checked:he,onCheckedChange:pe})]})]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(C.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:e.jsx(d,{className:g("border-0 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300 border-2",Q?"bg-green-500/10 border-green-500/50":"bg-gray-100/80 dark:bg-gray-800/80 border-gray-300 dark:border-gray-700"),children:e.jsxs(m,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(p,{className:"text-base font-semibold flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Status do Gateway"]}),e.jsx("div",{className:g("h-3 w-3 rounded-full animate-pulse",Q?"bg-green-500":"bg-gray-400")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white dark:bg-gray-900",children:[e.jsx("span",{className:"text-sm font-medium",children:"Gateway Ativo"}),e.jsx(u,{checked:Q,onCheckedChange:U})]}),Q&&e.jsx(C.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"p-3 rounded-lg bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-700 dark:text-green-400",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Gateway habilitado"})]})})]})]})})}),e.jsx(C.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.3},children:e.jsx(d,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(q,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"}),e.jsx("h3",{className:"font-semibold",children:"Verifica√ß√£o"})]}),W?e.jsx("div",{className:"p-4 rounded-lg bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(E,{className:"h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:"Gateway Verificado"}),se&&e.jsx("p",{className:"text-xs text-green-700 dark:text-green-400 mt-1",children:new Date(se).toLocaleString("pt-BR")}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-500 mt-1",children:["Ambiente: ",ee]})]})]})}):e.jsx("div",{className:"p-4 rounded-lg bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(B,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-amber-900 dark:text-amber-100",children:"N√£o Verificado"}),e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-400 mt-1",children:"Verifique suas credenciais"})]})]})}),e.jsx(h,{onClick:async()=>{await(async()=>{if(J&&z?.id)try{ne(!0);const e={};te?(e.configId=te,e.credentials=de,e.persistCredentials=!1):(e.slug=J.slug,e.credentials=de,e.persistCredentials=!1);const{data:a,error:s}=await l.functions.invoke("gateway-config-verify",{body:e});if(s)throw s;a?.success?(Y(!0),re(a.verifiedAt||(new Date).toISOString()),ae("production"),$({title:"Verifica√ß√£o bem-sucedida",description:a.message||"Credenciais verificadas com sucesso."})):(Y(!1),$({title:"Falha na verifica√ß√£o",description:a?.message||"N√£o foi poss√≠vel verificar as credenciais.",variant:"destructive"}))}catch(e){$({title:"Erro na verifica√ß√£o",description:e?.message||"Erro inesperado ao verificar as credenciais.",variant:"destructive"})}finally{ne(!1)}})()},disabled:le,className:"w-full gap-2 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700",children:le?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 animate-spin"}),"Verificando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4"}),"Verificar Credenciais"]})}),e.jsxs("a",{href:J.apiDocs,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors mt-2",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:"Documenta√ß√£o da API"}),e.jsx(G,{className:"h-3 w-3"})]})]})})})}),e.jsx(C.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.4},children:e.jsx(d,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:e.jsxs(m,{className:"p-6 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Tipo"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[("nacional"===J.type||"both"===J.type)&&e.jsx(n,{variant:"secondary",children:"Nacional"}),("global"===J.type||"both"===J.type)&&e.jsx(n,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:"Global"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"M√©todos de Pagamento"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:J.paymentMethods.map(a=>e.jsxs(n,{variant:"outline",className:"text-xs",children:["credit_card"===a&&"Cart√£o de Cr√©dito","debit_card"===a&&"Cart√£o de D√©bito","pix"===a&&"Pix","boleto"===a&&"Boleto","wallet"===a&&"Carteira Digital"]},a))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Features"}),e.jsx("ul",{className:"mt-1 space-y-1",children:J.features.map((a,s)=>e.jsxs("li",{className:"text-xs text-gray-700 dark:text-gray-300",children:["‚Ä¢ ",a]},s))})]})]})})})]})]}),e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},className:"flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(h,{variant:"outline",onClick:()=>T("/checkout/gateways"),disabled:H,className:"hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsx(h,{onClick:async()=>{if(J&&z?.id)try{let a=null;K(!0);const s=J.configFields.filter(e=>e.required&&!de[e.name]).map(e=>e.label);if(s.length>0)return void $({title:"Campos obrigat√≥rios",description:`Preencha os campos: ${s.join(", ")}`,variant:"destructive"});const{data:r,error:t}=await l.from("Gateway").select("id, slug, name").eq("slug",J.slug).single();if(t||!r?.id)throw t||new Error("Gateway n√£o encontrado no banco");const{data:i}=await l.from("GatewayConfig").select("id").eq("userId",z.id).eq("gatewayId",r.id).single();if(i){const e=[];ce&&e.push("credit_card"),xe&&e.push("pix"),he&&e.push("boleto");const s={...de,enabledPaymentMethods:e},{error:r}=await l.from("GatewayConfig").update({credentials:s,isActive:Q,updatedAt:(new Date).toISOString()}).eq("id",i.id);r||(a=i.id)}else{const{data:e}=await l.from("GatewayConfig").select("id").eq("userId",z.id).limit(1),s=[];ce&&s.push("credit_card"),xe&&s.push("pix"),he&&s.push("boleto");const t={...de,enabledPaymentMethods:s},{data:i,error:n}=await l.from("GatewayConfig").insert({userId:z.id,gatewayId:r.id,credentials:t,isActive:Q,isDefault:!e||0===e.length}).select("id").single();if(n)throw n;a=i?.id||null}$({title:"Configura√ß√£o salva!",description:`Gateway ${J.name} foi configurado com sucesso.`});try{const e=a?{configId:a,credentials:de,persistCredentials:!1}:{slug:J.slug,credentials:de,persistCredentials:!1},{data:s,error:r}=await l.functions.invoke("gateway-config-verify",{body:e});if(r)throw r;$(s?.success?{title:"Credenciais verificadas",description:s.message||"Gateway verificado com sucesso."}:{title:"Falha na verifica√ß√£o",description:s?.message||"Confira suas credenciais e tente novamente.",variant:"destructive"})}catch(e){$({title:"Erro ao verificar",description:e?.message||"N√£o foi poss√≠vel verificar as credenciais.",variant:"destructive"})}await ve()}catch(a){$({title:"Erro ao salvar",description:"N√£o foi poss√≠vel salvar a configura√ß√£o.",variant:"destructive"})}finally{K(!1)}},disabled:H,className:"bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 hover:from-blue-600 hover:via-purple-600 hover:to-pink-600 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:H?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Salvar Configura√ß√£o"]})})]})]}):null};export{O as default};
