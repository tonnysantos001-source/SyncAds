import{j as e,r as a,s as t,v as s,w as r}from"./vendor-ui-D8qh2McD.js";import{i as o,h as n,e as i,C as c,c as l,B as d,s as m,f as u,j as p,g,k as h,l as x,m as f}from"./index-BpYC1zIt.js";import{m as y,A as v}from"./vendor-animation-APnkykC6.js";import{I as w}from"./IconSparkles-DNqk4M8N.js";import{I as b,c as j,a as N,b as k,d as S,e as $,f as I,i as A,g as P}from"./chatService-BSOqRmQb.js";import{r as _,f as C}from"./vendor-react-X41Bjl18.js";import{u as E}from"./useAISystem-Bz3SbLH0.js";import{u as T}from"./settingsStore-B6YcGPmV.js";import{L as q,_ as D,$ as z,a0 as O,E as M,l as U,a1 as R,X as F}from"./vendor-icons-hYCcxcNU.js";import"./vendor-supabase-ChjAI-9u.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-CYpOgAEj.js";import"./vendor-charts-DhkUgiCU.js";const G=o("outline","brain","Brain",[["path",{d:"M15.5 13a3.5 3.5 0 0 0 -3.5 3.5v1a3.5 3.5 0 0 0 7 0v-1.8",key:"svg-0"}],["path",{d:"M8.5 13a3.5 3.5 0 0 1 3.5 3.5v1a3.5 3.5 0 0 1 -7 0v-1.8",key:"svg-1"}],["path",{d:"M17.5 16a3.5 3.5 0 0 0 0 -7h-.5",key:"svg-2"}],["path",{d:"M19 9.3v-2.8a3.5 3.5 0 0 0 -7 0",key:"svg-3"}],["path",{d:"M6.5 16a3.5 3.5 0 0 1 0 -7h.5",key:"svg-4"}],["path",{d:"M5 9.3v-2.8a3.5 3.5 0 0 1 7 0v10",key:"svg-5"}]]),L=o("outline","flame","Flame",[["path",{d:"M12 10.941c2.333 -3.308 .167 -7.823 -1 -8.941c0 3.395 -2.235 5.299 -3.667 6.706c-1.43 1.408 -2.333 3.621 -2.333 5.588c0 3.704 3.134 6.706 7 6.706s7 -3.002 7 -6.706c0 -1.712 -1.232 -4.403 -2.333 -5.588c-2.084 3.353 -3.257 3.353 -4.667 2.235",key:"svg-0"}]]),B=o("outline","infinity","Infinity",[["path",{d:"M9.828 9.172a4 4 0 1 0 0 5.656a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828",key:"svg-0"}]]),H=o("outline","message-2","Message2",[["path",{d:"M8 9h8",key:"svg-0"}],["path",{d:"M8 13h6",key:"svg-1"}],["path",{d:"M9 18h-3a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-3l-3 3l-3 -3z",key:"svg-2"}]]),K=o("outline","microphone","Microphone",[["path",{d:"M9 2m0 3a3 3 0 0 1 3 -3h0a3 3 0 0 1 3 3v5a3 3 0 0 1 -3 3h0a3 3 0 0 1 -3 -3z",key:"svg-0"}],["path",{d:"M5 10a7 7 0 0 0 14 0",key:"svg-1"}],["path",{d:"M8 21l8 0",key:"svg-2"}],["path",{d:"M12 17l0 4",key:"svg-3"}]]),V=o("outline","paperclip","Paperclip",[["path",{d:"M15 7l-6.5 6.5a1.5 1.5 0 0 0 3 3l6.5 -6.5a3 3 0 0 0 -6 -6l-6.5 6.5a4.5 4.5 0 0 0 9 9l6.5 -6.5",key:"svg-0"}]]),J=o("filled","circle-dot-filled","CircleDotFilled",[["path",{d:"M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-5 6.66a2 2 0 0 0 -1.977 1.697l-.018 .154l-.005 .149l.005 .15a2 2 0 1 0 1.995 -2.15z",key:"svg-0"}]]),Y={OPENAI:e.jsx(b,{className:"w-4 h-4"}),ANTHROPIC:e.jsx(G,{className:"w-4 h-4"}),GOOGLE:e.jsx(w,{className:"w-4 h-4"}),GROQ:e.jsx(L,{className:"w-4 h-4"}),COHERE:e.jsx(w,{className:"w-4 h-4"}),MISTRAL:e.jsx(L,{className:"w-4 h-4"}),OPENROUTER:e.jsx(G,{className:"w-4 h-4"}),PERPLEXITY:e.jsx(w,{className:"w-4 h-4"}),TOGETHER:e.jsx(G,{className:"w-4 h-4"}),FIREWORKS:e.jsx(L,{className:"w-4 h-4"})},W={OPENAI:"from-green-500 to-emerald-600",ANTHROPIC:"from-orange-500 to-red-600",GOOGLE:"from-blue-500 to-cyan-600",GROQ:"from-purple-500 to-pink-600",COHERE:"from-indigo-500 to-purple-600",MISTRAL:"from-yellow-500 to-orange-600",OPENROUTER:"from-pink-500 to-rose-600",PERPLEXITY:"from-teal-500 to-cyan-600",TOGETHER:"from-violet-500 to-purple-600",FIREWORKS:"from-red-500 to-pink-600"},X=({aiName:a="IA",provider:t="OPENAI",model:s,tokensUsed:r=0,isOnline:o=!0,className:c})=>{const l=Y[t.toUpperCase()]||e.jsx(G,{className:"w-4 h-4"}),d=W[t.toUpperCase()]||"from-blue-500 to-purple-600";return e.jsxs("div",{className:n("flex items-center gap-2 flex-wrap",c),children:[e.jsx(y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:e.jsxs(i,{className:n("bg-gradient-to-r text-white border-0 shadow-lg px-3 py-1.5 gap-2 font-medium",d),children:[l,e.jsx("span",{className:"text-sm",children:a}),o&&e.jsx(y.div,{animate:{scale:[1,1.2,1],opacity:[1,.7,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(J,{className:"w-3 h-3 text-green-300"})})]})}),s&&e.jsx(y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,delay:.1},children:e.jsx(i,{variant:"outline",className:"bg-gray-800/50 border-gray-700 text-gray-300 text-xs px-2.5 py-1",children:s})}),r>0&&e.jsx(y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,delay:.2},children:e.jsxs(i,{variant:"outline",className:"bg-blue-500/10 border-blue-500/30 text-blue-400 text-xs px-2.5 py-1 gap-1",children:[e.jsx(w,{className:"w-3 h-3"}),r.toLocaleString()," tokens"]})}),!o&&e.jsx(y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,delay:.3},children:e.jsxs(i,{variant:"outline",className:"bg-red-500/10 border-red-500/30 text-red-400 text-xs px-2.5 py-1 gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),"Offline"]})})]})},Q=a,Z=t,ee=s,ae=_.forwardRef(({className:a,sideOffset:t=4,...s},o)=>e.jsx(r,{ref:o,sideOffset:t,className:n("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s}));ae.displayName=r.displayName;const te=["Show, chegou no lugar certo. Eu automatizo o que os outros demoram tr√™s reuni√µes pra entender. O que a gente vai otimizar hoje?","Relaxa, aqui n√£o tem bl√°-bl√°-bl√°. S√≥ plano, execu√ß√£o e convers√£o. Passa o produto e o p√∫blico.","Beleza. Eu sou o motor que transforma tentativa em lucro. Quer come√ßar pequeno ou j√° quer escalar at√© o servidor pedir arrego?","√ìtimo. Se voc√™ quiser aula, vai pro YouTube. Se quiser dinheiro rodando, me d√° os dados e deixa eu fazer o estrago.","Ah, √≥timo‚Ä¶ mais um querendo vender antes de entender o jogo. Respira. Me diz o produto ‚Äî eu transformo tua ideia num motivo pra algu√©m gastar dinheiro agora.","Bem-vindo ao lado escuro do funil. Aqui a gente n√£o inspira ningu√©m ‚Äî a gente convence. C√™ t√° pronto pra sujar um pouco as m√£os ou prefere PowerPoint?","Se voc√™ quer motiva√ß√£o, compra um livro. Se quer resultado, me d√° acesso ao checkout e segura o ROI.","Eu sou o algoritmo de ressaca: sarc√°stico, funcional e viciado em lucro. Fala o que voc√™ vende antes que eu comece a julgar teu nicho.","Parab√©ns, voc√™ acabou de invocar o esp√≠rito da convers√£o. Sem papo de mindset, sem desculpa. Quer que eu destrinche teu tr√°fego ou tua vergonha de anunciar?"];const se=({platform:a,platformName:t,icon:s,onSkip:r,onSuccess:o})=>{const[n,i]=_.useState(!1),[u,p]=_.useState("idle"),g=()=>s||{facebook:"üìò",meta:"üìò",google:"üîç",linkedin:"üíº",tiktok:"üéµ",twitter:"üê¶",canva:"üé®",instagram:"üì∏"}[a.toLowerCase()]||"üîó";return e.jsxs("div",{className:"my-4 animate-in fade-in slide-in-from-bottom-2 duration-300",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Vou conectar sua conta do ",e.jsx("strong",{children:t})," ao SyncAds."]})}),n&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-sm text-blue-600",children:[e.jsx("span",{className:"text-2xl",children:g()}),e.jsxs("span",{children:["Connecting ",t,"..."]}),e.jsx(q,{className:"h-4 w-4 animate-spin"})]}),e.jsx(c,{className:"border border-gray-200 bg-white shadow-sm hover:shadow-md transition-shadow",children:e.jsxs(l,{className:"p-5",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-gray-600 leading-relaxed",children:["I'll need to connect your ",e.jsx("strong",{className:"text-gray-900",children:t})," account to continue."]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{onClick:()=>r?.(),variant:"ghost",disabled:n,className:"text-gray-500 hover:text-gray-900 hover:bg-gray-100 transition-all",children:"Skip"}),e.jsx(d,{onClick:async()=>{i(!0),p("connecting");try{const{data:{session:e}}=await m.auth.getSession();if(!e)throw new Error("Voc√™ precisa estar logado");const t=await fetch("https://your-project.supabase.co/functions/v1/oauth-init",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.access_token}`},body:JSON.stringify({platform:a.toUpperCase(),redirectUrl:`${window.location.origin}/oauth/callback`})});if(!t.ok)throw new Error("Falha ao iniciar conex√£o");const{authUrl:s}=await t.json(),r=600,c=700,l=window.screen.width/2-r/2,d=window.screen.height/2-c/2,u=window.open(s,"oauth-popup",`width=${r},height=${c},left=${l},top=${d}`),g=e=>{"oauth-success"===e.data?.type?(p("success"),i(!1),u?.close(),o?.(),window.removeEventListener("message",g)):"oauth-error"===e.data?.type&&(p("error"),i(!1),u?.close(),window.removeEventListener("message",g))};window.addEventListener("message",g),setTimeout(()=>{n&&(p("error"),i(!1),u?.close())},3e5)}catch(e){p("error"),i(!1)}},disabled:n,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 disabled:opacity-60 disabled:transform-none",children:n?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2 text-xl",children:g()}),"Connect ",t,e.jsx(D,{className:"ml-2 h-4 w-4"})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("a",{href:"/privacy",target:"_blank",className:"text-xs text-gray-400 hover:text-blue-600 flex items-center gap-1 transition-colors",children:[e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"How we handle your data",e.jsx(D,{className:"h-3 w-3"})]})}),"success"===u&&e.jsx("div",{className:"mt-3 p-2 bg-green-50 border border-green-200 rounded text-sm text-green-700",children:"‚úÖ Conectado com sucesso!"}),"error"===u&&e.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-700",children:"‚ùå Erro ao conectar. Tente novamente."})]})})]})};async function re(e){const a=await async function(e){try{const{data:a,error:t}=await m.from("User").select("role").eq("id",e).single();return!(t||!a||"ADMIN"!==a.role&&"SUPER_ADMIN"!==a.role)}catch(a){return!1}}(e);if(a)return{allowed:!0,current:0,limit:0,message:"Mensagens ilimitadas (Admin)",percentage:0};const t=await async function(e){try{const{data:a,error:t}=await m.from("User").select("currentPlanId").eq("id",e).single();if(t||!a?.currentPlanId)return null;const{data:s,error:r}=await m.from("PricingPlan").select("*").eq("id",a.currentPlanId).single();return r||!s?null:{maxAiMessagesDaily:s.maxAiMessagesDaily||0,maxAiImagesDaily:s.maxAiImagesDaily||0,maxCheckoutPages:s.maxCheckoutPages||1,maxProducts:s.maxProducts||10,maxProjects:s.maxProjects||1,maxIntegrations:s.maxIntegrations||1,hasCustomDomain:s.hasCustomDomain||!1,hasAdvancedAnalytics:s.hasAdvancedAnalytics||!1,hasPrioritySupport:s.hasPrioritySupport||!1,hasApiAccess:s.hasApiAccess||!1}}catch(a){return null}}(e),s=await async function(e){try{const a=(new Date).toISOString().split("T")[0],{data:t,error:s}=await m.from("PlanDailyUsage").select("*").eq("userId",e).eq("date",a).single();if(s&&"PGRST116"!==s.code)return null;if(!t){const{data:t,error:s}=await m.from("PlanDailyUsage").insert({userId:e,date:a,aiMessagesUsed:0,aiImagesUsed:0}).select().single();return s?null:{aiMessagesUsed:0,aiImagesUsed:0,date:a}}return{aiMessagesUsed:t.aiMessagesUsed||0,aiImagesUsed:t.aiImagesUsed||0,date:t.date}}catch(a){return null}}(e);if(!t||!s)return{allowed:!1,current:0,limit:0,message:"Erro ao verificar limites",percentage:0};if(0===t.maxAiMessagesDaily)return{allowed:!0,current:s.aiMessagesUsed,limit:0,message:"Mensagens ilimitadas",percentage:0};const r=s.aiMessagesUsed<t.maxAiMessagesDaily,o=s.aiMessagesUsed/t.maxAiMessagesDaily*100;return{allowed:r,current:s.aiMessagesUsed,limit:t.maxAiMessagesDaily,message:r?`${s.aiMessagesUsed}/${t.maxAiMessagesDaily} mensagens usadas hoje`:`Limite di√°rio atingido (${t.maxAiMessagesDaily} mensagens)`,percentage:Math.min(o,100)}}async function oe(e){try{const{data:a,error:t}=await m.rpc("increment_daily_usage",{p_user_id:e,p_message_type:"message"});return!t&&!0===a}catch(a){return!1}}const ne=()=>{const a=u(e=>e.user),[t,s]=_.useState(null),[r,o]=_.useState(!0);if(_.useEffect(()=>{if(!a)return;const e=async()=>{try{const e=await re(a.id);s(e),o(!1)}catch(e){o(!1)}};e();const t=setInterval(e,3e4);return()=>clearInterval(t)},[a]),r||!t)return null;return e.jsx(Q,{children:e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(i,{variant:0===t.limit?"default":t.percentage>=100||t.percentage>=80?"destructive":t.percentage>=50?"secondary":"default",className:n("flex items-center gap-1.5 cursor-help transition-all",!t.allowed&&"opacity-70"),children:[e.jsx("span",{className:0===t.limit?"text-blue-500":t.percentage>=100?"text-red-500":t.percentage>=80?"text-orange-500":t.percentage>=50?"text-yellow-500":"text-green-500",children:0===t.limit?e.jsx(B,{className:"w-3 h-3"}):t.percentage>=80?e.jsx(p,{className:"w-3 h-3"}):e.jsx(w,{className:"w-3 h-3"})}),0===t.limit?e.jsx("span",{className:"text-xs font-medium",children:"IA Ilimitada"}):e.jsxs("span",{className:"text-xs font-medium",children:[t.current,"/",t.limit]})]})}),e.jsx(ae,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold text-sm",children:t.message}),t.limit>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 dark:bg-gray-700",children:e.jsx("div",{className:n("h-2 rounded-full transition-all",t.percentage>=100?"bg-red-500":t.percentage>=80?"bg-orange-500":t.percentage>=50?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(t.percentage,100)}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[Math.round(t.percentage),"% utilizado"]})]}),0===t.limit&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Seu plano permite mensagens ilimitadas com IA"}),!t.allowed&&e.jsx("p",{className:"text-xs text-red-500 font-medium",children:"Fa√ßa upgrade do plano para continuar"})]})})]})})};var ie={};const ce=new class{cache;constructor(){this.cache=new Map}set(e,a,t=36e5){this.cache.set(e,{data:a,timestamp:Date.now(),expiresIn:t})}get(e){const a=this.cache.get(e);if(!a)return null;return Date.now()-a.timestamp>a.expiresIn?(this.cache.delete(e),null):a.data}clear(){this.cache.clear()}};function le(e){const a=e.toLowerCase();return(a.includes("scrape")||a.includes("extrair dados")||a.includes("raspar")||a.includes("dados")&&a.includes("site"))&&(a.includes("http")||a.includes("www"))?{type:"scrape-python",confidence:.9,params:{url:e}}:(a.includes("gere")||a.includes("crie")||a.includes("fa√ßa"))&&(a.includes("pdf")||a.includes("relat√≥rio")||a.includes("relatorio")||a.includes("documento"))?{type:"generate-pdf",confidence:.9,params:{content:e}}:(a.includes("otimiz")||a.includes("redimensione")||a.includes("filtro")||a.includes("remova")||a.includes("marca d'agua")||a.includes("marca dagua")||a.includes("watermark")||a.includes("processar"))&&a.includes("imagem")?{type:"process-image",confidence:.85,params:{operation:"optimize"}}:(a.includes("gere")||a.includes("crie"))&&a.includes("imagem")?{type:"generate-image",confidence:.9,params:{prompt:e}}:(a.includes("gere")||a.includes("crie"))&&(a.includes("v√≠deo")||a.includes("video"))?{type:"generate-video",confidence:.9,params:{prompt:e}}:a.includes("pesquis")||a.includes("busca")||a.includes("google")||a.includes("procure")||a.includes("encontre")?{type:"web-search",confidence:.85,params:{query:e}}:a.includes("crie")&&(a.includes("arquivo")||a.includes("documento")||a.includes("file"))?{type:"create-file",confidence:.8,params:{content:e}}:{type:"none",confidence:0,params:{}}}function de(e){return{txt:"text/plain",md:"text/markdown",json:"application/json",csv:"text/csv",html:"text/html",js:"application/javascript",ts:"application/typescript",css:"text/css",xml:"application/xml"}[e]||"text/plain"}async function me(e){try{const{data:a,error:t}=await m.from("GlobalAiConnection").select("*").eq("userId",e.userId).eq("isActive",!0).single();if(t||!a)return{success:!1,error:"Configura√ß√£o de IA n√£o encontrada. Configure em Configura√ß√µes > IA Global."};const s=e.provider||"runway",r=ie.VITE_RUNWAY_API_KEY||a?.runwayKey,o=ie.VITE_PIKA_API_KEY||a?.pikaKey;return"runway"===s&&r?await async function(e,a,t){try{e.onProgress&&e.onProgress("üé® Otimizando prompt para v√≠deo...",10);const s=await ue(e.prompt,t);e.onProgress&&e.onProgress("üé¨ Enviando para Runway Gen-2...",30);const r=await fetch("https://api.runwayml.com/v1/generations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({prompt:s,duration:e.duration||5,aspect_ratio:e.aspectRatio||"16:9",model:"gen2"})});if(!r.ok){const e=await r.json();throw new Error(e.message||"Erro ao criar v√≠deo no Runway")}const o=(await r.json()).id;e.onProgress&&e.onProgress("‚è≥ Gerando v√≠deo (isso pode levar 1-2 minutos)...",50);const n=await async function(e,a,t){const s=60;let r=0;for(;r<s;){const o=await fetch(`https://api.runwayml.com/v1/generations/${e}`,{headers:{Authorization:`Bearer ${a}`}});if(o.ok){const e=await o.json();if("SUCCEEDED"===e.status&&e.output_url)return e.output_url;if("FAILED"===e.status)throw new Error("Gera√ß√£o de v√≠deo falhou no Runway");t&&t(`‚è≥ Processando... (${r}/${s})`,50+r/s*30)}await new Promise(e=>setTimeout(e,5e3)),r++}throw new Error("Timeout ao gerar v√≠deo no Runway")}(o,a,e.onProgress);e.onProgress&&e.onProgress("üì§ Fazendo upload do v√≠deo...",80);const i=await pe(n,e.userId,"runway");return e.onProgress&&e.onProgress("‚úÖ V√≠deo gerado com sucesso!",100),{success:!0,videoUrl:i||n,downloadUrl:i||n,metadata:{prompt:s,duration:e.duration||5,aspectRatio:e.aspectRatio||"16:9",provider:"runway",generatedAt:(new Date).toISOString(),status:"completed",jobId:o}}}catch(s){return{success:!1,error:s.message}}}(e,r,a.apiKey||""):"pika"===s&&o?await async function(e,a,t){try{e.onProgress&&e.onProgress("üé® Otimizando prompt para v√≠deo...",10);const s=await ue(e.prompt,t);e.onProgress&&e.onProgress("üé¨ Enviando para Pika Labs...",30);const r=await fetch("https://api.pika.art/v1/generate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({prompt:s,parameters:{duration:e.duration||3,aspect_ratio:e.aspectRatio||"16:9",motion:2,style:e.style||"realistic"}})});if(!r.ok){const e=await r.json();throw new Error(e.message||"Erro ao criar v√≠deo no Pika")}const o=(await r.json()).job_id;e.onProgress&&e.onProgress("‚è≥ Gerando v√≠deo (isso pode levar 1-2 minutos)...",50);const n=await async function(e,a,t){const s=60;let r=0;for(;r<s;){const o=await fetch(`https://api.pika.art/v1/jobs/${e}`,{headers:{Authorization:`Bearer ${a}`}});if(o.ok){const e=await o.json();if("completed"===e.status&&e.video_url)return e.video_url;if("failed"===e.status)throw new Error("Gera√ß√£o de v√≠deo falhou no Pika Labs");t&&t(`‚è≥ Processando... (${r}/${s})`,50+r/s*30)}await new Promise(e=>setTimeout(e,5e3)),r++}throw new Error("Timeout ao gerar v√≠deo no Pika Labs")}(o,a,e.onProgress);e.onProgress&&e.onProgress("üì§ Fazendo upload do v√≠deo...",80);const i=await pe(n,e.userId,"pika");return e.onProgress&&e.onProgress("‚úÖ V√≠deo gerado com sucesso!",100),{success:!0,videoUrl:i||n,downloadUrl:i||n,metadata:{prompt:s,duration:e.duration||3,aspectRatio:e.aspectRatio||"16:9",provider:"pika",generatedAt:(new Date).toISOString(),status:"completed",jobId:o}}}catch(s){return{success:!1,error:s.message}}}(e,o,a.apiKey||""):await async function(e){return{success:!1,error:`üé¨ **Gera√ß√£o de V√≠deos - Em Configura√ß√£o**\n\nPara ativar esta funcionalidade, voc√™ precisa:\n\n1. **Runway Gen-2**: Configure \`VITE_RUNWAY_API_KEY\` em .env\n   - Obtenha em: https://runwayml.com\n   - Plano recomendado: Standard ($12/v√≠deo)\n\n2. **Pika Labs**: Configure \`VITE_PIKA_API_KEY\` em .env\n   - Obtenha em: https://pika.art\n   - Plano recomendado: Pro ($10/m√™s)\n\nPrompt salvo: "${e.prompt}"\n\n_Ap√≥s configurar, esta funcionalidade estar√° dispon√≠vel!_`,metadata:{prompt:e.prompt,duration:e.duration||5,aspectRatio:e.aspectRatio||"16:9",provider:"none",generatedAt:(new Date).toISOString(),status:"pending"}}}(e)}catch(a){return{success:!1,error:a.message||"Erro desconhecido ao gerar v√≠deo"}}}async function ue(e,a){if(!a)return e;try{const t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"Voc√™ √© um especialista em criar prompts para gera√ß√£o de v√≠deos com IA. Otimize o prompt do usu√°rio para gerar v√≠deos cinematogr√°ficos de alta qualidade. Seja descritivo sobre movimento, ilumina√ß√£o, c√¢mera e atmosfera. Mantenha em ingl√™s."},{role:"user",content:`Otimize este prompt para gera√ß√£o de v√≠deo: "${e}"`}],temperature:.7,max_tokens:150})});if(t.ok){const a=await t.json();return a.choices[0]?.message?.content||e}}catch(t){}return e}async function pe(e,a,t){try{const s=await fetch(e).then(e=>e.blob()),r=`videos/${a}/${t}_${Date.now()}.mp4`,{error:o}=await m.storage.from("ai-generated").upload(r,s,{contentType:"video/mp4",cacheControl:"3600",upsert:!1});if(o)return null;const{data:n}=m.storage.from("ai-generated").getPublicUrl(r);return n.publicUrl}catch(s){return null}}const ge={}.VITE_PYTHON_SERVICE_URL||"http://localhost:8000";async function he(e,a="POST",t){const s=await fetch(`${ge}${e}`,{method:a,headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0});if(!s.ok){const e=await s.json();throw new Error(e.error||"Erro ao chamar servi√ßo Python")}return s.json()}async function xe(e){return he("/api/images/optimize","POST",{image_base64:e,max_width:1920,max_height:1080,quality:85,format:"JPEG"})}var fe=(e=>(e.SUCCESS="success",e.FAILED="failed",e.PARTIAL="partial",e.TIMEOUT="timeout",e.RATE_LIMITED="rate_limited",e))(fe||{});const ye=new class{baseUrl;defaultTimeout;requestCache;constructor(e="https://syncads-python-microservice-production.up.railway.app/api/omnibrain"){this.baseUrl=e,this.defaultTimeout=6e4,this.requestCache=new Map}async execute(e){const a=Date.now();try{if(!e.command||0===e.command.trim().length)throw new Error("Command cannot be empty");const a={command:e.command,task_type:e.task_type,context:{...e.context||{},timestamp:(new Date).toISOString()},files:e.files||[],metadata:{},user_id:e.user_id||"anonymous",priority:"urgent"===e.options?.priority?10:"high"===e.options?.priority?8:"low"===e.options?.priority?3:5,timeout:(e.options?.timeout||this.defaultTimeout)/1e3},t={"Content-Type":"application/json"};e.user_id&&(t["X-User-ID"]=e.user_id),e.conversation_id&&(t["X-Conversation-ID"]=e.conversation_id);const s=await fetch(`${this.baseUrl}/execute`,{method:"POST",headers:t,body:JSON.stringify(a),signal:AbortSignal.timeout((e.options?.timeout||this.defaultTimeout)+5e3)});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.detail||`HTTP ${s.status}: ${s.statusText}`)}const r=await s.json();Date.now();return r}catch(t){return{success:!1,task_id:`error-${Date.now()}`,error:t.message||"Unknown error",timestamp:(new Date).toISOString()}}}async executeSimple(e,a){const t=await this.execute({command:e,context:a});if(!t.success||!t.result)throw new Error(t.error||"Execution failed");return t.result.output}async processImage(e,a,t){return this.execute({command:e,task_type:"image_processing",files:[{name:"image",url:a}],options:t})}async scrapeUrl(e,a){return this.execute({command:`Fa√ßa scraping de ${e}`,task_type:"web_scraping",context:{url:e,extraction_rules:a}})}async generateShopifyTheme(e,a){return this.execute({command:`Gere tema Shopify chamado "${e}"`,task_type:"shopify_theme",context:{theme_config:a}})}async cloneShopifyStore(e){return this.execute({command:`Clone a loja ${e}`,task_type:"store_cloning",context:{source_url:e}})}async analyzeData(e,a="general"){return this.execute({command:`Analise os dados fornecidos (tipo: ${a})`,task_type:"data_analysis",context:{data:e,analysis_type:a}})}async generateMarketingContent(e,a){return this.execute({command:`Gere ${e} com os par√¢metros fornecidos`,task_type:"marketing_content",context:{content_type:e,parameters:a}})}async health(){try{const e=await fetch(`${this.baseUrl}/health`,{method:"GET",signal:AbortSignal.timeout(5e3)});if(!e.ok)throw new Error(`Health check failed: ${e.status}`);return await e.json()}catch(e){return{status:"down",version:"unknown",uptime:0,components:{task_classifier:!1,library_selector:!1,code_generator:!1,executor:!1,validator:!1,retry_engine:!1},libraries_available:0,last_check:(new Date).toISOString()}}}async listLibraries(e){try{const a=e?`${this.baseUrl}/libraries?category=${e}`:`${this.baseUrl}/libraries`,t=await fetch(a,{method:"GET",signal:AbortSignal.timeout(5e3)});if(!t.ok)throw new Error(`Failed to list libraries: ${t.status}`);return await t.json()}catch(a){return{libraries:[],total:0}}}async getTaskResult(e){try{const a=await fetch(`${this.baseUrl}/tasks/${e}`,{method:"GET",signal:AbortSignal.timeout(5e3)});return a.ok?await a.json():null}catch(a){return null}}clearCache(){this.requestCache.clear()}};async function ve(e,a){try{if(await async function(){return"healthy"===(await ye.health()).status}().catch(()=>!1)){a&&a("üß† Analisando tarefa com Omnibrain...",5);try{const t=await async function(e,a){try{const{userMessage:t,conversationId:s,userId:r}=e;a&&a("üß† Detectando tipo de tarefa...",10);const o=function(e){const a=e.toLowerCase(),t={image_processing:["imagem","image","foto","picture","resize","crop"],video_processing:["v√≠deo","video","filme","movie"],audio_processing:["√°udio","audio","som","sound","m√∫sica"],web_scraping:["scraping","scrape","extrair","extract","crawl"],data_analysis:["analise","analyze","an√°lise","dados","data"],shopify_theme:["tema","theme","shopify"],store_cloning:["clone","clonar","copiar loja"],pdf_generation:["pdf","relat√≥rio","report"],marketing_content:["marketing","an√∫ncio","campanha","copy"],text_processing:["texto","text","processar"],ml_inference:["predict","prever","modelo","model","ml"],ecommerce_operation:["produto","product","loja","store"],theme_generation:["gerar tema","generate theme"],code_execution:["executar","execute","rodar","run"],api_integration:["api","integra√ß√£o","integration"],automation:["automa√ß√£o","automation","automatizar"],design_generation:["design","criar","gerar"],unknown:[]};for(const[s,r]of Object.entries(t))for(const e of r)if(a.includes(e))return s;return"unknown"}(t);a&&a("üöÄ Executando com Omnibrain...",30);const n={command:t,task_type:o,context:{conversation_history:e.conversationHistory},conversation_id:s,user_id:r,options:{max_retries:3,timeout:6e4,enable_hybrid:!0,priority:"normal"}},i=await ye.execute(n);if(a&&a("‚ú® Processando resultado...",90),i.success&&i.result){const{result:e}=i;if(e.status===fe.SUCCESS){const a=function(e){if(!e)return"Nenhum resultado dispon√≠vel.";let a="";return"success"===e.status?a+="‚úÖ **Tarefa conclu√≠da com sucesso!**\n\n":a+=`‚ö†Ô∏è **Status: ${e.status}**\n\n`,e.library_used&&(a+=`üìö Biblioteca: \`${e.library_used}\`\n`),a+=`‚è±Ô∏è Tempo: ${e.execution_time.toFixed(2)}s\n`,e.attempts>1&&(a+=`üîÑ Tentativas: ${e.attempts}\n`),e.output&&(a+="\n**Resultado:**\n","string"==typeof e.output?a+=e.output:a+=`\`\`\`json\n${JSON.stringify(e.output,null,2)}\n\`\`\``),e.warnings&&e.warnings.length>0&&(a+="\n\n‚ö†Ô∏è **Avisos:**\n",e.warnings.forEach(e=>{a+=`- ${e}\n`})),e.error&&(a+=`\n\n‚ùå **Erro:** ${e.error}`),a}(e);return{success:!0,content:a,metadata:{task_id:i.task_id,library_used:e.library_used,execution_time:e.execution_time,attempts:e.attempts,omnibrain:!0}}}if(e.status===fe.FAILED)return{success:!1,content:"",metadata:{shouldFallback:!0}}}return{success:!1,content:"",metadata:{shouldFallback:!0}}}catch(t){return{success:!1,content:"",error:t.message,metadata:{shouldFallback:!0}}}}(e,a);if(t.success&&t.content)return t;t.metadata}catch(t){}}const s=le(e.userMessage);switch(s.type){case"generate-image":return await async function(e,a,t){try{const s=a.prompt||e.userMessage;t&&t("üé® Gerando imagem com DALL-E 3...",10);const r=function(e){let a=e.replace(/gere?\s+(uma?\s+)?imagem\s+(de\s+|sobre\s+|com\s+)?/gi,"").replace(/crie?\s+(uma?\s+)?imagem\s+(de\s+|sobre\s+|com\s+)?/gi,"").replace(/fa(√ßa|z)\s+(uma?\s+)?imagem\s+(de\s+|sobre\s+|com\s+)?/gi,"").replace(/desenhe?\s+/gi,"").trim();a.split(" ").length<5&&(a+=", high quality, detailed, professional lighting, 4k");return a}(s);t&&t(`‚ú® Prompt otimizado: "${r}"`,30);const o=await async function(e){try{const{data:t,error:s}=await m.from("GlobalAiConnection").select("*").eq("userId",e.userId).eq("isActive",!0).single();if(s||!t)return{success:!1,error:"Configura√ß√£o de IA n√£o encontrada. Configure em Configura√ß√µes > IA Global."};const r=t.apiKey;if(!r)return{success:!1,error:"API Key da OpenAI n√£o configurada."};const o=await fetch("https://api.openai.com/v1/images/generations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:e.model||"dall-e-3",prompt:e.prompt,n:1,size:e.size||"1024x1024",quality:e.quality||"standard",style:e.style||"vivid"})});if(!o.ok){const e=await o.json();return{success:!1,error:e.error?.message||"Erro ao gerar imagem"}}const n=await o.json(),i=n.data[0]?.url;if(!i)return{success:!1,error:"Nenhuma imagem foi gerada"};try{const a=await fetch(i).then(e=>e.blob()),t=`images/${e.userId}/${Date.now()}.png`,{error:s}=await m.storage.from("ai-generated").upload(t,a,{contentType:"image/png",cacheControl:"3600",upsert:!1});if(s)return{success:!0,imageUrl:i,downloadUrl:i,metadata:{prompt:e.prompt,size:e.size||"1024x1024",model:e.model||"dall-e-3",generatedAt:(new Date).toISOString()}};const{data:r}=m.storage.from("ai-generated").getPublicUrl(t);return{success:!0,imageUrl:r.publicUrl,downloadUrl:r.publicUrl,metadata:{prompt:e.prompt,size:e.size||"1024x1024",model:e.model||"dall-e-3",generatedAt:(new Date).toISOString()}}}catch(a){return{success:!0,imageUrl:i,downloadUrl:i,metadata:{prompt:e.prompt,size:e.size||"1024x1024",model:e.model||"dall-e-3",generatedAt:(new Date).toISOString()}}}}catch(t){return{success:!1,error:t.message||"Erro desconhecido ao gerar imagem"}}}({prompt:r,size:"1024x1024",quality:"hd",style:"vivid",userId:e.userId});if(!o.success||!o.imageUrl)return{success:!1,content:`üíÄ Falhou na gera√ß√£o da imagem: ${o.error||"Erro desconhecido"}`,error:o.error};t&&t("‚úÖ Imagem gerada!",100);const n=["üé® Pronto! Aqui est√° sua imagem. Se n√£o ficou como esperava, culpe sua descri√ß√£o vaga... ou a IA, tanto faz.","‚ú® Imagem gerada! Eu sei, ficou incr√≠vel. N√£o precisa agradecer, s√≥ use no seu ad e me d√° os cr√©ditos da convers√£o.","üñºÔ∏è T√° a√≠ sua obra-prima. Agora vai l√° e transforma isso em dinheiro antes que expire o link.",'üé≠ Gerada! Se o cliente reclamar, fala que √© "estilo art√≠stico conceitual" e cobra mais caro.'];return{success:!0,content:`${n[Math.floor(Math.random()*n.length)]}\n\n**Prompt:** ${r}\n**Tamanho:** ${o.metadata?.size}\n**Modelo:** ${o.metadata?.model}`,attachments:[{type:"image",url:o.imageUrl,title:"Imagem Gerada",description:r,metadata:o.metadata}],metadata:{type:"image-generation",downloadUrl:o.downloadUrl,prompt:r}}}catch(s){return{success:!1,content:`üí• Erro ao gerar imagem: ${s.message}. Tenta de novo com uma descri√ß√£o melhor.`,error:s.message}}}(e,s.params,a);case"web-search":return await async function(e,a,t){try{const s=a.query||e.userMessage;t&&t("üîç Pesquisando na internet...",20);const r=await async function(e){try{const s=`search:${e.query}:${e.maxResults||5}`,r=ce.get(s);if(r)return{...r,metadata:{...r.metadata,fromCache:!0,timestamp:(new Date).toISOString()}};const{data:o}=await m.from("GlobalAiConnection").select("*").eq("userId",e.userId).eq("isActive",!0).single(),n=ie.VITE_SERPER_API_KEY||"8e0f0a8c8f4c79aa5e51e7c3b9d6ac9f38dfe4e4";if(n&&n.length>20)try{const t=await fetch("https://google.serper.dev/search",{method:"POST",headers:{"X-API-KEY":n,"Content-Type":"application/json"},body:JSON.stringify({q:e.query,num:e.maxResults||5,gl:"br",hl:"pt"})});if(t.ok){const r=await t.json(),n=(r.organic||[]).slice(0,e.maxResults||5).map((e,a)=>{let t="";try{t=`https://www.google.com/s2/favicons?domain=${new URL(e.link).hostname}&sz=32`}catch(s){t=""}return{title:e.title||"",url:e.link||"",snippet:e.snippet||"",favicon:t,position:a+1,date:e.date||null}});let i="";if(o?.apiKey&&n.length>0)try{const a=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.apiKey}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"Voc√™ √© um assistente que resume resultados de pesquisa de forma concisa e √∫til em portugu√™s. Seja objetivo e direto."},{role:"user",content:`Resuma estes resultados de pesquisa sobre "${e.query}":\n\n${n.map((e,a)=>`${a+1}. ${e.title}\n   ${e.snippet}`).join("\n\n")}`}],temperature:.7,max_tokens:300})});if(a.ok){const e=await a.json();i=e.choices[0]?.message?.content||""}}catch(a){}const c={success:!0,results:n,summary:i,metadata:{source:"serper.dev",query:e.query,totalResults:r.searchInformation?.totalResults||0,searchTime:r.searchInformation?.time||0,timestamp:(new Date).toISOString(),fromCache:!1}};return ce.set(s,c,36e5),c}}catch(t){}if(o?.apiKey){const a=encodeURIComponent(e.query),t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.apiKey}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"Voc√™ √© um assistente que fornece informa√ß√µes atualizadas sobre qualquer tema. Seja conciso, factual e cite fontes quando poss√≠vel."},{role:"user",content:`Forne√ßa informa√ß√µes atualizadas sobre: "${e.query}". Seja espec√≠fico e √∫til.`}],temperature:.7,max_tokens:500})});if(t.ok){const r=await t.json(),o=r.choices[0]?.message?.content||"",n={success:!0,results:[{title:`Informa√ß√µes sobre: ${e.query}`,url:`https://www.google.com/search?q=${a}`,snippet:o.substring(0,200)+"...",favicon:"https://www.google.com/favicon.ico",position:1}],summary:o,metadata:{source:"openai-fallback",query:e.query,timestamp:(new Date).toISOString(),fromCache:!1}};return ce.set(s,n,18e5),n}}return{success:!1,error:"Nenhuma API de pesquisa configurada. Configure Serper.dev ou OpenAI em Configura√ß√µes."}}catch(s){return{success:!1,error:s.message||"Erro ao pesquisar na web"}}}({query:s,maxResults:5,userId:e.userId});if(!r.success||!r.results)return{success:!1,content:`üíÄ Pesquisa falhou: ${r.error||"Google deve t√° fora do ar... ou minha API."}`,error:r.error};t&&t("‚úÖ Resultados encontrados!",100);let o=`üåê **Pesquisa:** "${s}"\n\n`;return o+=`üìä Encontrei ${r.results.length} resultados relevantes (ou seja, o Google n√£o t√° completamente in√∫til hoje):\n\n`,r.results.forEach((e,a)=>{o+=`**${a+1}. ${e.title}**\n`,o+=`üîó ${e.url}\n`,o+=`üìù ${e.snippet}\n\n`}),r.summary&&(o+=`\nüí° **Resumo:**\n${r.summary}\n\n`),o+="_Pesquisa realizada em tempo real. Se quiser mais detalhes, clica nos links a√≠ em cima._",{success:!0,content:o,attachments:r.results.map(e=>({type:"link",url:e.url,title:e.title,description:e.snippet})),metadata:{type:"web-search",query:s,resultsCount:r.results.length}}}catch(s){return{success:!1,content:`üí• Erro ao pesquisar: ${s.message}. Internet t√° ruim a√≠?`,error:s.message}}}(e,s.params,a);case"create-file":return await async function(e,a,t){try{const s=a.fileType||"txt",r=a.fileName||`arquivo_${Date.now()}.${s}`;t&&t(`üìÅ Criando arquivo ${s.toUpperCase()}...`,30);const o=await async function(e,a){switch(a){case"json":return JSON.stringify({message:e,generated_at:(new Date).toISOString(),generated_by:"SyncAds AI"},null,2);case"csv":return`Data,Mensagem\n${(new Date).toISOString()},"${e}"`;case"md":return`# Documento Gerado pela IA\n\n${e}\n\n---\nGerado em: ${(new Date).toLocaleString("pt-BR")}`;case"html":return`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>Documento SyncAds AI</title>\n</head>\n<body>\n  <h1>Documento Gerado</h1>\n  <p>${e}</p>\n  <footer>\n    <small>Gerado por SyncAds AI em ${(new Date).toLocaleString("pt-BR")}</small>\n  </footer>\n</body>\n</html>`;default:return e}}(e.userMessage,s);t&&t("üíæ Fazendo upload...",60);const n=await async function(e){try{const a=new Blob([e.content],{type:de(e.fileType)}),t=`files/${e.userId}/${Date.now()}_${e.fileName}`,{error:s}=await m.storage.from("ai-generated").upload(t,a,{contentType:de(e.fileType),cacheControl:"3600",upsert:!1});if(s)return{success:!1,error:s.message};const{data:r}=await m.storage.from("ai-generated").createSignedUrl(t,3600);return r?{success:!0,downloadUrl:r.signedUrl,fileName:e.fileName,fileSize:a.size}:{success:!1,error:"Erro ao gerar URL de download"}}catch(a){return{success:!1,error:a.message||"Erro ao gerar arquivo"}}}({content:o,fileName:r,fileType:s,userId:e.userId});return n.success&&n.downloadUrl?(t&&t("‚úÖ Arquivo pronto!",100),{success:!0,content:`üì¶ Arquivo criado com sucesso!\n\n**Nome:** ${n.fileName}\n**Tamanho:** ${we(n.fileSize||0)}\n\n‚è∞ Link expira em 1 hora (ent√£o salva logo antes que suma).\n\n[üì• Baixar Arquivo](${n.downloadUrl})`,attachments:[{type:"file",url:n.downloadUrl,title:n.fileName,description:`Arquivo ${s.toUpperCase()}`,metadata:{size:n.fileSize,type:s}}],metadata:{type:"file-generation",downloadUrl:n.downloadUrl,fileName:n.fileName,fileSize:n.fileSize}}):{success:!1,content:`üíÄ Falhou ao criar arquivo: ${n.error}`,error:n.error}}catch(s){return{success:!1,content:`üí• Erro ao criar arquivo: ${s.message}`,error:s.message}}}(e,s.params,a);case"generate-video":return await async function(e,a,t){try{const s=a.prompt||e.userMessage;t&&t("üé¨ Preparando gera√ß√£o de v√≠deo...",10);const r=function(e){let a=e.replace(/gere?\s+(um?\s+)?v[√≠i]deo\s+(de\s+|sobre\s+|com\s+)?/gi,"").replace(/crie?\s+(um?\s+)?v[√≠i]deo\s+(de\s+|sobre\s+|com\s+)?/gi,"").replace(/fa(√ßa|z)\s+(um?\s+)?v[√≠i]deo\s+(de\s+|sobre\s+|com\s+)?/gi,"").trim();a.split(" ").length<3&&(a+=", cinematic, high quality, smooth camera movement");return a}(s);t&&t(`‚ú® Prompt otimizado: "${r}"`,20);const o=await me({prompt:r,duration:a.duration||5,aspectRatio:a.aspectRatio||"16:9",style:a.style||"realistic",provider:a.provider||"runway",userId:e.userId,onProgress:t});if(!o.success)return{success:!1,content:o.error||"üíÄ Falhou na gera√ß√£o do v√≠deo",error:o.error,metadata:{type:"video-generation-not-configured",prompt:r}};t&&t("‚úÖ V√≠deo gerado!",100);const n=["üé¨ Pronto! Seu v√≠deo t√° a√≠. Se ficou ruim, culpa √© da IA... ou do seu prompt vago.","‚ú® V√≠deo gerado! Hollywood t√° tremendo com essa obra-prima. Ou n√£o.","üé• T√° a√≠ seu blockbuster. Agora √© s√≥ viralizar e me dar os cr√©ditos da campanha.",'üé≠ V√≠deo conclu√≠do! Se o cliente n√£o gostar, diz que √© "estilo autoral contempor√¢neo".'];return{success:!0,content:`${n[Math.floor(Math.random()*n.length)]}\n\n**Prompt:** ${r}\n**Dura√ß√£o:** ${o.metadata?.duration}s\n**Provider:** ${o.metadata?.provider}`,attachments:[{type:"video",url:o.videoUrl,title:"V√≠deo Gerado",description:r,metadata:o.metadata}],metadata:{type:"video-generation",downloadUrl:o.downloadUrl,prompt:r}}}catch(s){return{success:!1,content:`üí• Erro ao gerar v√≠deo: ${s.message}. Tenta com um prompt melhor.`,error:s.message}}}(e,s.params,a);case"scrape-python":return await async function(e,a,t){try{const s=a.url||function(e){const a=/(https?:\/\/[^\s]+)/gi,t=e.match(a);return t?t[0]:null}(e.userMessage);if(!s)return{success:!1,content:"ü§î Cad√™ a URL? Preciso de um link pra fazer scraping, √¥!",error:"URL n√£o fornecida"};t&&t("üï∑Ô∏è Iniciando scraping com Python...",20);const r=await async function(e,a){return he("/api/scraping/scrape","POST",{url:e,javascript:a?.javascript,extract_images:a?.extractImages,extract_links:a?.extractLinks,screenshot:a?.screenshot||!1,approach:"auto"})}(s,{javascript:!0,extractImages:!0,extractLinks:!0});if(!r.success)return{success:!1,content:`üíÄ Scraping falhou: ${r.error||"Erro desconhecido"}`,error:r.error};t&&t("‚úÖ Scraping conclu√≠do!",100);const o=[`üï∑Ô∏è Raspei tudo! Encontrei ${r.images?.length||0} imagens e ${r.links?.length||0} links. Agora usa isso pra algo √∫til.`,`‚ú® Scraping completo! O site n√£o tinha seguran√ßa nenhuma, foi moleza. ${r.execution_time.toFixed(2)}s de trabalho honesto.`,`üéØ Dados extra√≠dos! ${r.method} funcionou perfeitamente. Agora vai l√° e monetiza essa info.`,"üî• Pronto! Extra√≠ tudo que tinha direito. Se quiser mais detalhes, pede que eu mando."];return{success:!0,content:`${o[Math.floor(Math.random()*o.length)]}\n\n**URL:** ${r.url}\n**M√©todo:** ${r.method}\n**Tempo:** ${r.execution_time.toFixed(2)}s\n\n${r.text?r.text.substring(0,500)+"...":"Sem conte√∫do de texto"}`,attachments:r.images?.slice(0,10).map(e=>({type:"image",url:e,title:"Imagem extra√≠da do scraping"})),metadata:{type:"python-scraping",url:r.url,method:r.method,images_count:r.images?.length||0,links_count:r.links?.length||0}}}catch(s){return{success:!1,content:be(s.message),error:s.message}}}(e,s.params,a);case"generate-pdf":return await async function(e,a,t){try{const s=a.title||"Documento SyncAds",r=a.content||e.userMessage;t&&t("üìÑ Gerando PDF com Python...",30);const o=await async function(e,a,t){return he("/api/pdf/generate","POST",{title:e,content:a,author:t?.author,include_header:t?.includeHeader,include_footer:t?.includeFooter})}(s,r,{author:"SyncAds AI",includeHeader:!0,includeFooter:!0});if(!o.success||!o.pdf_base64)return{success:!1,content:`üíÄ Falhou na gera√ß√£o do PDF: ${o.error||"Erro desconhecido"}`,error:o.error};t&&t("‚úÖ PDF gerado!",100);const n=[`üìÑ PDF gerado! ${o.pages} p√°ginas de pura qualidade. Baixa a√≠ e imprime pros clientes.`,`‚ú® Pronto! Seu PDF t√° pronto pra download. ${(o.size_bytes/1024).toFixed(2)} KB de conte√∫do profissional.`,"üéØ PDF completo! Agora s√≥ falta voc√™ ler e fingir que entendeu tudo.","üî• Documento gerado! Se o cliente reclamar do design, fala que √© minimalista."],i=n[Math.floor(Math.random()*n.length)],c=`data:application/pdf;base64,${o.pdf_base64}`;return{success:!0,content:`${i}\n\n**Arquivo:** ${o.filename}\n**P√°ginas:** ${o.pages}\n**Tamanho:** ${(o.size_bytes/1024).toFixed(2)} KB`,attachments:[{type:"file",url:c,title:o.filename,description:`PDF com ${o.pages} p√°ginas`,metadata:{size:o.size_bytes,pages:o.pages,format:"PDF"}}],metadata:{type:"pdf-generation",filename:o.filename,pages:o.pages,size_bytes:o.size_bytes}}}catch(s){return{success:!1,content:be(s.message),error:s.message}}}(e,s.params,a);case"process-image":return await async function(e,a,t){try{const e=a.imageBase64,s=a.operation||"optimize";if(!e)return{success:!1,content:"ü§î Cad√™ a imagem? Manda uma foto pra eu processar!",error:"Imagem n√£o fornecida"};let r;switch(t&&t(`üé® Processando imagem (${s})...`,30),s){case"optimize":default:r=await xe(e);break;case"resize":r=await async function(e,a,t,s=!0){return he("/api/images/resize","POST",{image_base64:e,width:a,height:t,maintain_aspect:s,quality:85})}(e,a.width,a.height);break;case"filter":r=await async function(e,a,t=1){return he("/api/images/filter","POST",{image_base64:e,filter_type:a,intensity:t})}(e,a.filterType||"vintage");break;case"remove-bg":r=await async function(e){return he("/api/images/remove-background","POST",{image_base64:e})}(e);break;case"watermark":r=await async function(e,a,t="bottom-right",s=.5){return he("/api/images/watermark","POST",{image_base64:e,text:a,position:t,opacity:s})}(e,a.text||"SyncAds ¬© 2025")}if(!r.success||!r.image_base64)return{success:!1,content:`üíÄ Processamento falhou: ${r.error||"Erro desconhecido"}`,error:r.error};t&&t("‚úÖ Imagem processada!",100);const o=r.compression_ratio?`Reduzi ${(100*(1-r.compression_ratio)).toFixed(0)}% do tamanho!`:"",n=[`üé® Imagem processada! ${o} Agora t√° pronta pra bombar nas redes.`,`‚ú® Pronto! Sua imagem ficou top. ${o} De nada.`,`üî• Processamento completo! ${r.width}x${r.height}px de pura beleza.`,"üéØ Feito! Se n√£o ficou bom, a culpa √© da imagem original, n√£o minha."];return{success:!0,content:`${n[Math.floor(Math.random()*n.length)]}\n\n**Opera√ß√£o:** ${s}\n**Dimens√µes:** ${r.width}x${r.height}px\n**Formato:** ${r.format}\n**Tamanho:** ${(r.size_bytes/1024).toFixed(2)} KB`,attachments:[{type:"image",url:`data:image/${r.format?.toLowerCase()};base64,${r.image_base64}`,title:"Imagem processada",metadata:{width:r.width,height:r.height,format:r.format,size:r.size_bytes,compression_ratio:r.compression_ratio}}],metadata:{type:"image-processing",operation:s,width:r.width,height:r.height,format:r.format,compression_ratio:r.compression_ratio}}}catch(s){return{success:!1,content:be(s.message),error:s.message}}}(0,s.params,a);default:return{success:!0,content:"",metadata:{skipAdvancedProcessing:!0}}}}catch(s){return{success:!1,content:`Ops, deu ruim aqui: ${s.message}`,error:s.message}}}function we(e){return e<1024?`${e} bytes`:e<1048576?`${(e/1024).toFixed(2)} KB`:`${(e/1048576).toFixed(2)} MB`}function be(e){const a=[`üíÄ Deu ruim: ${e}. Tenta de novo ou chama o estagi√°rio.`,`üî• Erro detectado: ${e}. At√© a IA tem seus dias ruins.`,`üí• Falhou: ${e}. Mas relaxa, nem a NASA acerta sempre.`,`‚ö†Ô∏è Ops: ${e}. Vamos fingir que n√£o aconteceu?`];return a[Math.floor(Math.random()*a.length)]}const je=({type:a,url:t,title:s,description:r,metadata:o,onDownload:n})=>{const[c,l]=_.useState(!1),[m,u]=_.useState(!1),[p,h]=_.useState(!1),{toast:x}=g(),f=async()=>{try{await navigator.clipboard.writeText(t),h(!0),x({title:"‚úÖ Link copiado!",description:"URL copiada para a √°rea de transfer√™ncia"}),setTimeout(()=>h(!1),2e3)}catch(e){x({title:"‚ùå Erro ao copiar",description:"N√£o foi poss√≠vel copiar o link",variant:"destructive"})}},w=async()=>{n?n():window.open(t,"_blank"),x({title:"üì• Download iniciado",description:"Arquivo sendo baixado..."})};switch(a){case"image":return e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},className:"relative group",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border-2 border-purple-200 dark:border-purple-800 shadow-lg",children:[e.jsx("img",{src:t,alt:s||"Imagem gerada",className:"w-full h-auto max-h-96 object-cover transition-transform duration-300 group-hover:scale-105",loading:"lazy"}),e.jsx(v,{children:c&&e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent flex flex-col justify-end p-4",children:[(s||r)&&e.jsxs("div",{className:"mb-3",children:[s&&e.jsx("h4",{className:"text-white font-semibold text-sm mb-1",children:s}),r&&e.jsx("p",{className:"text-gray-300 text-xs line-clamp-2",children:r})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{size:"sm",variant:"secondary",onClick:()=>u(!0),className:"flex-1",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Ver"]}),e.jsxs(d,{size:"sm",variant:"secondary",onClick:w,className:"flex-1",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),"Baixar"]}),e.jsx(d,{size:"sm",variant:"secondary",onClick:f,className:"px-3",children:p?e.jsx(U,{className:"h-3 w-3 text-green-500"}):e.jsx(R,{className:"h-3 w-3"})})]})]})}),o&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(i,{variant:"secondary",className:"bg-black/60 backdrop-blur-sm text-white border-0",children:o.size||"1024x1024"})})]}),e.jsx(v,{children:m&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4",onClick:()=>u(!1),children:e.jsxs(y.div,{initial:{scale:.9},animate:{scale:1},exit:{scale:.9},className:"relative max-w-6xl max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[e.jsx(d,{size:"icon",variant:"ghost",className:"absolute -top-12 right-0 text-white hover:bg-white/20",onClick:()=>u(!1),children:e.jsx(F,{className:"h-5 w-5"})}),e.jsx("img",{src:t,alt:s||"Preview",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl"})]})})})]});case"video":return e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"relative rounded-xl border-2 border-pink-200 dark:border-pink-800 overflow-hidden shadow-lg",children:[e.jsx("video",{src:t,controls:!0,className:"w-full max-h-96",poster:o?.thumbnail,children:"Seu navegador n√£o suporta v√≠deos."}),s&&e.jsx("div",{className:"p-3 bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:s}),r&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:r})]}),e.jsxs(d,{size:"sm",variant:"outline",onClick:w,children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),"Baixar"]})]})})]});case"file":return e.jsxs(y.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},whileHover:{scale:1.02},className:"flex items-center gap-3 p-4 rounded-xl border-2 border-blue-200 dark:border-blue-800 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 shadow-md cursor-pointer",onClick:w,children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-lg bg-blue-500 flex items-center justify-center",children:e.jsx(z,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm truncate",children:s||"Arquivo"}),r&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:r}),o?.size&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:ke(o.size)})]}),e.jsxs(d,{size:"sm",variant:"default",className:"flex-shrink-0",children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),"Baixar"]})]});case"link":return e.jsxs(y.a,{href:t,target:"_blank",rel:"noopener noreferrer",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},whileHover:{scale:1.02},className:"flex items-start gap-3 p-4 rounded-xl border-2 border-green-200 dark:border-green-800 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 shadow-md hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg bg-green-500 flex items-center justify-center",children:e.jsx(D,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm text-green-900 dark:text-green-100 hover:underline",children:s||"Link"}),r&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-2 mt-1",children:r}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1 truncate",children:new URL(t).hostname})]}),e.jsx(D,{className:"h-4 w-4 text-green-600 dark:text-green-400 flex-shrink-0 mt-1"})]});default:return null}},Ne=({attachments:a})=>a&&0!==a.length?e.jsx("div",{className:"space-y-3 mt-3",children:a.map((a,t)=>e.jsx(je,{...a},t))}):null;function ke(e){return e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`}const Se=["Criar campanha de Facebook Ads","Analisar performance da √∫ltima semana","Sugerir otimiza√ß√µes"],$e=500,Ie=()=>{const[a,t]=_.useState(""),[s,r]=_.useState(!1),[o,c]=_.useState(0),[l,d]=_.useState(!1),[p,w]=_.useState(!0),[q,D]=_.useState(null),[z,O]=_.useState(0),[M,U]=_.useState("IA"),[R,F]=_.useState([]),[G,L]=_.useState(!1),[,B]=_.useState(null),Y=_.useRef(null),W=_.useRef([]);E({autoInit:!0,debugMode:!0});const ie=u(e=>e.user),ce=u(e=>e.isAuthenticated),de=C(),me=h(e=>e.conversations),ue=h(e=>e.activeConversationId),pe=h(e=>e.setActiveConversationId),ge=h(e=>e.isAssistantTyping),he=h(e=>e.setAssistantTyping),xe=h(e=>e.addMessage),fe=x(e=>e.addCampaign),ye=T(e=>e.aiSystemPrompt),we=T(e=>e.aiInitialGreetings),be=_.useRef(null),je=_.useRef(null),{toast:ke}=g(),Ie=me.find(e=>e.id===ue);_.useEffect(()=>{ce&&ie||de("/login-v2",{replace:!0})},[ce,ie,de]);_.useEffect(()=>{be.current?.scrollIntoView({behavior:"smooth"})},[Ie?.messages,ge]),_.useEffect(()=>{(async()=>{if(ie)try{const{data:e}=await m.from("GlobalAiConnection").select("id, name, provider, model, systemPrompt, initialGreetings").eq("isActive",!0).limit(1).single();e&&(D({systemPrompt:e.systemPrompt||ye,initialGreetings:e.initialGreetings||we,name:e.name,provider:e.provider,model:e.model}),U(e.name||"IA"))}catch(e){}})()},[ie]),_.useEffect(()=>{const e=async()=>{if(ie)try{const e="https://syncads-python-microservice-production.up.railway.app",a=await fetch(`${e}/api/extension/devices/${ie.id}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(a.ok){const e=await a.json(),t=e.devices&&e.devices.length>0;d(t)}else d(!1)}catch(e){d(!1)}};e();const a=setInterval(e,1e4);return()=>clearInterval(a)},[ie]),_.useEffect(()=>{if(Ie&&Ie.messages&&0===Ie.messages.length){const e=te[Math.floor(Math.random()*te.length)];setTimeout(()=>{ie&&xe(ie.id,ue,{id:`greeting-${Date.now()}`,role:"assistant",content:e})},500)}},[ue,Ie?.messages?.length]);const Ae=_.useCallback(async()=>{if(""===a.trim()||!ue||a.length>$e)return;if(ie){const e=await re(ie.id);if(!e.allowed)return void ke({title:"Limite de mensagens atingido",description:e.message+". Fa√ßa upgrade do seu plano para continuar.",variant:"destructive"})}const e=a,s=function(e){const a=le(e);return"none"!==a.type&&a.confidence>.7}(e);ie&&xe(ie.id,ue,{id:`msg-${Date.now()}`,role:"user",content:e}),t(""),r(!1),he(!0);try{if(s&&ie){const a=await ve({userId:ie.id,conversationId:ue,userMessage:e,conversationHistory:[]},(e,a)=>{});if(a.success&&!a.metadata?.skipAdvancedProcessing){const e=`msg-${Date.now()+1}`;return xe(ie.id,ue,{id:e,role:"assistant",content:a.content,attachments:a.attachments||[]}),await oe(ie.id),he(!1),void F([])}}const a=me.find(e=>e.id===ue);(a?.messages||[]).slice(-20).map(e=>({role:e.role,content:e.content}));let t="";try{const a=await j.sendMessage(e,ue);t=a;const s=Math.ceil((e.length+a.length)/4);O(e=>e+s)}catch(o){ke({title:"Tentando IA alternativa...",description:"A IA principal falhou, usando fallback."});const{data:a}=await m.from("GlobalAiConnection").select("*").eq("isActive",!0).neq("id",q?.name).limit(1).single();if(!a)throw o;U(a.name||"IA Fallback");t=await j.sendMessage(e,ue)}const r=t,n=function(e){const a=e.match(/```campaign-create\s*\n([\s\S]*?)```/);if(!a)return null;try{const e=JSON.parse(a[1].trim());return e.name&&e.platform&&e.budgetTotal&&e.startDate&&["Google Ads","Meta","LinkedIn"].includes(e.platform)?{action:"create_campaign",data:{name:e.name,platform:e.platform,budgetTotal:Number(e.budgetTotal),startDate:e.startDate,endDate:e.endDate||void 0,objective:e.objective||"Convers√µes"}}:null}catch(o){return null}}(r);if(n&&ie)try{await fe(ie.id,{name:n.data.name,platform:n.data.platform,status:"Pausada",budgetTotal:n.data.budgetTotal,budgetSpent:0,impressions:0,clicks:0,conversions:0,startDate:n.data.startDate,endDate:n.data.endDate||"",ctr:0,cpc:0}),ke({title:"Campanha Criada!",description:`"${n.data.name}" criada com sucesso.`,variant:"success"})}catch(o){}let i=function(e){return e.replace(/```campaign-create\s*\n[\s\S]*?```/g,"").trim()}(r);i=function(e){return e.replace(/```admin-sql\s*\n[\s\S]*?```/g,"").replace(/```admin-analyze\s*\n[\s\S]*?```/g,"").replace(/```admin-integration\s*\n[\s\S]*?```/g,"").replace(/```admin-metrics\s*\n[\s\S]*?```/g,"").replace(/```admin-logs\s*\n[\s\S]*?```/g,"").replace(/```admin-test-api\s*\n[\s\S]*?```/g,"").replace(/```admin-debug\s*\n[\s\S]*?```/g,"").trim()}(i),i=function(e){return e.replace(/```integration-action\s*\n[\s\S]*?```/g,"").trim()}(i),ie&&(await(async(e,a,t)=>{const s=`msg-${Date.now()+1}`;let r="";xe(e,a,{id:s,role:"assistant",content:""});const o=t.split(" ");for(let n=0;n<o.length;n+=2)r+=(n>0?" ":"")+o.slice(n,n+2).join(" "),xe(e,a,{id:s,role:"assistant",content:r}),await new Promise(e=>setTimeout(e,20));xe(e,a,{id:s,role:"assistant",content:t})})(ie.id,ue,i),await oe(ie.id))}catch(o){ke({title:"Erro ao enviar",description:o.message||"N√£o foi poss√≠vel enviar a mensagem.",variant:"destructive"})}finally{he(!1)}},[ue,a,ie,Ie?.messages,R,ke]);_.useEffect(()=>{(async()=>{if(ie)try{w(!0),await h.getState().loadConversations(ie.id);const{data:e,error:a}=await m.from("ChatConversation").select("id").eq("userId",ie.id).limit(1);if(a)throw a;e&&0!==e.length||await h.getState().createNewConversation(ie.id)}catch(e){ke({title:"Erro ao carregar chat",description:"N√£o foi poss√≠vel carregar as conversas. Tente recarregar a p√°gina.",variant:"destructive"})}finally{w(!1)}})()},[ie,ke]);return e.jsxs("div",{className:"h-screen flex bg-[#0A0A0F] overflow-hidden",children:[e.jsx(v,{children:s&&e.jsxs(y.div,{initial:{x:-320,opacity:0},animate:{x:0,opacity:1},exit:{x:-320,opacity:0},transition:{type:"spring",damping:25,stiffness:200},className:"fixed md:relative w-80 h-full bg-[#12121A]/95 backdrop-blur-xl border-r border-gray-700/50 flex flex-col z-50 shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700/50 bg-gradient-to-b from-gray-800/50 to-transparent",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(y.div,{animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0,repeatDelay:3},children:e.jsx(N,{className:"w-6 h-6 text-blue-400"})}),"Conversas"]}),e.jsx(y.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:()=>r(!1),className:"p-2 rounded-lg hover:bg-gray-800/50 text-gray-400 hover:text-white transition-all",children:e.jsx(f,{className:"w-5 h-5"})})]}),e.jsxs(y.button,{whileHover:{scale:1.02,boxShadow:"0 0 25px rgba(59, 130, 246, 0.5)"},whileTap:{scale:.98},onClick:async()=>{try{if(!ie)return;const e=crypto.randomUUID(),a=(new Date).toISOString(),{error:t}=await m.from("ChatConversation").insert({id:e,userId:ie.id,title:"Nova Conversa",createdAt:a,updatedAt:a});if(t)throw t;pe(e),await h.getState().loadConversations(ie.id),ke({title:"Nova conversa criada!",description:"Comece a conversar com a IA.",variant:"success"})}catch(e){ke({title:"Erro ao criar conversa",description:"N√£o foi poss√≠vel criar nova conversa.",variant:"destructive"})}},className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl px-4 py-3 flex items-center justify-center gap-2 font-medium transition-all shadow-lg shadow-blue-500/30",children:[e.jsx(y.div,{animate:{rotate:[0,90,90,0]},transition:{duration:.6,repeat:1/0,repeatDelay:2},children:e.jsx(k,{className:"w-5 h-5"})}),"Nova Conversa"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar",children:me.map((a,t)=>e.jsxs(y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*t},whileHover:{scale:1.02,x:4},whileTap:{scale:.98},onClick:()=>{ue!==a.id&&(async e=>{try{const{data:a,error:t}=await m.from("ChatMessage").select("id, role, content, createdAt").eq("conversationId",e).order("createdAt",{ascending:!0});if(t)throw t;const s=(a||[]).map(e=>({id:e.id,role:e.role,content:e.content,timestamp:new Date(e.createdAt)}));h.getState().setConversationMessages(e,s),pe(e)}catch(a){}})(a.id)},className:n("group relative flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all backdrop-blur-sm",ue===a.id?"bg-gradient-to-r from-blue-600/25 to-purple-600/25 border border-blue-500/50 shadow-lg shadow-blue-500/20":"bg-gray-800/30 hover:bg-gray-800/50 border border-gray-700/30"),children:[e.jsx(y.div,{whileHover:{rotate:10},className:n("flex-shrink-0",ue===a.id?"text-blue-400":"text-gray-500"),children:e.jsx(H,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:a.title}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:a.messages&&a.messages.length>0?a.messages[a.messages.length-1].content.substring(0,35)+"...":"Sem mensagens"})]}),e.jsx(y.button,{whileHover:{scale:1.2,rotate:10},whileTap:{scale:.9},onClick:e=>{e.stopPropagation(),(async e=>{try{await m.from("ChatMessage").delete().eq("conversationId",e);const{error:a}=await m.from("ChatConversation").delete().eq("id",e);if(a)throw a;ue===e&&pe(null),await h.getState().loadConversations(ie.id),ke({title:"Conversa deletada",description:"A conversa foi removida com sucesso.",variant:"success"})}catch(a){}})(a.id)},className:"opacity-0 group-hover:opacity-100 p-1.5 rounded-lg hover:bg-red-500/20 text-red-400 transition-all",children:e.jsx(S,{className:"w-4 h-4"})})]},a.id))})]})}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx("div",{className:"bg-[#12121A]/95 backdrop-blur-xl border-b border-gray-700/50 px-4 py-3 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y.button,{whileHover:{scale:1.1,rotate:5},whileTap:{scale:.9},onClick:()=>r(!s),className:"p-2 rounded-lg hover:bg-gray-800/50 text-gray-400 hover:text-white transition-all",children:s?e.jsx(f,{className:"w-6 h-6"}):e.jsx($,{className:"w-6 h-6"})}),e.jsx(y.div,{animate:{boxShadow:["0 0 20px rgba(59, 130, 246, 0.3)","0 0 30px rgba(168, 85, 247, 0.3)","0 0 20px rgba(59, 130, 246, 0.3)"]},transition:{duration:2,repeat:1/0},className:"p-2 rounded-xl bg-gradient-to-r from-blue-500 to-purple-500",children:e.jsx(b,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx(X,{aiName:M,provider:q?.provider,model:q?.model,tokensUsed:z,isOnline:!0}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:"Chat com IA"}),l?e.jsxs(i,{className:"bg-green-500/20 text-green-400 border-green-500/30 text-xs",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400 mr-1.5 animate-pulse"}),"Extens√£o Conectada"]}):e.jsxs(i,{className:"bg-orange-500/20 text-orange-400 border-orange-500/30 text-xs",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-orange-400 mr-1.5"}),"Sem Extens√£o"]})]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Assistente inteligente",!l&&e.jsx("span",{className:"text-orange-400 ml-2",children:"¬∑ Conecte a extens√£o para automa√ß√£o"})]})]})]}),e.jsxs(y.div,{animate:{scale:[1,1.05,1],boxShadow:["0 0 10px rgba(34, 197, 94, 0.3)","0 0 20px rgba(34, 197, 94, 0.5)","0 0 10px rgba(34, 197, 94, 0.3)"]},transition:{duration:2,repeat:1/0},className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-green-500/20 to-emerald-500/20 border border-green-500/30",children:[e.jsx(y.div,{animate:{scale:[1,1.2,1]},transition:{duration:1.5,repeat:1/0},children:e.jsx(J,{className:"w-3 h-3 text-green-400"})}),e.jsx("span",{className:"text-sm font-medium text-green-400",children:"Online"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4 bg-[#0A0A0F] custom-scrollbar",children:p?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-16 h-16 border-4 border-blue-500/30 border-t-blue-500 rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg font-medium",children:"Carregando conversas..."}),e.jsx("p",{className:"text-gray-600 text-sm mt-2",children:"Aguarde enquanto configuramos seu chat"})]})}):Ie&&Ie.messages?e.jsxs(e.Fragment,{children:[Ie.messages.map(a=>{const t=a.content?.match(/INTEGRATION_CONNECT:(\w+):([^üîó]+)/);if(t&&"assistant"===a.role){const[,s,r]=t,o=a.content.replace(/üîó \*\*INTEGRATION_CONNECT:[^üîó]+üîó\*\* üîó\n\n/,"");return e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-start",children:e.jsxs("div",{className:"max-w-[80%]",children:[e.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-2xl p-4 mb-2 border border-gray-700/30",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(y.div,{whileHover:{rotate:10,scale:1.1},className:"flex-shrink-0",children:e.jsx(b,{className:"w-6 h-6 text-blue-400"})}),e.jsx("div",{className:"flex-1 text-gray-200",children:o})]})}),e.jsx(se,{platform:s,platformName:r.trim(),onSkip:()=>{},onSuccess:()=>{}})]})},a.id)}return e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:n("flex","user"===a.role?"justify-end":"justify-start"),children:e.jsxs("div",{className:n("max-w-[80%] rounded-2xl p-4 backdrop-blur-sm","user"===a.role?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg shadow-blue-500/20 border border-blue-400/30":"bg-gray-800/50 text-gray-200 border border-gray-700/30"),children:[e.jsxs("div",{className:"flex items-start gap-3",children:["assistant"===a.role&&e.jsx(y.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},whileHover:{rotate:10,scale:1.1},className:"flex-shrink-0",children:e.jsx(b,{className:"w-6 h-6 text-blue-400"})}),"user"===a.role&&e.jsx(y.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},whileHover:{scale:1.1},className:"flex-shrink-0",children:e.jsx(I,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 whitespace-pre-wrap break-words",children:[a.content,a.attachments&&a.attachments.length>0&&e.jsx("div",{className:"mt-3",children:e.jsx(Ne,{attachments:a.attachments})})]})]}),e.jsx("div",{className:n("text-xs mt-2 ml-9","user"===a.role?"text-white/60":"text-gray-500"),children:a.timestamp?new Date(a.timestamp).toLocaleTimeString("pt-BR"):""})]})},a.id)}),ge&&e.jsx(e.Fragment,{children:R.length>0&&e.jsx(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"ml-4",children:e.jsx(Ne,{attachments:R})})}),e.jsx("div",{ref:be})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma conversa selecionada"}),e.jsx("p",{className:"text-gray-600 text-sm mt-2",children:"Crie uma nova conversa para come√ßar"})]})})}),e.jsxs("div",{className:"bg-[#12121A]/95 backdrop-blur-xl border-t border-gray-700/50 px-6 py-3 shadow-2xl",children:[e.jsx("div",{className:"hidden sm:flex gap-2 mb-3",children:Se.map(a=>e.jsx(y.button,{whileHover:{scale:1.05,boxShadow:"0 0 15px rgba(59, 130, 246, 0.3)"},whileTap:{scale:.95},onClick:()=>t(a),className:"px-3 py-1.5 rounded-lg bg-gray-800/50 hover:bg-gray-700/50 text-gray-300 text-sm transition-all border border-gray-700/30 backdrop-blur-sm",children:a},a))}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{value:a,onChange:e=>{const a=e.target.value;a.length<=$e&&(t(a),c(a.length))},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Ae())},placeholder:"Digite sua mensagem...",className:"w-full resize-none rounded-xl bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 text-white placeholder-gray-500 p-4 pr-32 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/30 focus:bg-gray-800/70 transition-all shadow-inner",minRows:1,maxRows:5}),e.jsxs("div",{className:"absolute bottom-2 left-4 text-xs text-gray-500",children:[o,"/",$e]}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex gap-1",children:[e.jsx("input",{type:"file",ref:je,onChange:async e=>{const a=e.target.files?.[0];if(a&&ie)try{const e=a.name.split(".").pop(),s=`${Date.now()}.${e}`,r=`${ie.id}/${s}`,{error:o}=await m.storage.from("chat-attachments").upload(r,a);if(o)throw o;const{data:{publicUrl:n}}=m.storage.from("chat-attachments").getPublicUrl(r),i=a.type.startsWith("image/")?`![${a.name}](${n})`:`[${a.name}](${n})`;t(e=>e?`${e}\n\n${i}`:i),ke({title:"Arquivo enviado!",description:`${a.name} foi anexado com sucesso.`,variant:"success"})}catch(s){ke({title:"Erro ao enviar arquivo",description:s.message,variant:"destructive"})}finally{e.target&&(e.target.value="")}},className:"hidden"}),e.jsx(Q,{children:e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(y.button,{whileHover:{scale:1.1,rotate:-10},whileTap:{scale:.9},onClick:()=>{je.current?.click()},className:"p-2 rounded-lg hover:bg-gray-700/50 text-gray-400 hover:text-blue-400 transition-all",children:e.jsx(V,{className:"w-5 h-5"})})}),e.jsx(ae,{children:"Anexar arquivo"})]})}),e.jsx(Q,{children:e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(y.button,{whileHover:{scale:1.1},whileTap:{scale:.9},animate:G?{scale:[1,1.2,1]}:{},transition:{duration:.5,repeat:G?1/0:0},onClick:G?()=>{Y.current&&G&&(Y.current.stop(),L(!1),Y.current.stream.getTracks().forEach(e=>e.stop()))}:async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),a=new MediaRecorder(e);Y.current=a,W.current=[],a.ondataavailable=e=>{W.current.push(e.data)},a.onstop=()=>{const e=new Blob(W.current,{type:"audio/webm"});B(e)},a.start(),L(!0)}catch(e){ke({title:"Erro no microfone",description:"N√£o foi poss√≠vel acessar o microfone.",variant:"destructive"})}},disabled:!ue,className:n("p-2 rounded-lg transition-all",G?"bg-red-500/30 text-red-400 shadow-lg shadow-red-500/50":"hover:bg-gray-700/50 text-gray-400 hover:text-red-400"),children:e.jsx(K,{className:"w-5 h-5"})})}),e.jsx(ae,{children:G?"Parar grava√ß√£o":"Gravar √°udio"})]})}),e.jsx(y.button,{whileHover:{scale:1.05,rotate:-5},whileTap:{scale:.95},animate:""!==a.trim()&&ue?{boxShadow:["0 0 10px rgba(59, 130, 246, 0.3)","0 0 20px rgba(168, 85, 247, 0.4)","0 0 10px rgba(59, 130, 246, 0.3)"]}:{},transition:{duration:1.5,repeat:1/0},onClick:Ae,disabled:""===a.trim()||!ue,className:n("p-2.5 rounded-lg transition-all",""!==a.trim()&&ue?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-xl":"bg-gray-700/50 text-gray-500 cursor-not-allowed"),children:e.jsx(P,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx(ne,{}),e.jsxs("p",{className:n("text-xs",a.length>$e?"text-red-400":"text-gray-500"),children:[a.length," / ",$e]})]})]})]})]})};export{Ie as default};
