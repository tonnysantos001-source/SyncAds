import{s as i}from"./index-CkeR9g7w.js";const m={async getShopifyIntegration(n){try{const{data:c,error:s}=await i.from("ShopifyIntegration").select("*").eq("userId",n).eq("isActive",!0).single();return s?(console.error("Error getting Shopify integration:",s),null):c}catch(c){return console.error("Error getting Shopify integration:",c),null}},async syncProducts(n,c){var s;try{const r=await this.getShopifyIntegration(n);if(!r)return{success:!1,message:"Integração Shopify não encontrada. Configure a integração em Integrações primeiro.",synced:0,errors:1};const{data:o,error:e}=await i.functions.invoke("shopify-sync",{body:{integrationId:r.id,action:"sync-products",limit:250}});if(e)return console.error("Error calling shopify-sync:",e),{success:!1,message:`Erro ao sincronizar: ${e.message}`,synced:0,errors:1};const t=((s=o==null?void 0:o.results)==null?void 0:s.products)||{};return t.success?{success:!0,message:`${t.synced||0} produtos sincronizados com sucesso!`,synced:t.synced||0,errors:0}:{success:!1,message:t.error||"Erro ao sincronizar produtos",synced:0,errors:1}}catch(r){return console.error("Error in syncProducts:",r),{success:!1,message:r.message||"Erro desconhecido ao sincronizar produtos",synced:0,errors:1}}},async syncOrders(n,c){var s;try{const r=await this.getShopifyIntegration(n);if(!r)return{success:!1,message:"Integração Shopify não encontrada. Configure a integração em Integrações primeiro.",synced:0,errors:1};const{data:o,error:e}=await i.functions.invoke("shopify-sync",{body:{integrationId:r.id,action:"sync-orders",limit:250}});if(e)return console.error("Error calling shopify-sync:",e),{success:!1,message:`Erro ao sincronizar: ${e.message}`,synced:0,errors:1};const t=((s=o==null?void 0:o.results)==null?void 0:s.orders)||{};return t.success?{success:!0,message:`${t.synced||0} pedidos sincronizados com sucesso!`,synced:t.synced||0,errors:0}:{success:!1,message:t.error||"Erro ao sincronizar pedidos",synced:0,errors:1}}catch(r){return console.error("Error in syncOrders:",r),{success:!1,message:r.message||"Erro desconhecido ao sincronizar pedidos",synced:0,errors:1}}},async syncCustomers(n){var c;try{const s=await this.getShopifyIntegration(n);if(!s)return{success:!1,message:"Integração Shopify não encontrada. Configure a integração em Integrações primeiro.",synced:0,errors:1};const{data:r,error:o}=await i.functions.invoke("shopify-sync",{body:{integrationId:s.id,action:"sync-customers",limit:250}});if(o)return console.error("Error calling shopify-sync:",o),{success:!1,message:`Erro ao sincronizar: ${o.message}`,synced:0,errors:1};const e=((c=r==null?void 0:r.results)==null?void 0:c.customers)||{};return e.success?{success:!0,message:`${e.synced||0} clientes sincronizados com sucesso!`,synced:e.synced||0,errors:0}:{success:!1,message:e.error||"Erro ao sincronizar clientes",synced:0,errors:1}}catch(s){return console.error("Error in syncCustomers:",s),{success:!1,message:s.message||"Erro desconhecido ao sincronizar clientes",synced:0,errors:1}}},async syncAbandonedCarts(n){var c;try{const s=await this.getShopifyIntegration(n);if(!s)return{success:!1,message:"Integração Shopify não encontrada. Configure a integração em Integrações primeiro.",synced:0,errors:1};const{data:r,error:o}=await i.functions.invoke("shopify-sync",{body:{integrationId:s.id,action:"sync-carts",limit:250}});if(o)return console.error("Error calling shopify-sync:",o),{success:!1,message:`Erro ao sincronizar: ${o.message}`,synced:0,errors:1};const e=((c=r==null?void 0:r.results)==null?void 0:c.abandonedCarts)||{};return e.success?{success:!0,message:`${e.synced||0} carrinhos abandonados sincronizados com sucesso!`,synced:e.synced||0,errors:0}:{success:!1,message:e.error||"Erro ao sincronizar carrinhos abandonados",synced:0,errors:1}}catch(s){return console.error("Error in syncAbandonedCarts:",s),{success:!1,message:s.message||"Erro desconhecido ao sincronizar carrinhos",synced:0,errors:1}}},async syncAll(n){var c,s,r,o,e,t,l,y;try{const a=await this.getShopifyIntegration(n);if(!a)return{success:!1,message:"Integração Shopify não encontrada. Configure a integração em Integrações primeiro.",synced:0,errors:1};const{data:d,error:g}=await i.functions.invoke("shopify-sync",{body:{integrationId:a.id,action:"sync-all",limit:250}});if(g)return console.error("Error calling shopify-sync:",g),{success:!1,message:`Erro ao sincronizar: ${g.message}`,synced:0,errors:1};const u=(d==null?void 0:d.results)||{},f=(((c=u.products)==null?void 0:c.synced)||0)+(((s=u.orders)==null?void 0:s.synced)||0)+(((r=u.customers)==null?void 0:r.synced)||0)+(((o=u.abandonedCarts)==null?void 0:o.synced)||0),h=!((e=u.products)!=null&&e.success)||!((t=u.orders)!=null&&t.success)||!((l=u.customers)!=null&&l.success)||!((y=u.abandonedCarts)!=null&&y.success);return d!=null&&d.success?{success:!0,message:`Sincronização completa! ${f} itens sincronizados.`,synced:f,errors:0,details:u}:{success:!1,message:"Sincronização completada com erros",synced:f,errors:1,details:u}}catch(a){return console.error("Error in syncAll:",a),{success:!1,message:a.message||"Erro desconhecido ao sincronizar",synced:0,errors:1}}},async getSyncStats(n){try{const{data:c,count:s}=await i.from("ShopifyProduct").select("*",{count:"exact"}).eq("userId",n),{data:r,count:o}=await i.from("ShopifyOrder").select("*",{count:"exact"}).eq("userId",n),{data:e,count:t}=await i.from("ShopifyCustomer").select("*",{count:"exact"}).eq("userId",n),{data:l,count:y}=await i.from("ShopifyAbandonedCart").select("*",{count:"exact"}).eq("userId",n),{data:a}=await i.from("ShopifyIntegration").select("lastSyncAt, lastSyncStatus").eq("userId",n).single();return{totalProducts:s||0,totalOrders:o||0,totalCustomers:t||0,totalAbandonedCarts:y||0,lastSync:(a==null?void 0:a.lastSyncAt)||null,lastSyncStatus:(a==null?void 0:a.lastSyncStatus)||null}}catch(c){return console.error("Error getting sync stats:",c),{totalProducts:0,totalOrders:0,totalCustomers:0,totalAbandonedCarts:0,lastSync:null,lastSyncStatus:null}}},async getSyncLogs(n,c=10){try{const{data:s,error:r}=await i.from("ShopifySyncLog").select("*").eq("userId",n).order("createdAt",{ascending:!1}).limit(c);if(r)throw r;return s||[]}catch(s){return console.error("Error getting sync logs:",s),[]}}},S=m;export{m as a,S as s};
