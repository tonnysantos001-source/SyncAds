import{s}from"./index-D3MMADof.js";const h={async list(t){try{let r=s.from("Customer").select("*").order("createdAt",{ascending:!1});t!=null&&t.status&&(r=r.eq("status",t.status)),t!=null&&t.search&&(r=r.or(`name.ilike.%${t.search}%,email.ilike.%${t.search}%,cpf.ilike.%${t.search}%`)),t!=null&&t.tags&&t.tags.length>0&&(r=r.contains("tags",t.tags));const{data:e,error:o}=await r;if(o)throw o;return e}catch(r){throw console.error("Error listing customers:",r),r}},async listFromShopify(t,r){try{let e=s.from("ShopifyCustomer").select("*").eq("userId",t).order("updatedAt",{ascending:!1});r!=null&&r.search&&(e=e.or(`email.ilike.%${r.search}%,firstName.ilike.%${r.search}%,lastName.ilike.%${r.search}%`));const{data:o,error:n}=await e;if(n)throw n;return(o||[]).map(a=>{var i,c,d;return{id:String(a.id),userId:a.userId,email:a.email||"",name:`${a.firstName||""} ${a.lastName||""}`.trim()||"Cliente",phone:a.phone,cpf:void 0,birthDate:void 0,gender:void 0,totalOrders:a.ordersCount||0,totalSpent:parseFloat(a.totalSpent||"0"),averageOrderValue:a.ordersCount>0?parseFloat(a.totalSpent||"0")/a.ordersCount:0,lastOrderAt:((i=a.shopifyData)==null?void 0:i.last_order_date)||void 0,tags:(c=a.shopifyData)!=null&&c.tags?a.shopifyData.tags.split(",").map(u=>u.trim()):[],notes:void 0,acceptsMarketing:((d=a.shopifyData)==null?void 0:d.accepts_marketing)||!1,status:"ACTIVE",createdAt:a.createdAt,updatedAt:a.updatedAt}})}catch(e){throw console.error("Error listing Shopify customers:",e),e}},async getById(t){try{const{data:r,error:e}=await s.from("Customer").select("*, CustomerAddress(*)").eq("id",t).single();if(e)throw e;return r}catch(r){throw console.error("Error getting customer:",r),r}},async getByEmail(t){try{const{data:r,error:e}=await s.from("Customer").select("*").eq("email",t).single();if(e)throw e;return r}catch(r){throw console.error("Error getting customer by email:",r),r}},async create(t){try{const{data:r,error:e}=await s.from("Customer").insert({...t,totalOrders:0,totalSpent:0,averageOrderValue:0}).select().single();if(e)throw e;return r}catch(r){throw console.error("Error creating customer:",r),r}},async update(t,r){try{const{data:e,error:o}=await s.from("Customer").update({...r,updatedAt:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return e}catch(e){throw console.error("Error updating customer:",e),e}},async toggleStatus(t,r){try{const{data:e,error:o}=await s.from("Customer").update({status:r,updatedAt:new Date().toISOString()}).eq("id",t).select().single();if(o)throw o;return e}catch(e){throw console.error("Error toggling customer status:",e),e}},async delete(t){try{const{error:r}=await s.from("Customer").delete().eq("id",t);if(r)throw r}catch(r){throw console.error("Error deleting customer:",r),r}}};export{h as c};
