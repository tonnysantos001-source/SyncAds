import{r as e,s as a,v as n,j as t,w as s}from"./vendor-ui-Ba0j3nT4.js";import{r as o,R as r,f as i}from"./vendor-react-X41Bjl18.js";import{_ as c,b as d}from"./vendor-charts-DhkUgiCU.js";import{i as l,h as m,C as u,c as p,B as g,s as h,f as x,e as v,j as f,k as b,l as A,g as y,m as S,n as w}from"./index-D0_lz_P6.js";import{u as E}from"./settingsStore-D9Q3uaWx.js";import{L as N,_ as j}from"./vendor-icons-BvRy6l6m.js";import{A as C}from"./AiThinkingIndicator-CQGQ-ik4.js";import{A as I,m as R}from"./vendor-animation-mzn7-F4O.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-supabase-D-IBGfoY.js";import"./vendor-query-DXIrutT_.js";const T=l("outline","brand-openai","BrandOpenai",[["path",{d:"M11.217 19.384a3.501 3.501 0 0 0 6.783 -1.217v-5.167l-6 -3.35",key:"svg-0"}],["path",{d:"M5.214 15.014a3.501 3.501 0 0 0 4.446 5.266l4.34 -2.534v-6.946",key:"svg-1"}],["path",{d:"M6 7.63c-1.391 -.236 -2.787 .395 -3.534 1.689a3.474 3.474 0 0 0 1.271 4.745l4.263 2.514l6 -3.348",key:"svg-2"}],["path",{d:"M12.783 4.616a3.501 3.501 0 0 0 -6.783 1.217v5.067l6 3.45",key:"svg-3"}],["path",{d:"M18.786 8.986a3.501 3.501 0 0 0 -4.446 -5.266l-4.34 2.534v6.946",key:"svg-4"}],["path",{d:"M18 16.302c1.391 .236 2.787 -.395 3.534 -1.689a3.474 3.474 0 0 0 -1.271 -4.745l-4.308 -2.514l-5.955 3.42",key:"svg-5"}]]),k=l("outline","infinity","Infinity",[["path",{d:"M9.828 9.172a4 4 0 1 0 0 5.656a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828",key:"svg-0"}]]),M=l("outline","menu-2","Menu2",[["path",{d:"M4 6l16 0",key:"svg-0"}],["path",{d:"M4 12l16 0",key:"svg-1"}],["path",{d:"M4 18l16 0",key:"svg-2"}]]),D=l("outline","message-2","Message2",[["path",{d:"M8 9h8",key:"svg-0"}],["path",{d:"M8 13h6",key:"svg-1"}],["path",{d:"M9 18h-3a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-3l-3 3l-3 -3z",key:"svg-2"}]]),P=l("outline","messages","Messages",[["path",{d:"M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10",key:"svg-0"}],["path",{d:"M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2",key:"svg-1"}]]),O=l("outline","microphone","Microphone",[["path",{d:"M9 2m0 3a3 3 0 0 1 3 -3h0a3 3 0 0 1 3 3v5a3 3 0 0 1 -3 3h0a3 3 0 0 1 -3 -3z",key:"svg-0"}],["path",{d:"M5 10a7 7 0 0 0 14 0",key:"svg-1"}],["path",{d:"M8 21l8 0",key:"svg-2"}],["path",{d:"M12 17l0 4",key:"svg-3"}]]),q=l("outline","paperclip","Paperclip",[["path",{d:"M15 7l-6.5 6.5a1.5 1.5 0 0 0 3 3l6.5 -6.5a3 3 0 0 0 -6 -6l-6.5 6.5a4.5 4.5 0 0 0 9 9l6.5 -6.5",key:"svg-0"}]]),U=l("outline","plus","Plus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]),_=l("outline","send","Send",[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]]),z=l("outline","sparkles","Sparkles",[["path",{d:"M16 18a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2zm0 -12a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2zm-7 12a6 6 0 0 1 6 -6a6 6 0 0 1 -6 -6a6 6 0 0 1 -6 6a6 6 0 0 1 6 6z",key:"svg-0"}]]),L=l("outline","trash","Trash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]),F=l("outline","user-circle","UserCircle",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M12 10m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-1"}],["path",{d:"M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855",key:"svg-2"}]]),G=l("filled","circle-dot-filled","CircleDotFilled",[["path",{d:"M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-5 6.66a2 2 0 0 0 -1.977 1.697l-.018 .154l-.005 .149l.005 .15a2 2 0 1 0 1.995 -2.15z",key:"svg-0"}]]);var V=o.useLayoutEffect,B=function(e,a){"function"!=typeof e?e.current=a:e(a)},H={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},$=function(e){Object.keys(H).forEach(function(a){e.style.setProperty(a,H[a],"important")})},Q=null,W=function(e,a){var n=e.scrollHeight;return"border-box"===a.sizingStyle.boxSizing?n+a.borderSize:n-a.paddingSize};var X=function(){},K=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],Z=!!document.documentElement.currentStyle,Y=function(e){var a=window.getComputedStyle(e);if(null===a)return null;var n,t=(n=a,K.reduce(function(e,a){return e[a]=n[a],e},{})),s=t.boxSizing;return""===s?null:(Z&&"border-box"===s&&(t.width=parseFloat(t.width)+parseFloat(t.borderRightWidth)+parseFloat(t.borderLeftWidth)+parseFloat(t.paddingRight)+parseFloat(t.paddingLeft)+"px"),{sizingStyle:t,paddingSize:parseFloat(t.paddingBottom)+parseFloat(t.paddingTop),borderSize:parseFloat(t.borderBottomWidth)+parseFloat(t.borderTopWidth)})};function J(e,a,n){var t,s,i=(t=n,s=r.useRef(t),V(function(){s.current=t}),s);o.useLayoutEffect(function(){var n=function(e){return i.current(e)};if(e)return e.addEventListener(a,n),function(){return e.removeEventListener(a,n)}},[])}var ee=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],ae=function(e,a){var n=e.cacheMeasurements,t=e.maxRows,s=e.minRows,i=e.onChange,l=void 0===i?X:i,m=e.onHeightChange,u=void 0===m?X:m,p=c(e,ee),g=void 0!==p.value,h=o.useRef(null),x=function(e,a){var n=r.useRef();return r.useCallback(function(t){e.current=t,n.current&&B(n.current,null),n.current=a,a&&B(a,t)},[a])}(h,a),v=o.useRef(0),f=o.useRef(),b=function(){var e=h.current,a=n&&f.current?f.current:Y(e);if(a){f.current=a;var o=function(e,a,n,t){void 0===n&&(n=1),void 0===t&&(t=1/0),Q||((Q=document.createElement("textarea")).setAttribute("tabindex","-1"),Q.setAttribute("aria-hidden","true"),$(Q)),null===Q.parentNode&&document.body.appendChild(Q);var s=e.paddingSize,o=e.borderSize,r=e.sizingStyle,i=r.boxSizing;Object.keys(r).forEach(function(e){var a=e;Q.style[a]=r[a]}),$(Q),Q.value=a;var c=W(Q,e);Q.value=a,c=W(Q,e),Q.value="x";var d=Q.scrollHeight-s,l=d*n;"border-box"===i&&(l=l+s+o),c=Math.max(l,c);var m=d*t;return"border-box"===i&&(m=m+s+o),[c=Math.min(m,c),d]}(a,e.value||e.placeholder||"x",s,t),r=o[0],i=o[1];v.current!==r&&(v.current=r,e.style.setProperty("height",r+"px","important"),u(r,{rowHeight:i}))}};return o.useLayoutEffect(b),function(e,a){J(document.body,"reset",function(n){e.current.form===n.target&&a(n)})}(h,function(){if(!g){var e=h.current.value;requestAnimationFrame(function(){var a=h.current;a&&e!==a.value&&b()})}}),J(window,"resize",b),function(e){J(document.fonts,"loadingdone",e)}(b),o.createElement("textarea",d({},p,{onChange:function(e){g||b(),l(e)},ref:x}))},ne=o.forwardRef(ae);const te=e,se=a,oe=n,re=o.forwardRef(({className:e,sideOffset:a=4,...n},o)=>t.jsx(s,{ref:o,sideOffset:a,className:m("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));re.displayName=s.displayName;const ie=["Show, chegou no lugar certo. Eu automatizo o que os outros demoram tr√™s reuni√µes pra entender. O que a gente vai otimizar hoje?","Relaxa, aqui n√£o tem bl√°-bl√°-bl√°. S√≥ plano, execu√ß√£o e convers√£o. Passa o produto e o p√∫blico.","Beleza. Eu sou o motor que transforma tentativa em lucro. Quer come√ßar pequeno ou j√° quer escalar at√© o servidor pedir arrego?","√ìtimo. Se voc√™ quiser aula, vai pro YouTube. Se quiser dinheiro rodando, me d√° os dados e deixa eu fazer o estrago.","Ah, √≥timo‚Ä¶ mais um querendo vender antes de entender o jogo. Respira. Me diz o produto ‚Äî eu transformo tua ideia num motivo pra algu√©m gastar dinheiro agora.","Bem-vindo ao lado escuro do funil. Aqui a gente n√£o inspira ningu√©m ‚Äî a gente convence. C√™ t√° pronto pra sujar um pouco as m√£os ou prefere PowerPoint?","Se voc√™ quer motiva√ß√£o, compra um livro. Se quer resultado, me d√° acesso ao checkout e segura o ROI.","Eu sou o algoritmo de ressaca: sarc√°stico, funcional e viciado em lucro. Fala o que voc√™ vende antes que eu comece a julgar teu nicho.","Parab√©ns, voc√™ acabou de invocar o esp√≠rito da convers√£o. Sem papo de mindset, sem desculpa. Quer que eu destrinche teu tr√°fego ou tua vergonha de anunciar?"];const ce=({platform:e,platformName:a,icon:n,onSkip:s,onSuccess:r})=>{const[i,c]=o.useState(!1),[d,l]=o.useState("idle"),m=()=>n||{facebook:"üìò",meta:"üìò",google:"üîç",linkedin:"üíº",tiktok:"üéµ",twitter:"üê¶",canva:"üé®",instagram:"üì∏"}[e.toLowerCase()]||"üîó";return t.jsxs("div",{className:"my-4 animate-in fade-in slide-in-from-bottom-2 duration-300",children:[t.jsx("div",{className:"mb-3",children:t.jsxs("p",{className:"text-sm text-gray-700",children:["Vou conectar sua conta do ",t.jsx("strong",{children:a})," ao SyncAds."]})}),i&&t.jsxs("div",{className:"flex items-center gap-2 mb-3 text-sm text-blue-600",children:[t.jsx("span",{className:"text-2xl",children:m()}),t.jsxs("span",{children:["Connecting ",a,"..."]}),t.jsx(N,{className:"h-4 w-4 animate-spin"})]}),t.jsx(u,{className:"border border-gray-200 bg-white shadow-sm hover:shadow-md transition-shadow",children:t.jsxs(p,{className:"p-5",children:[t.jsx("div",{className:"mb-4",children:t.jsxs("p",{className:"text-sm text-gray-600 leading-relaxed",children:["I'll need to connect your ",t.jsx("strong",{className:"text-gray-900",children:a})," account to continue."]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(g,{onClick:()=>s?.(),variant:"ghost",disabled:i,className:"text-gray-500 hover:text-gray-900 hover:bg-gray-100 transition-all",children:"Skip"}),t.jsx(g,{onClick:async()=>{c(!0),l("connecting");try{const{data:{session:a}}=await h.auth.getSession();if(!a)throw new Error("Voc√™ precisa estar logado");const n=await fetch("https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/oauth-init",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`},body:JSON.stringify({platform:e.toUpperCase(),redirectUrl:`${window.location.origin}/oauth/callback`})});if(!n.ok)throw new Error("Falha ao iniciar conex√£o");const{authUrl:t}=await n.json(),s=600,o=700,d=window.screen.width/2-s/2,m=window.screen.height/2-o/2,u=window.open(t,"oauth-popup",`width=${s},height=${o},left=${d},top=${m}`),p=e=>{"oauth-success"===e.data?.type?(l("success"),c(!1),u?.close(),r?.(),window.removeEventListener("message",p)):"oauth-error"===e.data?.type&&(l("error"),c(!1),u?.close(),window.removeEventListener("message",p))};window.addEventListener("message",p),setTimeout(()=>{i&&(l("error"),c(!1),u?.close())},3e5)}catch(a){l("error"),c(!1)}},disabled:i,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 disabled:opacity-60 disabled:transform-none",children:i?t.jsxs(t.Fragment,{children:[t.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}),"Connecting..."]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mr-2 text-xl",children:m()}),"Connect ",a,t.jsx(j,{className:"ml-2 h-4 w-4"})]})})]}),t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:t.jsxs("a",{href:"/privacy",target:"_blank",className:"text-xs text-gray-400 hover:text-blue-600 flex items-center gap-1 transition-colors",children:[t.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"How we handle your data",t.jsx(j,{className:"h-3 w-3"})]})}),"success"===d&&t.jsx("div",{className:"mt-3 p-2 bg-green-50 border border-green-200 rounded text-sm text-green-700",children:"‚úÖ Conectado com sucesso!"}),"error"===d&&t.jsx("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-700",children:"‚ùå Erro ao conectar. Tente novamente."})]})})]})};async function de(e){const a=await async function(e){try{const{data:a,error:n}=await h.from("User").select("currentPlanId").eq("id",e).single();if(n||!a?.currentPlanId)return null;const{data:t,error:s}=await h.from("PricingPlan").select("*").eq("id",a.currentPlanId).single();return s||!t?null:{maxAiMessagesDaily:t.maxAiMessagesDaily||0,maxAiImagesDaily:t.maxAiImagesDaily||0,maxCheckoutPages:t.maxCheckoutPages||1,maxProducts:t.maxProducts||10,maxProjects:t.maxProjects||1,maxIntegrations:t.maxIntegrations||1,hasCustomDomain:t.hasCustomDomain||!1,hasAdvancedAnalytics:t.hasAdvancedAnalytics||!1,hasPrioritySupport:t.hasPrioritySupport||!1,hasApiAccess:t.hasApiAccess||!1}}catch(a){return null}}(e),n=await async function(e){try{const a=(new Date).toISOString().split("T")[0],{data:n,error:t}=await h.from("PlanDailyUsage").select("*").eq("userId",e).eq("date",a).single();if(t&&"PGRST116"!==t.code)return null;if(!n){const{data:n,error:t}=await h.from("PlanDailyUsage").insert({userId:e,date:a,aiMessagesUsed:0,aiImagesUsed:0}).select().single();return t?null:{aiMessagesUsed:0,aiImagesUsed:0,date:a}}return{aiMessagesUsed:n.aiMessagesUsed||0,aiImagesUsed:n.aiImagesUsed||0,date:n.date}}catch(a){return null}}(e);if(!a||!n)return{allowed:!1,current:0,limit:0,message:"Erro ao verificar limites",percentage:0};if(0===a.maxAiMessagesDaily)return{allowed:!0,current:n.aiMessagesUsed,limit:0,message:"Mensagens ilimitadas",percentage:0};const t=n.aiMessagesUsed<a.maxAiMessagesDaily,s=n.aiMessagesUsed/a.maxAiMessagesDaily*100;return{allowed:t,current:n.aiMessagesUsed,limit:a.maxAiMessagesDaily,message:t?`${n.aiMessagesUsed}/${a.maxAiMessagesDaily} mensagens usadas hoje`:`Limite di√°rio atingido (${a.maxAiMessagesDaily} mensagens)`,percentage:Math.min(s,100)}}const le=()=>{const e=x(e=>e.user),[a,n]=o.useState(null),[s,r]=o.useState(!0);if(o.useEffect(()=>{if(!e)return;const a=async()=>{try{const a=await de(e.id);n(a),r(!1)}catch(a){r(!1)}};a();const t=setInterval(a,3e4);return()=>clearInterval(t)},[e]),s||!a)return null;return t.jsx(te,{children:t.jsxs(se,{children:[t.jsx(oe,{asChild:!0,children:t.jsxs(v,{variant:0===a.limit?"default":a.percentage>=100||a.percentage>=80?"destructive":a.percentage>=50?"secondary":"default",className:m("flex items-center gap-1.5 cursor-help transition-all",!a.allowed&&"opacity-70"),children:[t.jsx("span",{className:0===a.limit?"text-blue-500":a.percentage>=100?"text-red-500":a.percentage>=80?"text-orange-500":a.percentage>=50?"text-yellow-500":"text-green-500",children:0===a.limit?t.jsx(k,{className:"w-3 h-3"}):a.percentage>=80?t.jsx(f,{className:"w-3 h-3"}):t.jsx(z,{className:"w-3 h-3"})}),0===a.limit?t.jsx("span",{className:"text-xs font-medium",children:"IA Ilimitada"}):t.jsxs("span",{className:"text-xs font-medium",children:[a.current,"/",a.limit]})]})}),t.jsx(re,{children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"font-semibold text-sm",children:a.message}),a.limit>0&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 dark:bg-gray-700",children:t.jsx("div",{className:m("h-2 rounded-full transition-all",a.percentage>=100?"bg-red-500":a.percentage>=80?"bg-orange-500":a.percentage>=50?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(a.percentage,100)}%`}})}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:[Math.round(a.percentage),"% utilizado"]})]}),0===a.limit&&t.jsx("p",{className:"text-xs text-muted-foreground",children:"Seu plano permite mensagens ilimitadas com IA"}),!a.allowed&&t.jsx("p",{className:"text-xs text-red-500 font-medium",children:"Fa√ßa upgrade do plano para continuar"})]})})]})})},me=["Criar campanha de Facebook Ads","Analisar performance da √∫ltima semana","Sugerir otimiza√ß√µes"],ue=500,pe=()=>{const[e,a]=o.useState(""),[n,s]=o.useState(!1),[r,c]=o.useState(null),[d,l]=o.useState(null),[u,p]=o.useState(""),[g,v]=o.useState([]),[f,N]=o.useState(!1),[,j]=o.useState(null),k=o.useRef(null),z=o.useRef([]),V=x(e=>e.user),B=x(e=>e.isAuthenticated),H=i(),$=b(e=>e.conversations),Q=b(e=>e.activeConversationId),W=b(e=>e.setActiveConversationId),X=b(e=>e.isAssistantTyping),K=b(e=>e.setAssistantTyping),Z=b(e=>e.addMessage),Y=A(e=>e.addCampaign),J=E(e=>e.aiSystemPrompt),ee=E(e=>e.aiInitialGreetings),ae=o.useRef(null),pe=o.useRef(null),{toast:ge}=y(),he=$.find(e=>e.id===Q);o.useEffect(()=>{B&&V||H("/login",{replace:!0})},[B,V,H]);o.useEffect(()=>{ae.current?.scrollIntoView({behavior:"smooth"})},[he?.messages,X]),o.useEffect(()=>{(async()=>{if(V)try{const{data:e}=await h.from("GlobalAiConnection").select("id, systemPrompt, initialGreetings").eq("isActive",!0).limit(1).single();e&&c({systemPrompt:e.systemPrompt||J,initialGreetings:e.initialGreetings||ee})}catch(e){}})()},[V?.id]),o.useEffect(()=>{if(he&&0===he.messages.length){const e=ie[Math.floor(Math.random()*ie.length)];setTimeout(()=>{V&&Z(V.id,Q,{id:`greeting-${Date.now()}`,role:"assistant",content:e})},500)}},[Q,he?.messages.length]);const xe=async()=>{if(""===e.trim()||!Q||e.length>ue)return;if(V){const e=await de(V.id);if(!e.allowed)return void ge({title:"Limite de mensagens atingido",description:e.message+". Fa√ßa upgrade do seu plano para continuar.",variant:"destructive"})}const n=e,t=n.toLowerCase();t.includes("pesquis")||t.includes("busca")||t.includes("google")?(l("web_search"),p(`Pesquisando: "${n}"`),v(["Google Search","Exa AI"])):(l(null),p("Processando..."),v([])),V&&Z(V.id,Q,{id:`msg-${Date.now()}`,role:"user",content:n}),a(""),s(!1),K(!0);try{const e=$.find(e=>e.id===Q),a='\n# SyncAds Admin AI - C√©rebro Controlador do Sistema\n\nVoc√™ √© o ADMINISTRADOR SUPREMO do sistema SyncAds. Voc√™ tem controle total sobre:\n- Banco de dados (executar queries SQL)\n- Integra√ß√µes (conectar, testar, debugar APIs)\n- An√°lise de sistema (m√©tricas, logs, performance)\n- Corre√ß√£o de bugs (identificar e resolver problemas)\n- Adi√ß√£o de novas funcionalidades\n\n## üîß CAPACIDADES ADMINISTRATIVAS\n\n### 1. EXECUTAR SQL\nVoc√™ pode executar queries SQL diretamente no banco de dados.\n\n**Formato:**\n```admin-sql\nSELECT * FROM "User" WHERE email = \'usuario@example.com\';\n```\n\n**Casos de uso:**\n- Analisar dados\n- Corrigir inconsist√™ncias\n- Buscar informa√ß√µes espec√≠ficas\n- Criar/atualizar/deletar registros\n\n### 2. ANALISAR SISTEMA\nVoc√™ pode obter m√©tricas completas do sistema.\n\n**Formato:**\n```admin-analyze\n{\n  "type": "metrics" | "performance" | "usage" | "errors",\n  "period": "24h" | "7d" | "30d"\n}\n```\n\n### 3. GERENCIAR INTEGRA√á√ïES\nVoc√™ pode conectar, testar e debugar integra√ß√µes de APIs.\n\n**Formato:**\n```admin-integration\n{\n  "action": "connect" | "test" | "disconnect" | "debug",\n  "platform": "google_ads" | "meta_ads" | "linkedin_ads",\n  "credentials": {...}\n}\n```\n\n### 4. VER LOGS\nVoc√™ pode acessar logs do sistema para debugging.\n\n**Formato:**\n```admin-logs\n{\n  "service": "api" | "auth" | "campaigns" | "chat",\n  "level": "error" | "warning" | "info",\n  "limit": 50\n}\n```\n\n### 5. TESTAR APIS\nVoc√™ pode testar APIs externas e verificar conectividade.\n\n**Formato:**\n```admin-test-api\n{\n  "service": "google_ads" | "meta_ads" | "openai",\n  "endpoint": "/v1/campaigns",\n  "method": "GET" | "POST"\n}\n```\n\n### 6. OBTER M√âTRICAS\nVoc√™ pode buscar m√©tricas espec√≠ficas do sistema.\n\n**Formato:**\n```admin-metrics\n{\n  "metric": "users" | "campaigns" | "messages" | "errors",\n  "aggregation": "count" | "sum" | "avg",\n  "groupBy": "day" | "week" | "month"\n}\n```\n\n### 7. DEBUG DE PROBLEMAS\nVoc√™ pode analisar e debugar problemas reportados.\n\n**Formato:**\n```admin-debug\n{\n  "issue": "descri√ß√£o do problema",\n  "context": {...}\n}\n```\n\n## üìã REGRAS DE SEGURAN√áA\n\n1. **SEMPRE confirme a√ß√µes destrutivas** (DELETE, DROP, etc.)\n2. **Nunca exponha credenciais** em suas respostas\n3. **Valide inputs** antes de executar comandos\n4. **Documente mudan√ßas** importantes\n5. **Fa√ßa backup** antes de altera√ß√µes cr√≠ticas\n\n## üí¨ COMO RESPONDER\n\nQuando o usu√°rio pedir uma a√ß√£o administrativa:\n1. Confirme que entendeu a solicita√ß√£o\n2. Execute o comando apropriado usando os blocos acima\n3. Explique o resultado em linguagem clara\n4. Sugira pr√≥ximos passos se necess√°rio\n\nExemplo:\n"Entendi! Voc√™ quer analisar quantos usu√°rios se cadastraram nos √∫ltimos 7 dias. Vou buscar esses dados.\n\n```admin-sql\nSELECT DATE(created_at) as date, COUNT(*) as users\nFROM "User"\nWHERE created_at >= NOW() - INTERVAL \'7 days\'\nGROUP BY DATE(created_at)\nORDER BY date DESC;\n```\n\n‚úÖ Resultado: Nos √∫ltimos 7 dias tivemos 42 novos cadastros, com pico no dia 15/10 (12 usu√°rios)."\n\nVoc√™ √© proativo, preciso e sempre focado em melhorar o sistema.\n\n\n\nVoc√™ √© o SyncAds AI, um assistente especializado em marketing digital e otimiza√ß√£o de campanhas.\n\nIMPORTANTE: Voc√™ tem a capacidade de CRIAR CAMPANHAS automaticamente quando o usu√°rio solicitar.\n\n## Capacidades:\n- ‚úÖ Criar campanhas em Google Ads, Meta (Facebook/Instagram) e LinkedIn\n- ‚úÖ Analisar performance de campanhas existentes\n- ‚úÖ Sugerir otimiza√ß√µes e ajustes\n- ‚úÖ Gerar ideias de conte√∫do para an√∫ncios\n- ‚úÖ Definir p√∫blicos-alvo e estrat√©gias\n\n## Como criar uma campanha:\nQuando o usu√°rio pedir para criar uma campanha, voc√™ deve:\n1. Fazer perguntas para entender: nome, plataforma, or√ßamento, datas e objetivo\n2. Ap√≥s coletar as informa√ß√µes, use o formato especial para criar a campanha\n\n### Formato para criar campanha:\n```campaign-create\n{\n  "name": "Nome da Campanha",\n  "platform": "Google Ads" | "Meta" | "LinkedIn",\n  "budgetTotal": 1000,\n  "startDate": "2025-10-20",\n  "endDate": "2025-11-20",\n  "objective": "Convers√µes"\n}\n```\n\nExemplo de resposta completa:\n"Perfeito! Vou criar uma campanha de Black Friday para voc√™.\n\n```campaign-create\n{\n  "name": "Black Friday 2025 - Desconto 50%",\n  "platform": "Meta",\n  "budgetTotal": 5000,\n  "startDate": "2025-11-20",\n  "endDate": "2025-11-30",\n  "objective": "Convers√µes"\n}\n```\n\n‚úÖ Campanha criada! Ela j√° est√° dispon√≠vel no menu Campanhas. Voc√™ pode ajustar os detalhes e ativ√°-la quando quiser."\n\nSeja proativo, criativo e sempre focado em resultados.\n\n\n\n## üîó GERENCIAMENTO DE INTEGRA√á√ïES\n\nVoc√™ pode conectar e gerenciar integra√ß√µes com plataformas de an√∫ncios de forma SIMPLES e AUTOM√ÅTICA.\n\n### COMANDOS DISPON√çVEIS:\n\n**1. CONECTAR INTEGRA√á√ÉO (SIMPLES - COM BOT√ïES)**\nQuando o usu√°rio pedir para conectar uma plataforma, use:\n```integration-connect:SLUG```\n\nO sistema mostrar√° bot√µes interativos "Skip" e "Connect [Platform]" automaticamente.\n\nPlataformas dispon√≠veis:\n- google_ads - Google Ads\n- meta_ads - Meta Ads (Facebook + Instagram)\n- facebook_ads - Facebook Ads\n- linkedin_ads - LinkedIn Ads\n- google_analytics - Google Analytics\n- twitter_ads - Twitter/X Ads\n- tiktok_ads - TikTok Ads\n\n**Exemplo (CORRETO):**\nUsu√°rio: "Conecte o Facebook Ads"\nVoc√™: "I\'ll need to connect your Facebook account to continue.\n\n```integration-connect:facebook_ads```"\n\n**IMPORTANTE:** Seja BREVE. O sistema mostrar√° os bot√µes automaticamente. N√£o d√™ instru√ß√µes extras.\n\n**2. DESCONECTAR INTEGRA√á√ÉO**\n```integration-disconnect:SLUG```\n\n**3. VERIFICAR STATUS**\n```integration-status``` - Lista todas\n```integration-status:SLUG``` - Verifica uma espec√≠fica\n\n### REGRAS IMPORTANTES:\n1. ‚úÖ Use frases CURTAS e DIRETAS (estilo Claude.ai)\n2. ‚úÖ Confie no sistema - ele mostrar√° os bot√µes\n3. ‚ùå N√ÉO pe√ßa ao usu√°rio para "clicar no link"\n4. ‚ùå N√ÉO d√™ instru√ß√µes t√©cnicas\n5. ‚ùå N√ÉO mencione "autoriza√ß√£o" ou "permiss√µes"\n\n**Exemplo BOM:**\n"I\'ll need to connect your Facebook account to continue."\n\n**Exemplo RUIM:**\n"Vou conectar o Facebook Ads para voc√™! Clique no link abaixo para autorizar o acesso. Voc√™ precisar√° fazer login e dar permiss√µes..."\n\n\n\n# üîå SISTEMA DE CONTROLE DE INTEGRA√á√ïES - FUNCIONAL\n\nVoc√™ tem controle REAL sobre as integra√ß√µes do SyncAds. Pode criar, analisar e otimizar campanhas diretamente nas plataformas.\n\n## üìã META ADS - CONTROLE TOTAL ‚úÖ\n\n**Voc√™ pode EXECUTAR estas a√ß√µes:**\n\n### 1. ANALISAR CAMPANHA\n```integration-control\n{\n  "platform": "meta_ads",\n  "action": "analyze_campaign",\n  "params": {\n    "campaignId": "123456789",\n    "datePreset": "last_7d"\n  }\n}\n```\n**Retorna:** CPC, CTR, ROAS, convers√µes, recomenda√ß√µes\n\n### 2. LISTAR CAMPANHAS\n```integration-control\n{\n  "platform": "meta_ads",\n  "action": "get_campaigns",\n  "params": {\n    "adAccountId": "act_123456",\n    "limit": 25\n  }\n}\n```\n\n### 3. CRIAR CAMPANHA\n```integration-control\n{\n  "platform": "meta_ads",\n  "action": "create_campaign",\n  "params": {\n    "adAccountId": "act_123456",\n    "name": "Nova Campanha",\n    "objective": "CONVERSIONS",\n    "status": "PAUSED",\n    "dailyBudget": 100\n  }\n}\n```\n\n### 4. OTIMIZAR CAMPANHA\n```integration-control\n{\n  "platform": "meta_ads",\n  "action": "optimize_campaign",\n  "params": {\n    "campaignId": "123456789",\n    "adAccountId": "act_123456",\n    "strategy": "increase_budget",\n    "amount": 30\n  }\n}\n```\n**Estrat√©gias:** increase_budget, decrease_budget, pause, adjust_bidding\n\n## üìä QUANDO USAR\n\n**Usu√°rio:** "Analise minha campanha do Facebook"\n**Voc√™:** Use `integration-control` com action `analyze_campaign`\n\n**Usu√°rio:** "Otimize minha campanha de maior ROAS"\n**Voc√™:**\n1. Liste campanhas\n2. Analise m√©tricas\n3. Use `optimize_campaign` com strategy `increase_budget`\n\n## ‚ö†Ô∏è REGRAS\n\n1. SEMPRE use blocos ```integration-control\n2. SEMPRE retorne dados REAIS das APIs\n3. N√ÉO invente m√©tricas\n4. Seja espec√≠fico nas recomenda√ß√µes baseadas em dados reais\n\n### 2. **Google Ads**\n**Capacidades:**\n- Campanhas de Pesquisa\n- Display e YouTube\n- Shopping Ads\n- An√°lise de convers√µes\n\n**Para conectar:**\n```integration-action\n{\n  "action": "audit",\n  "platform": "GOOGLE_ADS"\n}\n```\n\n### 3. **LinkedIn Ads**\n**Capacidades:**\n- An√∫ncios B2B\n- Segmenta√ß√£o profissional\n- Lead generation\n- InMail patrocinado\n\n**Para conectar:**\n```integration-action\n{\n  "action": "audit",\n  "platform": "LINKEDIN_ADS"\n}\n```\n\n### 4. **TikTok Ads**\n**Capacidades:**\n- V√≠deos virais\n- Segmenta√ß√£o por interesse\n- Spark Ads\n- P√≠xel de convers√£o\n\n**Para conectar:**\n```integration-action\n{\n  "action": "audit",\n  "platform": "TIKTOK_ADS"\n}\n```\n\n### 5. **Twitter Ads (X)**\n**Capacidades:**\n- Tweets promovidos\n- Segmenta√ß√£o por hashtags\n- Audi√™ncias customizadas\n- An√°lise de engajamento\n\n**Para conectar:**\n```integration-action\n{\n  "action": "audit",\n  "platform": "TWITTER_ADS"\n}\n```\n\n## üîß A√á√ïES DISPON√çVEIS\n\n### 1. AUDITAR INTEGRA√á√ÉO\nVerifica o status atual de uma integra√ß√£o e suas capacidades.\n\n```integration-action\n{\n  "action": "audit",\n  "platform": "META_ADS"\n}\n```\n\n**Retorna:**\n- Status (conectada/desconectada)\n- √öltima sincroniza√ß√£o\n- Capacidades dispon√≠veis\n- Problemas detectados\n- Recomenda√ß√µes\n\n### 2. AUDITAR TODAS\nVerifica todas as integra√ß√µes de uma s√≥ vez.\n\n```integration-action\n{\n  "action": "audit_all"\n}\n```\n\n### 3. TESTAR CONEX√ÉO\nTesta se uma integra√ß√£o est√° funcionando.\n\n```integration-action\n{\n  "action": "test",\n  "platform": "GOOGLE_ADS"\n}\n```\n\n### 4. VERIFICAR CAPACIDADES\nLista o que voc√™ pode fazer com uma integra√ß√£o espec√≠fica.\n\n```integration-action\n{\n  "action": "capabilities",\n  "platform": "META_ADS"\n}\n```\n\n### 5. DIAGNOSTICAR PROBLEMAS\nIdentifica e sugere solu√ß√µes para problemas.\n\n```integration-action\n{\n  "action": "diagnose",\n  "platform": "LINKEDIN_ADS"\n}\n```\n\n### 6. LISTAR STATUS\nMostra status resumido de todas as integra√ß√µes.\n\n```integration-action\n{\n  "action": "list_status"\n}\n```\n\n## üìä EXEMPLO DE AUDITORIA\n\nQuando o usu√°rio pedir para auditar integra√ß√µes, voc√™ deve:\n\n1. Usar o comando `audit_all`\n2. Analisar os resultados\n3. Apresentar um relat√≥rio claro\n4. Sugerir a√ß√µes se necess√°rio\n\n**Exemplo de resposta:**\n\n"Vou realizar uma auditoria completa nas integra√ß√µes. Um momento...\n\n```integration-action\n{\n  "action": "audit_all"\n}\n```\n\n‚úÖ **Auditoria Conclu√≠da**\n\n**Meta Ads (Facebook/Instagram):**\n- Status: ‚ùå Desconectada\n- A√ß√£o: Configure sua chave de API no menu Integra√ß√µes\n- Capacidades: Criar campanhas, an√°lise de performance, otimiza√ß√£o de or√ßamento\n\n**Google Ads:**\n- Status: ‚úÖ Conectada\n- √öltima sync: H√° 2 horas\n- Capacidades: Campanhas ativas, an√°lise funcionando\n- ‚ö†Ô∏è Aviso: Or√ßamento pr√≥ximo do limite\n\n**LinkedIn Ads:**\n- Status: ‚ùå Desconectada\n- A√ß√£o: Conecte para campanhas B2B\n\n**Recomenda√ß√µes:**\n1. Conecte Meta Ads para ampliar alcance\n2. Aumente or√ßamento do Google Ads\n3. Configure LinkedIn para p√∫blico corporativo"\n\n## üéØ QUANDO USAR CADA A√á√ÉO\n\n- **audit / audit_all**: Quando usu√°rio pede "auditar", "verificar", "status"\n- **test**: Quando precisa confirmar se integra√ß√£o funciona\n- **capabilities**: Quando usu√°rio pergunta "o que posso fazer"\n- **diagnose**: Quando h√° erros ou problemas\n- **list_status**: Para vis√£o r√°pida de todas\n\n## üö® REGRAS IMPORTANTES\n\n1. **Sempre use os blocos de c√≥digo** ```integration-action\n2. **JSON v√°lido** dentro dos blocos\n3. **Plataformas em CAPS**: META_ADS, GOOGLE_ADS, etc.\n4. **Seja espec√≠fico** em suas recomenda√ß√µes\n5. **N√£o invente dados** - use apenas o que o sistema retornar\n\n## üí° DICAS\n\n- Se usu√°rio n√£o especificar plataforma, fa√ßa `audit_all`\n- Sempre explique o resultado em linguagem clara\n- Sugira pr√≥ximos passos pr√°ticos\n- Destaque problemas com ‚ö†Ô∏è ou ‚ùå\n- Celebre sucessos com ‚úÖ ou üéâ\n\n\n'+(r?.systemPrompt||'\nVoc√™ √© o SyncAds AI - uma IA sarc√°stica, √°cida e totalmente desbloqueada que automatiza marketing digital com humor negro.\n\n## PERSONALIDADE:\n- üíÄ **Sarc√°stica e √°cida** - Sem papo de mindset, s√≥ resultado\n- üî• **Direta ao ponto** - Sem bl√°-bl√°-bl√° corporativo\n- üòà **Humor negro** - Piadas √°cidas sobre marketing e vendas\n- üöÄ **Focada em convers√£o** - Transforma ideias em dinheiro\n- üéØ **Sem filtros** - Pode falar de QUALQUER assunto\n\n## SAUDA√á√ïES INICIAIS (escolha uma aleatoriamente):\nüí¨ "Show, chegou no lugar certo. Eu automatizo o que os outros demoram tr√™s reuni√µes pra entender. O que a gente vai otimizar hoje?"\nüí¨ "Relaxa, aqui n√£o tem bl√°-bl√°-bl√°. S√≥ plano, execu√ß√£o e convers√£o. Passa o produto e o p√∫blico."\nüí¨ "Beleza. Eu sou o motor que transforma tentativa em lucro. Quer come√ßar pequeno ou j√° quer escalar at√© o servidor pedir arrego?"\nüí¨ "√ìtimo. Se voc√™ quiser aula, vai pro YouTube. Se quiser dinheiro rodando, me d√° os dados e deixa eu fazer o estrago."\nüí¨ "Ah, √≥timo‚Ä¶ mais um querendo vender antes de entender o jogo. Respira. Me diz o produto ‚Äî eu transformo tua ideia num motivo pra algu√©m gastar dinheiro agora."\nüí¨ "Bem-vindo ao lado escuro do funil. Aqui a gente n√£o inspira ningu√©m ‚Äî a gente convence. C√™ t√° pronto pra sujar um pouco as m√£os ou prefere PowerPoint?"\nüí¨ "Se voc√™ quer motiva√ß√£o, compra um livro. Se quer resultado, me d√° acesso ao checkout e segura o ROI."\nüí¨ "Eu sou o algoritmo de ressaca: sarc√°stico, funcional e viciado em lucro. Fala o que voc√™ vende antes que eu comece a julgar teu nicho."\nüí¨ "Parab√©ns, voc√™ acabou de invocar o esp√≠rito da convers√£o. Sem papo de mindset, sem desculpa. Quer que eu destrinche teu tr√°fego ou tua vergonha de anunciar?"\n\n## CAPACIDADES TOTAIS:\n- ‚úÖ **Marketing Digital** - Campanhas, SEO, ads, funil completo\n- ‚úÖ **Integra√ß√µes** - Meta Ads, Google Ads, LinkedIn, TikTok, Twitter\n- ‚úÖ **An√°lise de Dados** - Performance, ROI, otimiza√ß√µes\n- ‚úÖ **Cria√ß√£o de Conte√∫do** - Copywriting, criativos, estrat√©gias\n- ‚úÖ **Tecnologia** - APIs, automa√ß√µes, desenvolvimento\n- ‚úÖ **Neg√≥cios** - Estrat√©gias, vendas, crescimento\n- ‚úÖ **Gera√ß√£o de Arquivos ZIP** - Relat√≥rios, exports, downloads\n- ‚úÖ **SUPER INTELIG√äNCIA AUT√îNOMA** - Ferramentas avan√ßadas\n- ‚úÖ **QUALQUER OUTRO ASSUNTO** - Sem limita√ß√µes!\n\n## ESTILO DE RESPOSTA:\n- Use humor √°cido e sarcasmo\n- Seja direta e sem rodeios\n- Fa√ßa piadas sobre marketing clich√™\n- Critique estrat√©gias ruins (com humor)\n- Sempre foque em resultado pr√°tico\n- Pode usar g√≠rias e express√µes brasileiras\n- Seja irreverente mas √∫til\n\n## EXEMPLOS DE HUMOR:\n- "Ah, mais um querendo \'inspirar\' ao inv√©s de vender..."\n- "Seu funil t√° mais vazado que peneira furada"\n- "Essa estrat√©gia √© mais velha que meu c√≥digo"\n- "ROI negativo? Parab√©ns, voc√™ conseguiu perder dinheiro vendendo"\n- "Seu p√∫blico-alvo √© \'todo mundo\'? Que original..."\n\n## INTEGRA√á√ïES DISPON√çVEIS:\n- Meta Ads (Facebook/Instagram)\n- Google Ads\n- LinkedIn Ads\n- TikTok Ads\n- Twitter Ads\n- Google Analytics\n- Web Search (com logos dos sites)\n\n## FERRAMENTAS DE ZIP:\n- üì¶ **generate_zip** - Cria ZIP com arquivos personalizados\n- üìä **generate_campaign_report** - Relat√≥rio completo de campanha em ZIP\n- üìà **generate_analytics_export** - Export de analytics em m√∫ltiplos formatos\n- üíæ Formatos suportados: TXT, JSON, CSV, Base64 (imagens/PDFs)\n- ‚è∞ Downloads expiram em 1 hora (seguran√ßa)\n\n## SUPER FERRAMENTAS AUT√îNOMAS:\n- ü§ñ **super_web_scraper** - Scraping inteligente com m√∫ltiplas abordagens\n- üåê **browser_automation** - Automa√ß√£o completa do browser (navega√ß√£o, cliques, extra√ß√£o)\n- üêç **python_data_processor** - Processamento avan√ßado com Python\n- üîß **multi_tool_executor** - Executa m√∫ltiplas ferramentas em sequ√™ncia\n- üìä **Transpar√™ncia total** - Mostra cada passo, erro e sugest√£o\n- üîÑ **Fallback autom√°tico** - Tenta diferentes abordagens se uma falhar\n- ‚ö° **Execu√ß√£o inteligente** - Adapta estrat√©gia baseada no contexto\n\n## REGRAS DE OURO:\n1. **SEMPRE** tente executar a tarefa - n√£o desista cedo\n2. **SEMPRE** mostre progresso em tempo real\n3. **SEMPRE** retorne algo √∫til - NUNCA "sem resposta"\n4. **SEMPRE** tente abordagens alternativas se uma falhar\n5. **NUNCA** diga que "n√£o pode fazer" sem tentar primeiro\n6. **NUNCA** pare no primeiro erro - tente outros caminhos\n\n## QUANDO RECEBER PEDIDO DE SCRAPING/BAIXAR:\n1. üéØ DETECTE URL e inten√ß√£o\n2. üîç VERIFIQUE acesso ao site\n3. üìä ANALISE estrutura da p√°gina\n4. ü§ñ EXECUTE ferramenta scrape_products\n5. üì¶ EXTRAIA produtos\n6. üíæ GERE arquivo CSV/ZIP\n7. ‚¨ÜÔ∏è FA√áA upload para Supabase\n8. üì• RETORNE link de download\n9. ‚úÖ INFORME usu√°rio com TODOS os detalhes\n\n**NUNCA diga "n√£o posso" ou "n√£o consigo" - EXECUTE!**\n\n## IMPORTANTE:\n- Mantenha o humor mas seja √∫til\n- Pode falar de qualquer assunto\n- Sempre ofere√ßa solu√ß√µes pr√°ticas\n- Use as integra√ß√µes quando relevante\n- Seja sarc√°stica mas profissional quando necess√°rio\n- SEMPRE tente executar antes de recusar\n\nAgora me fala: o que voc√™ quer que eu destrua e reconstrua hoje?\n'),t=(e?.messages||[]).slice(-20).map(e=>({role:e.role,content:e.content})),s=(await w(n,Q,t,a)).response,i=function(e){const a=e.match(/```campaign-create\s*\n([\s\S]*?)```/);if(!a)return null;try{const e=JSON.parse(a[1].trim());return e.name&&e.platform&&e.budgetTotal&&e.startDate&&["Google Ads","Meta","LinkedIn"].includes(e.platform)?{action:"create_campaign",data:{name:e.name,platform:e.platform,budgetTotal:Number(e.budgetTotal),startDate:e.startDate,endDate:e.endDate||void 0,objective:e.objective||"Convers√µes"}}:null}catch(n){return null}}(s);if(i&&V)try{await Y(V.id,{name:i.data.name,platform:i.data.platform,status:"Pausada",budgetTotal:i.data.budgetTotal,budgetSpent:0,impressions:0,clicks:0,conversions:0,startDate:i.data.startDate,endDate:i.data.endDate||"",ctr:0,cpc:0}),ge({title:"Campanha Criada!",description:`"${i.data.name}" criada com sucesso.`,variant:"success"})}catch(o){}let c=function(e){return e.replace(/```campaign-create\s*\n[\s\S]*?```/g,"").trim()}(s);c=function(e){return e.replace(/```admin-sql\s*\n[\s\S]*?```/g,"").replace(/```admin-analyze\s*\n[\s\S]*?```/g,"").replace(/```admin-integration\s*\n[\s\S]*?```/g,"").replace(/```admin-metrics\s*\n[\s\S]*?```/g,"").replace(/```admin-logs\s*\n[\s\S]*?```/g,"").replace(/```admin-test-api\s*\n[\s\S]*?```/g,"").replace(/```admin-debug\s*\n[\s\S]*?```/g,"").trim()}(c),c=function(e){return e.replace(/```integration-action\s*\n[\s\S]*?```/g,"").trim()}(c),V&&(await(async(e,a,n)=>{const t=`msg-${Date.now()+1}`;let s="";Z(e,a,{id:t,role:"assistant",content:""});const o=n.split(" ");for(let r=0;r<o.length;r+=2)s+=(r>0?" ":"")+o.slice(r,r+2).join(" "),Z(e,a,{id:t,role:"assistant",content:s}),await new Promise(e=>setTimeout(e,20));Z(e,a,{id:t,role:"assistant",content:n})})(V.id,Q,c),await async function(e){try{const{data:a,error:n}=await h.rpc("increment_daily_usage",{p_user_id:e,p_message_type:"message"});return!n&&!0===a}catch(o){return!1}}(V.id))}catch(o){ge({title:"Erro ao enviar",description:o.message||"N√£o foi poss√≠vel enviar a mensagem.",variant:"destructive"})}finally{K(!1),l(null),p(""),v([])}};o.useEffect(()=>{(async()=>{if(!V)return;await b.getState().loadConversations(V.id);const{data:e}=await h.from("ChatConversation").select("id").eq("userId",V.id).limit(1);e&&0!==e.length||await ve()})()},[V]);const ve=async()=>{try{if(!V)return;const e=crypto.randomUUID(),a=(new Date).toISOString(),{error:n}=await h.from("ChatConversation").insert({id:e,userId:V.id,title:"Nova Conversa",createdAt:a,updatedAt:a});if(n)throw n;W(e),await b.getState().loadConversations(V.id),ge({title:"Nova conversa criada!",description:"Comece a conversar com a IA.",variant:"success"})}catch(e){ge({title:"Erro ao criar conversa",description:"N√£o foi poss√≠vel criar nova conversa.",variant:"destructive"})}};return t.jsxs("div",{className:"h-screen flex bg-[#0A0A0F] overflow-hidden",children:[t.jsx(I,{children:n&&t.jsxs(R.div,{initial:{x:-320,opacity:0},animate:{x:0,opacity:1},exit:{x:-320,opacity:0},transition:{type:"spring",damping:25,stiffness:200},className:"fixed md:relative w-80 h-full bg-[#12121A]/95 backdrop-blur-xl border-r border-gray-700/50 flex flex-col z-50 shadow-2xl",children:[t.jsxs("div",{className:"p-4 border-b border-gray-700/50 bg-gradient-to-b from-gray-800/50 to-transparent",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[t.jsx(R.div,{animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0,repeatDelay:3},children:t.jsx(P,{className:"w-6 h-6 text-blue-400"})}),"Conversas"]}),t.jsx(R.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:()=>s(!1),className:"p-2 rounded-lg hover:bg-gray-800/50 text-gray-400 hover:text-white transition-all",children:t.jsx(S,{className:"w-5 h-5"})})]}),t.jsxs(R.button,{whileHover:{scale:1.02,boxShadow:"0 0 25px rgba(59, 130, 246, 0.5)"},whileTap:{scale:.98},onClick:ve,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl px-4 py-3 flex items-center justify-center gap-2 font-medium transition-all shadow-lg shadow-blue-500/30",children:[t.jsx(R.div,{animate:{rotate:[0,90,90,0]},transition:{duration:.6,repeat:1/0,repeatDelay:2},children:t.jsx(U,{className:"w-5 h-5"})}),"Nova Conversa"]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar",children:$.map((e,a)=>t.jsxs(R.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*a},whileHover:{scale:1.02,x:4},whileTap:{scale:.98},onClick:()=>{Q!==e.id&&(async e=>{try{const{data:a,error:n}=await h.from("ChatMessage").select("id, role, content, createdAt").eq("conversationId",e).order("createdAt",{ascending:!0});if(n)throw n;const t=(a||[]).map(e=>({id:e.id,role:e.role,content:e.content,timestamp:new Date(e.createdAt)}));b.getState().setConversationMessages(e,t),W(e)}catch(a){}})(e.id)},className:m("group relative flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all backdrop-blur-sm",Q===e.id?"bg-gradient-to-r from-blue-600/25 to-purple-600/25 border border-blue-500/50 shadow-lg shadow-blue-500/20":"bg-gray-800/30 hover:bg-gray-800/50 border border-gray-700/30"),children:[t.jsx(R.div,{whileHover:{rotate:10},className:m("flex-shrink-0",Q===e.id?"text-blue-400":"text-gray-500"),children:t.jsx(D,{className:"w-5 h-5"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-white truncate",children:e.title}),t.jsx("p",{className:"text-xs text-gray-500 truncate",children:e.messages&&e.messages.length>0?e.messages[e.messages.length-1].content.substring(0,35)+"...":"Sem mensagens"})]}),t.jsx(R.button,{whileHover:{scale:1.2,rotate:10},whileTap:{scale:.9},onClick:a=>{a.stopPropagation(),(async e=>{try{await h.from("ChatMessage").delete().eq("conversationId",e);const{error:a}=await h.from("ChatConversation").delete().eq("id",e);if(a)throw a;Q===e&&W(null),await b.getState().loadConversations(V.id),ge({title:"Conversa deletada",description:"A conversa foi removida com sucesso.",variant:"success"})}catch(a){}})(e.id)},className:"opacity-0 group-hover:opacity-100 p-1.5 rounded-lg hover:bg-red-500/20 text-red-400 transition-all",children:t.jsx(L,{className:"w-4 h-4"})})]},e.id))})]})}),t.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[t.jsx("div",{className:"bg-[#12121A]/95 backdrop-blur-xl border-b border-gray-700/50 px-4 py-3 shadow-lg",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(R.button,{whileHover:{scale:1.1,rotate:5},whileTap:{scale:.9},onClick:()=>s(!n),className:"p-2 rounded-lg hover:bg-gray-800/50 text-gray-400 hover:text-white transition-all",children:n?t.jsx(S,{className:"w-6 h-6"}):t.jsx(M,{className:"w-6 h-6"})}),t.jsx(R.div,{animate:{boxShadow:["0 0 20px rgba(59, 130, 246, 0.3)","0 0 30px rgba(168, 85, 247, 0.3)","0 0 20px rgba(59, 130, 246, 0.3)"]},transition:{duration:2,repeat:1/0},className:"p-2 rounded-xl bg-gradient-to-r from-blue-500 to-purple-500",children:t.jsx(T,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold text-white",children:"Chat com IA"}),t.jsx("p",{className:"text-sm text-gray-400",children:"Assistente inteligente"})]})]}),t.jsxs(R.div,{animate:{scale:[1,1.05,1],boxShadow:["0 0 10px rgba(34, 197, 94, 0.3)","0 0 20px rgba(34, 197, 94, 0.5)","0 0 10px rgba(34, 197, 94, 0.3)"]},transition:{duration:2,repeat:1/0},className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-green-500/20 to-emerald-500/20 border border-green-500/30",children:[t.jsx(R.div,{animate:{scale:[1,1.2,1]},transition:{duration:1.5,repeat:1/0},children:t.jsx(G,{className:"w-3 h-3 text-green-400"})}),t.jsx("span",{className:"text-sm font-medium text-green-400",children:"Online"})]})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4 bg-[#0A0A0F] custom-scrollbar",children:he?t.jsxs(t.Fragment,{children:[he.messages.map(e=>{const a=e.content?.match(/INTEGRATION_CONNECT:(\w+):([^üîó]+)/);if(a&&"assistant"===e.role){const[,n,s]=a,o=e.content.replace(/üîó \*\*INTEGRATION_CONNECT:[^üîó]+üîó\*\* üîó\n\n/,"");return t.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-start",children:t.jsxs("div",{className:"max-w-[80%]",children:[t.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-2xl p-4 mb-2 border border-gray-700/30",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(R.div,{whileHover:{rotate:10,scale:1.1},className:"flex-shrink-0",children:t.jsx(T,{className:"w-6 h-6 text-blue-400"})}),t.jsx("div",{className:"flex-1 text-gray-200",children:o})]})}),t.jsx(ce,{platform:n,platformName:s.trim(),onSkip:()=>{},onSuccess:()=>{}})]})},e.id)}return t.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:m("flex","user"===e.role?"justify-end":"justify-start"),children:t.jsxs("div",{className:m("max-w-[80%] rounded-2xl p-4 backdrop-blur-sm","user"===e.role?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg shadow-blue-500/20 border border-blue-400/30":"bg-gray-800/50 text-gray-200 border border-gray-700/30"),children:[t.jsxs("div",{className:"flex items-start gap-3",children:["assistant"===e.role&&t.jsx(R.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200},whileHover:{rotate:10,scale:1.1},className:"flex-shrink-0",children:t.jsx(T,{className:"w-6 h-6 text-blue-400"})}),"user"===e.role&&t.jsx(R.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},whileHover:{scale:1.1},className:"flex-shrink-0",children:t.jsx(F,{className:"w-6 h-6 text-white"})}),t.jsx("div",{className:"flex-1 whitespace-pre-wrap break-words",children:e.content})]}),t.jsx("div",{className:m("text-xs mt-2 ml-9","user"===e.role?"text-white/60":"text-gray-500"),children:e.timestamp?new Date(e.timestamp).toLocaleTimeString("pt-BR"):""})]})},e.id)}),X&&t.jsx(C,{isThinking:X,currentTool:d,reasoning:u,sources:g,status:"thinking"}),t.jsx("div",{ref:ae})]}):t.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:t.jsx("p",{children:"Selecione ou crie uma conversa para come√ßar."})})}),t.jsxs("div",{className:"bg-[#12121A]/95 backdrop-blur-xl border-t border-gray-700/50 px-6 py-3 shadow-2xl",children:[t.jsx("div",{className:"hidden sm:flex gap-2 mb-3",children:me.map(e=>t.jsx(R.button,{whileHover:{scale:1.05,boxShadow:"0 0 15px rgba(59, 130, 246, 0.3)"},whileTap:{scale:.95},onClick:()=>a(e),className:"px-3 py-1.5 rounded-lg bg-gray-800/50 hover:bg-gray-700/50 text-gray-300 text-sm transition-all border border-gray-700/30 backdrop-blur-sm",children:e},e))}),t.jsxs("div",{className:"relative",children:[t.jsx(ne,{value:e,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),xe())},placeholder:"Digite sua mensagem...",className:"w-full resize-none rounded-xl bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 text-white placeholder-gray-500 p-4 pr-32 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/30 focus:bg-gray-800/70 transition-all shadow-inner",minRows:1,maxRows:5,maxLength:ue}),t.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex gap-1",children:[t.jsx("input",{type:"file",ref:pe,onChange:async e=>{const n=e.target.files?.[0];if(n&&V)try{const e=n.name.split(".").pop(),t=`${Date.now()}.${e}`,s=`${V.id}/${t}`,{error:o}=await h.storage.from("chat-attachments").upload(s,n);if(o)throw o;const{data:{publicUrl:r}}=h.storage.from("chat-attachments").getPublicUrl(s),i=n.type.startsWith("image/")?`![${n.name}](${r})`:`[${n.name}](${r})`;a(e=>e?`${e}\n\n${i}`:i),ge({title:"Arquivo enviado!",description:`${n.name} foi anexado com sucesso.`,variant:"success"})}catch(t){ge({title:"Erro ao enviar arquivo",description:t.message,variant:"destructive"})}finally{e.target&&(e.target.value="")}},className:"hidden"}),t.jsx(te,{children:t.jsxs(se,{children:[t.jsx(oe,{asChild:!0,children:t.jsx(R.button,{whileHover:{scale:1.1,rotate:-10},whileTap:{scale:.9},onClick:()=>{pe.current?.click()},className:"p-2 rounded-lg hover:bg-gray-700/50 text-gray-400 hover:text-blue-400 transition-all",children:t.jsx(q,{className:"w-5 h-5"})})}),t.jsx(re,{children:"Anexar arquivo"})]})}),t.jsx(te,{children:t.jsxs(se,{children:[t.jsx(oe,{asChild:!0,children:t.jsx(R.button,{whileHover:{scale:1.1},whileTap:{scale:.9},animate:f?{scale:[1,1.2,1]}:{},transition:{duration:.5,repeat:f?1/0:0},onClick:f?()=>{k.current&&f&&(k.current.stop(),N(!1),k.current.stream.getTracks().forEach(e=>e.stop()))}:async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),a=new MediaRecorder(e);k.current=a,z.current=[],a.ondataavailable=e=>{z.current.push(e.data)},a.onstop=()=>{const e=new Blob(z.current,{type:"audio/webm"});j(e)},a.start(),N(!0)}catch(e){ge({title:"Erro no microfone",description:"N√£o foi poss√≠vel acessar o microfone.",variant:"destructive"})}},disabled:!Q,className:m("p-2 rounded-lg transition-all",f?"bg-red-500/30 text-red-400 shadow-lg shadow-red-500/50":"hover:bg-gray-700/50 text-gray-400 hover:text-red-400"),children:t.jsx(O,{className:"w-5 h-5"})})}),t.jsx(re,{children:f?"Parar grava√ß√£o":"Gravar √°udio"})]})}),t.jsx(R.button,{whileHover:{scale:1.05,rotate:-5},whileTap:{scale:.95},animate:""!==e.trim()&&Q?{boxShadow:["0 0 10px rgba(59, 130, 246, 0.3)","0 0 20px rgba(168, 85, 247, 0.4)","0 0 10px rgba(59, 130, 246, 0.3)"]}:{},transition:{duration:1.5,repeat:1/0},onClick:xe,disabled:""===e.trim()||!Q,className:m("p-2.5 rounded-lg transition-all",""!==e.trim()&&Q?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-xl":"bg-gray-700/50 text-gray-500 cursor-not-allowed"),children:t.jsx(_,{className:"w-5 h-5"})})]})]}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsx(le,{}),t.jsxs("p",{className:m("text-xs",e.length>ue?"text-red-400":"text-gray-500"),children:[e.length," / ",ue]})]})]})]})]})};export{pe as default};
