import{s}from"./index-BW39Rbqj.js";const e={async getShopifyIntegration(e){try{const{data:r,error:o}=await s.from("ShopifyIntegration").select("*").eq("userId",e).eq("isActive",!0).single();return o?null:r}catch(r){return null}},async syncProducts(e,r){try{const r=await this.getShopifyIntegration(e);if(!r)return{success:!1,message:"Integração Shopify não encontrada. Configure a integração em Integrações primeiro.",synced:0,errors:1};const{data:o,error:n}=await s.functions.invoke("shopify-sync",{body:{integrationId:r.id,action:"sync-products",limit:250}});if(n)return{success:!1,message:`Erro ao sincronizar: ${n.message}`,synced:0,errors:1};const c=o?.results?.products||{};return c.success?{success:!0,message:`${c.synced||0} produtos sincronizados com sucesso!`,synced:c.synced||0,errors:0}:{success:!1,message:c.error||"Erro ao sincronizar produtos",synced:0,errors:1}}catch(o){return{success:!1,message:o.message||"Erro desconhecido ao sincronizar produtos",synced:0,errors:1}}},async syncOrders(e,r){try{const r=await this.getShopifyIntegration(e);if(!r)return{success:!1,message:"Integração Shopify não encontrada. Configure a integração em Integrações primeiro.",synced:0,errors:1};const{data:o,error:n}=await s.functions.invoke("shopify-sync",{body:{integrationId:r.id,action:"sync-orders",limit:250}});if(n)return{success:!1,message:`Erro ao sincronizar: ${n.message}`,synced:0,errors:1};const c=o?.results?.orders||{};return c.success?{success:!0,message:`${c.synced||0} pedidos sincronizados com sucesso!`,synced:c.synced||0,errors:0}:{success:!1,message:c.error||"Erro ao sincronizar pedidos",synced:0,errors:1}}catch(o){return{success:!1,message:o.message||"Erro desconhecido ao sincronizar pedidos",synced:0,errors:1}}},async syncCustomers(e){try{const r=await this.getShopifyIntegration(e);if(!r)return{success:!1,message:"Integração Shopify não encontrada. Configure a integração em Integrações primeiro.",synced:0,errors:1};const{data:o,error:n}=await s.functions.invoke("shopify-sync",{body:{integrationId:r.id,action:"sync-customers",limit:250}});if(n)return{success:!1,message:`Erro ao sincronizar: ${n.message}`,synced:0,errors:1};const c=o?.results?.customers||{};return c.success?{success:!0,message:`${c.synced||0} clientes sincronizados com sucesso!`,synced:c.synced||0,errors:0}:{success:!1,message:c.error||"Erro ao sincronizar clientes",synced:0,errors:1}}catch(r){return{success:!1,message:r.message||"Erro desconhecido ao sincronizar clientes",synced:0,errors:1}}},async syncAbandonedCarts(e){try{const r=await this.getShopifyIntegration(e);if(!r)return{success:!1,message:"Integração Shopify não encontrada. Configure a integração em Integrações primeiro.",synced:0,errors:1};const{data:o,error:n}=await s.functions.invoke("shopify-sync",{body:{integrationId:r.id,action:"sync-carts",limit:250}});if(n)return{success:!1,message:`Erro ao sincronizar: ${n.message}`,synced:0,errors:1};const c=o?.results?.abandonedCarts||{};return c.success?{success:!0,message:`${c.synced||0} carrinhos abandonados sincronizados com sucesso!`,synced:c.synced||0,errors:0}:{success:!1,message:c.error||"Erro ao sincronizar carrinhos abandonados",synced:0,errors:1}}catch(r){return{success:!1,message:r.message||"Erro desconhecido ao sincronizar carrinhos",synced:0,errors:1}}},async syncDiscounts(e){try{const r=await this.getShopifyIntegration(e);if(!r)return{success:!1,message:"Integração Shopify não encontrada. Configure a integração em Integrações primeiro.",synced:0,errors:1};const{data:o,error:n}=await s.functions.invoke("shopify-sync",{body:{integrationId:r.id,action:"sync-discounts",limit:250}});if(n)return{success:!1,message:`Erro ao sincronizar: ${n.message}`,synced:0,errors:1};const c=o?.results?.discounts||{};return c.success?{success:!0,message:`${c.synced||0} descontos sincronizados com sucesso!`,synced:c.synced||0,errors:0}:{success:!1,message:c.error||"Erro ao sincronizar descontos",synced:0,errors:1}}catch(r){return{success:!1,message:r.message||"Erro desconhecido ao sincronizar descontos",synced:0,errors:1}}},async syncAll(e){try{const r=await this.getShopifyIntegration(e);if(!r)return{success:!1,message:"Integração Shopify não encontrada. Configure a integração em Integrações primeiro.",synced:0,errors:1};const{data:o,error:n}=await s.functions.invoke("shopify-sync",{body:{integrationId:r.id,action:"sync-all",limit:250}});if(n)return{success:!1,message:`Erro ao sincronizar: ${n.message}`,synced:0,errors:1};const c=o?.results||{},t=(c.products?.synced||0)+(c.orders?.synced||0)+(c.customers?.synced||0)+(c.abandonedCarts?.synced||0)+(c.discounts?.synced||0);c.products?.success&&c.orders?.success&&c.customers?.success&&c.abandonedCarts?.success&&c.discounts;return o?.success?{success:!0,message:`Sincronização completa! ${t} itens sincronizados.`,synced:t,errors:0,details:c}:{success:!1,message:"Sincronização completada com erros",synced:t,errors:1,details:c}}catch(r){return{success:!1,message:r.message||"Erro desconhecido ao sincronizar",synced:0,errors:1}}},async getSyncStats(e){try{const{data:r,count:o}=await s.from("ShopifyProduct").select("*",{count:"exact"}).eq("userId",e),{data:n,count:c}=await s.from("ShopifyOrder").select("*",{count:"exact"}).eq("userId",e),{data:t,count:a}=await s.from("ShopifyCustomer").select("*",{count:"exact"}).eq("userId",e),{data:i,count:d}=await s.from("ShopifyAbandonedCart").select("*",{count:"exact"}).eq("userId",e),{count:u}=await s.from("ShopifyDiscountCode").select("*",{count:"exact"}).eq("userId",e),{data:y}=await s.from("ShopifyIntegration").select("lastSyncAt, lastSyncStatus").eq("userId",e).single();return{totalProducts:o||0,totalOrders:c||0,totalCustomers:a||0,totalAbandonedCarts:d||0,totalDiscounts:u||0,lastSync:y?.lastSyncAt||null,lastSyncStatus:y?.lastSyncStatus||null}}catch(r){return{totalProducts:0,totalOrders:0,totalCustomers:0,totalAbandonedCarts:0,totalDiscounts:0,lastSync:null,lastSyncStatus:null}}},async getSyncLogs(e,r=10){try{const{data:o,error:n}=await s.from("ShopifySyncLog").select("*").eq("userId",e).order("createdAt",{ascending:!1}).limit(r);if(n)throw n;return o||[]}catch(o){return[]}}},r=e;export{e as a,r as s};
