import{D as de,F as ce,g as n,J as S,j as e,k as o,H as A,C as F,l as M,o as D,t as E,x as P,q as I,B as d,I as v}from"./index-qiFCddzp.js";import{L as N}from"./label-CD9iOjXz.js";import{D as B,b as Y,c as $,d as R,e as q}from"./dialog-DGiNKBGT.js";import{C as z}from"./crown-EORrVspV.js";import{S as me}from"./shield-Bilpbqyo.js";import{P as H}from"./plus-DPFj_Naz.js";import{C as y}from"./check-CpciLbWX.js";import{A as xe}from"./arrow-right-CVhZTrJd.js";import{C as G}from"./credit-card-B0Cc5V2A.js";import{L as pe}from"./lock-DkY293MX.js";import{C as he}from"./circle-alert-DT5KRBw7.js";import{S as Z}from"./sparkles-JyRQxeTP.js";import{B as ge}from"./building-2-BNschL8y.js";import{Z as ue}from"./zap-C8gZj2gq.js";const De=()=>{const t=de(a=>a.user),{toast:l}=ce(),[J,L]=n.useState(!0),[K,Q]=n.useState([]),[i,W]=n.useState(null),[b,X]=n.useState([]),[_,c]=n.useState(!1),[ee,w]=n.useState(!1),[r,V]=n.useState(null),[m,k]=n.useState(!1),[s,x]=n.useState({cardNumber:"",cardName:"",expiryMonth:"",expiryYear:"",cvv:""});n.useEffect(()=>{O()},[t==null?void 0:t.id]);const O=async()=>{try{L(!0),await Promise.all([ae(),re(),T()])}catch(a){console.error("Error loading billing data:",a),l({title:"Erro ao carregar dados",description:"Não foi possível carregar as informações de faturamento.",variant:"destructive"})}finally{L(!1)}},ae=async()=>{const{data:a,error:p}=await S.from("PricingPlan").select("*").eq("active",!0).order("sortOrder");!p&&a&&Q(a)},re=async()=>{if(!(t!=null&&t.id))return;const{data:a,error:p}=await S.from("User").select(`
        *,
        plan:planId (*)
      `).eq("id",t.id).single();!p&&(a!=null&&a.plan)&&W({id:"current",planId:a.planId,status:"active",currentPeriodStart:new Date().toISOString(),currentPeriodEnd:new Date(Date.now()+30*24*60*60*1e3).toISOString(),plan:a.plan})},T=async()=>{t!=null&&t.id&&X([])},se=async()=>{try{if(k(!0),!s.cardNumber||!s.cardName||!s.expiryMonth||!s.expiryYear||!s.cvv){l({title:"Campos obrigatórios",description:"Preencha todos os campos do cartão.",variant:"destructive"});return}await new Promise(a=>setTimeout(a,2e3)),l({title:"Cartão adicionado com sucesso!",description:"Uma cobrança de R$ 1,00 foi feita para verificação e será estornada em breve."}),c(!1),x({cardNumber:"",cardName:"",expiryMonth:"",expiryYear:"",cvv:""}),T()}catch(a){console.error("Error adding card:",a),l({title:"Erro ao adicionar cartão",description:"Não foi possível adicionar o cartão. Tente novamente.",variant:"destructive"})}finally{k(!1)}},te=async a=>{if(V(a),b.length===0&&a.slug!=="free"){l({title:"Adicione um cartão",description:"Você precisa adicionar um método de pagamento antes de fazer upgrade."}),c(!0);return}w(!0)},ie=async()=>{if(r)try{k(!0);const{error:a}=await S.from("User").update({planId:r.id}).eq("id",t.id);if(a)throw a;l({title:"Plano atualizado!",description:`Você agora está no plano ${r.name}. ${r.slug!=="free"?"Aproveite seus 7 dias grátis!":""}`}),w(!1),V(null),O()}catch(a){console.error("Error upgrading plan:",a),l({title:"Erro ao atualizar plano",description:"Não foi possível atualizar seu plano. Tente novamente.",variant:"destructive"})}finally{k(!1)}},C=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(parseFloat(a)),ne=a=>{const h=a.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),j=h&&h[0]||"",f=[];for(let g=0,oe=j.length;g<oe;g+=4)f.push(j.substring(g,g+4));return f.length?f.join(" "):a},U=a=>{switch(a){case"free":return Z;case"starter":return ue;case"pro":return z;case"enterprise":return ge;default:return Z}},le={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},u={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};return J?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-gray-50 via-white to-pink-50 dark:from-gray-950 dark:via-gray-900 dark:to-pink-950/20",children:e.jsx(o.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(A,{className:"h-8 w-8 text-pink-500"})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-pink-50 dark:from-gray-950 dark:via-gray-900 dark:to-pink-950/20",children:e.jsxs(o.div,{className:"p-6 sm:p-8 max-w-7xl mx-auto space-y-8",variants:le,initial:"hidden",animate:"visible",children:[e.jsxs(o.div,{variants:u,className:"space-y-2",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-pink-600 via-purple-600 to-blue-600 bg-clip-text text-transparent",children:"Faturamento"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Gerencie seu plano, métodos de pagamento e faturas"})]}),i&&e.jsx(o.div,{variants:u,children:e.jsxs(F,{className:"border-none shadow-xl bg-gradient-to-br from-white/80 to-gray-50/80 dark:from-gray-900/80 dark:to-gray-800/80 backdrop-blur-xl",children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(D,{className:"text-2xl",children:"Plano Atual"}),e.jsx(E,{children:"Seu plano e benefícios"})]}),i.plan.isPopular&&e.jsxs(P,{className:"bg-gradient-to-r from-yellow-500 to-orange-600 text-white border-none",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),"Popular"]})]})}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-pink-500 to-purple-600",children:(()=>{const a=U(i.plan.slug);return e.jsx(a,{className:"w-6 h-6 text-white"})})()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:i.plan.name}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[C(i.plan.price),"/",i.plan.interval==="month"?"mês":"ano"]})]})]}),i.plan.slug!=="free"&&e.jsx("div",{className:"p-4 rounded-lg bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-400",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-medium",children:["7 dias grátis • Taxa:"," ",i.plan.transactionFeePercentage,"%"]})]})})]})]})}),e.jsxs(o.div,{variants:u,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Planos Disponíveis"}),b.length===0&&e.jsxs(d,{onClick:()=>c(!0),className:"bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Adicionar Cartão"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:K.map(a=>{var j;const p=U(a.slug),h=(i==null?void 0:i.plan.id)===a.id;return e.jsx(o.div,{variants:u,whileHover:{y:-8,scale:1.02},className:"relative",children:e.jsxs(F,{className:`border-none shadow-xl backdrop-blur-xl h-full transition-all ${a.isPopular?"bg-gradient-to-br from-purple-500/10 to-pink-500/10 ring-2 ring-purple-500/50":"bg-white/80 dark:bg-gray-900/80"}`,children:[((j=a.metadata)==null?void 0:j.badge)&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:e.jsx(P,{className:"bg-gradient-to-r from-yellow-500 to-orange-600 text-white border-none shadow-lg",children:a.metadata.badge})}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${a.isPopular?"bg-gradient-to-br from-purple-500 to-pink-600":"bg-gradient-to-br from-gray-400 to-gray-600"}`,children:e.jsx(p,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(D,{className:"text-xl",children:a.name}),e.jsx(E,{className:"text-xs",children:a.description})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-3xl font-bold",children:C(a.price)}),a.interval!=="lifetime"&&e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["/",a.interval==="month"?"mês":"ano"]})]}),a.slug!=="free"&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Taxa: ",a.transactionFeePercentage,"% por transação"]})]})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[a.features.slice(0,5).map((f,g)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(y,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:f})]},g)),a.features.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 pl-6",children:["+",a.features.length-5," recursos"]})]}),e.jsx(d,{onClick:()=>te(a),disabled:h,className:`w-full ${a.isPopular?"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700":"bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800"} ${h?"opacity-50 cursor-not-allowed":""}`,children:h?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Plano Atual"]}):e.jsxs(e.Fragment,{children:["Selecionar Plano",e.jsx(xe,{className:"w-4 h-4 ml-2"})]})})]})]})},a.id)})})]}),b.length>0&&e.jsx(o.div,{variants:u,children:e.jsxs(F,{className:"border-none shadow-xl bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl",children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(D,{children:"Métodos de Pagamento"}),e.jsx(E,{children:"Gerencie seus cartões"})]}),e.jsxs(d,{onClick:()=>c(!0),variant:"outline",size:"sm",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Adicionar"]})]})}),e.jsx(I,{children:e.jsx("div",{className:"space-y-3",children:b.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[a.brand," •••• ",a.last4]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Expira em ",a.expiryMonth,"/",a.expiryYear]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.isDefault&&e.jsx(P,{variant:"secondary",children:"Padrão"}),a.isVerified&&e.jsxs(P,{className:"bg-green-500 text-white",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Verificado"]})]})]},a.id))})})]})}),e.jsx(B,{open:_,onOpenChange:c,children:e.jsxs(Y,{className:"sm:max-w-md",children:[e.jsxs($,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Adicionar Cartão"]}),e.jsx(q,{children:"Adicione um cartão para ativar seu plano. Faremos uma cobrança de R$ 1,00 para verificação que será estornada."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"cardNumber",children:"Número do Cartão"}),e.jsx(v,{id:"cardNumber",placeholder:"1234 5678 9012 3456",value:s.cardNumber,onChange:a=>x({...s,cardNumber:ne(a.target.value)}),maxLength:19})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"cardName",children:"Nome no Cartão"}),e.jsx(v,{id:"cardName",placeholder:"NOME COMO NO CARTÃO",value:s.cardName,onChange:a=>x({...s,cardName:a.target.value.toUpperCase()})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"expiryMonth",children:"Mês"}),e.jsx(v,{id:"expiryMonth",placeholder:"MM",value:s.expiryMonth,onChange:a=>x({...s,expiryMonth:a.target.value}),maxLength:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"expiryYear",children:"Ano"}),e.jsx(v,{id:"expiryYear",placeholder:"AA",value:s.expiryYear,onChange:a=>x({...s,expiryYear:a.target.value}),maxLength:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"cvv",children:"CVV"}),e.jsx(v,{id:"cvv",placeholder:"123",type:"password",value:s.cvv,onChange:a=>x({...s,cvv:a.target.value}),maxLength:4})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800",children:[e.jsx(pe,{className:"w-4 h-4 text-blue-600 mt-0.5"}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-400",children:"Seus dados estão protegidos com criptografia de ponta a ponta"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{variant:"outline",onClick:()=>c(!1),className:"flex-1",disabled:m,children:"Cancelar"}),e.jsx(d,{onClick:se,className:"flex-1 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700",disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2 animate-spin"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Adicionar Cartão"]})})]})]})}),e.jsx(B,{open:ee,onOpenChange:w,children:e.jsxs(Y,{className:"sm:max-w-md",children:[e.jsxs($,{children:[e.jsx(R,{children:"Confirmar Upgrade"}),e.jsxs(q,{children:["Você está prestes a mudar para o plano ",r==null?void 0:r.name]})]}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-lg border border-gray-200 dark:border-gray-700 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Plano"}),e.jsx("span",{className:"font-medium",children:r.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Valor"}),e.jsxs("span",{className:"font-medium",children:[C(r.price),"/",r.interval==="month"?"mês":"ano"]})]}),r.slug!=="free"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Taxa por transação"}),e.jsxs("span",{className:"font-medium",children:[r.transactionFeePercentage,"%"]})]}),e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"7 dias grátis inclusos"})]})})]})]}),r.slug!=="free"&&e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-800",children:[e.jsx(he,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),e.jsxs("p",{className:"text-xs text-yellow-700 dark:text-yellow-400",children:["Você não será cobrado nos próximos 7 dias. Após o período de teste, será cobrado ",C(r.price),"."]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{variant:"outline",onClick:()=>w(!1),className:"flex-1",disabled:m,children:"Cancelar"}),e.jsx(d,{onClick:ie,className:"flex-1 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700",disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2 animate-spin"}),"Processando..."]}):"Confirmar Upgrade"})]})]})})]})})};export{De as default};
