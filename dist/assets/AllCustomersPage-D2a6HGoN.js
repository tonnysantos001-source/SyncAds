import{j as e}from"./vendor-ui-D8qh2McD.js";import{r as a}from"./vendor-react-X41Bjl18.js";import{s as t,g as s,f as r,B as i,I as l,C as n,a as o,b as d,c,e as x}from"./index-ACNCpQAK.js";import{T as m,a as g,b as h,c as p,d as u,e as y}from"./table-Dx8T6TSO.js";import{a as j}from"./shopifySync-CEh51ffm.js";import{S as b}from"./skeleton-CiY9lNz1.js";import{u as f}from"./useDebounce-Cz1S1MGD.js";import{u as v}from"./vendor-query-CYpOgAEj.js";import{m as N}from"./vendor-animation-APnkykC6.js";import{R as k,N as w,b0 as C,ah as S,D as z,S as T,r as A,P as I,w as $,aQ as E,aO as q}from"./vendor-icons-CouwLySB.js";import{f as P}from"./vendor-utils-Dl0_yMKq.js";import{p as B}from"./pt-BR-BbSwNUOy.js";import"./vendor-supabase-ChjAI-9u.js";const F=({title:a,value:t,icon:s,color:r,delay:i=0,subtitle:l})=>e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:i},children:e.jsxs(n,{className:"relative overflow-hidden border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 ${r} opacity-10 rounded-full blur-3xl`}),e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:a}),e.jsx("div",{className:`p-2 rounded-lg ${r} bg-opacity-10`,children:e.jsx(s,{className:`h-5 w-5 ${r.replace("bg-","text-")}`})})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-3xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:t}),l&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:l})]})]})}),L=()=>{const[L,M]=a.useState(!1),[O,R]=a.useState(""),[V,D]=a.useState(0),[U,G]=a.useState("all"),{toast:K}=s(),Q=r(e=>e.user),H=f(O,500),{data:J,isLoading:W,totalCount:X,totalPages:Y,refetch:Z}=(({userId:e,page:a=0,pageSize:s=50,search:r="",type:i="all",status:l="all",enabled:n=!0})=>{const{data:o,isLoading:d,error:c,refetch:x}=v({queryKey:["customers",e,a,s,r,i,l],queryFn:async()=>{if(!e)throw new Error("User ID is required");let n=t.from("Customer").select("*",{count:"exact"}).eq("userId",e).order("createdAt",{ascending:!1}).range(a*s,(a+1)*s-1);r&&(n=n.or(`name.ilike.%${r}%,email.ilike.%${r}%,phone.ilike.%${r}%,cpfCnpj.ilike.%${r}%,whatsappNumber.ilike.%${r}%`)),"all"!==i&&(n=n.eq("type",i)),"all"!==l&&(n=n.eq("status",l));const{data:o,error:d,count:c}=await n;if(d)throw d;return{customers:o||[],count:c||0}},enabled:n&&!!e,staleTime:3e5,gcTime:6e5}),m=o?.count||0,g=Math.ceil(m/s);return{data:o?.customers||[],isLoading:d,error:c,totalCount:m,totalPages:g,refetch:x}})({userId:Q?.id||"",page:V,pageSize:50,search:H,type:U,enabled:!!Q?.id}),_=J;a.useEffect(()=>{D(0)},[O,J]);const ee=async()=>{if(Q?.id)try{M(!0),K({title:"Sincronizando...",description:"Buscando clientes da Shopify"});const e=await j.syncCustomers(Q.id);e.success?(K({title:"Sincronização concluída!",description:e.message}),await Z()):K({title:"Erro na sincronização",description:e.message,variant:"destructive"})}catch(e){K({title:"Erro ao sincronizar",description:"Configure a integração Shopify em Integrações",variant:"destructive"})}finally{M(!1)}else K({title:"Erro",description:"Faça login para sincronizar",variant:"destructive"})},ae=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),te=J.reduce((e,a)=>e+a.totalSpent,0),se=J.reduce((e,a)=>e+a.totalOrders,0),re=J.filter(e=>"ACTIVE"===e.status).length,ie=J.length>0?te/J.length:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-5xl font-black bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 dark:from-blue-400 dark:via-purple-400 dark:to-pink-400 bg-clip-text text-transparent mb-2",children:"Clientes"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 font-medium text-lg",children:"Visualize e gerencie todos os clientes da sua loja"})]}),e.jsx(N.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:e.jsxs(i,{onClick:ee,disabled:L,size:"lg",className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(k,{className:"mr-2 h-5 w-5 "+(L?"animate-spin":"")}),L?"Sincronizando...":"Sincronizar Shopify"]})})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(F,{title:"Total de Clientes",value:J.length,icon:w,color:"bg-blue-500",delay:.1}),e.jsx(F,{title:"Clientes Ativos",value:re,icon:C,color:"bg-green-500",delay:.2,subtitle:`${(re/J.length*100||0).toFixed(0)}% do total`}),e.jsx(F,{title:"Total de Pedidos",value:se,icon:S,color:"bg-purple-500",delay:.3,subtitle:`${(se/J.length||0).toFixed(1)} por cliente`}),e.jsx(F,{title:"Receita Total",value:ae(te),icon:z,color:"bg-pink-500",delay:.4,subtitle:`Ticket médio: ${ae(ie)}`})]}),e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},className:"relative",children:[e.jsx(T,{className:"absolute left-4 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400 dark:text-gray-500"}),e.jsx(l,{placeholder:"Buscar por nome, email ou CPF...",value:O,onChange:e=>R(e.target.value),className:"pl-12 h-12 border-0 bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl shadow-lg text-base"})]}),e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:e.jsxs(n,{className:"border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(o,{children:e.jsx(d,{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent",children:"Lista de Clientes"})}),e.jsxs(c,{children:[W?e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(a=>e.jsx(b,{className:"h-16 w-full"},a))}):0===_.length?e.jsxs(N.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 opacity-20 blur-3xl rounded-full"}),e.jsx(w,{className:"relative h-20 w-20 text-gray-400 dark:text-gray-600"})]}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Nenhum cliente encontrado"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6 max-w-md",children:O?"Tente ajustar os filtros de busca":"Sincronize com a Shopify para importar seus clientes"}),!O&&e.jsxs(i,{onClick:ee,disabled:L,size:"lg",className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:[e.jsx(k,{className:"mr-2 h-5 w-5 "+(L?"animate-spin":"")}),"Sincronizar Clientes"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(m,{children:[e.jsx(g,{children:e.jsxs(h,{className:"hover:bg-transparent border-gray-200 dark:border-gray-700",children:[e.jsx(p,{className:"font-semibold text-gray-700 dark:text-gray-300",children:"Cliente"}),e.jsx(p,{className:"font-semibold text-gray-700 dark:text-gray-300",children:"Contato"}),e.jsx(p,{className:"font-semibold text-gray-700 dark:text-gray-300",children:"Pedidos"}),e.jsx(p,{className:"font-semibold text-gray-700 dark:text-gray-300",children:"Total Gasto"}),e.jsx(p,{className:"font-semibold text-gray-700 dark:text-gray-300",children:"Última Compra"}),e.jsx(p,{className:"font-semibold text-gray-700 dark:text-gray-300",children:"Status"})]})}),e.jsx(u,{children:_.map((a,t)=>e.jsxs(N.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.05*t},className:"hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors border-gray-200 dark:border-gray-700",children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-semibold",children:a.name.charAt(0).toUpperCase()}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:a.name})]})}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(A,{className:"h-3 w-3 text-gray-400"}),a.email]}),a.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(I,{className:"h-3 w-3 text-gray-400"}),a.phone]})]})}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:a.totalOrders})]})}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:ae(a.totalSpent)})]})}),e.jsx(y,{children:e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.lastOrderAt?P(new Date(a.lastOrderAt),"dd/MM/yyyy",{locale:B}):"-"})}),e.jsx(y,{children:e.jsx(x,{variant:"ACTIVE"===a.status?"default":"secondary",className:"ACTIVE"===a.status?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400",children:"ACTIVE"===a.status?"Ativo":"Bloqueado"})})]},a.id))})]})}),!W&&_.length>0&&Y>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4 px-2",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Página ",V+1," de ",Y," (",X," ","clientes no total)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>D(Math.max(0,V-1)),disabled:0===V,children:[e.jsx(E,{className:"h-4 w-4 mr-1"}),"Anterior"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>D(Math.min(Y-1,V+1)),disabled:V>=Y-1,children:["Próxima",e.jsx(q,{className:"h-4 w-4 ml-1"})]})]})]})]})]})})]})};export{L as default};
