import{j as e}from"./vendor-ui-D3JNL6pE.js";import{r as s}from"./vendor-react-X41Bjl18.js";import{g as a,s as i,B as t,I as r,C as o,c,e as d}from"./index-X3DAL2EH.js";import{L as n}from"./label-DIrmZ_ur.js";import{S as l,a as m,b as h,c as x,d as p}from"./select-CXeQ-gju.js";import{T as j,a as u,b as v,c as f,d as g,e as y}from"./table-WZMLcjmV.js";import{D as N,e as b,a as w,b as C,c as P}from"./dialog-B52Folhg.js";import{L as k,aO as D,Q as A,Y as E}from"./vendor-icons-C9d2sOc_.js";import"./vendor-supabase-HUq0BeMy.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-animation-DtB50Lbk.js";import"./vendor-query-DqG_mm-v.js";function S(){const{toast:S}=a(),[I,F]=s.useState([]),[M,z]=s.useState(!0),[U,q]=s.useState(!1),[O,R]=s.useState(null),[T,L]=s.useState({name:"",description:"",type:"FIXED",basePrice:0,pricePerUnit:0,estimatedDays:5,isActive:!0,isDefault:!1});s.useEffect(()=>{X()},[]);const X=async()=>{try{const{data:{user:e}}=await i.auth.getUser();if(!e)return;const{data:s,error:a}=await i.from("ShippingMethod").select("*").eq("userId",e.id).order("createdAt",{ascending:!1});if(a)throw a;F(s||[])}catch(e){S({title:"Erro",description:"Não foi possível carregar os métodos de frete",variant:"destructive"})}finally{z(!1)}},B=()=>{L({name:"",description:"",type:"FIXED",basePrice:0,pricePerUnit:0,estimatedDays:5,isActive:!0,isDefault:!1}),R(null)};return M?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-gray-400"})}):e.jsx("div",{children:e.jsxs("div",{className:"p-6 sm:p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white dark:text-white",children:"Frete e Entrega"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 dark:text-gray-400 mt-1",children:"Configure os métodos de entrega disponíveis no seu checkout"})]}),e.jsxs(N,{open:U,onOpenChange:q,children:[e.jsx(b,{asChild:!0,children:e.jsxs(t,{onClick:()=>{B(),q(!0)},className:"bg-pink-600 hover:bg-pink-700",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Novo método"]})}),e.jsxs(w,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(C,{children:e.jsx(P,{children:O?"Editar Método de Frete":"Novo Método de Frete"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Nome do método *"}),e.jsx(r,{placeholder:"Ex: Correios PAC",value:T.name,onChange:e=>L({...T,name:e.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Descrição"}),e.jsx(r,{placeholder:"Ex: Entrega em 5 a 7 dias úteis",value:T.description,onChange:e=>L({...T,description:e.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Tipo de frete *"}),e.jsxs(l,{value:T.type,onValueChange:e=>L({...T,type:e}),children:[e.jsx(m,{children:e.jsx(h,{})}),e.jsxs(x,{children:[e.jsx(p,{value:"FIXED",children:"Fixo"}),e.jsx(p,{value:"WEIGHT_BASED",children:"Por peso"}),e.jsx(p,{value:"PRICE_BASED",children:"Por valor"}),e.jsx(p,{value:"LOCAL_PICKUP",children:"Retirada local"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Preço base (R$) *"}),e.jsx(r,{type:"number",step:"0.01",value:T.basePrice,onChange:e=>L({...T,basePrice:parseFloat(e.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Prazo (dias) *"}),e.jsx(r,{type:"number",value:T.estimatedDays,onChange:e=>L({...T,estimatedDays:parseInt(e.target.value)||0})})]})]}),"FIXED"!==T.type&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Preço por unidade (R$)"}),e.jsx(r,{type:"number",step:"0.01",value:T.pricePerUnit,onChange:e=>L({...T,pricePerUnit:parseFloat(e.target.value)||0})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(t,{variant:"outline",className:"flex-1",onClick:()=>{q(!1),B()},children:"Cancelar"}),e.jsx(t,{className:"flex-1 bg-pink-600 hover:bg-pink-700",onClick:async()=>{try{const{data:{user:e}}=await i.auth.getUser();if(!e)return;if(O){const{error:e}=await i.from("ShippingMethod").update(T).eq("id",O.id);if(e)throw e;S({title:"Método atualizado",description:"O método de frete foi atualizado com sucesso"})}else{const{error:s}=await i.from("ShippingMethod").insert({...T,userId:e.id});if(s)throw s;S({title:"Método criado",description:"O método de frete foi criado com sucesso"})}await X(),q(!1),R(null),B()}catch(e){S({title:"Erro",description:"Não foi possível salvar o método de frete",variant:"destructive"})}},disabled:!T.name,children:O?"Atualizar":"Criar"})]})]})]})]}),0===I.length?e.jsx(o,{children:e.jsxs(c,{className:"py-12 text-center",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 dark:text-gray-400 mb-4",children:"Você ainda não tem métodos de frete configurados."}),e.jsxs(t,{onClick:()=>q(!0),className:"bg-pink-600 hover:bg-pink-700",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Criar primeiro método"]})]})}):e.jsx(o,{children:e.jsxs(j,{children:[e.jsx(u,{children:e.jsxs(v,{children:[e.jsx(f,{children:"Nome"}),e.jsx(f,{children:"Tipo"}),e.jsx(f,{children:"Preço"}),e.jsx(f,{children:"Prazo"}),e.jsx(f,{children:"Status"}),e.jsx(f,{className:"text-right",children:"Ações"})]})}),e.jsx(g,{children:I.map(s=>e.jsxs(v,{children:[e.jsx(y,{className:"font-medium",children:s.name}),e.jsx(y,{children:s.type}),e.jsxs(y,{children:["R$ ",s.basePrice.toFixed(2)]}),e.jsxs(y,{children:[s.estimatedDays," dias"]}),e.jsx(y,{children:e.jsx(d,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativo":"Inativo"})}),e.jsx(y,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>(async e=>{try{const{error:s}=await i.from("ShippingMethod").update({isActive:!e.isActive}).eq("id",e.id);if(s)throw s;await X()}catch(s){S({title:"Erro",description:"Não foi possível alterar o status do método",variant:"destructive"})}})(s),children:s.isActive?"Desativar":"Ativar"}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>(e=>{R(e),L({name:e.name,description:e.description||"",type:e.type,basePrice:e.basePrice,pricePerUnit:e.pricePerUnit,estimatedDays:e.estimatedDays,isActive:e.isActive,isDefault:e.isDefault}),q(!0)})(s),children:e.jsx(A,{className:"h-4 w-4"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Tem certeza que deseja excluir este método?"))try{const{error:s}=await i.from("ShippingMethod").delete().eq("id",e);if(s)throw s;S({title:"Método excluído",description:"O método de frete foi excluído com sucesso"}),await X()}catch(s){S({title:"Erro",description:"Não foi possível excluir o método de frete",variant:"destructive"})}})(s.id),children:e.jsx(E,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})})}export{S as default};
