import{c as le,b as oe,r as c,s as w,j as e,d as f,e as I,f as k,h as g,an as U,o as F,B as h,I as X}from"./index-C14FxL5X.js";import{L as N}from"./label-BP6R2bl_.js";import{S as V}from"./switch-DKVob2Dt.js";import{D as W,b as H,c as Z,d as J,e as Q,f as Y}from"./dialog-BccfhY2b.js";import{A as z,b as ne,a as M}from"./alert-C8bp-uiR.js";import{S as ce}from"./separator-r4ABNZIW.js";import{u as de}from"./useOptimizedSelectors-BBeii5UI.js";import{A as ee}from"./activity-2JR3Y-rk.js";import{C as se}from"./circle-check-DKyWb45W.js";import{C as xe}from"./circle-x-Df672Jz0.js";import{E as me}from"./external-link-BXELCa1S.js";import{P as he}from"./plus-Bu2Ym9ga.js";import{S as pe}from"./square-pen-CuGTipgc.js";import{T as ue}from"./trash-2-BS6cHD5X.js";import"./index-Ca1HAPI1.js";import"./x-KmGBjaf8.js";import"./settingsStore-C2e4mnTC.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=le("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),ge=()=>{const{user:r}=de(),{toast:l}=oe(),[P,v]=c.useState([]),[d,b]=c.useState([]),[G,O]=c.useState(!0),[L,E]=c.useState(!1),[q,_]=c.useState(!1),[y,S]=c.useState(!1),j=async()=>{try{const{data:t,error:a}=await w.from("Pixel").select("*").eq("isActive",!0).order("platform");if(a)throw a;v(t||[])}catch(t){console.error("Error fetching pixels:",t),l({title:"Erro ao carregar pixels",description:t.message,variant:"destructive"})}},o=async()=>{if(r!=null&&r.id)try{O(!0);const{data:t,error:a}=await w.from("PixelConfig").select("*").eq("userId",r.id).order("createdAt",{ascending:!1});if(a)throw a;b(t||[])}catch(t){console.error("Error fetching pixel configs:",t),l({title:"Erro ao carregar configura√ß√µes",description:t.message,variant:"destructive"})}finally{O(!1)}},D=async t=>{if(!(r!=null&&r.id))return l({title:"Erro",description:"Usu√°rio n√£o autenticado",variant:"destructive"}),null;try{E(!0);const{data:a,error:n}=await w.from("PixelConfig").insert({userId:r.id,platform:t.platform,pixelId:t.pixelId,name:t.name,accessToken:t.accessToken,isActive:t.isActive??!0,events:t.events||["page_view","add_to_cart","purchase","initiate_checkout"],config:t.config||{}}).select().single();if(n)throw n;return l({title:"Pixel cadastrado!",description:`O pixel ${t.name||t.platform} foi cadastrado com sucesso.`}),await o(),a}catch(a){return console.error("Error creating pixel config:",a),l({title:"Erro ao cadastrar pixel",description:a.message,variant:"destructive"}),null}finally{E(!1)}},A=async(t,a)=>{try{_(!0);const{data:n,error:u}=await w.from("PixelConfig").update({...a,updatedAt:new Date().toISOString()}).eq("id",t).select().single();if(u)throw u;return l({title:"Pixel atualizado!",description:"As configura√ß√µes do pixel foram atualizadas com sucesso."}),await o(),n}catch(n){return console.error("Error updating pixel config:",n),l({title:"Erro ao atualizar pixel",description:n.message,variant:"destructive"}),null}finally{_(!1)}},T=async t=>{try{S(!0);const{error:a}=await w.from("PixelConfig").delete().eq("id",t);if(a)throw a;return l({title:"Pixel removido!",description:"A configura√ß√£o do pixel foi removida com sucesso."}),await o(),!0}catch(a){return console.error("Error deleting pixel config:",a),l({title:"Erro ao remover pixel",description:a.message,variant:"destructive"}),!1}finally{S(!1)}},p=async(t,a)=>{try{const{error:n}=await w.from("PixelConfig").update({isActive:a,updatedAt:new Date().toISOString()}).eq("id",t);if(n)throw n;return l({title:a?"Pixel ativado!":"Pixel desativado!",description:a?"O pixel est√° agora rastreando eventos.":"O pixel foi pausado temporariamente."}),await o(),!0}catch(n){return console.error("Error toggling pixel config:",n),l({title:"Erro ao alterar status",description:n.message,variant:"destructive"}),!1}},B=t=>d.some(a=>a.platform===t),i=t=>d.find(a=>a.platform===t),x=()=>d.filter(t=>t.isActive),C={total:d.length,active:d.filter(t=>t.isActive).length,inactive:d.filter(t=>!t.isActive).length,byPlatform:{facebook:d.filter(t=>t.platform==="FACEBOOK").length,tiktok:d.filter(t=>t.platform==="TIKTOK").length,google:d.filter(t=>t.platform==="GOOGLE_ADS").length}};return c.useEffect(()=>{j()},[]),c.useEffect(()=>{r!=null&&r.id&&o()},[r==null?void 0:r.id]),{pixels:P,pixelConfigs:d,loading:G,creating:L,updating:q,deleting:y,stats:C,createPixelConfig:D,updatePixelConfig:A,deletePixelConfig:T,togglePixelConfig:p,fetchPixelConfigs:o,fetchPixels:j,hasPixelForPlatform:B,getPixelConfigByPlatform:i,getActivePixelConfigs:x}},K={FACEBOOK:{platform:"FACEBOOK",name:"Meta Ads (Facebook/Instagram)",description:"Pixel do Meta para rastreamento de convers√µes no Facebook e Instagram",icon:"üìò",color:"#1877F2",documentation:"https://developers.facebook.com/docs/meta-pixel",requiredFields:["pixelId"],availableEvents:["page_view","add_to_cart","purchase","initiate_checkout","view_content","search","add_payment_info","complete_registration"]},TIKTOK:{platform:"TIKTOK",name:"TikTok Ads",description:"Pixel do TikTok para rastreamento de convers√µes e cria√ß√£o de p√∫blicos",icon:"üéµ",color:"#000000",documentation:"https://ads.tiktok.com/help/article?aid=10000357",requiredFields:["pixelId"],availableEvents:["page_view","add_to_cart","purchase","initiate_checkout","view_content","search","add_payment_info","complete_registration"]},GOOGLE_ADS:{platform:"GOOGLE_ADS",name:"Google Ads",description:"Tag de convers√£o do Google Ads para remarketing e medi√ß√£o",icon:"üîç",color:"#4285F4",documentation:"https://support.google.com/google-ads/answer/6331314",requiredFields:["pixelId"],availableEvents:["page_view","add_to_cart","purchase","begin_checkout","view_item","search","add_payment_info","sign_up"]}},te=(r,l)=>{switch(r){case"FACEBOOK":return/^\d{15,16}$/.test(l);case"TIKTOK":return/^[A-Z0-9]{15,20}$/.test(l);case"GOOGLE_ADS":return/^AW-\d{9,11}$/.test(l)||/^G-[A-Z0-9]{10}$/.test(l);default:return!1}},Te=()=>{const{pixelConfigs:r,loading:l,creating:P,updating:v,deleting:d,stats:b,createPixelConfig:G,updatePixelConfig:O,deletePixelConfig:L,togglePixelConfig:E,hasPixelForPlatform:q}=ge(),[_,y]=c.useState(!1),[S,j]=c.useState(!1),[o,D]=c.useState(null),[A,T]=c.useState(null),[p,B]=c.useState(""),[i,x]=c.useState({platform:"FACEBOOK",pixelId:"",name:"",isActive:!0,events:["page_view","add_to_cart","purchase","initiate_checkout"]}),[C,t]=c.useState(null),a=s=>{D(s),x({platform:s,pixelId:"",name:"",isActive:!0,events:K[s].availableEvents.slice(0,4)}),t(null),y(!0)},n=s=>{T(s),x({platform:s.platform,pixelId:s.pixelId,name:s.name||"",isActive:s.isActive,events:s.events}),t(null),j(!0)},u=()=>{y(!1),j(!1),D(null),T(null),t(null)},ae=async()=>{if(!te(i.platform,i.pixelId)){t("ID de pixel inv√°lido para esta plataforma. Verifique o formato correto.");return}await G(i)&&u()},ie=async()=>{if(!A)return;if(i.pixelId&&i.pixelId!==A.pixelId&&!te(i.platform,i.pixelId)){t("ID de pixel inv√°lido para esta plataforma. Verifique o formato correto.");return}await O(A.id,{pixelId:i.pixelId,name:i.name,isActive:i.isActive,events:i.events})&&u()},re=async s=>{window.confirm("Tem certeza que deseja remover este pixel? Esta a√ß√£o n√£o pode ser desfeita.")&&await L(s)},$=r.filter(s=>{var m;return s.pixelId.toLowerCase().includes(p.toLowerCase())||((m=s.name)==null?void 0:m.toLowerCase().includes(p.toLowerCase()))||s.platform.toLowerCase().includes(p.toLowerCase())});return l?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Carregando pixels..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Pixels de Rastreamento"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Gerencie seus pixels do Meta, TikTok e Google Ads integrados com sua Shopify"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(f,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Total de Pixels"}),e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold",children:b.total})})]}),e.jsxs(f,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Pixels Ativos"}),e.jsx(se,{className:"h-4 w-4 text-green-600"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold",children:b.active})})]}),e.jsxs(f,{className:"border-0 bg-white/80 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Pixels Inativos"}),e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold",children:b.inactive})})]}),e.jsxs(f,{children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:"Plataformas"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"3"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Meta, TikTok, Google"})]})]})]}),e.jsxs(z,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(ne,{children:"Integra√ß√£o com Shopify"}),e.jsx(M,{children:"Os pixels cadastrados aqui ser√£o automaticamente integrados ao seu checkout da Shopify para rastreamento de convers√µes."})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Plataformas Dispon√≠veis"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:Object.values(K).map(s=>{const m=q(s.platform);return e.jsxs(f,{className:"hover:shadow-md transition-shadow",children:[e.jsx(I,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-2xl",style:{backgroundColor:s.color+"20"},children:s.icon}),e.jsxs("div",{children:[e.jsx(k,{className:"text-lg",children:s.name}),m&&e.jsxs(F,{variant:"secondary",className:"mt-1",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Configurado"]})]})]})})}),e.jsxs(g,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("a",{href:s.documentation,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:[e.jsx(me,{className:"w-3 h-3"}),"Documenta√ß√£o"]}),e.jsxs(h,{size:"sm",onClick:()=>a(s.platform),disabled:P,variant:m?"outline":"default",children:[e.jsx(he,{className:"w-4 h-4 mr-1"}),m?"Adicionar Outro":"Cadastrar Pixel"]})]})]})]},s.platform)})})]}),e.jsx(ce,{}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Pixels Cadastrados"}),e.jsx(X,{type:"text",placeholder:"Buscar pixels...",value:p,onChange:s=>B(s.target.value),className:"max-w-xs"})]}),$.length===0?e.jsx(f,{children:e.jsxs(g,{className:"py-12 text-center",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Nenhum pixel cadastrado"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:p?"Nenhum pixel encontrado com esse filtro.":"Cadastre seu primeiro pixel para come√ßar a rastrear convers√µes."})]})}):e.jsx("div",{className:"space-y-4",children:$.map(s=>{const m=K[s.platform];return e.jsx(f,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-xl flex-shrink-0",style:{backgroundColor:m.color+"20"},children:m.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name||m.name}),e.jsx(F,{variant:s.isActive?"default":"secondary",children:s.isActive?"Ativo":"Inativo"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Pixel ID: ",s.pixelId]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.events.slice(0,4).map(R=>e.jsx(F,{variant:"outline",className:"text-xs",children:R},R)),s.events.length>4&&e.jsxs(F,{variant:"outline",className:"text-xs",children:["+",s.events.length-4]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>E(s.id,!s.isActive),disabled:v,children:e.jsx(fe,{className:`w-4 h-4 ${s.isActive?"text-green-600":"text-gray-400"}`})}),e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>n(s),disabled:v,children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>re(s.id),disabled:d,children:e.jsx(ue,{className:"w-4 h-4 text-red-600"})})]})]})})},s.id)})})]}),e.jsx(W,{open:_,onOpenChange:y,children:e.jsxs(H,{children:[e.jsxs(Z,{children:[e.jsxs(J,{children:["Cadastrar Pixel"," ",o&&K[o].name]}),e.jsx(Q,{children:"Configure um novo pixel para rastrear convers√µes na sua loja Shopify."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"pixelId",children:["Pixel ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(X,{id:"pixelId",placeholder:o==="FACEBOOK"?"1234567890123456":o==="TIKTOK"?"CXXXXXXXXXXXXXXXXX":"AW-1234567890 ou G-XXXXXXXXXX",value:i.pixelId,onChange:s=>x({...i,pixelId:s.target.value})}),o&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Formato esperado:"," ",o==="FACEBOOK"&&"15-16 d√≠gitos",o==="TIKTOK"&&"C√≥digo alfanum√©rico de 15-20 caracteres",o==="GOOGLE_ADS"&&"AW-XXXXXXXXXX ou G-XXXXXXXXXX"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"name",children:"Nome (Opcional)"}),e.jsx(X,{id:"name",placeholder:"Ex: Pixel Principal, Pixel de Remarketing...",value:i.name,onChange:s=>x({...i,name:s.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{id:"isActive",checked:i.isActive,onCheckedChange:s=>x({...i,isActive:s})}),e.jsx(N,{htmlFor:"isActive",children:"Ativar pixel imediatamente"})]}),C&&e.jsx(z,{variant:"destructive",children:e.jsx(M,{children:C})})]}),e.jsxs(Y,{children:[e.jsx(h,{variant:"outline",onClick:u,children:"Cancelar"}),e.jsx(h,{onClick:ae,disabled:P||!i.pixelId,children:P?"Cadastrando...":"Cadastrar Pixel"})]})]})}),e.jsx(W,{open:S,onOpenChange:j,children:e.jsxs(H,{children:[e.jsxs(Z,{children:[e.jsx(J,{children:"Editar Pixel"}),e.jsx(Q,{children:"Atualize as configura√ß√µes do seu pixel."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"edit-pixelId",children:"Pixel ID"}),e.jsx(X,{id:"edit-pixelId",value:i.pixelId,onChange:s=>x({...i,pixelId:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"edit-name",children:"Nome"}),e.jsx(X,{id:"edit-name",placeholder:"Nome do pixel",value:i.name,onChange:s=>x({...i,name:s.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{id:"edit-isActive",checked:i.isActive,onCheckedChange:s=>x({...i,isActive:s})}),e.jsx(N,{htmlFor:"edit-isActive",children:"Pixel ativo"})]}),C&&e.jsx(z,{variant:"destructive",children:e.jsx(M,{children:C})})]}),e.jsxs(Y,{children:[e.jsx(h,{variant:"outline",onClick:u,children:"Cancelar"}),e.jsx(h,{onClick:ie,disabled:v,children:v?"Salvando...":"Salvar Altera√ß√µes"})]})]})})]})};export{Te as default};
