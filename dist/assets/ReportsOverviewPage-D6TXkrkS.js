import{f as Se,u as Te,r as f,s as B,j as e,B as ke,ad as Oe,g as x,l as h,o as D,S as Ie,C as Ee,h as u,i as p,k as C,P as Fe,U as $e}from"./index-CkeR9g7w.js";import{P as R}from"./progress-jGy6JE2u.js";import{S as W}from"./skeleton-2doKeoxp.js";import{S as Be,a as Me,b as Ve,c as He,d as M}from"./select-JpR3_KMR.js";import{g as Le,B as S,X as V,Y as H,f as Ge,A as J,R as Q,c as ze,C as Z,T as _,d as Ke,L as Ue,a as qe,b as Xe}from"./AreaChart-B4sE0q67.js";import{D as Ye}from"./dollar-sign-D134eXIX.js";import{T as We}from"./trending-up-k6H__tiy.js";import{C as ee}from"./circle-check-DwupJ2fp.js";import{C as se}from"./clock-CdKCH_xW.js";import{C as te}from"./circle-x-D72F6FZY.js";import{C as Je}from"./circle-alert-TmrAZG4u.js";import{S as Qe}from"./shopping-bag-5lC3SRRr.js";import"./index-iLHSLSK-.js";var Ze=Le({chartName:"BarChart",GraphicalChild:S,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:V},{axisType:"yAxis",AxisComp:H}],formatAxisMap:Ge});function xs(){const{toast:ae}=Se(),m=Te(s=>s.user),[re,L]=f.useState(!0),[G,z]=f.useState(!1),[j,ne]=f.useState("7days"),[a,ie]=f.useState({totalRevenue:0,revenueChange:0,totalOrders:0,ordersChange:0,averageOrderValue:0,aovChange:0,checkoutViews:0,conversionRate:0,abandonedCarts:0,abandonmentRate:0,recoveredCarts:0,recoveryRate:0,pendingPayments:0,paidOrders:0,failedPayments:0,totalCustomers:0,newCustomers:0}),[K,le]=f.useState([]),[de,oe]=f.useState([]),[U,ce]=f.useState([]),[q,me]=f.useState([]);f.useEffect(()=>{if(m!=null&&m.id){T();const s=setInterval(T,3e4);return()=>clearInterval(s)}},[m==null?void 0:m.id,j]);const T=async()=>{if(m!=null&&m.id)try{L(!0);const[s,r,t]=await Promise.all([xe(),he(),ue()]);ge(s,r,t),fe(s),je(s),pe(s)}catch(s){console.error("Error loading dashboard:",s)}finally{L(!1)}},xe=async()=>{const{data:s,error:r}=await B.from("Order").select("*").eq("userId",m.id).order("createdAt",{ascending:!1}).limit(500);if(r)throw r;return s||[]},he=async()=>{const{data:s,error:r}=await B.from("AbandonedCart").select("*").eq("userId",m.id);return r?[]:s||[]},ue=async()=>{const{data:s,error:r}=await B.from("Customer").select("*").eq("userId",m.id);return r?[]:s||[]},pe=s=>{const r=s.filter(t=>t.items&&t.items.length>0).slice(0,5).map(t=>({id:t.id,orderNumber:t.orderNumber,customerName:t.customerName,amount:t.total,status:t.paymentStatus,items:t.items||[],createdAt:t.createdAt}));me(r)},ge=(s,r,t)=>{const d=new Date;let n;switch(j){case"today":n=new Date(d.setHours(0,0,0,0));break;case"7days":n=new Date(d.getTime()-7*24*60*60*1e3);break;case"30days":n=new Date(d.getTime()-30*24*60*60*1e3);break;default:n=new Date(d.getTime()-7*24*60*60*1e3)}const i=s.filter(l=>new Date(l.createdAt)>=n),o=new Date(n.getTime()-(d.getTime()-n.getTime())),N=s.filter(l=>new Date(l.createdAt)>=o&&new Date(l.createdAt)<n),v=i.filter(l=>l.paymentStatus==="PAID"),y=N.filter(l=>l.paymentStatus==="PAID"),c=v.reduce((l,$)=>l+(parseFloat($.total)||0),0),g=y.reduce((l,$)=>l+(parseFloat($.total)||0),0),ve=g>0?(c-g)/g*100:0,w=v.length,ye=y.length>0?(w-y.length)/y.length*100:0,X=w>0?c/w:0,O=y.length>0?g/y.length:0,be=O>0?(X-O)/O*100:0,P=r.filter(l=>new Date(l.abandonedAt)>=n),I=P.filter(l=>!l.recoveredAt).length,Y=P.filter(l=>l.recoveredAt).length,E=i.length+I,we=E>0?I/E*100:0,Ce=P.length>0?Y/P.length*100:0,F=E,De=F>0?w/F*100:0,Ae=i.filter(l=>l.paymentStatus==="PENDING").length,Pe=i.filter(l=>l.paymentStatus==="FAILED").length,Re=t.filter(l=>new Date(l.createdAt)>=n).length;ie({totalRevenue:c,revenueChange:ve,totalOrders:w,ordersChange:ye,averageOrderValue:X,aovChange:be,checkoutViews:F,conversionRate:De,abandonedCarts:I,abandonmentRate:we,recoveredCarts:Y,recoveryRate:Ce,pendingPayments:Ae,paidOrders:w,failedPayments:Pe,totalCustomers:t.length,newCustomers:Re})},fe=s=>{const r=new Date,t=j==="today"?24:j==="7days"?7:30,d=[];for(let n=t-1;n>=0;n--){const i=new Date(r);i.setDate(i.getDate()-n),j==="today"?i.setHours(r.getHours()-n,0,0,0):i.setHours(0,0,0,0);const o=new Date(i);j==="today"?o.setHours(i.getHours()+1):o.setDate(i.getDate()+1);const N=s.filter(c=>{const g=new Date(c.createdAt);return g>=i&&g<o}),v=N.filter(c=>c.paymentStatus==="PAID"),y=v.reduce((c,g)=>c+(parseFloat(g.total)||0),0);d.push({date:j==="today"?i.getHours()+"h":i.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"}),receita:y,pedidos:v.length,pendentes:N.filter(c=>c.paymentStatus==="PENDING").length,falhos:N.filter(c=>c.paymentStatus==="FAILED").length})}le(d),oe(d)},je=s=>{const r=[];s.slice(0,10).forEach(t=>{var i,o,N,v;const d=((o=(i=t.items)==null?void 0:i[0])==null?void 0:o.image)||null,n=((v=(N=t.items)==null?void 0:N[0])==null?void 0:v.name)||"Produto";t.paymentStatus==="PAID"?r.push({id:t.id,type:"payment",title:"Pagamento Confirmado",description:`${t.customerName||"Cliente"} - ${n}`,time:k(t.updatedAt||t.createdAt),status:"success",image:d}):t.paymentStatus==="PENDING"?r.push({id:t.id,type:"checkout",title:"Checkout Iniciado",description:`${n} - ${b(t.total)}`,time:k(t.createdAt),status:"info",image:d}):t.paymentStatus==="FAILED"&&r.push({id:t.id,type:"payment",title:"Pagamento Falhou",description:`${t.orderNumber} - ${n}`,time:k(t.updatedAt||t.createdAt),status:"error",image:d})}),ce(r.slice(0,5))},Ne=async()=>{z(!0),await T(),z(!1),ae({title:"Dashboard atualizado!",description:"Dados carregados com sucesso"})},b=s=>{const r=typeof s=="string"?parseFloat(s):s;return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r||0)},k=s=>{const r=new Date,t=new Date(s),d=r.getTime()-t.getTime(),n=Math.floor(d/6e4),i=Math.floor(d/36e5),o=Math.floor(d/864e5);return n<1?"Agora":n<60?`${n}m atrás`:i<24?`${i}h atrás`:`${o}d atrás`},A=({title:s,value:r,change:t,icon:d,color:n})=>e.jsxs(x,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:s}),e.jsx("div",{className:`rounded-full p-2 ${n}`,children:e.jsx(d,{className:"h-5 w-5"})})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-3xl font-bold",children:r}),t!==void 0&&e.jsxs("div",{className:"flex items-center mt-2 text-sm",children:[t>=0?e.jsx(qe,{className:"h-4 w-4 text-green-500 mr-1"}):e.jsx(Xe,{className:"h-4 w-4 text-red-500 mr-1"}),e.jsxs("span",{className:t>=0?"text-green-500":"text-red-500",children:[Math.abs(t).toFixed(1),"%"]}),e.jsx("span",{className:"text-muted-foreground ml-1",children:"vs. período anterior"})]})]})]});return re&&K.length===0?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(W,{className:"h-12 w-64"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(s=>e.jsx(W,{className:"h-32"},s))})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Visão geral das suas métricas de vendas e conversão"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Be,{value:j,onValueChange:s=>ne(s),children:[e.jsx(Me,{className:"w-[160px]",children:e.jsx(Ve,{})}),e.jsxs(He,{children:[e.jsx(M,{value:"today",children:"Hoje"}),e.jsx(M,{value:"7days",children:"7 dias"}),e.jsx(M,{value:"30days",children:"30 dias"})]})]}),e.jsx(ke,{onClick:Ne,disabled:G,variant:"outline",size:"icon",children:e.jsx(Oe,{className:`h-4 w-4 ${G?"animate-spin":""}`})})]})]}),e.jsx(x,{className:"bg-gradient-to-r from-purple-500/10 via-pink-500/10 to-orange-500/10 border-purple-500/20",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"h-8 w-8 text-purple-500"}),e.jsxs("span",{className:"absolute -top-1 -right-1 flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Usuários Online Agora"}),e.jsx("p",{className:"text-3xl font-bold",children:a.pendingPayments>0?a.pendingPayments:"0"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs(D,{variant:"outline",className:"text-sm",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500 mr-2 animate-pulse"}),"Ao Vivo"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[a.pendingPayments," no checkout"]})]})]})})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(A,{title:"Receita Total",value:b(a.totalRevenue),change:a.revenueChange,icon:Ye,color:"bg-green-500/10 text-green-500"}),e.jsx(A,{title:"Pedidos Pagos",value:a.totalOrders.toString(),change:a.ordersChange,icon:Ie,color:"bg-blue-500/10 text-blue-500"}),e.jsx(A,{title:"Taxa de Conversão",value:`${a.conversionRate.toFixed(1)}%`,icon:We,color:"bg-purple-500/10 text-purple-500"}),e.jsx(A,{title:"Ticket Médio",value:b(a.averageOrderValue),change:a.aovChange,icon:Ee,color:"bg-orange-500/10 text-orange-500"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Receita ao Longo do Tempo"}),e.jsx(C,{children:"Análise de faturamento por período"})]}),e.jsx(h,{children:e.jsx(Q,{width:"100%",height:300,children:e.jsxs(ze,{data:K,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorReceita",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]})}),e.jsx(Z,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(V,{dataKey:"date",tick:{fill:"#888",fontSize:12}}),e.jsx(H,{tick:{fill:"#888",fontSize:12}}),e.jsx(_,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px"},formatter:s=>b(s)}),e.jsx(Ke,{type:"monotone",dataKey:"receita",stroke:"#8b5cf6",strokeWidth:2,fillOpacity:1,fill:"url(#colorReceita)"})]})})})]}),e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Status de Pedidos"}),e.jsx(C,{children:"Distribuição por status de pagamento"})]}),e.jsx(h,{children:e.jsx(Q,{width:"100%",height:300,children:e.jsxs(Ze,{data:de,children:[e.jsx(Z,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(V,{dataKey:"date",tick:{fill:"#888",fontSize:12}}),e.jsx(H,{tick:{fill:"#888",fontSize:12}}),e.jsx(_,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(Ue,{}),e.jsx(S,{dataKey:"pedidos",fill:"#22c55e",name:"Pagos",radius:[4,4,0,0]}),e.jsx(S,{dataKey:"pendentes",fill:"#eab308",name:"Pendentes",radius:[4,4,0,0]}),e.jsx(S,{dataKey:"falhos",fill:"#ef4444",name:"Falhos",radius:[4,4,0,0]})]})})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(x,{className:"border-green-500/20 bg-green-500/5",children:[e.jsx(u,{children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-green-500"}),"Pedidos Pagos"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:a.paidOrders}),e.jsx(R,{value:a.paidOrders/(a.paidOrders+a.pendingPayments+a.failedPayments||1)*100,className:"mt-3 h-2"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[b(a.totalRevenue)," em receita"]})]})]}),e.jsxs(x,{className:"border-yellow-500/20 bg-yellow-500/5",children:[e.jsx(u,{children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-yellow-500"}),"Pagamentos Pendentes"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:a.pendingPayments}),e.jsx(R,{value:a.pendingPayments/(a.paidOrders+a.pendingPayments+a.failedPayments||1)*100,className:"mt-3 h-2"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Aguardando confirmação"})]})]}),e.jsxs(x,{className:"border-red-500/20 bg-red-500/5",children:[e.jsx(u,{children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-red-500"}),"Pagamentos Falhados"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:a.failedPayments}),e.jsx(R,{value:a.failedPayments/(a.paidOrders+a.pendingPayments+a.failedPayments||1)*100,className:"mt-3 h-2"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Requer atenção"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Atividade em Tempo Real"}),e.jsx(C,{children:"Últimas ações no checkout"})]}),e.jsx(h,{children:U.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(J,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhuma atividade recente"})]}):e.jsx("div",{className:"space-y-3",children:U.map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg hover:bg-muted/50 transition-colors border",children:[s.image?e.jsx("img",{src:s.image,alt:s.title,className:"w-12 h-12 rounded object-cover"}):e.jsx("div",{className:`rounded-full p-2 ${s.status==="success"?"bg-green-500/10 text-green-500":s.status==="error"?"bg-red-500/10 text-red-500":s.status==="warning"?"bg-yellow-500/10 text-yellow-500":"bg-blue-500/10 text-blue-500"}`,children:s.status==="success"?e.jsx(ee,{className:"h-5 w-5"}):s.status==="error"?e.jsx(te,{className:"h-5 w-5"}):s.status==="warning"?e.jsx(Je,{className:"h-5 w-5"}):e.jsx(se,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.description})]}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:s.time})]},s.id))})})]}),e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Últimas Transações"}),e.jsx(C,{children:"Pedidos mais recentes"})]}),e.jsx(h,{children:q.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Qe,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhuma transação recente"})]}):e.jsx("div",{className:"space-y-3",children:q.map(s=>{var d,n,i,o;const r=(n=(d=s.items)==null?void 0:d[0])==null?void 0:n.image,t=((o=(i=s.items)==null?void 0:i[0])==null?void 0:o.name)||"Produto";return e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-muted/50 transition-colors border",children:[r?e.jsx("img",{src:r,alt:t,className:"w-12 h-12 rounded object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded bg-muted flex items-center justify-center",children:e.jsx(Fe,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium",children:t}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.customerName||"Cliente"," •"," ",s.orderNumber]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold",children:b(s.amount)}),e.jsx(D,{variant:s.status==="PAID"?"default":s.status==="PENDING"?"secondary":"destructive",className:"text-xs",children:s.status==="PAID"?"Pago":s.status==="PENDING"?"Pendente":"Falhou"})]})]},s.id)})})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Carrinhos Abandonados"}),e.jsx(C,{children:"Oportunidades de recuperação"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Abandonados"}),e.jsx("p",{className:"text-3xl font-bold",children:a.abandonedCarts})]}),e.jsxs(D,{variant:"destructive",className:"text-lg px-3 py-1",children:[a.abandonmentRate.toFixed(1),"%"]})]}),e.jsx(R,{value:a.abandonmentRate,className:"h-2"}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Recuperados"}),e.jsx("p",{className:"text-xl font-bold text-green-500",children:a.recoveredCarts})]}),e.jsxs(D,{variant:"outline",className:"text-green-500",children:[a.recoveryRate.toFixed(1),"% recuperação"]})]})]})]}),e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Clientes"}),e.jsx(C,{children:"Base de clientes"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"text-3xl font-bold",children:a.totalCustomers})]}),e.jsx($e,{className:"h-8 w-8 text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Novos Clientes"}),e.jsx("p",{className:"text-xl font-bold text-blue-500",children:a.newCustomers})]}),e.jsx(D,{variant:"outline",className:"text-blue-500",children:"Este período"})]})]})]})]})]})}export{xs as default};
