import{d as $,r as u,s as c,j as e,N as i,C as d,e as x,f as m,aa as w,h as g,au as G,a9 as q,aj as K,g as O,as as z,I as J,n as Q}from"./index-CVm5GJqW.js";import{T as V,a as W,b as C,c as o,d as X,e as l}from"./table-T0ipQFgk.js";import{S as k}from"./SuperAdminLayout-B0xL8IJo.js";function ae(){const{toast:T}=$(),[n,I]=u.useState([]),[p,A]=u.useState(""),[E,M]=u.useState(!0);u.useEffect(()=>{S()},[]);const S=async()=>{try{const{data:a,error:s}=await c.from("User").select("id, name, email, plan, createdAt").order("createdAt",{ascending:!1});if(s)throw s;const f=(a||[]).map(t=>t.id),{data:v}=await c.from("ChatConversation").select("userId, id").in("userId",f),D=(v||[]).map(t=>t.id),{data:P}=await c.from("ChatMessage").select("conversationId").in("conversationId",D),y=new Map;(v||[]).forEach(t=>{const r=(P||[]).filter(F=>F.conversationId===t.id).length,H=y.get(t.userId)||0;y.set(t.userId,H+r)});const{data:U}=await c.from("AiUsage").select("userId, totalTokens, estimatedCost, createdAt").in("userId",f).order("createdAt",{ascending:!1}),j=new Map;(U||[]).forEach(t=>{j.has(t.userId)||j.set(t.userId,t)});const{data:b}=await c.from("GlobalAiConnection").select("provider").eq("isActive",!0).limit(1).maybeSingle(),L=(a||[]).map(t=>{const r=j.get(t.id);return{clientId:t.id,clientName:t.name||"Sem nome",clientSlug:t.email||"",plan:t.plan||"FREE",totalMessages:y.get(t.id)||0,totalTokens:(r==null?void 0:r.totalTokens)||0,estimatedCost:(r==null?void 0:r.estimatedCost)||0,aiProvider:(b==null?void 0:b.provider)||"N/A",lastUsed:(r==null?void 0:r.createdAt)||null}});I(L)}catch(a){console.error("Error loading usage data:",a),T({title:"Erro ao carregar uso de IA",description:a.message,variant:"destructive"})}finally{M(!1)}},N=n.filter(a=>a.clientName.toLowerCase().includes(p.toLowerCase())||a.clientSlug.toLowerCase().includes(p.toLowerCase())),h={totalMessages:n.reduce((a,s)=>a+s.totalMessages,0),totalTokens:n.reduce((a,s)=>a+s.totalTokens,0),totalCost:n.reduce((a,s)=>a+s.estimatedCost,0),avgMessagesPerClient:n.length>0?n.reduce((a,s)=>a+s.totalMessages,0)/n.length:0},R=a=>{const s={FREE:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100",STARTER:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",PRO:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",ENTERPRISE:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200"};return e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s[a]||s.FREE}`,children:a})},B=a=>{const s={openai:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",anthropic:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",google:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200","N/A":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100"};return e.jsx(Q,{variant:"outline",className:s[a]||s["N/A"],children:a.toUpperCase()})};return E?e.jsx(k,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsx(k,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent",children:"Uso de IA"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Acompanhe o uso de inteligência artificial por cliente"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(d,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-gray-300",children:"Total de Mensagens"}),e.jsx(w,{className:"h-4 w-4 text-blue-400"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:h.totalMessages.toLocaleString("pt-BR")}),e.jsx("p",{className:"text-xs text-gray-400",children:"Todas conversas com IA"})]})]})}),e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(d,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-gray-300",children:"Total de Tokens"}),e.jsx(G,{className:"h-4 w-4 text-amber-400"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[(h.totalTokens/1e3).toFixed(1),"K"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Tokens processados"})]})]})}),e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(d,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-gray-300",children:"Custo Estimado"}),e.jsx(q,{className:"h-4 w-4 text-green-400"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:["R$"," ",h.totalCost.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Custo com APIs"})]})]})}),e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:e.jsxs(d,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-gray-300",children:"Média por Usuário"}),e.jsx(K,{className:"h-4 w-4 text-purple-400"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:Math.round(h.avgMessagesPerClient)}),e.jsx("p",{className:"text-xs text-gray-400",children:"Mensagens / usuário"})]})]})})]}),e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:e.jsxs(d,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsx(x,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(m,{className:"text-white",children:"Uso de IA por Usuário"}),e.jsx(O,{className:"text-gray-400",children:"Detalhes de mensagens, tokens e custos"})]})})}),e.jsxs(g,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx(J,{placeholder:"Buscar usuário...",value:p,onChange:a=>A(a.target.value),className:"pl-10 bg-gray-800 border-gray-700 text-white placeholder:text-gray-500"})]})}),e.jsx("div",{className:"border border-gray-700/50 rounded-lg overflow-hidden",children:e.jsxs(V,{children:[e.jsx(W,{children:e.jsxs(C,{className:"border-gray-700/50 hover:bg-gray-800/50",children:[e.jsx(o,{className:"text-gray-300 font-semibold",children:"Cliente"}),e.jsx(o,{className:"text-gray-300 font-semibold",children:"Plano"}),e.jsx(o,{className:"text-gray-300 font-semibold",children:"Provider"}),e.jsx(o,{className:"text-gray-300 font-semibold",children:"Mensagens"}),e.jsx(o,{className:"text-gray-300 font-semibold",children:"Tokens"}),e.jsx(o,{className:"text-gray-300 font-semibold",children:"Custo"}),e.jsx(o,{className:"text-gray-300 font-semibold",children:"Último Uso"})]})}),e.jsx(X,{children:N.length===0?e.jsx(C,{children:e.jsx(l,{colSpan:7,className:"text-center py-8 text-gray-500",children:"Nenhum dado de uso encontrado"})}):N.map((a,s)=>e.jsxs(i.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"border-gray-700/50 hover:bg-gray-800/50 transition-colors",children:[e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:a.clientName}),e.jsx("div",{className:"text-sm text-gray-400",children:a.clientSlug})]})}),e.jsx(l,{children:R(a.plan)}),e.jsx(l,{children:B(a.aiProvider)}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-white",children:a.totalMessages})]})}),e.jsx(l,{children:e.jsx("span",{className:"text-sm text-white",children:a.totalTokens.toLocaleString("pt-BR")})}),e.jsx(l,{children:e.jsxs("span",{className:"font-semibold text-green-400",children:["R$"," ",a.estimatedCost.toLocaleString("pt-BR",{minimumFractionDigits:2})]})}),e.jsx(l,{children:a.lastUsed?e.jsx("span",{className:"text-sm text-gray-400",children:new Date(a.lastUsed).toLocaleDateString("pt-BR")}):e.jsx("span",{className:"text-sm text-gray-500",children:"Nunca"})})]},a.clientId))})]})})]})]})})]})})}export{ae as default};
