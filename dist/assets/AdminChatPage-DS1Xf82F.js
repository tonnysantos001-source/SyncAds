import{j as e}from"./vendor-ui-D8qh2McD.js";import{r as a}from"./vendor-react-X41Bjl18.js";import{i as s,e as t,g as r,B as i,K as o,L as n,v as l,M as c,N as d,O as m,x as h,C as p,c as x,P as g,Q as u,s as b}from"./index-i3b3sNGH.js";import{T as f}from"./textarea-Bhi9zn9b.js";import{S as y}from"./SuperAdminLayout-ra5929iV.js";import{I as v}from"./IconSearch-C91qHzWN.js";import{I as j}from"./IconBrain-qW6XWcXL.js";import{m as w,A as k}from"./vendor-animation-APnkykC6.js";import{h as N,a3 as C,aG as S,aH as I,$ as A,af as M,aI as z,aJ as E,a0 as F,S as _}from"./vendor-icons-CouwLySB.js";import"./vendor-supabase-ChjAI-9u.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-CYpOgAEj.js";const $=s("outline","cloud-computing","CloudComputing",[["path",{d:"M6.657 16c-2.572 0 -4.657 -2.007 -4.657 -4.483c0 -2.475 2.085 -4.482 4.657 -4.482c.393 -1.762 1.794 -3.2 3.675 -3.773c1.88 -.572 3.956 -.193 5.444 1c1.488 1.19 2.162 3.007 1.77 4.769h.99c1.913 0 3.464 1.56 3.464 3.486c0 1.927 -1.551 3.487 -3.465 3.487h-11.878",key:"svg-0"}],["path",{d:"M12 16v5",key:"svg-1"}],["path",{d:"M16 16v4a1 1 0 0 0 1 1h4",key:"svg-2"}],["path",{d:"M8 16v4a1 1 0 0 1 -1 1h-4",key:"svg-3"}]]),T=s("outline","code","Code",[["path",{d:"M7 8l-4 4l4 4",key:"svg-0"}],["path",{d:"M17 8l4 4l-4 4",key:"svg-1"}],["path",{d:"M14 4l-4 16",key:"svg-2"}]]),O=s("outline","download","Download",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 11l5 5l5 -5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]),Q=s("outline","photo","Photo",[["path",{d:"M15 8h.01",key:"svg-0"}],["path",{d:"M3 6a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v12a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3v-12z",key:"svg-1"}],["path",{d:"M3 16l5 -5c.928 -.893 2.072 -.893 3 0l5 5",key:"svg-2"}],["path",{d:"M14 14l1 -1c.928 -.893 2.072 -.893 3 0l3 3",key:"svg-3"}]]),D=s("outline","robot","Robot",[["path",{d:"M6 4m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v4a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M12 2v2",key:"svg-1"}],["path",{d:"M9 12v9",key:"svg-2"}],["path",{d:"M15 12v9",key:"svg-3"}],["path",{d:"M5 16l4 -2",key:"svg-4"}],["path",{d:"M15 14l4 2",key:"svg-5"}],["path",{d:"M9 18h6",key:"svg-6"}],["path",{d:"M10 8v.01",key:"svg-7"}],["path",{d:"M14 8v.01",key:"svg-8"}]]),J=s("outline","video","Video",[["path",{d:"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z",key:"svg-0"}],["path",{d:"M3 6m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z",key:"svg-1"}]]);function q({emotion:a="neutral",size:s=48}){const t={thinking:"animate-bounce",happy:"animate-bounce",angry:"animate-shake",neutral:""}[a],r={thinking:{eyebrow:e.jsx("path",{d:"M 10 15 Q 12 10 14 15",stroke:"#000",strokeWidth:"1.5",fill:"none",strokeLinecap:"round"}),mouth:e.jsx("path",{d:"M 12 22 Q 16 24 20 22",stroke:"#000",strokeWidth:"1.5",fill:"none",strokeLinecap:"round"})},happy:{eyebrow:e.jsx("path",{d:"M 10 14 Q 12 12 14 14",stroke:"#000",strokeWidth:"1.5",fill:"none",strokeLinecap:"round"}),mouth:e.jsx("path",{d:"M 11 23 Q 16 26 21 23",stroke:"#000",strokeWidth:"2",fill:"none",strokeLinecap:"round"})},angry:{eyebrow:e.jsx("path",{d:"M 10 16 Q 12 20 14 16",stroke:"#000",strokeWidth:"1.5",fill:"none",strokeLinecap:"round"}),mouth:e.jsx("path",{d:"M 12 23 Q 16 20 20 23",stroke:"#000",strokeWidth:"1.5",fill:"none",strokeLinecap:"round"})},neutral:{eyebrow:e.jsx("path",{d:"M 10 15 Q 12 15 14 15",stroke:"#000",strokeWidth:"1.5",fill:"none",strokeLinecap:"round"}),mouth:e.jsx("path",{d:"M 12 22 Q 16 23 20 22",stroke:"#000",strokeWidth:"1.5",fill:"none",strokeLinecap:"round"})}}[a];return e.jsxs("div",{className:`relative ${t}`,style:{width:s,height:s},children:[e.jsxs("svg",{width:s,height:s,viewBox:"0 0 32 32",className:"drop-shadow-lg",children:[e.jsx("ellipse",{cx:"16",cy:"18",rx:"14",ry:"12",fill:"#00A8E8",stroke:"#0093C7",strokeWidth:"0.5"}),e.jsx("ellipse",{cx:"16",cy:"20",rx:"6",ry:"5",fill:"#F5D5B8",stroke:"#E6C5A0",strokeWidth:"0.5"}),e.jsx("ellipse",{cx:"22",cy:"10",rx:"5",ry:"8",fill:"#00A8E8",stroke:"#0093C7",strokeWidth:"0.5"}),e.jsx("ellipse",{cx:"22",cy:"10",rx:"3",ry:"5",fill:"#F5D5B8"}),e.jsx("ellipse",{cx:"10",cy:"10",rx:"5",ry:"8",fill:"#00A8E8",stroke:"#0093C7",strokeWidth:"0.5"}),e.jsx("ellipse",{cx:"10",cy:"10",rx:"3",ry:"5",fill:"#F5D5B8"}),e.jsx("ellipse",{cx:"12.5",cy:"17",rx:"2.5",ry:"3",fill:"#FFFFFF"}),e.jsx("circle",{cx:"13",cy:"17.5",r:"1.5",fill:"#000"}),e.jsx("circle",{cx:"13.5",cy:"17",r:"0.5",fill:"#FFF"}),e.jsx("ellipse",{cx:"19.5",cy:"17",rx:"2.5",ry:"3",fill:"#FFFFFF"}),e.jsx("circle",{cx:"20",cy:"17.5",r:"1.5",fill:"#000"}),e.jsx("circle",{cx:"20.5",cy:"17",r:"0.5",fill:"#FFF"}),r.eyebrow,e.jsx("ellipse",{cx:"16",cy:"20.5",rx:"1.5",ry:"1",fill:"#000"}),r.mouth,e.jsx("path",{d:"M 20 6 Q 22 4 24 6 Q 22 8 20 6",fill:"#00A8E8",stroke:"#0093C7",strokeWidth:"0.5"}),e.jsx("path",{d:"M 16 4 Q 18 2 20 4 Q 18 6 16 4",fill:"#00A8E8",stroke:"#0093C7",strokeWidth:"0.5"}),e.jsx("path",{d:"M 12 6 Q 10 4 8 6 Q 10 8 12 6",fill:"#00A8E8",stroke:"#0093C7",strokeWidth:"0.5"})]}),"neutral"!==a&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white animate-ping"})]})}if("undefined"!=typeof document){const e=document.createElement("style");e.textContent="\n    @keyframes shake {\n      0%, 100% { transform: translateX(0); }\n      25% { transform: translateX(-2px); }\n      75% { transform: translateX(2px); }\n    }\n    .animate-shake {\n      animation: shake 0.5s ease-in-out infinite;\n    }\n  ",document.head.appendChild(e)}const L={thinking:{icon:j,color:"from-purple-500 to-pink-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",borderColor:"border-purple-200 dark:border-purple-800",message:"Pensando..."},searching:{icon:v,color:"from-blue-500 to-cyan-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800",message:"Pesquisando na internet..."},"generating-image":{icon:Q,color:"from-green-500 to-emerald-500",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800",message:"Gerando imagem..."},"generating-video":{icon:J,color:"from-red-500 to-orange-500",bgColor:"bg-red-50 dark:bg-red-900/20",borderColor:"border-red-200 dark:border-red-800",message:"Gerando v√≠deo..."},coding:{icon:T,color:"from-yellow-500 to-amber-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-200 dark:border-yellow-800",message:"Escrevendo c√≥digo..."},downloading:{icon:O,color:"from-indigo-500 to-purple-500",bgColor:"bg-indigo-50 dark:bg-indigo-900/20",borderColor:"border-indigo-200 dark:border-indigo-800",message:"Preparando download..."},processing:{icon:$,color:"from-teal-500 to-cyan-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",borderColor:"border-teal-200 dark:border-teal-800",message:"Processando..."}},U={sm:{iconSize:16,dotSize:4,spacing:"gap-2",padding:"p-3",textSize:"text-xs"},md:{iconSize:20,dotSize:6,spacing:"gap-3",padding:"p-4",textSize:"text-sm"},lg:{iconSize:24,dotSize:8,spacing:"gap-4",padding:"p-5",textSize:"text-base"}},P=({type:a="thinking",message:s,size:t="md"})=>{const r=L[a],i=U[t],o=r.icon;return e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`\n        ${r.bgColor}\n        ${r.borderColor}\n        ${i.padding}\n        ${i.spacing}\n        rounded-2xl border-2 shadow-lg\n        backdrop-blur-sm\n        flex items-center\n        max-w-md\n      `,children:[e.jsxs(w.div,{className:"relative flex-shrink-0",animate:{rotate:[0,360]},transition:{duration:3,repeat:1/0,ease:"linear"},children:[e.jsx("div",{className:`\n          bg-gradient-to-br ${r.color}\n          rounded-full p-2\n          shadow-lg\n        `,children:e.jsx(o,{size:i.iconSize,className:"text-white",strokeWidth:2.5})}),e.jsx(w.div,{className:`\n            absolute inset-0 bg-gradient-to-br ${r.color}\n            rounded-full opacity-30\n          `,animate:{scale:[1,1.5,1],opacity:[.3,0,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("span",{className:`\n          ${i.textSize}\n          font-medium\n          bg-gradient-to-r ${r.color}\n          bg-clip-text text-transparent\n        `,children:s||r.message}),e.jsx("div",{className:"flex gap-1",children:[0,1,2].map(a=>e.jsx(w.div,{className:`\n                bg-gradient-to-br ${r.color}\n                rounded-full\n              `,style:{width:i.dotSize,height:i.dotSize},animate:{y:[-3,3,-3],opacity:[1,.5,1]},transition:{duration:1,repeat:1/0,ease:"easeInOut",delay:.15*a}},a))})]}),e.jsx(w.div,{animate:{y:[-2,2,-2]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(D,{size:i.iconSize,className:"text-gray-400 dark:text-gray-500",strokeWidth:1.5})})]})},W=({color:a="from-blue-500 to-purple-500"})=>e.jsx("div",{className:"flex gap-2",children:[0,1,2].map(s=>e.jsx(w.div,{className:`w-2 h-2 rounded-full bg-gradient-to-br ${a}`,animate:{scale:[1,1.5,1],opacity:[1,.5,1]},transition:{duration:1,repeat:1/0,ease:"easeInOut",delay:.2*s}},s))});function R({isThinking:a,currentTool:s,reasoning:r,sources:i,status:o="thinking",connectionStatus:n,progress:l,modernStyle:c=!0}){if(!a)return null;const d=()=>{switch(o){case"success":return"happy";case"error":return"angry";default:return"thinking"}},m=()=>{switch(s){case"web_search":return"Pesquisando na internet";case"web_scraping":return"Coletando dados";case"python_exec":return"Executando c√≥digo";case"generate_image":return"Gerando imagem";case"generate_video":return"Gerando v√≠deo";case"create_file":return"Criando arquivo";default:return"Pensando"}},h=()=>{switch(s){case"web_search":return"searching";case"generate_image":return"generating-image";case"generate_video":return"generating-video";case"python_exec":return"coding";case"create_file":return"downloading";case"web_scraping":return"processing";default:return"thinking"}},p=()=>{switch(o){case"success":return"from-green-50 to-emerald-50 border-green-200";case"error":return"from-red-50 to-pink-50 border-red-200";default:return"from-blue-50 to-purple-50 border-blue-200"}};return c?e.jsx(k,{children:e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`mb-4 p-5 bg-gradient-to-br ${p()} rounded-2xl border-2 shadow-xl backdrop-blur-sm`,children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx(w.div,{animate:{y:[0,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(q,{emotion:d(),size:56})}),e.jsx("div",{className:"flex-1",children:e.jsx(P,{type:h(),message:m(),size:"md"})})]}),void 0!==l&&l>0&&e.jsxs(w.div,{initial:{opacity:0,scaleX:0},animate:{opacity:1,scaleX:1},className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Progresso"}),e.jsxs("span",{className:"text-xs font-bold text-blue-600",children:[l,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx(w.div,{className:"h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500",initial:{width:0},animate:{width:`${l}%`},transition:{duration:.5,ease:"easeOut"}})})]}),r&&e.jsx(w.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mb-3 p-4 bg-white/80 dark:bg-gray-800/80 rounded-xl border border-blue-100 dark:border-blue-800 shadow-sm backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-purple-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed",children:r})]})}),i&&i.length>0&&e.jsxs(w.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{className:"h-4 w-4 text-blue-500"}),e.jsx("p",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400",children:"Fontes consultadas:"})]}),e.jsx("div",{className:"grid gap-2",children:i.map((a,s)=>e.jsxs(w.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1*s},className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400 bg-white/60 dark:bg-gray-800/60 rounded-lg px-3 py-2 backdrop-blur-sm",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"}),e.jsx("span",{className:"truncate flex-1",children:a})]},s))})]}),n&&e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-4 pt-4 border-t border-blue-200 dark:border-blue-800",children:e.jsx("div",{className:"flex items-center gap-2",children:n.isConnected?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 text-green-500 animate-pulse"}),e.jsxs("span",{className:"text-xs font-medium text-green-600 dark:text-green-400",children:[n.platform," conectado"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 text-red-500"}),e.jsxs("span",{className:"text-xs font-medium text-red-600 dark:text-red-400",children:[n.platform," n√£o conectado"]})]})})})]})}):e.jsxs("div",{className:`mb-4 p-4 bg-gradient-to-r ${p()} rounded-lg border`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"relative flex-shrink-0 flex items-center justify-center",children:e.jsx(q,{emotion:d(),size:48})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(t,{variant:"secondary",className:"gap-2",children:[(()=>{switch(s){case"web_search":return e.jsx(_,{className:"h-4 w-4"});case"web_scraping":return e.jsx(F,{className:"h-4 w-4"});case"python_exec":return e.jsx(E,{className:"h-4 w-4"});case"generate_image":return e.jsx(z,{className:"h-4 w-4"});case"generate_video":return e.jsx(M,{className:"h-4 w-4"});case"create_file":return e.jsx(A,{className:"h-4 w-4"});default:return e.jsx(N,{className:"h-4 w-4"})}})(),m(),e.jsx(W,{})]})}),r&&e.jsx("div",{className:"mb-3 p-3 bg-white/60 rounded-lg border border-blue-100",children:e.jsx("p",{className:"text-sm text-gray-700",children:r})}),i&&i.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Fontes consultadas:"}),i.map((a,s)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(C,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:a})]},s))]})]})]}),n&&e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200",children:e.jsx("div",{className:"flex items-center gap-2",children:n.isConnected?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-3 w-3 text-green-500"}),e.jsxs("span",{className:"text-xs text-gray-600",children:[n.platform," conectado"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-3 w-3 text-red-500"}),e.jsxs("span",{className:"text-xs text-gray-600",children:[n.platform," n√£o conectado"]})]})})})]})}function X(){const{toast:s}=r(),[v,j]=a.useState([]),[w,k]=a.useState(""),[N,C]=a.useState(!1),[S,I]=a.useState(null),[A,M]=a.useState([]),[z,E]=a.useState(!0),F=a.useRef(null),[_,$]=a.useState(null),[T,O]=a.useState(""),[Q,D]=a.useState([]),J=async()=>{try{const{data:{user:e}}=await b.auth.getUser();if(!e)return;const{data:a,error:s}=await b.from("ChatConversation").select("id, title, createdAt, updatedAt").eq("userId",e.id).order("updatedAt",{ascending:!1}).limit(20);if(s)throw s;M(a||[])}catch(e){}},q=async e=>{try{const{data:a,error:s}=await b.from("ChatMessage").select("id, role, content, createdAt").eq("conversationId",e).order("createdAt",{ascending:!0});if(s)throw s;const t=(a||[]).map(e=>({id:e.id,role:e.role,content:e.content,timestamp:new Date(e.createdAt)}));j(t),I(e)}catch(a){s({title:"Erro",description:"N√£o foi poss√≠vel carregar mensagens.",variant:"destructive"})}};a.useEffect(()=>{(async()=>{try{const{data:{user:e},error:a}=await b.auth.getUser();if(a||!e)return s({title:"Erro de autentica√ß√£o",description:"Voc√™ precisa fazer login novamente.",variant:"destructive"}),void(window.location.href="/login-v2");await J();const{data:t,error:r}=await b.from("ChatConversation").select("id, title, createdAt, updatedAt").eq("userId",e.id).order("updatedAt",{ascending:!1}).limit(1).single();t&&(I(t.id),await q(t.id))}catch(e){}})()},[]),a.useEffect(()=>{F.current?.scrollIntoView({behavior:"smooth"})},[v]);const L=async()=>{if(!w.trim()||N||!S)return;const e=w.trim();k(""),C(!0);try{if(!S)throw new Error("Conversa n√£o inicializada");const a=S,s={id:`temp-${Date.now()}`,role:"USER",content:e,timestamp:new Date};j(e=>[...e,s]);const t=function(e){const a=e.toLowerCase();return a.includes("conecte facebook")||a.includes("conecte o facebook")||a.includes("facebook ads")?"facebook":a.includes("conecte google")||a.includes("google ads")?"google":a.includes("conecte linkedin")?"linkedin":a.includes("conecte tiktok")?"tiktok":null}(e),r=await(async(e,a)=>{try{const s=e.toLowerCase();let t=null,r="";if(s.includes("pesquis")||s.includes("busca")||s.includes("google")||s.includes("internet")){t="web_search";let a=e;if(s.includes("pesquis")){const s=e.match(/pesquis[ae]\s+(.+)/i);a=s?s[1]:e}r=`Pesquisando na web sobre: "${a}"`,$("web_search"),O(r),D(["Google Search","Exa AI","Tavily"])}else if(s.includes("baix")||s.includes("rasp")||s.includes("scrape")){t="web_scraping";const a=e.match(/https?:\/\/[^\s]+/i),s=a?a[0]:"URL n√£o especificada";r=`Raspando dados de: ${s}`,$("web_scraping"),O(r),D([s])}else s.includes("python")||s.includes("calcule")||s.includes("execute c√≥digo")?(t="python_exec",r="Executando c√≥digo Python para processar dados...",$("python_exec"),O(r)):($(null),O("Processando sua solicita√ß√£o..."),D([]));const{data:{session:i}}=await b.auth.getSession();if(!i)throw new Error("N√£o autenticado");const o="https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/chat-enhanced",n=v.map(e=>({role:e.role.toLowerCase(),content:e.content})),l=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92c2tlcHFnZ214bGZja3hxZ2JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4MjQ4NTUsImV4cCI6MjA3NjQwMDg1NX0.UdNgqpTN38An6FuoJPZlj_zLkmAqfJQXb6i1DdTQO_E"},body:JSON.stringify({message:e,conversationId:a,conversationHistory:n,systemPrompt:void 0})});if(!l.ok){const e=await l.json();throw new Error(e.error||"Erro ao processar mensagem")}const c=await l.json();return c.error?`‚ö†Ô∏è ${c.response||c.error}`:c.response&&"Sem resposta da IA"!==c.response?($(null),O(""),D([]),c.response):"‚ö†Ô∏è IA n√£o configurada ou sem resposta. Configure uma IA em Configura√ß√µes > IA Global."}catch(s){return $(null),O(""),D([]),`‚ùå Erro: ${s.message}`}})(e,a),i={id:`temp-${Date.now()+1}`,role:"ASSISTANT",content:r,timestamp:new Date,metadata:t?{oauthAction:{platform:t,action:"connect"}}:void 0};j(e=>[...e,i])}catch(a){const e={id:`error-${Date.now()}`,role:"ASSISTANT",content:`‚ùå ERRO DETALHADO:\n\n${a.message}\n\n${a.stack||"Sem stack trace"}\n\n${JSON.stringify(a,null,2)}`,timestamp:new Date};j(a=>[...a,e]),s({title:"Erro ao processar",description:a.message,variant:"destructive"})}finally{C(!1)}};return e.jsx(y,{children:e.jsxs("div",{className:"h-[calc(100vh-80px)] flex",children:[e.jsxs("div",{className:(z?"w-72":"w-0")+" transition-all duration-300 bg-gray-900/50 border-r border-gray-700/50 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-300",children:"Conversas"}),e.jsx(i,{onClick:()=>E(!1),variant:"ghost",size:"sm",className:"h-7 w-7 p-0",children:e.jsx(o,{className:"h-4 w-4"})})]}),e.jsxs(i,{onClick:async()=>{try{const{data:{user:e}}=await b.auth.getUser();if(!e)return;const a=crypto.randomUUID(),t=(new Date).toISOString(),{error:r}=await b.from("ChatConversation").insert({id:a,userId:e.id,title:"üÜï Nova Conversa",createdAt:t,updatedAt:t});if(r)throw r;j([]),I(a),await J(),s({title:"‚úÖ Nova conversa criada!",description:"Comece um novo chat do zero."})}catch(e){s({title:"Erro",description:e.message||"N√£o foi poss√≠vel criar nova conversa.",variant:"destructive"})}},className:"w-full gap-2",size:"sm",children:[e.jsx(n,{className:"h-4 w-4"}),"Nova Conversa"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:A.map(a=>e.jsxs("div",{className:"group relative flex items-center gap-2 p-3 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors "+(S===a.id?"bg-blue-50 border border-blue-200":"bg-white"),onClick:()=>q(a.id),children:[e.jsx(l,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.title}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(a.updatedAt).toLocaleDateString("pt-BR")})]}),e.jsx(i,{onClick:e=>{e.stopPropagation(),(async e=>{try{await b.from("ChatMessage").delete().eq("conversationId",e),await b.from("ChatConversation").delete().eq("id",e),S===e&&(j([]),I(null)),await J(),s({title:"‚úÖ Conversa deletada!",description:"Conversa removida com sucesso."})}catch(a){s({title:"Erro",description:"N√£o foi poss√≠vel deletar conversa.",variant:"destructive"})}})(a.id)},variant:"ghost",size:"sm",className:"h-7 w-7 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(c,{className:"h-3.5 w-3.5 text-red-500"})})]},a.id))})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"border-b border-gray-700/50 bg-gray-900/50 backdrop-blur-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[!z&&e.jsx(i,{onClick:()=>E(!0),variant:"ghost",size:"sm",className:"h-9 w-9 p-0",children:e.jsx(d,{className:"h-5 w-5"})}),e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-500",children:e.jsx(m,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Chat Administrativo"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Chat com IA"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(i,{onClick:async()=>{if(S)try{await b.from("ChatMessage").delete().eq("conversationId",S),j([]),s({title:"‚úÖ Mensagens limpas!",description:"Chat limpo com sucesso."})}catch(e){s({title:"Erro",description:"N√£o foi poss√≠vel limpar mensagens.",variant:"destructive"})}},variant:"outline",size:"sm",className:"gap-2 hover:bg-red-50 hover:border-red-300",children:[e.jsx(c,{className:"h-4 w-4 text-red-500"}),"Limpar Chat"]}),e.jsxs(t,{className:"bg-gradient-to-r from-green-500 to-emerald-500",children:[e.jsx(h,{className:"h-3 w-3 mr-1"}),"Online"]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[v.map(a=>e.jsx("div",{className:"flex "+("USER"===a.role?"justify-end":"justify-start"),children:e.jsx(p,{className:"max-w-[80%] "+("USER"===a.role?"bg-gradient-to-r from-blue-500 to-purple-500 text-white":"SYSTEM"===a.role?"bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200":"bg-white"),children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-2",children:["ASSISTANT"===a.role&&e.jsx(m,{className:"h-5 w-5 text-blue-600 mt-1 flex-shrink-0"}),"SYSTEM"===a.role&&e.jsx(h,{className:"h-5 w-5 text-amber-600 mt-1 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"whitespace-pre-wrap break-words text-sm "+("USER"===a.role?"text-white":"text-gray-900"),children:a.content}),a.metadata?.oauthAction&&e.jsxs(i,{onClick:()=>(async e=>{try{const{data:{user:a}}=await b.auth.getUser();if(!a)throw new Error("Usu√°rio n√£o autenticado");const t="https://ovskepqggmxlfckxqgbr.supabase.co/functions/v1/oauth-init",{data:{session:r}}=await b.auth.getSession();if(!r)throw new Error("N√£o autenticado");const i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92c2tlcHFnZ214bGZja3hxZ2JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4MjQ4NTUsImV4cCI6MjA3NjQwMDg1NX0.UdNgqpTN38An6FuoJPZlj_zLkmAqfJQXb6i1DdTQO_E"},body:JSON.stringify({platform:e,redirectUrl:`${window.location.origin}/integrations/callback`})});if(!i.ok)throw new Error("Erro ao iniciar OAuth");const{authUrl:o}=await i.json();window.open(o,"_blank"),s({title:"üîó Autoriza√ß√£o Necess√°ria",description:`Abra a nova aba para autorizar ${e}`})}catch(a){s({title:"Erro ao conectar",description:a.message,variant:"destructive"})}})(a.metadata.oauthAction.platform),className:"mt-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",size:"sm",children:["Conectar ",a.metadata.oauthAction.platform]})]})]}),e.jsx("div",{className:"text-xs mt-2 "+("USER"===a.role?"text-white/70":"text-gray-400"),children:a.timestamp.toLocaleTimeString("pt-BR")})]})})},a.id)),N&&e.jsx(R,{isThinking:N,currentTool:_,reasoning:T,sources:Q}),N&&e.jsx("div",{className:"flex justify-start",children:e.jsx(p,{className:"bg-gray-800/50 border-gray-700",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4 animate-spin text-blue-600"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Processando..."})]})})})}),e.jsx("div",{ref:F})]}),e.jsx("div",{className:"border-t border-gray-700/50 p-4 bg-gray-900/50 backdrop-blur-xl",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{value:w,onChange:e=>k(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),L())},placeholder:"Digite seu comando... (Ex: '/help', 'quantos usu√°rios temos?', '/stats')",className:"min-h-[60px] resize-none",disabled:N}),e.jsx(i,{onClick:L,disabled:!w.trim()||N||!S,className:"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",size:"lg",children:N?e.jsx(g,{className:"h-5 w-5 animate-spin"}):e.jsx(u,{className:"h-5 w-5"})})]})})]})]})})}export{X as default};
