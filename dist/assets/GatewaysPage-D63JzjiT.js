import{j as e}from"./vendor-ui-DAyDU-p2.js";import{r as s}from"./vendor-react-BDwqAlkB.js";import{s as a,_ as t,$ as r,a0 as i,g as o,f as n,B as c,a1 as l,I as d,C as u,a as m,b as g,v as y,c as p,a2 as x,a3 as h,d as b,e as v,a4 as j}from"./index-Bc1oLC4s.js";import{L as f}from"./label-D9dueHBS.js";import{D as w,e as N,a as C,b as A,c as E,d as M,f as I}from"./dialog-CRcRZQv9.js";import{S as R,a as S,b as T,c as P,d as K}from"./select-DU-a5icj.js";import{S as k}from"./SuperAdminLayout-DHtcfpG2.js";import{m as O}from"./vendor-animation-x8f1c1kX.js";import"./vendor-supabase-rKXMzPQL.js";import"./vendor-utils-Dl0_yMKq.js";import"./vendor-query-D3VdSFIC.js";import"./vendor-icons-CzCc3fGi.js";const D={async list(e){try{let s=a.from("Gateway").select("*").eq("isActive",!0).order("isPopular",{ascending:!1}).order("name",{ascending:!0});e?.type&&(s=s.eq("type",e.type)),void 0!==e?.isPopular&&(s=s.eq("isPopular",e.isPopular)),void 0!==e?.supportsPix&&(s=s.eq("supportsPix",e.supportsPix)),void 0!==e?.supportsCreditCard&&(s=s.eq("supportsCreditCard",e.supportsCreditCard));const{data:t,error:r}=await s;if(r)throw r;return t}catch(s){throw s}},async getById(e){try{const{data:s,error:t}=await a.from("Gateway").select("*").eq("id",e).single();if(t)throw t;return s}catch(s){throw s}},async getBySlug(e){try{const{data:s,error:t}=await a.from("Gateway").select("*").eq("slug",e).single();if(t)throw t;return s}catch(s){throw s}},async listPopular(){try{const{data:e,error:s}=await a.from("Gateway").select("*").eq("isActive",!0).eq("isPopular",!0).order("name",{ascending:!0});if(s)throw s;return e}catch(e){throw e}}};class _ extends Error{type;userMessage;details;code;statusCode;retryable;constructor(e){super(e.message),this.name="CustomError",this.type=e.type,this.userMessage=e.userMessage,this.details=e.details,this.code=e.code,this.statusCode=e.statusCode||500,this.retryable=e.retryable||!1}}function G(e){return e?.code?function(e){const s=e.code,a=e.message||"";if("PGRST301"===s||a.includes("JWT"))return{type:"SESSION_EXPIRED",message:a,userMessage:"Sua sess√£o expirou. Fa√ßa login novamente.",code:s,statusCode:401,retryable:!1};if("PGRST116"===s||a.includes("not found"))return{type:"NOT_FOUND",message:a,userMessage:"Registro n√£o encontrado.",code:s,statusCode:404,retryable:!1};if("23505"===s||a.includes("duplicate")||a.includes("already exists"))return{type:"DUPLICATE_ENTRY",message:a,userMessage:"Este registro j√° existe.",code:s,statusCode:409,retryable:!1};if(a.includes("permission denied")||a.includes("RLS"))return{type:"FORBIDDEN",message:a,userMessage:"Voc√™ n√£o tem permiss√£o para esta a√ß√£o.",code:s,statusCode:403,retryable:!1};return{type:"DATABASE_ERROR",message:a,userMessage:"Erro ao acessar o banco de dados.",code:s,statusCode:500,retryable:!0}}(e):e?.response?function(e){const s=e.response?.status,a=e.response?.data,t=a?.message||a?.error||e.message;switch(s){case 400:return{type:"VALIDATION_ERROR",message:t,userMessage:"Dados inv√°lidos. Verifique os campos.",statusCode:400,details:a,retryable:!1};case 401:return{type:"UNAUTHORIZED",message:t,userMessage:"Voc√™ precisa fazer login.",statusCode:401,retryable:!1};case 403:return{type:"FORBIDDEN",message:t,userMessage:"Voc√™ n√£o tem permiss√£o para esta a√ß√£o.",statusCode:403,retryable:!1};case 404:return{type:"NOT_FOUND",message:t,userMessage:"Recurso n√£o encontrado.",statusCode:404,retryable:!1};case 409:return{type:"DUPLICATE_ENTRY",message:t,userMessage:"Este registro j√° existe.",statusCode:409,retryable:!1};case 429:return{type:"RATE_LIMIT_EXCEEDED",message:t,userMessage:"Muitas requisi√ß√µes. Aguarde um momento.",statusCode:429,retryable:!0};case 500:case 502:case 503:case 504:return{type:"API_ERROR",message:t,userMessage:"Erro no servidor. Tente novamente em alguns instantes.",statusCode:s,retryable:!0};default:return{type:"API_ERROR",message:t,userMessage:"Erro na comunica√ß√£o com o servidor.",statusCode:s,details:a,retryable:!0}}}(e):e?.message?.includes("fetch")||e?.message?.includes("network")?{type:"NETWORK_ERROR",message:e.message,userMessage:"Erro de conex√£o. Verifique sua internet.",retryable:!0}:e?.message?.includes("timeout")?{type:"TIMEOUT",message:e.message,userMessage:"A opera√ß√£o demorou muito. Tente novamente.",retryable:!0}:e instanceof _?{type:e.type,message:e.message,userMessage:e.userMessage,details:e.details,code:e.code,statusCode:e.statusCode,retryable:e.retryable}:{type:"UNKNOWN_ERROR",message:e?.message||"Erro desconhecido",userMessage:"Algo deu errado. Tente novamente.",details:e,retryable:!1}}const q=new class{logs=[];maxLogs=100;log(e,s){const a={timestamp:(new Date).toISOString(),type:e.type,message:e.message,userMessage:e.userMessage,details:e.details,code:e.code,statusCode:e.statusCode,userId:s?.userId,organizationId:s?.organizationId,url:window.location.href,userAgent:navigator.userAgent};this.logs.unshift(a),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(0,this.maxLogs)),this.sendToSentry(a)}getLogs(e=20){return this.logs.slice(0,e)}clear(){this.logs=[]}sendToSentry(e){t("error_details",{type:e.type,code:e.code,statusCode:e.statusCode,url:e.url}),r(e.userMessage,"error",{type:e.type,code:e.code,statusCode:e.statusCode});const s=new Error(e.message);s.name=e.type,i(s,{type:e.type,code:e.code,statusCode:e.statusCode,userMessage:e.userMessage,details:e.details,userId:e.userId,organizationId:e.organizationId,url:e.url})}};function z(){const{toast:e}=o(),{user:a,organization:t}=n(),r=s.useCallback((s,r)=>{const i=function(e,s){const a=G(e);return q.log(a,s),a}(s,{userId:a?.id,organizationId:t?.id});return e({title:"Erro",description:r||i.userMessage,variant:"destructive"}),i},[e,a,t]),i=s.useCallback(s=>{e({title:"Sucesso",description:s})},[e]),c=s.useCallback(s=>{e({title:"Aten√ß√£o",description:s,variant:"default"})},[e]),l=s.useCallback(s=>{e({title:"Informa√ß√£o",description:s})},[e]),d=s.useCallback(async(e,s)=>{try{const a=s?.retry?()=>async function(e,s={}){const{maxRetries:a=3,delayMs:t=1e3,backoff:r=!0}=s;let i;for(let n=0;n<=a;n++)try{return await e()}catch(o){if(i=o,!G(o).retryable)throw o;if(n===a)break;const e=r?t*Math.pow(2,n):t;await new Promise(s=>setTimeout(s,e))}throw i}(e,s.retry):e,t=await a();return s?.successMessage&&i(s.successMessage),t}catch(a){return r(a,s?.errorMessage),null}},[r,i]);return{showError:r,showSuccess:i,showWarning:c,showInfo:l,executeWithErrorHandling:d}}const L=[{value:"stripe",label:"Stripe",icon:"üí≥"},{value:"mercadopago",label:"Mercado Pago",icon:"üáßüá∑"},{value:"pagseguro",label:"PagSeguro",icon:"üîí"},{value:"paypal",label:"PayPal",icon:"üÖøÔ∏è"},{value:"asaas",label:"Asaas",icon:"üí∞"}];function F(){const{showError:t,executeWithErrorHandling:r}=z(),[i,o]=s.useState([]),[n,_]=s.useState(!1),[G,q]=s.useState(!0),[F,U]=s.useState({name:"",provider:"",publicKey:"",secretKey:""});s.useEffect(()=>{V()},[]);const V=async()=>{q(!0);const e=await r(async()=>{const e=await D.list();return await Promise.all(e.map(async e=>{try{const{count:s}=await a.from("Transaction").select("*",{count:"exact",head:!0}).eq("gatewayId",e.id);return{id:e.id,name:e.name,provider:e.type,publicKey:e.apiKey?.slice(0,20)+"***"||"N/A",isActive:e.isActive,createdAt:e.createdAt,transactionsCount:s||0}}catch{return{id:e.id,name:e.name,provider:e.type,publicKey:e.apiKey?.slice(0,20)+"***"||"N/A",isActive:e.isActive,createdAt:e.createdAt,transactionsCount:0}}}))},{errorMessage:"N√£o foi poss√≠vel carregar os gateways"});e&&o(e),q(!1)},B={total:i.length,active:i.filter(e=>e.isActive).length,totalTransactions:i.reduce((e,s)=>e+(s.transactionsCount||0),0)};return G?e.jsx(k,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsx(k,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(O.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"Gateways de Pagamento"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Gerencie os meios de recebimento dos clientes"})]}),e.jsxs(w,{open:n,onOpenChange:_,children:[e.jsx(N,{asChild:!0,children:e.jsxs(c,{className:"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",children:[e.jsx(l,{className:"h-4 w-4 mr-2"}),"Adicionar Gateway"]})}),e.jsxs(C,{className:"sm:max-w-[500px] bg-gray-900 border-gray-700",children:[e.jsxs(A,{children:[e.jsx(E,{className:"text-white",children:"Adicionar Gateway de Pagamento"}),e.jsx(M,{className:"text-gray-400",children:"Configure um novo meio de recebimento"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"name",className:"text-gray-300",children:"Nome"}),e.jsx(d,{id:"name",placeholder:"Ex: Stripe Principal",value:F.name,onChange:e=>U({...F,name:e.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"provider",className:"text-gray-300",children:"Provider"}),e.jsxs(R,{value:F.provider,onValueChange:e=>U({...F,provider:e}),children:[e.jsx(S,{className:"bg-gray-800 border-gray-700 text-white",children:e.jsx(T,{placeholder:"Selecione um provider"})}),e.jsx(P,{className:"bg-gray-800 border-gray-700",children:L.map(s=>e.jsx(K,{value:s.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.label})]})},s.value))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"publicKey",className:"text-gray-300",children:"Public Key"}),e.jsx(d,{id:"publicKey",placeholder:"pk_test_...",value:F.publicKey,onChange:e=>U({...F,publicKey:e.target.value}),className:"bg-gray-800 border-gray-700 text-white"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"secretKey",className:"text-gray-300",children:"Secret Key"}),e.jsx(d,{id:"secretKey",type:"password",placeholder:"sk_test_...",value:F.secretKey,onChange:e=>U({...F,secretKey:e.target.value}),className:"bg-gray-800 border-gray-700 text-white"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Esta chave ser√° armazenada de forma segura e criptografada"})]})]}),e.jsxs(I,{children:[e.jsx(c,{variant:"outline",onClick:()=>_(!1),className:"border-gray-700 text-gray-300 hover:bg-gray-800",children:"Cancelar"}),e.jsx(c,{className:"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white border-0",onClick:async()=>{if(!(F.name&&F.provider&&F.publicKey&&F.secretKey))return void t(new Error("Campos obrigat√≥rios"),"Preencha todos os campos");await r(async()=>{const{data:e,error:s}=await a.from("Gateway").insert({name:F.name,type:F.provider,apiKey:F.publicKey,secretKey:F.secretKey,isActive:!0,createdAt:(new Date).toISOString()}).select().single();if(s)throw s;return e},{successMessage:`${F.name} foi configurado com sucesso.`,errorMessage:"N√£o foi poss√≠vel adicionar o gateway"})&&(_(!1),U({name:"",provider:"",publicKey:"",secretKey:""}),V())},children:"Adicionar Gateway"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(u,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium text-gray-300",children:"Gateways Configurados"}),e.jsx(y,{className:"h-4 w-4 text-blue-400"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:B.total}),e.jsx("p",{className:"text-xs text-gray-400",children:"Total de meios de pagamento"})]})]})}),e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(u,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium text-gray-300",children:"Gateways Ativos"}),e.jsx(x,{className:"h-4 w-4 text-green-400"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:B.active}),e.jsx("p",{className:"text-xs text-gray-400",children:"Recebendo pagamentos"})]})]})}),e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(u,{className:"border-gray-700/50 bg-gray-900/50 backdrop-blur-xl",children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium text-gray-300",children:"Transa√ß√µes"}),e.jsx(h,{className:"h-4 w-4 text-purple-400"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:B.totalTransactions}),e.jsx("p",{className:"text-xs text-gray-400",children:"Total processadas"})]})]})})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:0===i.length?e.jsx(u,{className:"col-span-full",children:e.jsxs(p,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(CreditCard,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Nenhum gateway configurado"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Adicione seu primeiro gateway de pagamento"}),e.jsxs(c,{className:"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white border-0",onClick:()=>_(!0),children:[e.jsx(l,{className:"h-5 w-5 mr-2"}),"Adicionar Gateway"]})]})}):i.map((s,t)=>{const i=(o=s.provider,L.find(e=>e.value===o)||{label:o,icon:"üí≥"});var o;return e.jsx(O.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},children:e.jsxs(u,{className:"relative overflow-hidden border-gray-700/50 bg-gray-800/50 backdrop-blur-xl",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 transform translate-x-16 -translate-y-16 rounded-full "+(s.isActive?"bg-green-500/10":"bg-gray-500/10")}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:i.icon}),e.jsxs("div",{children:[e.jsx(g,{className:"text-lg text-white",children:s.name}),e.jsx(b,{className:"text-gray-400",children:i.label})]})]}),e.jsx(v,{variant:s.isActive?"default":"outline",children:s.isActive?"Ativo":"Inativo"})]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Public Key"}),e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded block overflow-hidden text-ellipsis",children:s.publicKey})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Transa√ß√µes"}),e.jsx("span",{className:"font-medium text-white",children:s.transactionsCount||0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",className:"flex-1 border-gray-700 hover:bg-gray-700",size:"sm",onClick:()=>{},children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),"Configurar"]}),e.jsx(c,{variant:s.isActive?"destructive":"default",size:"sm",onClick:()=>(async(e,s)=>{await r(async()=>{const{error:t}=await a.from("Gateway").update({isActive:s,updatedAt:(new Date).toISOString()}).eq("id",e);if(t)throw t;return!0},{successMessage:s?"Gateway ativado":"Gateway desativado",errorMessage:"N√£o foi poss√≠vel atualizar o status"})&&V()})(s.id,!s.isActive),children:s.isActive?e.jsx(j,{className:"h-4 w-4"}):e.jsx(x,{className:"h-4 w-4"})})]})]})]})},s.id)})})]})})}export{F as default};
