import{r as n,f as w,s as p,j as a,B as l,I as c,g as A,h as I,i as L,k as P,t as F,l as U,a5 as M,n as B}from"./index-CyI7FNJ-.js";import{T as k,a as V,b as f,c as d,d as H,e as o}from"./table-Bm2d0gWs.js";import{D as $,f as q,a as G,b as J,c as K,d as Q,e as W}from"./dialog-CnYdr2Ox.js";import{L as m}from"./label-BLZJIE26.js";import{S as X,a as Y,b as Z,c as _,d as h}from"./select-Dm1prm-d.js";import{S as E}from"./SuperAdminLayout-BQs65VJu.js";import{P as aa}from"./plus-Dt0_cQJq.js";import"./index-wuPswXnP.js";import"./Logo-DXc3W4ow.js";import"./message-square-DU3TkHtD.js";import"./dollar-sign-DElrT58V.js";function xa(){const[v,N]=n.useState([]),[S,b]=n.useState(!0),[g,T]=n.useState(""),[z,u]=n.useState(!1),{toast:x}=w(),[s,i]=n.useState({name:"",slug:"",plan:"FREE",maxUsers:2,maxCampaigns:5,maxChatMessages:100});n.useEffect(()=>{j()},[]);const j=async()=>{try{const{data:e,error:r}=await p.from("Organization").select("*").order("createdAt",{ascending:!1});if(r)throw r;N(e||[])}catch(e){x({title:"Erro ao carregar organizaÃ§Ãµes",description:e.message,variant:"destructive"})}finally{b(!1)}},R=async()=>{try{const{error:e}=await p.from("Organization").insert({name:s.name,slug:s.slug,plan:s.plan,status:"TRIAL",maxUsers:s.maxUsers,maxCampaigns:s.maxCampaigns,maxChatMessages:s.maxChatMessages,trialEndsAt:new Date(Date.now()+12096e5).toISOString()});if(e)throw e;x({title:"âœ… OrganizaÃ§Ã£o criada!",description:`${s.name} foi criada com sucesso.`}),u(!1),j(),i({name:"",slug:"",plan:"FREE",maxUsers:2,maxCampaigns:5,maxChatMessages:100})}catch(e){x({title:"Erro ao criar organizaÃ§Ã£o",description:e.message,variant:"destructive"})}},C=async(e,r)=>{try{const{error:t}=await p.from("Organization").update({status:r}).eq("id",e);if(t)throw t;x({title:"Status atualizado",description:`OrganizaÃ§Ã£o ${r==="ACTIVE"?"ativada":"suspensa"}.`}),j()}catch(t){x({title:"Erro ao atualizar status",description:t.message,variant:"destructive"})}},y=v.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())||e.slug.toLowerCase().includes(g.toLowerCase())),D=e=>{const r={ACTIVE:{variant:"default",label:"Ativa"},TRIAL:{variant:"secondary",label:"Trial"},SUSPENDED:{variant:"destructive",label:"Suspensa"},CANCELLED:{variant:"outline",label:"Cancelada"}},t=r[e]||r.TRIAL;return a.jsx(B,{variant:t.variant,children:t.label})},O=e=>{const r={FREE:"bg-gray-100 text-gray-800",STARTER:"bg-blue-100 text-blue-800",PRO:"bg-purple-100 text-purple-800",ENTERPRISE:"bg-emerald-100 text-emerald-800"};return a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${r[e]||r.FREE}`,children:e})};return S?a.jsx(E,{children:a.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-76px)]",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})})}):a.jsx(E,{children:a.jsxs("div",{className:"p-8",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"OrganizaÃ§Ãµes"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Gerenciar todos os clientes do sistema"})]}),a.jsxs($,{open:z,onOpenChange:u,children:[a.jsx(q,{asChild:!0,children:a.jsxs(l,{children:[a.jsx(aa,{className:"h-4 w-4 mr-2"}),"Nova OrganizaÃ§Ã£o"]})}),a.jsxs(G,{className:"sm:max-w-[500px]",children:[a.jsxs(J,{children:[a.jsx(K,{children:"Nova OrganizaÃ§Ã£o"}),a.jsx(Q,{children:"Criar uma nova organizaÃ§Ã£o cliente no sistema"})]}),a.jsxs("div",{className:"grid gap-4 py-4",children:[a.jsxs("div",{className:"grid gap-2",children:[a.jsx(m,{htmlFor:"name",children:"Nome da OrganizaÃ§Ã£o"}),a.jsx(c,{id:"name",placeholder:"Ex: Acme Inc",value:s.name,onChange:e=>i({...s,name:e.target.value})})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(m,{htmlFor:"slug",children:"Slug (URL)"}),a.jsx(c,{id:"slug",placeholder:"acme-inc",value:s.slug,onChange:e=>i({...s,slug:e.target.value})})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(m,{htmlFor:"plan",children:"Plano"}),a.jsxs(X,{value:s.plan,onValueChange:e=>i({...s,plan:e}),children:[a.jsx(Y,{children:a.jsx(Z,{})}),a.jsxs(_,{children:[a.jsx(h,{value:"FREE",children:"FREE"}),a.jsx(h,{value:"STARTER",children:"STARTER"}),a.jsx(h,{value:"PRO",children:"PRO"}),a.jsx(h,{value:"ENTERPRISE",children:"ENTERPRISE"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"grid gap-2",children:[a.jsx(m,{htmlFor:"maxUsers",children:"Max Users"}),a.jsx(c,{id:"maxUsers",type:"number",value:s.maxUsers,onChange:e=>i({...s,maxUsers:parseInt(e.target.value)})})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(m,{htmlFor:"maxCampaigns",children:"Max Campanhas"}),a.jsx(c,{id:"maxCampaigns",type:"number",value:s.maxCampaigns,onChange:e=>i({...s,maxCampaigns:parseInt(e.target.value)})})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsx(m,{htmlFor:"maxChatMessages",children:"Max Msgs"}),a.jsx(c,{id:"maxChatMessages",type:"number",value:s.maxChatMessages,onChange:e=>i({...s,maxChatMessages:parseInt(e.target.value)})})]})]})]}),a.jsxs(W,{children:[a.jsx(l,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),a.jsx(l,{onClick:R,children:"Criar OrganizaÃ§Ã£o"})]})]})]})]}),a.jsxs(A,{children:[a.jsx(I,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(L,{children:"Todas as OrganizaÃ§Ãµes"}),a.jsxs(P,{children:[v.length," organizaÃ§Ãµes cadastradas"]})]}),a.jsxs("div",{className:"relative w-64",children:[a.jsx(F,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-500"}),a.jsx(c,{placeholder:"Buscar organizaÃ§Ãµes...",className:"pl-8",value:g,onChange:e=>T(e.target.value)})]})]})}),a.jsx(U,{children:a.jsxs(k,{children:[a.jsx(V,{children:a.jsxs(f,{children:[a.jsx(d,{children:"OrganizaÃ§Ã£o"}),a.jsx(d,{children:"Plano"}),a.jsx(d,{children:"Status"}),a.jsx(d,{children:"Limites"}),a.jsx(d,{children:"Criada em"}),a.jsx(d,{className:"text-right",children:"AÃ§Ãµes"})]})}),a.jsx(H,{children:y.map(e=>a.jsxs(f,{children:[a.jsx(o,{children:a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:e.name}),a.jsx("div",{className:"text-sm text-gray-500",children:e.slug})]})}),a.jsx(o,{children:O(e.plan)}),a.jsx(o,{children:D(e.status)}),a.jsx(o,{children:a.jsxs("div",{className:"text-sm",children:[a.jsxs("div",{children:["ðŸ‘¥ ",e.maxUsers," users"]}),a.jsxs("div",{children:["ðŸŽ¯ ",e.maxCampaigns," campanhas"]}),a.jsxs("div",{children:["ðŸ’¬ ",e.maxChatMessages," msgs"]})]})}),a.jsx(o,{children:new Date(e.createdAt).toLocaleDateString("pt-BR")}),a.jsx(o,{className:"text-right",children:a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.status==="SUSPENDED"?a.jsx(l,{size:"sm",variant:"outline",onClick:()=>C(e.id,"ACTIVE"),children:"Ativar"}):a.jsx(l,{size:"sm",variant:"outline",onClick:()=>C(e.id,"SUSPENDED"),children:"Suspender"}),a.jsx(l,{size:"sm",variant:"ghost",children:a.jsx(M,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]})})}export{xa as default};
